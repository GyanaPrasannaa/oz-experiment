// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},s=function(e,t){return function(){return e.apply(t,arguments)}};n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return i(t,e),t.prototype.defaults={lang:null,strings:null},t}(Backbone.Model),t=function(){function e(){this.get=s(this.get,this),this.loadBackup=s(this.loadBackup,this),this.onSuccess=s(this.onSuccess,this),_.extend(this,Backbone.Events),this.lang=(navigator.language||navigator.userLanguage).toLowerCase(),$.ajax({url:"/api/localisation/desktop/"+this.lang,dataType:"json",success:this.onSuccess,error:this.loadBackup}),null}return e.prototype.lang=null,e.prototype.data=null,e.prototype.onSuccess=function(e){var t;return t=null,e.responseText?t=JSON.parse(e.responseText):t=e,this.data=new n(t),this.trigger("complete"),null},e.prototype.loadBackup=function(){var e=this;return $.ajax({url:"/locale/en/strings.txt",dataType:"text",complete:this.onSuccess,error:function(){return console.log("error on loading backup")}}),null},e.prototype.get=function(e){return this.data.get("strings")[e]||""},e}(),e=function(){function r(){this.onError=s(this.onError,this),this.onSuccess=s(this.onSuccess,this),this.compare=s(this.compare,this),this.browser=BrowserDetect.browser,this.browserVersion=BrowserDetect.version}var e,t,n;return e=null,t=null,n=Modernizr.webgl,r.prototype.init=function(){return this.compare()},r.prototype.compare=function(){var e;if(this.browser==="Chrome"&&n)return this.onSuccess();if(this.browser==="Chrome"&&!n)return this.onError({message:"Chrome_NoWebGL_message",buttons:["Chrome_NoWebGL_button1","Chrome_NoWebGL_button2"]});if(this.browser==="Firefox"&&n)return this.onError({message:"FF4_Safari_WebGLmessage",buttons:["FF4_Safari_WebGL_button1","FF4_Safari_WebGL_button2"]});if(this.browser==="Firefox"&&!n)return this.onError({message:"FF4_noWebGL_message",buttons:["FF4_noWebGL_button1","FF4_noWebGL_button2"]});if(this.browser==="Explorer"&&(this.browserVersion===6||this.browserVersion===7||this.browserVersion===8||this.browserVersion===9))return this.onError({message:"Explorer_OldVersion_message",buttons:["Explorer_OldVersion_button1"]});if(this.browser==="Safari"&&n)return this.onError({message:"FF4_Safari_WebGLmessage",buttons:["FF4_Safari_WebGL_button1","FF4_Safari_WebGL_button2"]});if(this.browser==="Safari"&&!n)return this.onError({message:"Safari_message",buttons:["Safari_button1"]});window.WebGLRenderingContext||this.onError({message:"NoWebGLRenderingContext_message",buttons:["NoWebGLRenderingContext_button1","NoWebGLRenderingContext_button2"]}),e=canvas.getContext("webgl");if(!e)return this.onError({message:"NoWebGL_message",buttons:["NoWebGL_button1","NoWebGL_button2"]})},r.prototype.onSuccess=function(){return this.onError({message:"Chrome_NoWebGL_message",buttons:["Chrome_NoWebGL_button1","Chrome_NoWebGL_button2"]})},r.prototype.onError=function(e){},r}(),$(function(){var n,r,i=this;return window.error={},window.detection=new e,window.errorMessage={},window.detection.onSuccess=function(){return $("#detect").remove(),$(".qualityCheck").css({display:"table"}),$(".qualityCheck").animate({opacity:1},1e3),navigator.appVersion.indexOf("Win")!==-1&&$(".qualityCheck").find(".settings_button").each(function(e,t){return $(t).css({padding:"7px 20px 8px 20px"})}),$(".low_quality").click(onLowClick),$(".high_quality").click(onHighClick)},window.onQuality=function(){var e;return e=document.createElement("script"),e.type="text/javascript",e.src="/js/r.js",$("head").append(e)},window.onLowClick=function(){return $(".qualityCheck").find(".settings_button").each(function(e,t){return $(t).css({cursor:"default"}),$(t).click(null)}),(window||document).textureQuality="low",(window||document).displayQuality="med",(window||document).dof=!1,$(".qualityCheck").animate({opacity:0},1e3,window.onCompleteAnim)},window.onHighClick=function(){return $(".qualityCheck").find(".settings_button").each(function(e,t){return $(t).css({cursor:"default"}),$(t).click(null)}),(window||document).textureQuality="med",(window||document).displayQuality="hi",(window||document).dof=!0,$(".qualityCheck").animate({opacity:0},1e3,window.onCompleteAnim)},window.onCompleteAnim=function(){return $(".qualityCheck").remove(),$("#polite").css({display:"table"}),onQuality()},window.detection.onError=function(e){return window.errorMessage=e,window.error.locale=new t,window.error.locale.on("complete",window.fallbackTemplate)},window.fallbackTemplate=function(e){var t,n,r,i,s,o,u;$("#detect").css({display:"table"}),$("#detect .title").html(window.error.locale.get("homeTitle")),$("#detect .errorMessage span").html(window.error.locale.get(window.errorMessage.message)),o=window.errorMessage.buttons,u=[];for(i=0,s=o.length;i<s;i++)n=o[i],window.showTechOrTrailer(n)?(r=window.error.locale.get(n+"_url"),t=$("<a/>"),t.css({"text-decoration":"none"}),r==="_!_tryanyway"?t.click(window.tryAnyway):t.attr({href:r,target:"_blank"}),t.html("<button class='abstractbutton'>"+window.error.locale.get(n)+"</button>"),$("#detect .btnContainer").append(t),$("#detect .btnContainer").append("<br>"),navigator.appVersion.indexOf("Win")!==-1?u.push($(t).css({padding:"7px 20px 8px 20px"})):u.push(void 0)):u.push(void 0);return u},window.showTechOrTrailer=function(e){return e.indexOf("Chrome_NoWebGL_button")>-1?!1:e.indexOf("FF4_noWebGL_button")>-1?!1:e.indexOf("NoWebGLRenderingContext_button")>-1?!1:e.indexOf("NoWebGL_button")>-1?!1:!0},window.tryAnyway=function(e){return e.preventDefault(),window.detection.onSuccess()},n=new Image,n.src="/img/home/interface_1x.png",window.devicePixelRatio===2&&(r=new Image,r.src="/img/home/interface_2x.png"),window.detection.init()})}).call(this);