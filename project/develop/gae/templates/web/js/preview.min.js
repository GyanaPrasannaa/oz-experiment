// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C={}.hasOwnProperty,k=function(e,t){function r(){this.constructor=e}for(var n in t)C.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},L=function(e,t){return function(){return e.apply(t,arguments)}};s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.defaults={frames:null,animations:null,images:null},t.prototype.id=null,t}(Backbone.Model),u=function(e){function t(){return this.getImage=L(this.getImage,this),this.get=L(this.get,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.model=s,t.prototype.fullSize=null,t.prototype.image=null,t.prototype.image2=null,t.prototype.image1FullSize=null,t.prototype.image2FullSize=null,t.prototype.get=function(e){var t;return t={},t.frame=this.at(0).get("animations")[e][0],t.coord=this.at(0).get("frames")[t.frame],t.x=t.coord[0],t.y=t.coord[1],t.width=t.coord[2],t.height=t.coord[3],t},t.prototype.getImage=function(){var e,t;return e="/img/preview/"+this.at(0).get("images"),t={},t.image=e.replace(".png","_1x.png"),window.devicePixelRatio===2&&(t.image2=e.replace(".png","_2x.png")),t},t}(Backbone.Collection),g=function(){function e(){}return e.data=null,e.playing=!1,e.animationTimer=null,e.animationDuration=1e3/3,e.initialize=function(t){return e.data=t,e.playing||e.play(),null},e.toggle=function(){return e.playing?e.stop():e.play(),null},e.play=function(t){return e.playing=!0,e.playAudioLoop(t),null},e.stop=function(){return e.playing=!1,e.stopAudioLoop(),null},e.playAudioLoop=function(t){var n;return n=e.animationDuration,t?e.colNo=t:e.colNo=e.data.cols.length/2,e.doLoopAudio(),e.loopAudio=setInterval(e.doLoopAudio,n),null},e.doLoopAudio=function(t){var n,r,i;t==null&&(t=e.data.cols.length-1),e.colNo>t&&(e.colNo=0),n=e.data.cols[e.colNo],r=0;while(r<n.rows.length)i=n.rows[r],e.playSound(e.colNo,i),r++;r=0;while(r<e.data.loops.length)e.playLoopSound(e.data.loops[r]),r++;return e.colNo++,null},e.playLoopSound=function(t){var n;return n="",t.step?e.colNo%t.step===0&&(n=t.event):t.col!=null&&e.colNo===t.col&&(n=t.event),n!==""&&S.send(t.event),null},e.stopAudioLoop=function(){return clearInterval(e.loopAudio),null},e.playSound=function(t,n){return S.send(e.getSoundEvent(t,n)),null},e.getSoundEvent=function(t,n){return e.data.notes[e.data.dimensions.lines-1-n].event},e.transitionTo=function(t,n,r){var i;return S.userLoopLonger=r,t?(e.data=r,i=n<12?n+12+r.dimensions.cols/2:n-12+r.dimensions.cols/2,e.play(i)):e.initialize(r),null},e}.call(this),S=function(){function e(){}return e.xmlLink=null,e.mp3link=null,e.swfLink=null,e.loaded=!1,e.progress=0,e.holding=[],e.userPaused=!1,e.userLoop=null,e.userLoopLonger=null,e.active=!1,e.onBatchComplete=null,e.prototype.batchLoaded=!1,e.init=function(t){return t?(e.xmlLink="http://soundcontroller.se/unit9/oz/config.xml",e.mp3link="http://soundcontroller.se/unit9/oz/mp3s/",e.swfLink="http://soundcontroller.se/unit9/oz/",require(["http://soundcontroller.se/unit9/oz/scsound.js"],e.onLibLoaded)):(e.xmlLink="/sounds/config.xml",e.mp3link="/sounds/",e.swfLink="/sounds/",require(["/js/vendor/scsound.js"],e.onLibLoaded))},e.onLibLoaded=function(){return e.active?SCSound.initialize(e.xmlLink,e.mp3link,e.swfLink,e.onloadcomplete,e.onloadprogress,e.onbatchloaded):e.progress=100},e.onloadprogress=function(t){return e.progress=Math.round(t.toFixed(2)*100)},e.onloadcomplete=function(){return e.loaded=!0},e.onbatchloaded=function(){if(e.onBatchComplete!=null)return typeof e.onBatchComplete!="string"?(e.send(e.onBatchComplete[0]),e.onBatchComplete=e.onBatchComplete[1]):(e.send(e.onBatchComplete),e.onBatchComplete!=="musicbox_shared"?e.playBackgroundMusic():e.batchLoaded=!0,e.onBatchComplete=null)},e.send=function(t,n){n!=null&&(e.onBatchComplete=n);if(e.active)return e.loaded?SCSound.send(t):e.holding.push(t)},e.paused=function(t){if(e.userPaused)return;return e.userPaused=t,e.send("sound_off")},e.resume=function(t){t==null&&(t=!1);if(t){e.userPaused=!1,e.send("sound_on");return}if(e.userPaused)return;return e.userPaused=!1,e.send("sound_on")},e.oz=function(){return(window||document).oz},e.playBackgroundMusic=function(){return e.userLoop?g.initialize(e.userLoopLonger):g.initialize(JSON.parse(e.oz().baseAssets.get("loopbg").result))},e.preview=function(e){return g.initialize(e)},e.stopBackgroundMusic=function(){return g.stop()},e.transition=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v;r=JSON.parse(e.oz().baseAssets.get("loopbg").result),c=e.userLoop,s=[];for(u=h=0,d=r.dimensions.cols;0<=d?h<d:h>d;u=0<=d?++h:--h)s[u]={rows:[]};for(u=p=0,v=c.cols.length;0<=v?p<v:p>v;u=0<=v?++p:--p){o=c.cols[u],a=0,i=u<12?u+c.dimensions.cols/2:u-c.dimensions.cols/2,l=[];while(a<o.rows.length)f=o.rows[a],a++,l.push(f);s[i+r.dimensions.cols/2]={rows:l}}return r.cols=s,g.transitionTo(t,n,r)},e}.call(this),d=function(){function e(){}return e.lerp=function(e,t,n){return t+(n-t)*e},e.norm=function(e,t,n){return(e-t)/(n-t)},e.map=function(t,n,r,i,s){return e.lerp(e.norm(t,n,r),i,s)},e}.call(this),n=function(e){function t(){return this.oz=L(this.oz,this),this.initialize=L(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.initialize=function(){return this.setElement($("body")),console.log("LKASJDLKJSAD"),this.header=new h,this.$el.append(this.header.$el),window.location.href.indexOf(":8888")>-1?this.thumb=new x("1.jpeg"):this.thumb=new x(this.getImageId()),this.container=this.$el.append('<div class="buttonContainer"><div class="buttonCell" /></div>'),this.button=new o(this.oz().locale.get("cutoutSharePageButton"),"/cutout"),this.footer=new f,this.container.find(".buttonCell").prepend(this.button.$el),this.$el.append(this.footer.$el)},t.prototype.getImageId=function(){return window.location.href.substr(window.location.href.lastIndexOf("/")+1,window.location.href.length)},t.prototype.oz=function(){return(window||document).oz},t}(Backbone.View),x=function(e){function t(){return this.oz=L(this.oz,this),this.initAnimation=L(this.initAnimation,this),this.initialize=L(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.initialize=function(e){var t,n=this;return this.setElement($(".wrapper")),this.fullImg=$("<div/>"),this.fullImg.addClass("imgAnim"),this.thumb=$(".wrapper img"),this.fullImg.append(this.thumb),this.$el.append(this.fullImg),this.thumb.bind("load",function(){return n.polaroid=new Image,n.polaroid.onload=function(){return n.thumb.addClass("imgLoaded"),n.fullImg.append(n.polaroid),n.initAnimation()},n.polaroid.src="/img/preview/cutout_polaroid.png"}),t="",window.location.href.indexOf(":8888")>-1?t="/img/preview/1.jpeg":t="/api/image/get/"+e,this.thumb.attr({src:t}),this.fullImg.on("webkitAnimationEnd",function(){return $(document).trigger("thumbTransitionEnded")})},t.prototype.initAnimation=function(){return this.fullImg.addClass("img")},t.prototype.oz=function(){return(window||document).oz},t}(Backbone.View),e=function(e){function t(){return this.oz=L(this.oz,this),this.onAssetsComplete=L(this.onAssetsComplete,this),this.onUnLock=L(this.onUnLock,this),this.onLock=L(this.onLock,this),this.onLockMouseMove=L(this.onLockMouseMove,this),this.pointerLockChange=L(this.pointerLockChange,this),this.releasePointLock=L(this.releasePointLock,this),this.pointLock=L(this.pointLock,this),this.onAssetsProgress=L(this.onAssetsProgress,this),this.onAssetsInitLoading=L(this.onAssetsInitLoading,this),this.onEnterFrame=L(this.onEnterFrame,this),this.mouseEnabled=L(this.mouseEnabled,this),this.show=L(this.show,this),this.hide=L(this.hide,this),this.onResize=L(this.onResize,this),this.remove=L(this.remove,this),this.addChild=L(this.addChild,this),this.dispose=L(this.dispose,this),this.move=L(this.move,this),this.empty=L(this.empty,this),this.render=L(this.render,this),this.pause=L(this.pause,this),this.resume=L(this.resume,this),this.update=L(this.update,this),this.init=L(this.init,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.el=null,t.prototype.id=null,t.prototype.children=null,t.prototype.template=null,t.prototype.templateVars=null,t.prototype.assetsBatch=null,t.prototype.paused=!0,t.prototype.displayMode="",t.prototype.visible=!0,t.prototype.initialize=function(){return this.children=[],this.template&&this.setElement(this.template),this.id&&this.$el.attr("id",this.id),this.className&&this.$el.addClass(this.className),this.init(),this.assetsBatch!=null&&(this.onAssetsInitLoading(),this.oz().baseAssets.on("COMPLETE",this.onAssetsComplete),this.oz().baseAssets.on("PROGRESS",this.onAssetsProgress),this.oz().baseAssets.loadBatch(this.assetsBatch)),this.paused=!1},t.prototype.init=function(){return this},t.prototype.update=function(){var e,t,n,r;r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],e.update();return this},t.prototype.resume=function(){var e,t,n,r;this.paused=!1,r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],e.resume!=null&&e.resume(),e.$el.resume();return this},t.prototype.pause=function(){var e,t,n,r;this.paused=!0,r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],e.pause!=null&&e.pause(),e.$el.pause();return this},t.prototype.render=function(){var e,t,n,r;r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],e.render();return this},t.prototype.empty=function(){var e,t,n,r;r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],e&&(e.dispose!=null&&e.dispose(),e.empty!=null&&e.empty(),this.remove(e));return this.children=[],this.$el.empty(),this},t.prototype.move=function(e,t){return this.$el.css({left:e,top:t}),this},t.prototype.dispose=function(){var e;return e=$(this.$el.children()[0]).attr("id")||$(this.$el.children()[0]).attr("class")||this.$el.html()||this.$el.attr("class")||this.$el.attr("style"),console.error("don't forget to override dispose -> "+e),this},t.prototype.addChild=function(e,t){var n;return t==null&&(t=!1),e.el&&this.children.push(e),n=e.el?e.$el:e,t?this.$el.prepend(n):this.$el.append(n),this},t.prototype.remove=function(e){var t;if(e==null)return;return t=e.el?e.$el:$(e),t&&e.dispose(),t&&this.children.indexOf(e)!==-1&&this.children.splice(this.children.indexOf(e),1),t.remove()},t.prototype.onResize=function(e){var t,n,r,i;i=this.children;for(n=0,r=i.length;n<r;n++)t=i[n],t.onResize&&t.onResize();return this},t.prototype.hide=function(e,t,n,r,i){var s=this;e==null&&(e=!1),t==null&&(t=null),n==null&&(n=400),r==null&&(r="linear"),i==null&&(i=!1),this.visible=!1;if(!!e)return this.$el.stop().animate({opacity:0},n,r,function(){t&&t();if(i)return s.$el.css({visibility:"hidden"})});this.$el.css({opacity:0});if(i)return this.$el.css({visibility:"hidden"})},t.prototype.show=function(e,t,n,r){return e==null&&(e=!1),t==null&&(t=null),n==null&&(n=400),r==null&&(r="linear"),this.visible=!0,this.$el.css({visibility:"visible"}),e?this.$el.stop().animate({opacity:1},n,r,t):this.$el.css({opacity:1})},t.prototype.mouseEnabled=function(e){return this.$el.css({"pointer-events":e?"auto":"none"})},t.prototype.onEnterFrame=function(){var e,t,n,r;r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],!this.paused&&e&&e.onEnterFrame&&e.paused===!1&&e.onEnterFrame();return this},t.prototype.onAssetsInitLoading=function(){return this},t.prototype.onAssetsProgress=function(){return this},t.prototype.pointLock=function(){var e;return $(document).bind("pointerlockchange",this.pointerLockChange),$(document).bind("mozpointerlockchange",this.pointerLockChange),$(document).bind("webkitpointerlockchange",this.pointerLockChange),e=$("body")[0],e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock()},t.prototype.releasePointLock=function(){var e;return $(document).unbind("pointerlockchange",this.pointerLockChange),$(document).unbind("mozpointerlockchange",this.pointerLockChange),$(document).unbind("webkitpointerlockchange",this.pointerLockChange),$(document).unbind("mousemove",this.onLockMouseMove),e=document,e.exitPointerLock=e.exitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,e.exitPointerLock()},t.prototype.pointerLockChange=function(e){return document.mozPointerLockElement===$("body")[0]||document.webkitPointerLockElement===$("body")[0]?($(document).bind("mousemove",this.onLockMouseMove),this.onLock()):(this.releasePointLock(),$(document).unbind("mousemove",this.onLockMouseMove),this.onUnLock())},t.prototype.onLockMouseMove=function(e){return this},t.prototype.onLock=function(){return this},t.prototype.onUnLock=function(){return this},t.prototype.onAssetsComplete=function(){return this.oz().baseAssets.off("COMPLETE",this.onAssetsComplete),this.oz().baseAssets.off("PROGRESS",this.onAssetsProgress)},t.prototype.oz=function(){return(window||document).oz},t}(Backbone.View),t=function(e){function t(){return this.oz=L(this.oz,this),this.show=L(this.show,this),this.hide=L(this.hide,this),this.pause=L(this.pause,this),this.resume=L(this.resume,this),this.dispose=L(this.dispose,this),this.changeLabel=L(this.changeLabel,this),this.onclick=L(this.onclick,this),this.onout=L(this.onout,this),this.onover=L(this.onover,this),this.disable=L(this.disable,this),this.enable=L(this.enable,this),this.init=L(this.init,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.el=null,t.prototype.id=null,t.prototype.label=null,t.prototype.template=null,t.prototype.templateVars=null,t.prototype.tagName="button",t.prototype.className="abstractbutton",t.prototype.classButton=null,t.prototype.classAnimated=null,t.prototype.initialize=function(){var e;return this.template&&(e=_.template(this.oz().templates.get(this.template)),this.setElement(e(this.templateVars))),this.id&&this.$el.attr("id",this.id),this.className&&this.$el.addClass(this.className),this.classAnimated&&this.$el.addClass(this.classAnimated),this.label!=null&&this.$el.append(this.label),this.init()},t.prototype.init=function(){return this},t.prototype.enable=function(){return this.$el.css({cursor:"pointer"}),this.$el.removeClass("disabled"),this.$el.mouseover(this.onover),this.$el.mouseout(this.onout),this.$el.bind("click",this.onclick)},t.prototype.disable=function(){return this.$el.css({cursor:"default"}),this.$el.addClass("disabled"),this.$el.unbind("mouseover"),this.$el.unbind("mouseout"),this.$el.unbind("click")},t.prototype.onover=function(){return this.$el.addClass("over")},t.prototype.onout=function(){return this.$el.removeClass("over")},t.prototype.onclick=function(){return this},t.prototype.changeLabel=function(e){return this.$el.html(e)},t.prototype.dispose=function(){var e;return e=$(this.$el.children()[0]).attr("id")||$(this.$el.children()[0]).attr("class")||this.$el.html(),this},t.prototype.resume=function(){return this},t.prototype.pause=function(){return this},t.prototype.hide=function(e,t){return e==null&&(e=!1),t==null&&(t=null),this.visible=!1,e?this.$el.animate({opacity:0},400,"linear",t):this.$el.css({opacity:0})},t.prototype.show=function(e,t){return e==null&&(e=!1),t==null&&(t=null),this.visible=!0,e?this.$el.animate({opacity:1},400,"linear",t):this.$el.css({opacity:1})},t.prototype.oz=function(){return(window||document).oz},t}(Backbone.View),E=function(e){function t(){return this.dispose=L(this.dispose,this),this.onclick=L(this.onclick,this),this.onout=L(this.onout,this),this.onover=L(this.onover,this),this.init=L(this.init,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.initialize=function(e,n,r){return r==null&&(r="btanimated"),this.id=e,this.label=n,this.classAnimated=r,t.__super__.initialize.call(this)},t.prototype.init=function(){return this.enable()},t.prototype.onover=function(){return S.send("btn_generic_over"),t.__super__.onover.call(this)},t.prototype.onout=function(){return t.__super__.onout.call(this)},t.prototype.onclick=function(){return S.send("btn_generic_click"),this.trigger("click",this)},t.prototype.dispose=function(){return this},t}(t),w=function(e){function t(){return this.oz=L(this.oz,this),this.dispose=L(this.dispose,this),this.center=L(this.center,this),this.removeClass=L(this.removeClass,this),this.addClass=L(this.addClass,this),this.css=L(this.css,this),this.out=L(this.out,this),this.over=L(this.over,this),this.init=L(this.init,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.ss=null,t.prototype.from=null,t.prototype.asset=null,t.prototype.initialize=function(e){return this.asset=e,t.__super__.initialize.call(this)},t.prototype.init=function(){var e,t,n,r,i,s;return this.ss=this.oz().ss.get(this.asset),i=Math.round(this.ss.x/2)-1,s=Math.round(this.ss.y/2),r=Math.round(this.ss.width/2),n=Math.round(this.ss.height/2),t=window.devicePixelRatio===2?this.oz().ss.image1FullSize:this.oz().ss.image1FullSize,e={width:r,height:n,"background-image":"url("+this.oz().ssImage.src+")","background-size":""+t[0]+"px "+t[1]+"px","background-position":"-"+i+"px -"+s+"px"},window.devicePixelRatio===2&&(e["background-image"]="-webkit-image-set(url("+this.oz().ssImage.src+") 1x, url("+this.oz().ssImage2x.src+") 2x)"),this.$el.css(e),this.render()},t.prototype.over=function(e){return this.changeState(e)},t.prototype.out=function(){var e,t;return e=Math.round(this.ss.x/2)-1,t=Math.round(this.ss.y/2),this.$el.css({"background-position":-e+"px "+ -t+"px"})},t.prototype.css=function(e){return this.$el.css(e)},t.prototype.addClass=function(e){return this.$el.addClass(e)},t.prototype.removeClass=function(e){return this.$el.removeClass(e)},t.prototype.center=function(){var e;return e=Math.round(this.ss.width/4),this.$el.css({position:"absolute",left:"50%","margin-left":""+ -e+"px"})},t.prototype.dispose=function(){return this},t.prototype.oz=function(){return(window||document).oz},t}(e),o=function(e){function t(){return this.initialize=L(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.className="extra-page-button",t.prototype.tagName="a",t.prototype.initialize=function(e,t){return this.$el.text(e),this.$el.attr({href:t,target:"_blank"})},t}(Backbone.View),a=function(e){function t(){return this.onEnterFrame=L(this.onEnterFrame,this),this.initialize=L(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.tagName="div",t.prototype.initialize=function(){var e,t,n,r,i;return this.setElement($("body")),this.header=new h,this.$el.append(this.header.$el),n=$('<div class="errorContainer"/>'),t=$("<div/>"),n.append(t),i=new w("instructions_warning"),i.$el.addClass("ssAsset"),t.append(i.$el),r=$("<p/>"),r.html(this.oz().locale.get("share_page_expired_copy")),t.append(r),e=new w("breaker_down"),e.$el.addClass("ssAsset"),t.append(e.$el),this.$el.append(n),this.footer=new f,this.$el.append(this.footer.$el)},t.prototype.onEnterFrame=function(){return this},t}(e),f=function(e){function t(){return this.onWindowResize=L(this.onWindowResize,this),this.renderShare=L(this.renderShare,this),this.initialize=L(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.tagName="footer",t.prototype.initialize=function(){return this.footerLogos=new l,this.footerShare=new c,this.ratings=new b,this.$el.append(this.footerLogos.$el),this.$el.append(this.footerShare.$el),this.$el.append(this.ratings.$el),setTimeout(this.renderShare,1e3),$(window).bind("resize",this.onWindowResize)},t.prototype.renderShare=function(){return twttr.widgets.load(),gapi.plusone.render("g-plusone",{size:"medium",expandTo:"top"})},t.prototype.onWindowResize=function(e){return this.$el.css("width",$("body").width())},t}(Backbone.View),l=function(e){function t(){return this.initialize=L(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.className="footer-logos",t.prototype.initialize=function(){return this.logo_oz_asset=new w("logo_oz"),this.logo_oz=$("<a/>"),this.logo_oz.append(this.logo_oz_asset.$el),this.logo_oz.attr({"class":"logo_oz",href:"/",target:"_blank"}),this.logo_chrome_asset=new w("logo_chrome"),this.logo_chrome=$("<a/>"),this.logo_chrome.append(this.logo_chrome_asset.$el),this.logo_chrome.attr({"class":"logo_chrome",href:" http://www.chromeexperiments.com",target:"_blank"}),this.logo_google_asset=new w("logo_google"),this.logo_google=$("<a/>"),this.logo_google.append(this.logo_google_asset.$el),this.logo_google.attr({"class":"logo_google",href:"http://google.com",target:"_blank"}),this.$el.append(this.logo_oz),this.$el.append(this.logo_chrome),this.$el.append(this.logo_google)},t}(Backbone.View),c=function(e){function t(){return this.oz=L(this.oz,this),this.addWeibo=L(this.addWeibo,this),this.addRenRen=L(this.addRenRen,this),this.initialize=L(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.className="footer-share",t.prototype.initialize=function(){return this.lang=(navigator.language||navigator.userLanguage).toLowerCase(),this.lang.indexOf("zn")===-1?(this.$googleBtn=$("<div/>"),this.$googleBtn.attr({id:"g-plusone","class":"g-plusone",align:"right","data-size":"medium"}),this.$facebookBtn=$("<iframe/>"),this.$facebookBtn.attr({"class":"fb-like",src:"//www.facebook.com/plugins/like.php?send=false&layout=button_count&href="+document.location.origin,scrolling:"no",frameborder:"0"}),this.$twitterBtn=$("<a/>"),this.$twitterBtn.attr({"class":"twitter-share-button",href:"https://twitter.com/share","data-via":"unit9","data-lang":this.lang,"data-size":"small","data-hashtags":this.oz().locale.get("seo_twtter_hashtag"),"data-text":this.oz().locale.get("seo_twtter_default_text"),"data-via":this.oz().locale.get("seo_twitter_handle")}),this.$el.append(this.$googleBtn),this.$el.append(this.$twitterBtn),this.$el.append(this.$facebookBtn)):(this.addWeibo(),this.addRenRen())},t.prototype.addRenRen=function(){var e,t,n,r,i,s;r=[],s=130,e=20,n={url:window.location.href,title:document.title,description:"",image:""};for(t in n)i=n[t],r.push(t+"="+encodeURIComponent(i||""));return this.renren=$('<iframe scrolling="no" frameborder="0" allowtransparency="true" src="http://www.connect.renren.com/like/v2?'+r.join("&")+"\" style='width:"+s+"px; height:"+e+"px;'/>"),this.$el.append(this.renren)},t.prototype.addWeibo=function(){var e,t,n,r,i,s;s=72,i=24,t={url:window.location.href,type:"2",count:"1",appkey:"",title:"",pic:"",ralateUid:"",language:"zh_cn",rnd:(new Date).valueOf()},n=[];for(e in t)r=t[e],n.push(e+"="+encodeURIComponent(r||""));return this.weibo=$('<iframe class="weibo_share" allowTransparency="true" frameborder="0" scrolling="no" src="http://hits.sinajs.cn/A1/weiboshare.html?'+n.join("&")+'" width="'+s+'" height="'+i+'"/>'),this.weibo.css({"-webkit-transform":"scale(.85)","margin-top":"-2px"}),this.$el.append(this.weibo)},t.prototype.oz=function(){return(window||document).oz},t}(Backbone.View),h=function(e){function t(){return this.oz=L(this.oz,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.className="header",t.prototype.tagName="span",t.prototype.initialize=function(){return this.img_flourish=new w("breaker_up"),this.$cellContainer=$("<div/>"),this.$cellContainer.attr("class","innerFooterCenter"),this.$sentence=$("<span/>"),this.$sentence.text(this.oz().locale.get("homeTitle")),this.img_flourish2=new w("breaker_down"),this.$cellContainer.append(this.img_flourish.$el),this.$cellContainer.append(this.$sentence),this.$cellContainer.append(this.img_flourish2.$el),this.$el.append(this.$cellContainer)},t.prototype.oz=function(){return(window||document).oz},t}(Backbone.View),b=function(e){function t(){return this.oz=L(this.oz,this),this.initialize=L(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.tagName="div",t.prototype.className="ratings",t.prototype.initialize=function(){return this.pg=new w("rating_block"),this.$copyright=$("<a/>"),this.$copyright.text(this.oz().locale.get("menuRatings")),this.$copyright.attr({href:this.oz().locale.get("menuRatingsLink")}),this.$el.append(this.pg.$el),this.$el.append(this.$copyright)},t.prototype.oz=function(){return(window||document).oz},t}(Backbone.View),p=function(){function e(){this.get=L(this.get,this),this.loadBackup=L(this.loadBackup,this),this.onSuccess=L(this.onSuccess,this),this.init=L(this.init,this),_.extend(this,Backbone.Events)}return e.prototype.lang=null,e.prototype.data=null,e.prototype.init=function(){return this.lang=(navigator.language||navigator.userLanguage).toLowerCase(),$.ajax({url:"/api/localisation/desktop/"+this.lang,dataType:"json",success:this.onSuccess,error:this.loadBackup})},e.prototype.onSuccess=function(e){var t;return t=null,e.responseText?t=JSON.parse(e.responseText):t=e,this.data=t,this.trigger("complete")},e.prototype.loadBackup=function(){var e=this;return $.ajax({url:"/locale/en/strings.txt",dataType:"text",complete:this.onSuccess,error:function(){return console.log("error on loading backup")}})},e.prototype.get=function(e){return this.data.strings[e]||""},e}(),r=function(e){function t(){return this.oz=L(this.oz,this),this.onEnterFrame=L(this.onEnterFrame,this),this.activate=L(this.activate,this),this.onAllSoundsLoaded=L(this.onAllSoundsLoaded,this),this.soudControllerLoaded=L(this.soudControllerLoaded,this),this.tooglePlay=L(this.tooglePlay,this),this.addInterface=L(this.addInterface,this),this.addSpinner=L(this.addSpinner,this),this.init=L(this.init,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.soundsLoaded=!1,t.prototype.container=null,t.prototype.buttons=null,t.prototype.playing=!1,t.prototype.init=function(){return this.setElement($("body")),this.header=new h,this.$el.append(this.header.$el),S.active=!0,S.init(!0),this.addInterface(),this.buttonContainer=this.$el.append('<div class="buttonContainer"><div class="buttonCell" /></div>'),this.button=new o(this.oz().locale.get("musicSharePageButton"),"/music"),this.buttonContainer.find(".buttonCell").append(this.button.$el),this.footer=new f,this.$el.append(this.footer.$el)},t.prototype.addSpinner=function(){var e,t;return this.spinner=new Sonic({width:50,height:50,stepsPerFrame:1,trailLength:1,pointDistance:.02,fps:30,fillColor:"#FFFFFF",step:function(e,t){return this._.beginPath(),this._.moveTo(e.x,e.y),this._.arc(e.x,e.y,t*3,0,Math.PI*2,!1),this._.closePath(),this._.fill()},path:[["arc",25,25,10,0,360]]}),e=$("<div />"),e.css({position:"absolute",width:"100%",height:"100%",display:"table","pointer-events":"none"}),t=$("<div />"),t.css({display:"table-cell",width:"100%",height:"100%","vertical-align":"middle"}),e.append(t),this.$el.append(e),t.append(this.spinner.canvas),this.spinner.play()},t.prototype.addInterface=function(){return this.container=$('<div class="button_music_container"/>'),this.buttons=$('<div class="button_music_play"/>'),this.playPause=$('<div class="playPause"/>'),this.playPause.css({visibility:"hidden"}),this.btPlay=$('<img src="/img/preview/music_button_play.png"/>'),this.btPlay.bind("click",this.tooglePlay),this.btPause=$('<img src="/img/preview/music_button_pause.png"/>'),this.btPause.bind("click",this.tooglePlay),this.btPause.css({opacity:0}),this.playPause.append(this.btPause),this.playPause.append(this.btPlay),this.buttons.append(this.playPause),this.container.append(this.buttons),this.$el.append(this.container),this.addSpinner()},t.prototype.tooglePlay=function(){return this.playing?(this.playing=!1,this.btPause.css({opacity:0}),this.btPlay.css({opacity:1}),S.stopBackgroundMusic()):(this.playing=!0,this.btPause.css({opacity:1}),this.btPlay.css({opacity:0}),S.preview(this.oz().result))},t.prototype.soudControllerLoaded=function(){return this.soundsLoaded=!0,S.send("load_scene_5","musicbox_shared")},t.prototype.onAllSoundsLoaded=function(){var e=this;return S.batchLoaded=!1,this.spinner.stop(),$(this.spinner.canvas).animate({opacity:0},{duration:250,complete:function(){return $(e.spinner.canvas).css({visibility:"hidden"})}}),this.activate()},t.prototype.activate=function(){return this.playPause.css({opacity:0,visibility:"visible"}),this.playPause.animate({opacity:1},300),this},t.prototype.onEnterFrame=function(){return this.soundsLoaded?S.batchLoaded&&this.onAllSoundsLoaded():S.loaded&&this.soudControllerLoaded(),t.__super__.onEnterFrame.call(this)},t.prototype.oz=function(){return(window||document).oz},t}(e),v=function(t){function n(){return this.dispose=L(this.dispose,this),this.restore=L(this.restore,this),this.render=L(this.render,this),this.initialize=L(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return k(n,t),n.prototype.data=null,n.prototype.initialize=function(e){return this.data=e,n.__super__.initialize.call(this)},n.prototype.init=function(){return this.container=(new e).setElement($('<div class="musicbox"/>')),this.container.dispose=function(){},this.addChild(this.container),this.render()},n.prototype.render=function(){return this.$el.css({position:"absolute",display:"table",width:"100%",height:"100%"}),this.table=new y(this.data),this.container.addChild(this.table)},n.prototype.restore=function(){return this.container.$el.animate({opacity:1},300,"linear")},n.prototype.dispose=function(){return n.__super__.dispose.call(this)},n}(e),m=function(e){function t(){return this.newTooltip=L(this.newTooltip,this),this.cellHoverOff=L(this.cellHoverOff,this),this.cellHoverOn=L(this.cellHoverOn,this),this.activateCell=L(this.activateCell,this),this.cellClick=L(this.cellClick,this),this.playing=L(this.playing,this),this.buildTable=L(this.buildTable,this),this.init=L(this.init,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.animating=!1,t.prototype.template="        <div class='music-grid-table'>             <table>            </table>        </div>        ",t.prototype.table=null,t.prototype.data=null,t.prototype.init=function(){return this.table=this.$el.find("table")},t.prototype.buildTable=function(e){var t,n,r,i,s,o,u,a,f;this.data=e,n=$("<tbody></tbody>");for(r=o=0,a=this.data.dimensions.lines;0<=a?o<a:o>a;r=0<=a?++o:--o){s=$("<tr></tr>");for(i=u=0,f=this.data.dimensions.cols;0<=f?u<f:u>f;i=0<=f?++u:--u)t=$("<td data-note='"+r+"'></td>"),s.append(t),$.inArray(r,this.data.cols[i].rows)>-1&&this.activateCell(t);n.append(s)}return this.table.append(n),this.render()},t.prototype.events={"click td":"cellClick","mouseenter td":"cellHoverOn","mouseleave td":"cellHoverOff"},t.prototype.playing=function(e){if(e===!0)return this.animating=!0;if(e===!1)return this.animating=!1},t.prototype.cellClick=function(e){return this.activateCell($(e.currentTarget))},t.prototype.activateCell=function(e){return e.toggleClass("on")},t.prototype.cellHoverOn=function(e){var t;if(this.animating===!1)return $(e.currentTarget).prepend(this.newTooltip(this.data.notes[this.data.dimensions.lines-1-$(e.currentTarget).attr("data-note")].label)),t=$(e.currentTarget).find(".music-note-tooltip"),t.css({"margin-top":"-44px","margin-left":""+($(e.currentTarget).width()/2-20)+"px"}),t.fadeIn(300)},t.prototype.cellHoverOff=function(e){var t;if(this.animating===!1)return t=$(e.currentTarget).find(".music-note-tooltip"),t.fadeOut(300).remove()},t.prototype.newTooltip=function(e){return'<div class="music-note-tooltip">'+e+"</div>"},t}(e),y=function(t){function n(){return this.dispose=L(this.dispose,this),this.playLoopSound=L(this.playLoopSound,this),this.doLoopAudio=L(this.doLoopAudio,this),this.stop=L(this.stop,this),this.play=L(this.play,this),this.togglePlay=L(this.togglePlay,this),this.exportJson=L(this.exportJson,this),this.render=L(this.render,this),this.init=L(this.init,this),this.initialize=L(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return k(n,t),n.prototype.template="        <div class='box-container'>            <div class='decorated-box'>                <div class='center_bar'></div>                                <div id='r1' class='row'>                    <div id='c11' class='cell'></div>                    <div id='c12' class='cell'></div>                    <div id='c13' class='cell'></div>                </div>                <div id='r2' class='row'>                    <div id='c21' class='cell'></div>                    <div id='c22' class='cell'>                        <div class='grid-mask'></div>                    </div>                    <div id='c23' class='cell'></div>                </div>                <div id='r3' class='row'>                    <div id='c31' class='cell'></div>                    <div id='c32' class='cell'></div>                    <div id='c33' class='cell'></div>                </div>            </div>            <div class='musicbox_button_container'>            </div>        </div>        ",n.prototype.playing=!1,n.prototype.stopPlaying=!1,n.prototype.wasPlaying=!1,n.prototype.animationTimer=
null,n.prototype.animationDuration=1e3/3,n.prototype.initialize=function(e){return this.data=e,n.__super__.initialize.call(this)},n.prototype.init=function(){return this.render()},n.prototype.render=function(){var t;return this.grid=new m,this.grid.buildTable(this.data),this.container=this.$el.find(".grid-mask"),this.container.append(this.grid.$el),this.playBtn=new w("button_play"),this.pauseBtn=new w("button_pause"),this.pauseBtn.$el.css({position:"absolute",top:0,width:""+(parseInt(this.pauseBtn.$el.css("width"))+1)+"px"}),this.pauseBtn.hide(),this.playPauseBtn=(new e).setElement($("<div class='autoplay'/>")),this.playPauseBtn.$el.on("click",this.togglePlay),this.playPauseBtn.addChild(this.playBtn),this.playPauseBtn.addChild(this.pauseBtn),t=this.$el.find(".musicbox_button_container"),t.append(this.playPauseBtn.$el),this["export"]=new E("exportJson","Export JSON"),this["export"].on("click",this.exportJson),t.append(this["export"].$el)},n.prototype.exportJson=function(){var e,t,n;return n=this.exportSong("col"),n.dimensions={lines:this.data.dimensions.lines,cols:this.data.dimensions.cols},n.notes=this.data.notes,n.loops=this.data.loops,e=document.createElement("a"),t=new Blob([JSON.stringify(n)],{type:"text/json"}),e.href=window.URL.createObjectURL(t),e.download="music.json",e.click()},n.prototype.togglePlay=function(){return this.playing?this.stop():this.play()},n.prototype.play=function(){return this.playLoop($(this.$el.find("table")[0])),this.playAudioLoop(this.exportSong("col")),this.playing=!0,this.grid.playing(!0),this.playBtn.hide(!0),this.pauseBtn.show(!0)},n.prototype.stop=function(){return this.stopLoop(),this.stopAudioLoop(),this.playing=!1,this.grid.playing(!1),this.playBtn.show(!0),this.pauseBtn.hide(!0)},n.prototype.playLoop=function(e){var t,n,r,i,s=this;i=e.find(".music-note-tooltip"),n=0;while(n<i.length)$(i[n]).remove(),n++;return t=e.clone(!0,!0),this.grid.$el.append(t),t.addClass("leftTweak"),r=parseInt(e.css("width"),10),this.loopAnimation=e.animate({"margin-left":-r},this.animationDuration*this.data.dimensions.cols,"linear",function(){return e.remove(),s.playLoop($(s.$el.find("table")[0]))})},n.prototype.stopLoop=function(){var e;return this.loopAnimation.stop(),this.$el.find("table").length>1&&(e=$(this.$el.find("table")[0]),e.remove()),$(this.$el.find("table")).removeClass("leftTweak")},n.prototype.playAudioLoop=function(e){var t;return t=this.animationDuration,this.colNo=this.data.dimensions.cols/2,this.doLoopAudio(e),this.loopAudio=setInterval(this.doLoopAudio,t,e)},n.prototype.doLoopAudio=function(e){var t,n,r;this.colNo>this.data.dimensions.cols-1&&(this.colNo=0),console.log("------------------------------------------- ",this.colNo),t=e.cols[this.colNo],n=0;while(n<t.rows.length)r=t.rows[n],this.playSound(this.colNo,r),this.animateCell(this.colNo,r),n++;n=0;while(n<this.data.loops.length)this.playLoopSound(this.data.loops[n]),n++;return this.colNo++},n.prototype.playLoopSound=function(e){var t;t="",e.step?this.colNo%e.step===0&&(t=e.event):e.col!=null&&this.colNo===e.col&&(t=e.event);if(t!=="")return S.send(e.event)},n.prototype.stopAudioLoop=function(){return clearInterval(this.loopAudio)},n.prototype.exportSong=function(e){var t,n,r,i;e||(e="row"),i=$(this.$el.find("table"));if(e==="row"){r={rows:[]},t=0;while(t<this.data.dimensions.lines){r.rows[t]={columns:[]},n=0;while(n<this.data.dimensions.cols)this.checkCell(i,t,n)===!0&&r.rows[t].columns.push(n),n++;t++}}else if(e==="col"){r={cols:[]},t=0;while(t<this.data.dimensions.cols){r.cols[t]={rows:[]},n=0;while(n<this.data.dimensions.lines)this.checkCell(i,n,t)===!0&&r.cols[t].rows.push(n),n++;t++}}return r},n.prototype.checkCell=function(e,t,n){var r,i;i=$(e.find("tr")[t]),r=$(i.find("td")[n]);if(r)return r.hasClass("on")?!0:!1;throw"Error exporting song: couldn't find specified cell."},n.prototype.playSound=function(e,t){return S.send(this.getSoundEvent(e,t))},n.prototype.animateCell=function(e,t){var n,r,i,s,o;return e<this.data.dimensions.cols/2&&this.$el.find("table").length>1?o=this.$el.find("table")[1]:o=this.$el.find("table")[0],s=$(o).find("tr")[t],n=$(s).find("td")[e],$(n).addClass("flash"),i=function(){return $(n).removeClass("flash")},r=this.animationDuration,setTimeout(i,r)},n.prototype.getSoundEvent=function(e,t){return this.data.notes[this.data.dimensions.lines-1-t].event},n.prototype.dispose=function(){return this.loopAnimation.stop(),this.playPauseBtn.$el.off("click",this.togglePlay),this.btAmbientSound.off("click",this.testAmbientSound),this["export"].off("click",this.exportJson)},n}(e),N=function(){function e(e,t,n,r){this.getMix=L(this.getMix,this),this._generate=L(this._generate,this),this.generate=L(this.generate,this),this.sampleRate=isNaN(e)||e===null?this.sampleRate:e,this.frequency=isNaN(t)||t===null?this.frequency:t,this.pan=isNaN(n)||n===null?this.pan:n,this.length=isNaN(r)||r===null?this.length:r,this.samplesLeft=this.length*this.sampleRate,this.osc=audioLib.Oscillator(this.sampleRate,this.frequency*2),this.lfo=audioLib.Oscillator(this.sampleRate,this.frequency*2.8),this.envelope=audioLib.ADSREnvelope(this.sampleRate,10,100,.2,2e3,10,this.length*1e3),this.lfo.waveShape="sine",this.envelope.triggerGate()}return e.prototype.sampleRate=44100,e.prototype.frequency=440,e.prototype.sample=0,e.prototype.length=12,e.prototype.samplesLeft=null,e.prototype.mix=.5,e.prototype.pan=.5,e.prototype.generate=function(){this.lfo.generate(),this.osc.fm=this.lfo.getMix(),this.osc.generate(),this.envelope.generate(),this.sample=this.osc.getMix()*this.envelope.getMix();if(!--this.samplesLeft)return this.generate=this._generate},e.prototype._generate=function(){},e.prototype.getMix=function(e){return this.sample*this.pan},e}(),i=function(e){function t(){return this.oz=L(this.oz,this),this.initialize=L(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.initialize=function(){return this.setElement($("body")),this.header=new h,this.$el.append(this.header.$el),this.thumb=new T,this.wrapper=$('<div class="wrapper"/>'),this.$el.append(this.wrapper),this.containerThumb=this.wrapper.append('<div class="thumbContainer"><div class="thumbCell" style="margin-top: 25px;" /></div>'),this.container=this.$el.append('<div class="buttonContainer"><div class="buttonCell" /></div>'),this.button=new o(this.oz().locale.get("zoetropeSharePageButton"),"/zoetrope"),this.footer=new f,this.container.find(".buttonCell").append(this.button.$el),this.containerThumb.find(".thumbCell").append(this.thumb.$el),this.$el.append(this.footer.$el),this.thumb.init(this.getImageId())},t.prototype.getImageId=function(){return window.location.href.substr(window.location.href.lastIndexOf("/")+1,window.location.href.length)},t.prototype.oz=function(){return(window||document).oz},t}(Backbone.View),T=function(e){function t(){return this.loadComplete=L(this.loadComplete,this),this.getWidth=L(this.getWidth,this),this.getHeight=L(this.getHeight,this),this.animate=L(this.animate,this),this.init=L(this.init,this),this.initialize=L(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.tagName="div",t.prototype.currentFrame=0,t.prototype.totalFrames=0,t.prototype.ratio=1.777777778,t.prototype.imgRatio=0,t.prototype.__w=0,t.prototype.initialize=function(){return this},t.prototype.init=function(e){var t=this;return this.bg=new Image,this.bg.onload=function(e){return t.__w=document.width,t.imgRatio=t.bg.width/t.bg.height,t.__w>600&&(t.__w=600),t.$el.append(t.bg),t.$spriteSheet=t.$el.find("img:first-child"),t.$el.css({height:t.bg.height,width:t.__w,"margin-left":"18px"}),t.totalFrames=Math.round(t.bg.width/t.__w),setInterval(t.animate,150),t.loadComplete()},window.location.href.indexOf(":8888")>-1||window.location.href.indexOf("unit9")>-1?this.bg.src="/api/image/get/example.jpeg":this.bg.src="/api/image/get/"+e},t.prototype.animate=function(){return this.currentFrame++,this.currentFrame>=this.totalFrames&&(this.currentFrame=0),this.$spriteSheet.css({"margin-left":-this.currentFrame*this.__w+"px"})},t.prototype.getHeight=function(){return this.bg.height},t.prototype.getWidth=function(){return this.__w},t.prototype.loadComplete=function(){},t}(Backbone.View),$(function(){var e,t,s,o,f,l,c,h,d,v,m=this;return v=window||document,v.oz={},v.oz.ss=null,v.oz.view=null,v.oz.imagesSS=null,v.oz.result=null,v.oz.ssImage=new Image,v.oz.ssImage.onload=function(){return l()},v.oz.ssImage2x=new Image,v.oz.ssImage2x.onload=function(){return v.oz.ss.image2FullSize=[v.oz.ssImage2x.width,v.oz.ssImage2x.height],f()},c=function(e){return v.oz.imagesSS=v.oz.ss.getImage(),v.oz.ssImage.src=v.oz.imagesSS.image},t=function(){var e,t,n,r,i;return i=window.location.href,e="preview/",t=i.indexOf(e),n=i.lastIndexOf("/"),r=i.substring(t+e.length,n).split("/").join(""),r},e=function(){return window.location.href.substr(window.location.href.lastIndexOf("/")+1,window.location.href.length)},l=function(){return v.oz.ss.image1FullSize=[v.oz.ssImage.width,v.oz.ssImage.height],v.oz.imagesSS.image2?v.oz.ssImage2x.src=v.oz.imagesSS.image2:f()},f=function(){return v.oz.ss.image1FullSize=[v.oz.ssImage.width,v.oz.ssImage.height],v.oz.locale=new p,v.oz.locale.on("complete",d),v.oz.locale.init()},h=function(e){v.oz.result=e.result?e.result:e;switch(v.oz.module){case"cutout":return e.result.approved?v.oz.view=new n:v.oz.view=new a;case"music":return v.oz.view=new r,s();case"zoe":return e.result.approved?v.oz.view=new i:v.oz.view=new a}},d=function(){switch(v.oz.module){case"music":return $.ajax({url:"/api/music/"+e(),error:function(){return v.oz.view=new a},success:h});default:return $.ajax({url:"/api/image/info/"+e(),error:function(){return v.oz.view=new a},success:h})}},o=function(e){return console.log(e)},s=function(){var e;return window.requestAnimationFrame(s),typeof (e=v.oz.view).onEnterFrame=="function"?e.onEnterFrame():void 0},v.oz.module=t(),v.oz.ss=new u,v.oz.ss.url="/js/ss/extra_pages.json",v.oz.ss.fetch({success:c,error:o})})}).call(this);