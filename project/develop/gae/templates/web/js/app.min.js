// Generated by CoffeeScript 1.4.0
(function(){var Abstract,AbstractButton,AbstractChapter,AbstractScene,Analytics,AppView,AssetLoader,Base3DChapter,BaseAssets,BaseLandingOpenings,BatchLoadModel,BrowserDetection,Canvas,Carnival,Carnival2,Carnival3,CheckBox,Circle,CollectionBatchLoad,CollectionSpriteSheets,CollectionTemplates,Controller,Copyright,Credits,Cutout,CutoutCanvas,CutoutPolaroid,ElasticNumber,Filter,Final,Footer,IFLAutomaticPerformanceAdjust,IFLBasicShader,IFLBasicShaderDoubleLightmap,IFLCameraPathInteraction,IFLCloudsShader,IFLColorCorrectionShader,IFLDandelionParticlesShader,IFLHotspotManager,IFLLoader,IFLMaterialManager,IFLModelManager,IFLNoiseShader,IFLOzifyParticleSystem,IFLPhongFresnelShader,IFLPhongFresnelShaderDoubleLightMap,IFLSal2x,IFLSkyCubeShader,IFLStormFresnelShader,IFLTerrainLambertShader,IFLTornadoShader,IFLTornadoShaderWin,IFLWindGenerator,IFLWindyParticlesShader,Instructions,InstructionsChapter,LandingAgree,LandingFinal,LandingPause,Loading,LoadingCard,Locale,LocaleModel,LocalisedTexture,Logo,LogoParticles,MainMenu,Map,MapMenu,MathUtils,MenuFilledCircle,MenuSeparator,MusicBox,MusicBoxGrid,MusicBoxSequencer,MusicBoxTable,MusicButtons,OpeningTitles,Particle,ParticleCard,Particles,Payoff,PlayPause,PreloaderEvents,QueryString,RainDrops,Ratings,Requester,Router,SSAsset,Share,ShareBox,ShareMenu,ShareScene,SimpleButton,Slider,SoundController,SpriteSheetModel,StaticOverlay,Storm,StormInstructions,Stormtest,SubLoader,TemplateModel,Templates,ThumbCutout,VideoPlayer,WebCam,Wrapper,Zoetrope,ZoetropeCountDown,ZoetropeMakeMovie,ZoetropePlayer,ZoetropeReplaceLabel,ZoetropeThumb,ZoetropeTimeline,ZoetropeWebcamFeed,__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__bind=function(e,t){return function(){return e.apply(t,arguments)}},__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};IFLBasicShader=function(){function e(){this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{diffuseMultiplier:{type:"f",value:1},lightMapMultiplier:{type:"f",value:1},additiveLightMap:{type:"i",value:0},windMin:{type:"v2",value:new THREE.Vector2(-400,-800)},windSize:{type:"v2",value:new THREE.Vector2(1e3,1e3)},windDirection:{type:"v3",value:new THREE.Vector3(1,0,0)},tWindForce:{type:"t",value:null},windScale:{type:"f",value:1}}])}return e.prototype.uniforms=null,e.prototype.vertexShader=[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,"#ifdef USE_COLOR","uniform vec2 windMin;","uniform vec2 windSize;","uniform vec3 windDirection;","uniform sampler2D tWindForce;","uniform float windScale;","#endif","void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,"vec4 mvPosition;","#ifdef USE_COLOR","vec4 wpos = modelMatrix * vec4( position, 1.0 );","wpos.z = -wpos.z;","vec2 totPos = wpos.xz - windMin;","vec2 windUV = totPos / windSize;","float vWindForce = texture2D(tWindForce,windUV).x;","float windVertexScale = color.r;","float windMod = ((1.0 - vWindForce)*windVertexScale) * windScale;","vec4 pos = vec4(position , 1.0);","pos.x += windMod * windDirection.x;","pos.y += windMod * windDirection.y;","pos.z += windMod * windDirection.z;","mvPosition = modelViewMatrix *  pos;","#else","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,"}"].join("\n"),e.prototype.fragmentShader=["uniform vec3 diffuse;","uniform float opacity;","uniform float diffuseMultiplier;","uniform float lightMapMultiplier;","uniform bool additiveLightMap;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );","#ifdef USE_MAP","vec4 tex = texture2D( map, vUv );","gl_FragColor = gl_FragColor * vec4( tex.xyz * diffuseMultiplier, tex.w );","#endif","#ifdef USE_LIGHTMAP","vec4 map2col = texture2D( lightMap, vUv2 ) * lightMapMultiplier;","if(additiveLightMap){","gl_FragColor += map2col;","} else {","gl_FragColor *= map2col;","gl_FragColor.w = map2col.w;","}","#endif",THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),e}(),IFLBasicShaderDoubleLightmap=function(e){function t(){this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{diffuseMultiplier:{type:"f",value:1},lightMapMultiplier:{type:"f",value:1},additiveLightMap:{type:"i",value:0},lightMap2:{type:"t",value:null},lightmapBlend:{type:"f",value:0},windMin:{type:"v2",value:new THREE.Vector2(-400,-800)},windSize:{type:"v2",value:new THREE.Vector2(1e3,1e3)},windDirection:{type:"v3",value:new THREE.Vector3(1,0,0)},tWindForce:{type:"t",value:null},windScale:{type:"f",value:1}}]),this.fragmentShader=["uniform vec3 diffuse;","uniform float opacity;","uniform float diffuseMultiplier;","uniform bool additiveLightMap;","uniform sampler2D lightMap2;","uniform float lightmapBlend;","uniform float lightMapMultiplier;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );","#ifdef USE_MAP","gl_FragColor = gl_FragColor * ( texture2D( map, vUv ) * diffuseMultiplier );","#endif","#ifdef USE_LIGHTMAP","vec4 map2col = mix( texture2D( lightMap, vUv2 ), texture2D( lightMap2, vUv2 ), lightmapBlend) * lightMapMultiplier;","if(additiveLightMap){","gl_FragColor += map2col;","} else {","gl_FragColor *= map2col;","gl_FragColor.w = map2col.w;","}","#endif",THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")}return __extends(t,e),t}(IFLBasicShader),IFLCloudsShader=function(){function e(){this.uniforms={tDiffuse:{type:"t",value:null},scale:{type:"f",value:100},alpha:{type:"f",value:1},angle:{type:"f",value:0},rotation:{type:"f",value:0},dist:{type:"f",value:200},resolution:{type:"v2",value:new THREE.Vector2(1,1)}}}return e.prototype.uniforms=null,e.prototype.vertexShader=["varying vec2  vUV;","varying float vAlpha;","uniform float scale;","uniform float alpha;","uniform float angle;","uniform float rotation;","uniform float dist;","uniform vec2  resolution;","const float MINZ = 40.0;","const float MAXZ = 100.0;","void main() {","vUV = uv;","mat4 matRot = mat4( cos( angle ), -sin( angle ), 0.0, 0.0, sin( angle ), cos( angle ), 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0 );","gl_Position = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);","//float fScale = scale * dist / gl_Position.z;","float fScale = dist;","gl_Position = gl_Position + matRot * vec4((uv.x - 0.5) * fScale , (uv.y - 0.5) * fScale, 0.0, 0.0);","vAlpha = alpha;","/*if (gl_Position.z < MINZ)","vAlpha = 0.0;","if (gl_Position.z >= MINZ && gl_Position.z <= MAXZ) {","vAlpha = (gl_Position.z - MINZ) / (MAXZ - MINZ);","}*/","}"].join("\n"),e.prototype.fragmentShader=["uniform sampler2D tDiffuse;","varying vec2  vUV;","varying float vAlpha;","void main() {","gl_FragColor = texture2D(tDiffuse, vUV);","gl_FragColor.a *= vAlpha;","}"].join("\n"),e}(),IFLColorCorrectionShader=function(){function e(){this.uniforms={tDiffuse:{type:"t",value:null},saturation:{type:"v4",value:new THREE.Vector4(0,0,0,1)},powRGB:{type:"v3",value:new THREE.Vector3(1,1,1)},mulRGB:{type:"v3",value:new THREE.Vector3(1,1,1)},vignetteOffset:{type:"f",value:1.2},vignetteDarkness:{type:"f",value:1.3},volumetricLightX:{type:"f",value:.5},volumetricLightY:{type:"f",value:.5},enableVolumetricLight:{type:"i",value:0},tVolumetricLight:{type:"t",value:null},tOverlay:{type:"t",value:null}}}return e.prototype.uniforms=null,e.prototype.vertexShader=["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),e.prototype.fragmentShader=["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec3 powRGB;","uniform vec3 mulRGB;","uniform vec4 saturation;","uniform float vignetteOffset;","uniform float vignetteDarkness;","uniform bool enableVolumetricLight;","uniform float volumetricLightX;","uniform float volumetricLightY;","uniform sampler2D tVolumetricLight;","const int iSamples = 10;","uniform sampler2D tOverlay;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.xyz = mulRGB * pow( gl_FragColor.xyz, powRGB );","gl_FragColor.r = clamp(gl_FragColor.r, 0.0, 1.0);","gl_FragColor.g = clamp(gl_FragColor.g, 0.0, 1.0);","gl_FragColor.b = clamp(gl_FragColor.b, 0.0, 1.0);","vec3 luminanceWeights = vec3(0.2126,0.7152,0.0722);","float luminance = dot(gl_FragColor.xyz,luminanceWeights);","vec3 greyscale = vec3(luminance,luminance,luminance);","gl_FragColor.xyz = mix(gl_FragColor.xyz,greyscale.xyz,saturation.xyz);","gl_FragColor.r = clamp(gl_FragColor.r, 0.0, 1.0);","gl_FragColor.g = clamp(gl_FragColor.g, 0.0, 1.0);","gl_FragColor.b = clamp(gl_FragColor.b, 0.0, 1.0);","if (enableVolumetricLight){","vec2 deltaTextCoord = vec2(vUv - vec2(volumetricLightX,volumetricLightY));","deltaTextCoord *= 1.0 /  float(iSamples) * 0.99;","vec2 coord = vUv;","float illuminationDecay = 1.0;","vec4 FragColor = vec4(0.0);","for(int i=0; i < iSamples ; i++)","{","coord -= deltaTextCoord;","vec4 texel = texture2D(tVolumetricLight, coord);","texel *= illuminationDecay * 0.7;","FragColor += texel;","illuminationDecay *= 0.91;","}","FragColor *= 0.2;","FragColor = clamp(FragColor, 0.0, 1.0);","gl_FragColor += FragColor;","}","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( vignetteOffset );","gl_FragColor = vec4( mix( gl_FragColor.rgb, vec3( 1.0 - vignetteDarkness ), dot( uv, uv ) ), gl_FragColor.a );","}"].join("\n"),e}(),IFLDandelionParticlesShader=function(){function e(){this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap,{}])}return e.prototype.uniforms=null,e.prototype.vertexShader=["attribute float rotation;","uniform float size;","uniform float scale;","varying float vRotation;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {","vRotation = rotation;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),e.prototype.fragmentShader=["uniform vec3 psColor;","uniform float opacity;","varying float vRotation;","const float mid = 0.5;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );","#ifdef USE_MAP","vec2 rotated = vec2(cos(vRotation) * (gl_PointCoord.x - mid) + sin(vRotation) * (gl_PointCoord.y - mid) + mid, cos(vRotation) * (gl_PointCoord.y - mid) - sin(vRotation) * (gl_PointCoord.x - mid) + mid);","gl_FragColor = texture2D( map,  rotated);","#endif",THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),e}(),IFLNoiseShader=function(){function e(){this.uniforms={fTime:{type:"f",value:1},vScale:{type:"v2",value:new THREE.Vector2(1,1)},vOffset:{type:"v2",value:new THREE.Vector2(1,1)}}}return e.prototype.uniforms=null,e.prototype.fragmentShader=["uniform float fTime;","varying vec2 vUv;","vec4 permute( vec4 x ) {","return mod( ( ( x * 34.0 ) + 1.0 ) * x, 289.0 );","}","vec4 taylorInvSqrt( vec4 r ) {","return 1.79284291400159 - 0.85373472095314 * r;","}","float snoise( vec3 v ) {","const vec2 C = vec2( 1.0 / 6.0, 1.0 / 3.0 );","const vec4 D = vec4( 0.0, 0.5, 1.0, 2.0 );","vec3 i  = floor( v + dot( v, C.yyy ) );","vec3 x0 = v - i + dot( i, C.xxx );","vec3 g = step( x0.yzx, x0.xyz );","vec3 l = 1.0 - g;","vec3 i1 = min( g.xyz, l.zxy );","vec3 i2 = max( g.xyz, l.zxy );","vec3 x1 = x0 - i1 + 1.0 * C.xxx;","vec3 x2 = x0 - i2 + 2.0 * C.xxx;","vec3 x3 = x0 - 1. + 3.0 * C.xxx;","i = mod( i, 289.0 );","vec4 p = permute( permute( permute( i.z + vec4( 0.0, i1.z, i2.z, 1.0 ) ) + i.y + vec4( 0.0, i1.y, i2.y, 1.0 ) ) + i.x + vec4( 0.0, i1.x, i2.x, 1.0 ) );","float n_ = 1.0 / 7.0;","vec3 ns = n_ * D.wyz - D.xzx;","vec4 j = p - 49.0 * floor( p * ns.z *ns.z );","vec4 x_ = floor( j * ns.z );","vec4 y_ = floor( j - 7.0 * x_ );","vec4 x = x_ *ns.x + ns.yyyy;","vec4 y = y_ *ns.x + ns.yyyy;","vec4 h = 1.0 - abs( x ) - abs( y );","vec4 b0 = vec4( x.xy, y.xy );","vec4 b1 = vec4( x.zw, y.zw );","vec4 s0 = floor( b0 ) * 2.0 + 1.0;","vec4 s1 = floor( b1 ) * 2.0 + 1.0;","vec4 sh = -step( h, vec4( 0.0 ) );","vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;","vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;","vec3 p0 = vec3( a0.xy, h.x );","vec3 p1 = vec3( a0.zw, h.y );","vec3 p2 = vec3( a1.xy, h.z );","vec3 p3 = vec3( a1.zw, h.w );","vec4 norm = taylorInvSqrt( vec4( dot( p0, p0 ), dot( p1, p1 ), dot( p2, p2 ), dot( p3, p3 ) ) );","p0 *= norm.x;","p1 *= norm.y;","p2 *= norm.z;","p3 *= norm.w;","vec4 m = max( 0.6 - vec4( dot( x0, x0 ), dot( x1, x1 ), dot( x2, x2 ), dot( x3, x3 ) ), 0.0 );","m = m * m;","return 42.0 * dot( m*m, vec4( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 ), dot( p3, x3 ) ) );","}","float surface3( vec3 coord ) {","float n = 0.0;","n += 1.0 * abs( snoise( coord ) );","n += 0.5 * abs( snoise( coord * 2.0 ) );","n += 0.25 * abs( snoise( coord * 4.0 ) );","n += 0.125 * abs( snoise( coord * 8.0 ) );","return n;","}","void main( void ) {","vec3 coord = vec3( vUv, -fTime );","float n = surface3( coord );","gl_FragColor = vec4( vec3( n, n, n ), 1.0 );","}"].join("\n"),e.prototype.vertexShader=["varying vec2 vUv;","uniform vec2 vScale;","uniform vec2 vOffset;","void main( void ) {","vUv = (uv * vScale) + vOffset;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),e}(),IFLPhongFresnelShader=function(){function e(){this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},diffuseMultiplier:{type:"f",value:1},envmapMultiplier:{type:"f",value:2},lightMapMultiplier:{type:"f",value:1},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)},tAux:{type:"t",value:null},mFresnelPower:{type:"f",value:-2.5},windMin:{type:"v2",value:new THREE.Vector2(-400,-800)},windSize:{type:"v2",value:new THREE.Vector2(1e3,1e3)},windDirection:{type:"v3",value:new THREE.Vector3(1,0,0)},tWindForce:{type:"t",value:null},windScale:{type:"f",value:2}}])}return e.prototype.uniforms=null,e.prototype.vertexShader=[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,"varying vec3 vReflect;","uniform sampler2D tAux;","varying float vFresnel;","uniform float mFresnelPower;","#ifdef USE_COLOR","uniform float windScale;","uniform vec2 windMin;","uniform vec2 windSize;","uniform vec3 windDirection;","uniform sampler2D tWindForce;","#endif","void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,"vec4 mvPosition;","#ifdef USE_COLOR","vec4 wpos = modelMatrix * vec4( position.x ,position.y, -position.z, 1.0 );","vec2 totPos = wpos.xz - windMin;","vec2 windUV = totPos / windSize;","float vWindForce = texture2D( tWindForce , windUV ).x;","float windMod = ( (1.0 - vWindForce) * color.r) * windScale;","vec4 pos = vec4( position.x + windMod * windDirection.x, position.y + windMod * windDirection.y , position.z + windMod * windDirection.z,  1.0);","mvPosition = modelViewMatrix *  pos;","#else","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,"#if defined( USE_ENVMAP )","vec3 nWorld = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","vReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );","#endif","float fresnelFactor;","#ifdef USE_MAP","fresnelFactor = 1.0 - texture2D( tAux, vUv ).r;","#else","fresnelFactor = 1.0;","#endif","float fresnelPow =  mFresnelPower + ( 5.0 * fresnelFactor );","float fresnel = pow( 1.0 + dot( normalize( mvPosition.xyz ) , normalize( transformedNormal ) ), fresnelPow );","vFresnel = clamp( fresnel, 0.0, 1.0 );","}"].join("\n"),e.prototype.fragmentShader=[THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float diffuseMultiplier;","uniform float envmapMultiplier;","uniform float lightMapMultiplier;","varying float vFresnel;","#ifdef USE_ENVMAP","varying vec3 vReflect;","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#endif","void main() {","gl_FragColor = vec4( diffuse, opacity );","#ifdef USE_MAP","gl_FragColor = texture2D( map, vUv ) * diffuseMultiplier;","#endif","#ifdef USE_LIGHTMAP","vec4 map2col = texture2D( lightMap, vUv2 );","gl_FragColor *= map2col * lightMapMultiplier;","gl_FragColor.w = map2col.w;","#endif",THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef USE_ENVMAP","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * vReflect.x, vReflect.yz ) ) *  envmapMultiplier;","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) ) * envmapMultiplier;","#endif","float fresnel;","#ifdef DOUBLE_SIDED","fresnel = flipNormal * vFresnel;","#else","fresnel = vFresnel;","#endif","#ifdef USE_SPECULARMAP","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz * texelSpecular.xyz ,  fresnel * specularStrength   );","#else","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz,  fresnel * specularStrength  );","#endif","#endif",THREE.ShaderChunk.fog_fragment,"}"].join("\n"),e}(),IFLPhongFresnelShaderDoubleLightMap=function(e){function t(){this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},diffuseMultiplier:{type:"f",value:1},envmapMultiplier:{type:"f",value:2},lightMapMultiplier:{type:"f",value:1},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)},lightmapBlend:{type:"f",value:0},lightMap2:{type:"t",value:null},tAux:{type:"t",value:null},mFresnelPower:{type:"f",value:-2.5},windMin:{type:"v2",value:new THREE.Vector2(-400,-800)},windSize:{type:"v2",value:new THREE.Vector2(1e3,1e3)},windDirection:{type:"v3",value:new THREE.Vector3(1,0,0)},tWindForce:{type:"t",value:null},windScale:{type:"f",value:2}}]),this.fragmentShader=[THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"uniform vec3 diffuse;","uniform float opacity;","uniform float lightmapBlend;","uniform sampler2D lightMap2;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float diffuseMultiplier;","uniform float envmapMultiplier;","uniform float lightMapMultiplier;","uniform float vFresnel;","#ifdef USE_ENVMAP","varying vec3 vReflect;","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#endif","void main() {","gl_FragColor = vec4( diffuse, opacity );","#ifdef USE_MAP","gl_FragColor = texture2D( map, vUv ) * diffuseMultiplier;","#endif","#ifdef USE_LIGHTMAP","vec4 map2col = mix( texture2D( lightMap, vUv2 ), texture2D( lightMap2, vUv2 ), lightmapBlend);","gl_FragColor *= map2col * lightMapMultiplier;","gl_FragColor.w = map2col.w;","#endif",THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef USE_ENVMAP","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * vReflect.x, vReflect.yz ) ) * envmapMultiplier;","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) ) * envmapMultiplier;","#endif","float fresnel;","#ifdef DOUBLE_SIDED","fresnel = flipNormal * vFresnel;","#else","fresnel = vFresnel;","#endif","#ifdef USE_SPECULARMAP","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz * texelSpecular.xyz ,  fresnel * specularStrength   );","#else","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz,  fresnel * specularStrength  );","#endif","#endif",THREE.ShaderChunk.fog_fragment,"}"].join("\n")}return __extends(t,e),t.prototype.uniforms=null,t}(IFLPhongFresnelShader),IFLSal2x=function(){function e(){this.uniforms={tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(0,0)},opacity:{type:"f",value:1}}}return e.prototype.uniforms=null,e.prototype.vertexShader=["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),e.prototype.fragmentShader=["#ifdef GL_ES","precision mediump float;","#endif","uniform sampler2D tDiffuse;","uniform vec2 resolution;","uniform float opacity;","varying vec2 vUv;","void main()","{","vec2 UL, UR, DL, DR;","float dx = pow(resolution.x, -1.0) * 0.25;","float dy = pow(resolution.y, -1.0) * 0.25;","vec4 dt = vec4(1.0, 1.0, 1.0, 1.0);","UL = vUv + vec2(-dx,-dy);","UR = vUv + vec2( dx,-dy);","DL = vUv + vec2(-dx, dy);","DR = vUv + vec2( dx, dy);","vec4 c00 = texture2D(tDiffuse, UL);","vec4 c20 = texture2D(tDiffuse, UR);","vec4 c02 = texture2D(tDiffuse, DL);","vec4 c22 = texture2D(tDiffuse, DR);","float m1 = dot(abs(c00-c22), dt) + 0.001;","float m2 = dot(abs(c02-c20), dt) + 0.001;","gl_FragColor = (m1*(c02+c20) + m2*(c22+c00)) / (2.0*(m1+m2));","gl_FragColor.a *= opacity;","}"].join("\n"),e}(),IFLSkyCubeShader=function(){function e(){this.uniforms={tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}}}return e.prototype.uniforms=null,e.prototype.vertexShader=["varying vec3 vViewPosition;","void main() {","vec4 mPosition = modelMatrix * vec4( position, 1.0 );","vViewPosition = cameraPosition - mPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),e.prototype.fragmentShader=["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vViewPosition;","void main() {","vec3 wPos = cameraPosition - vViewPosition;","gl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );","}"].join("\n"),e}(),IFLStormFresnelShader=function(){function e(){this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.envmap,{envmapMul:{type:"f",value:3},envmapMix:{type:"f",value:.6},envmapPow:{type:"f",value:1},specmapMul:{type:"f",value:.6},specmapPow:{type:"f",value:.1},fresnelPower:{type:"f",value:0},specMap:{type:"t",value:null},cubeX:{type:"f",value:-126},cubeY:{type:"f",value:107},cubeZ:{type:"f",value:51}}])}return e.prototype.uniforms=null,e.prototype.vertexShader=["#define PHONG","#define USE_ENVMAP",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"varying vec3 vViewPosition;","varying vec3 vNormal;","varying vec3 vObjectNormal;","varying vec3 vReflect;","varying vec3 vWorldPosition;","void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = transformedNormal;","vObjectNormal = objectNormal;",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 nWorld = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","vReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );","#endif","vWorldPosition = mPosition.xyz;","}"].join("\n"),e.prototype.fragmentShader=[THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"uniform vec3 diffuse;","uniform float opacity;","uniform float envmapMix;","uniform float envmapMul;","uniform float envmapPow;","uniform float specmapMul;","uniform float specmapPow;","uniform float fresnelPower;","uniform float cubeX;","uniform float cubeY;","uniform float cubeZ;","uniform samplerCube specMap;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;","varying vec3 vNormal;","varying vec3 vObjectNormal;","#ifdef USE_ENVMAP","varying vec3 vReflect;","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#endif","#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 nmap = texture2D( normalMap, vUv ).xyz;","nmap.y = 1.0 - nmap.y;","vec3 mapN = nmap * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif","void main() {","gl_FragColor = vec4( diffuse, opacity );","#ifdef USE_MAP","gl_FragColor = texture2D( map, vUv );","#endif","#ifdef USE_LIGHTMAP","vec4 map2col = texture2D( lightMap, vUv2 );","gl_FragColor *= map2col;","gl_FragColor.w = map2col.w;","#endif",THREE.ShaderChunk.alphatest_fragment,"vec3 viewPosition = normalize( vViewPosition );","vec3 normal = normalize( vNormal );","#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 objectNormal = normalize( vObjectNormal );","objectNormal = perturbNormal2Arb( -viewPosition, objectNormal );","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","reflectVec = reflect( cameraToVertex, objectNormal );","#else","reflectVec = vReflect;","#endif","vec3 sunNormal = normalize( vec3( cubeX, cubeY, cubeZ ) );","reflectVec = reflect( reflectVec, sunNormal );","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 envColor  = textureCube( envMap,  flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","vec4 specColor = textureCube( specMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 envColor  = textureCube( envMap,  vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","vec4 specColor = textureCube( specMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","envColor.xyz  *= pow( envColor.xyz, vec3( envmapPow, envmapPow, envmapPow ) );","envColor.xyz  *= envmapMul;","specColor.xyz  = pow( specColor.xyz, vec3( specmapPow, specmapPow, specmapPow ) );","specColor.xyz *= specmapMul;","gl_FragColor.xyz *= mix( vec3(1.0, 1.0, 1.0), envColor.xyz, envmapMix);","gl_FragColor.xyz *= specColor.xyz;","#endif",THREE.ShaderChunk.fog_fragment,"}"].join("\n"),e}(),IFLTerrainLambertShader=function(){function e(){this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap,{tBlendmap:{type:"t",value:null},lightMapMultiplier:{type:"f",value:3},offsetRepeatR:{type:"v4",value:new THREE.Vector4(1,1,1,1)},offsetRepeatG:{type:"v4",value:new THREE.Vector4(1,1,1,1)},offsetRepeatB:{type:"v4",value:new THREE.Vector4(1,1,1,1)},enableDiffuseR:{type:"i",value:0},enableDiffuseG:{type:"i",value:0},enableDiffuseB:{type:"i",value:0},tDiffuseR:{type:"t",value:null},tDiffuseG:{type:"t",value:null},tDiffuseB:{type:"t",value:null},enableSpecularR:{type:"i",value:0},enableSpecularG:{type:"i",value:0},enableSpecularB:{type:"i",value:0},tSpecularR:{type:"t",value:null},tSpecularG:{type:"t",value:null},tSpecularB:{type:"t",value:null},ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}])}return e.prototype.uniforms=null,e.prototype.vertexShader=["#define LAMBERT",THREE.ShaderChunk.map_pars_vertex,"uniform vec4 offsetRepeatR;","uniform vec4 offsetRepeatG;","uniform vec4 offsetRepeatB;","varying vec2 vUvUnscaled;","varying vec2 vUvR;","varying vec2 vUvG;","varying vec2 vUvB;",THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {","#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv  = uv * offsetRepeat.zw + offsetRepeat.xy;","vUvR = uv * offsetRepeatR.zw + offsetRepeatR.xy;","vUvG = uv * offsetRepeatG.zw + offsetRepeatG.xy;","vUvB = uv * offsetRepeatB.zw + offsetRepeatB.xy;","vUvUnscaled = uv;","#endif",THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),e.prototype.fragmentShader=["uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,"uniform sampler2D tBlendmap;","uniform bool enableDiffuseR;","uniform bool enableDiffuseG;","uniform bool enableDiffuseB;","uniform sampler2D tDiffuseR;","uniform sampler2D tDiffuseG;","uniform sampler2D tDiffuseB;","uniform float lightMapMultiplier;","varying vec2 vUvUnscaled;","varying vec2 vUvR;","varying vec2 vUvG;","varying vec2 vUvB;","uniform sampler2D lightMap;",THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"uniform bool enableSpecularR;","uniform bool enableSpecularG;","uniform bool enableSpecularB;","uniform sampler2D tSpecularR;","uniform sampler2D tSpecularG;","uniform sampler2D tSpecularB;","void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vUv );","#ifdef USE_COLOR","#else","vec4 vColor = texture2D( tBlendmap, vUvUnscaled );","#endif","vec4 fragColorR;","fragColorR = texture2D( tDiffuseR, vUvR );","gl_FragColor.xyz = mix( gl_FragColor.xyz, fragColorR.xyz, vColor.r );","vec4 fragColorG;","fragColorG = texture2D( tDiffuseG, vUvG );","gl_FragColor.xyz = mix( gl_FragColor.xyz, fragColorG.xyz, vColor.g );","vec4 fragColorB;","#ifdef GAMMA_INPUT","fragColorB = texture2D( tDiffuseB, vUvB );","fragColorB.xyz *= fragColorB.xyz;","#else","fragColorB = texture2D( tDiffuseB, vUvB );","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, fragColorB.xyz, vColor.b );","#endif",THREE.ShaderChunk.alphatest_fragment,"float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","#ifdef USE_COLOR","if( enableSpecularR )","texelSpecular = vec4( mix( texelSpecular.xyz, texture2D( tSpecularR, vUv ).xyz, vColor.r ), 1.0);","if( enableSpecularG )","texelSpecular = vec4( mix( texelSpecular.xyz, texture2D( tSpecularG, vUv ).xyz, vColor.g ), 1.0);","if( enableSpecularR )","texelSpecular = vec4( mix( texelSpecular.xyz, texture2D( tSpecularB, vUv ).xyz, vColor.b ), 1.0);","#endif","#else","specularStrength = 1.0;","#endif"
,"#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * ( texture2D( lightMap, vUvUnscaled ) * lightMapMultiplier );","#endif",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),e}(),IFLTornadoShader=function(){function e(){this.uniforms={tDiffuse:{type:"t",value:null},time:{type:"f",value:0},resolution:{type:"v2",value:new THREE.Vector2(0,0)},camera_matrix:{type:"m4",value:new THREE.Matrix4},tornado_bounding_radius:{type:"f",value:80},light_harshness:{type:"f",value:.3},light_darkness:{type:"f",value:1},cloud_edge_sharpness:{type:"f",value:1},storm_tint:{type:"v3",value:new THREE.Vector3(1,1,1)},final_colour_scale:{type:"f",value:10},gamma_correction:{type:"f",value:1.7},environment_rotation:{type:"f",value:.2},storm_alpha_correction:{type:"f",value:1.7},tornado_density:{type:"f",value:.2},tornado_height:{type:"f",value:120},spin_speed:{type:"f",value:.2},base_step_scaling:{type:"f",value:.7},min_step_size:{type:"f",value:1},cam_fov:{type:"f",value:60},dist_approx:{type:"f",value:1}}}return e.prototype.uniforms=null,e.prototype.vertexShader=["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),e.prototype.fragmentShader=["// The 'Storm Shader' by Dmytry Lavrov, Copyright 2012 (http://dmytry.com/) with permission from Moritz Helmsteadter at The Max Plank Institute","// is licensed under a Creative Commons attribution license http://creativecommons.org/licenses/by/3.0","// free to share and remix for any purpose as long as it includes this note.","#ifdef GL_ES","precision mediump float;","#endif","// change these to 0 to disable specific features","#define BENT 0","#define FAKE_DIRECTIONAL_LIGHT 0","#define ENVIRONMENT_TEXTURE 1","#define NEGATE_Z 1  /// set to 1 for production viewer to match opengl convention","#define USE_BOUNDING_VOLUME 1","uniform float cam_fov;","const float pi=3.141592654;","#if BENT","const float bend_height=50.0;","const float bend_displacement=20.0;/// Watch out for bounding volume. The tornado's radius is about 25 units.","#endif","uniform float tornado_bounding_radius; /// = max(pow(tornado_height,1.5)*0.03, bend_displacement)+10;","uniform float light_harshness;/// adjust these two parameters to chage the look of tornado.","uniform float light_darkness;","uniform float cloud_edge_sharpness;/// decrease to make fuzzier edge.","uniform vec3 storm_tint;","uniform float final_colour_scale;","uniform float gamma_correction;","uniform float environment_rotation;","uniform float storm_alpha_correction;","uniform float tornado_density;","uniform float tornado_height;","uniform float spin_speed;","const int number_of_steps=180;/// number of isosurface raytracing steps","uniform float base_step_scaling;/// Larger values allow for faster rendering but cause rendering artifacts. When stepping the isosurface, the value is multiplied by this number to obtain the distance of each step","uniform float min_step_size;/// Minimal step size, this value is added to the step size, larger values allow to speed up the rendering at expense of artifacts.","uniform float dist_approx;","// input values passed into this shader","uniform float time;/// use for blinking effects","uniform vec2 resolution;/// screen resolution","uniform mat4 camera_matrix; /// transform from camera to the world (not from the world to the camera","const vec3 towards_sun=vec3(1,5.0,1.0);","#if ENVIRONMENT_TEXTURE","uniform sampler2D tDiffuse;","#endif","float hash( float n )","{","return fract(sin(n)*43758.5453);","}","float snoise( in vec3 x )","{","vec3 p = floor(x);","vec3 f = fract(x);","f = f*f*(3.0-2.0*f);","float n = p.x + p.y*57.0+p.z*137.0;","float res = 1.0-2.0*mix(","mix(mix( hash(n+  0.0), hash(n+  1.0),f.x), mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y),","mix(mix( hash(n+  137.0), hash(n+  138.0),f.x), mix( hash(n+ 57.0+137.0), hash(n+ 58.0+137.0),f.x),f.y),","f.z",");","return res;","}","mat2 Spin(float angle){","return mat2(cos(angle),-sin(angle),sin(angle),cos(angle));","}","float ridged(float f){","return 1.0-2.0*abs(f);","}","float sigmoid(float f){","if(f<0.0)return 0.0;","if(f>1.0)return 1.0;","return f*f*(3.0-f*2.0);","}","float Shape(vec3 q)/// the isosurface shape function, the surface is at o(q)=0","{ ","float t=time;","if(q.z<0.0)return length(q);","#if BENT","q.x+=sigmoid(1.0-q.z/bend_height)*bend_displacement;","#endif","vec3 spin_pos=vec3(Spin(t-sqrt(q.z))*q.xy,q.z-t*5.0);","float zcurve=pow(q.z,1.5)*0.03;","float v1=clamp(zcurve*0.2,0.1,1.0)*snoise(spin_pos*vec3(0.1,0.1,0.1))*5.0;","float v=abs(length(q.xy)-zcurve)-5.5-v1;","v=v-ridged(snoise(vec3(Spin(t*1.5+0.1*q.z)*q.xy,q.z-t*4.0)*0.3))*1.2;","//v+=max(0.0,q.z-tornado_height);","return v;","}","vec2 TextureCoord(vec3 q){","#if BENT","q.x+=sigmoid(1.0-q.z/bend_height)*bend_displacement;","#endif","//return vec2(atan(q.y,q.x)*(0.5/pi), 1.0-q.z/tornado_height);","return vec2(mod(atan(q.y,q.x)*(0.5/pi)+environment_rotation,1.0), mod(1.0-q.z/tornado_height,1.0));","}","//Normalized gradient of the field at the point q , used as surface normal","vec3 GetNormal(vec3 q)","{","vec3 f=vec3(0.5,0.0,0.0);","float b=Shape(q);","return normalize(vec3(Shape(q+f.xyy)-b, Shape(q+f.yxy)-b, Shape(q+f.yyx)-b));","}","void Fog_(float dist, out vec3 colour, out vec3 multiplier){/// calculates fog colour, and the multiplier for the colour of item behind the fog. If you do two intervals consecutively it will calculate the result correctly.","vec3 fog=exp(-dist*vec3(0.03,0.05,0.1)*0.2);","colour=vec3(1.0)-fog;","multiplier=fog;/// (1.0-a)+a*(1.0-b + b*x) = 1.0-a+a-ab+abx = 1.0-ab+abx","}","void FogStep(float dist, vec3 fog_absorb, vec3 fog_reemit, inout vec3 colour, inout vec3 multiplier){/// calculates fog colour, and the multiplier for the colour of item behind the fog. If you do two intervals consecutively it will calculate the result correctly.","vec3 fog=exp(-dist*fog_absorb);","colour+=multiplier*(storm_tint-fog)*fog_reemit;","multiplier*=fog;/// (1.0-a)+a*(1.0-b + b*x) = 1.0-a+a-ab+abx = 1.0-ab+abx","}","bool RayCylinderIntersect(vec3 org, vec3 dir, out float min_dist, out float max_dist){ ","vec2 p=org.xy;","vec2 d=dir.xy;","float r=tornado_bounding_radius;","float a=dot(d,d)+1.0E-10;/// A in quadratic formula , with a small constant to avoid division by zero issue","float det, b;","b = -dot(p,d); /// -B/2 in quadratic formula","/// AC = (p.x*p.x + p.y*p.y + p.z*p.z)*dd + r*r*dd ","det=(b*b) - dot(p,p)*a + r*r*a;/// B^2/4 - AC = determinant / 4","if (det<0.0){","return false;","}","det= sqrt(det); /// already divided by 2 here","min_dist= (b - det)/a; /// still needs to be divided by A","max_dist= (b + det)/a;  ","if(max_dist>0.0){","return true;","}else{","return false;","}","}","void RaytraceFoggy(vec3 org, vec3 dir, float min_dist, float max_dist, inout vec3 colour, inout vec3 multiplier){","vec3 q=org+dir*min_dist;","vec3 pp;","float d=0.0;","float old_d=d;","float dist=min_dist;","#if ENVIRONMENT_TEXTURE","vec3 tx_colour = vec3(0.0, 0.0, 0.0);","float rrr=180.0/5.0;","for(int i=0;i<5;i++)","tx_colour += texture2D(tDiffuse, TextureCoord(org+dir*(min_dist+min_step_size*rrr*dist_approx))).xyz;","tx_colour = (tx_colour / 5.0) * 0.35;","#endif","float step_scaling=base_step_scaling;","float extra_step=min_step_size;","for(int i=0;i<number_of_steps;i++)","{","old_d=d;","float density=-Shape(q);","d=max(density*step_scaling,0.0);","float step_dist=d+extra_step;","if(density>0.0){","float d2=-Shape(q+towards_sun);","//float brightness=exp(-0.7*clamp(d2,-10.0,20.0));","float v=-0.6*density;","#if FAKE_DIRECTIONAL_LIGHT","v-=clamp(d2*light_harshness,0.0,light_darkness);","#endif","float brightness=exp(v);","vec3 fog_colour=vec3(brightness);","#if ENVIRONMENT_TEXTURE","//vec3 tx_colour=texture2D(tDiffuse, TextureCoord(q)).xyz;","fog_colour *= tx_colour;","#endif","//FogStep(step_dist*0.2, clamp(density*cloud_edge_sharpness, 0.0, 1.0)*vec3(1,1,1), fog_colour, colour, multiplier);","FogStep(step_dist*tornado_density, clamp(density*cloud_edge_sharpness, 0.0, 1.0)*vec3(1,1,1), fog_colour, colour, multiplier);","}","if(dist>max_dist || multiplier.x<0.01){","return;","}","dist+=step_dist; ","q=org+dist*dir;","}   ","return;","}","void main(void)","{","vec2 p = -1.0 + 2.0 * gl_FragCoord.xy / resolution.xy;","p.y *= resolution.y/resolution.x;","float dirz=1.0/tan(cam_fov*0.5*pi/180.0);","#if NEGATE_Z","dirz=-dirz;","#endif","//dirz=-2.5;","vec3 dir=normalize(vec3(p.x,p.y,dirz));","dir=(camera_matrix*vec4(dir,0.0)).xyz;","//Raymarching the isosurface:","float dist;","vec3 multiplier=vec3(1.0);","vec3 color=vec3(0.0);","vec3 org=camera_matrix[3].xyz;/// origin of the ray","float min_dist=0.0, max_dist=1.0E4;","#if USE_BOUNDING_VOLUME","if(!RayCylinderIntersect(org, dir, min_dist, max_dist)) {","discard;","return;","}","min_dist=max(min_dist,0.0);","#endif","RaytraceFoggy(org, dir, min_dist, max_dist, color, multiplier);","vec3 col = pow(color, vec3(gamma_correction))*final_colour_scale;","float a = 1.0 - (multiplier.r);","gl_FragColor = vec4(col, pow(a, storm_alpha_correction));","}"].join("\n"),e}(),IFLTornadoShaderWin=function(){function e(){this.uniforms={tDiffuse:{type:"t",value:null},time:{type:"f",value:0},resolution:{type:"v2",value:new THREE.Vector2(0,0)},camera_matrix:{type:"m4",value:new THREE.Matrix4},light_harshness:{type:"f",value:.3},light_darkness:{type:"f",value:1},cloud_edge_sharpness:{type:"f",value:1},storm_tint:{type:"v3",value:new THREE.Vector3(1,1,1)},final_colour_scale:{type:"f",value:10},gamma_correction:{type:"f",value:1.7},environment_rotation:{type:"f",value:.2}}}return e.prototype.uniforms=null,e.prototype.vertexShader=["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),e.prototype.fragmentShader=["#ifdef GL_ES","precision mediump float;","#endif","/// change these to 0 to disable specific features","#define BENT 1","#define FAKE_DIRECTIONAL_LIGHT 1","#define ENVIRONMENT_TEXTURE 0","#define NEGATE_Z 1  /// set to 1 for production viewer to match opengl convention","#define USE_BOUNDING_VOLUME 1","const float cam_fov=60.0;","const float pi=3.141592654;","const float tornado_height=80.0;/// how tall is the tornado","#if BENT","const float bend_height=50.0;","const float bend_displacement=20.0;/// Watch out for bounding volume. The tornado's radius is about 25 units.","#endif","const float tornado_bounding_radius=30.0; /// = max(pow(tornado_height,1.5)*0.03, bend_displacement)+10;","uniform float environment_rotation; // 0 is 0 degrees, 0.5 is 180 degrees, 1 is 360 degrees","uniform float light_harshness;/// adjust these two parameters to chage the look of tornado.","uniform float light_darkness;","uniform float cloud_edge_sharpness;/// decrease to make fuzzier edge.","uniform vec3 storm_tint;","uniform float final_colour_scale;","uniform float gamma_correction;","const float spin_speed=0.2;","const int number_of_steps=180;/// number of isosurface raytracing steps","const float base_step_scaling=0.9;/// Larger values allow for faster rendering but cause rendering artifacts. When stepping the isosurface, the value is multiplied by this number to obtain the distance of each step","const float min_step_size=1.0;/// Minimal step size, this value is added to the step size, larger values allow to speed up the rendering at expense of artifacts.","/// input values passed into this shader","uniform float time;/// use for blinking effects","uniform vec2 resolution;/// screen resolution","uniform mat4 camera_matrix; /// transform from camera to the world (not from the world to the camera","uniform sampler2D tDiffuse;","const vec3 towards_sun=vec3(1,1,5.0);","float hash( float n )","{","return fract(sin(n)*43758.5453);","}","float snoise( in vec3 x )","{","vec3 p = floor(x);","vec3 f = fract(x);","f = f*f*(3.0-2.0*f);","float n = p.x + p.y*57.0+p.z*137.0;","float res = 1.0-2.0*mix(","mix(mix( hash(n+  0.0), hash(n+  1.0),f.x), mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y),","mix(mix( hash(n+  137.0), hash(n+  138.0),f.x), mix( hash(n+ 57.0+137.0), hash(n+ 58.0+137.0),f.x),f.y),","f.z",");","return res;","}","mat2 Spin(float angle){","return mat2(cos(angle),-sin(angle),sin(angle),cos(angle));","}","float ridged(float f){","return 1.0-2.0*abs(f);","}","float sigmoid(float f){","if(f<0.0)return 0.0;","if(f>1.0)return 1.0;","return f*f*(3.0-f*2.0);","}","float Shape(vec3 q)/// the isosurface shape function, the surface is at o(q)=0","{ ","float t=time;","if(q.z<0.0)return length(q);","#if BENT","q.x+=sigmoid(1.0-q.z/bend_height)*bend_displacement;","#endif","vec3 spin_pos=vec3(Spin(t-sqrt(q.z))*q.xy,q.z-t*5.0);","float zcurve=pow(q.z,1.5)*0.03;","float v1=clamp(zcurve*0.2,0.1,1.0)*snoise(spin_pos*vec3(0.1,0.1,0.1))*5.0;","float v=abs(length(q.xy)-zcurve)-5.5-v1;","v=v-ridged(snoise(vec3(Spin(t*1.5+0.1*q.z)*q.xy,q.z-t*4.0)*0.3))*1.2;","v+=max(0.0,q.z-tornado_height);","return v;","}","vec2 TextureCoord(vec3 q){","#if BENT","q.x+=sigmoid(1.0-q.z/bend_height)*bend_displacement;","#endif","return vec2(atan(q.y,q.x)*(0.5/pi)+environment_rotation, 1.0-q.z/tornado_height);","}","//Normalized gradient of the field at the point q , used as surface normal","vec3 GetNormal(vec3 q)","{","vec3 f=vec3(0.5,0.0,0.0);","float b=Shape(q);","return normalize(vec3(Shape(q+f.xyy)-b, Shape(q+f.yxy)-b, Shape(q+f.yyx)-b));","}","void Fog_(float dist, out vec3 colour, out vec3 multiplier){/// calculates fog colour, and the multiplier for the colour of item behind the fog. If you do two intervals consecutively it will calculate the result correctly.","vec3 fog=exp(-dist*vec3(0.03,0.05,0.1)*0.2);","colour=vec3(1.0)-fog;","multiplier=fog;/// (1.0-a)+a*(1.0-b + b*x) = 1.0-a+a-ab+abx = 1.0-ab+abx","}","void FogStep(float dist, vec3 fog_absorb, vec3 fog_reemit, inout vec3 colour, inout vec3 multiplier){/// calculates fog colour, and the multiplier for the colour of item behind the fog. If you do two intervals consecutively it will calculate the result correctly.","vec3 fog=exp(-dist*fog_absorb);","colour+=multiplier*(storm_tint-fog)*fog_reemit;","multiplier*=fog;/// (1.0-a)+a*(1.0-b + b*x) = 1.0-a+a-ab+abx = 1.0-ab+abx","}","bool RayCylinderIntersect(vec3 org, vec3 dir, out float min_dist, out float max_dist){ ","vec2 p=org.xy;","vec2 d=dir.xy;","float r=tornado_bounding_radius;","float a=dot(d,d)+1.0E-10;/// A in quadratic formula , with a small constant to avoid division by zero issue","float det, b;","b = -dot(p,d); /// -B/2 in quadratic formula","/// AC = (p.x*p.x + p.y*p.y + p.z*p.z)*dd + r*r*dd ","det=(b*b) - dot(p,p)*a + r*r*a;/// B^2/4 - AC = determinant / 4","if (det<0.0){","return false;","}","det= sqrt(det); /// already divided by 2 here","min_dist= (b - det)/a; /// still needs to be divided by A","max_dist= (b + det)/a;  ","if(max_dist>0.0){","return true;","}else{","return false;","}","}","void RaytraceFoggy(vec3 org, vec3 dir, float min_dist, float max_dist, inout vec3 colour, inout vec3 multiplier){","vec3 q=org+dir*min_dist;","vec3 pp;","float d=0.0;","float old_d=d;","float dist=min_dist;","float step_scaling=base_step_scaling;","const float extra_step=min_step_size;","for(int i=0;i<number_of_steps;i++)","{","old_d=d;","float density=-Shape(q);","d=max(density*step_scaling,0.0);","float step_dist=d+extra_step;","if(density>0.0){","float d2=-Shape(q+towards_sun);","//float brightness=exp(-0.7*clamp(d2,-10.0,20.0));","float v=-0.6*density;","#if FAKE_DIRECTIONAL_LIGHT","v-=clamp(d2*light_harshness,0.0,light_darkness);","#endif","float brightness=exp(v);","vec3 fog_colour=vec3(brightness);","#if ENVIRONMENT_TEXTURE","vec3 tx_colour=texture2D(tDiffuse, TextureCoord(q)).xyz;","fog_colour*=tx_colour;          ","#endif","FogStep(step_dist*0.2, clamp(density*cloud_edge_sharpness, 0.0, 1.0)*vec3(1,1,1), fog_colour, colour, multiplier);","}","if(dist>max_dist || multiplier.x<0.01){","return;","}","dist+=step_dist; ","q=org+dist*dir;","}   ","return;","}","void main(void)","{","vec2 p = -1.0 + 2.0 * gl_FragCoord.xy / resolution.xy;","p.y *= resolution.y/resolution.x;","float dirz=1.0/tan(cam_fov*0.5*pi/180.0);","#if NEGATE_Z","dirz=-dirz;","#endif","//dirz=-2.5;","vec3 dir=normalize(vec3(p.x,p.y,dirz));","dir=(camera_matrix*vec4(dir,0.0)).xyz;","//Raymarching the isosurface:","float dist;","vec3 multiplier=vec3(1.0);","vec3 color=vec3(0.0);","vec3 org=camera_matrix[3].xyz;/// origin of the ray","float min_dist=0.0, max_dist=1.0E4;","#if USE_BOUNDING_VOLUME","if(!RayCylinderIntersect(org, dir, min_dist, max_dist)){","return;","}","min_dist=max(min_dist,0.0);","#endif","RaytraceFoggy(org, dir, min_dist, max_dist, color, multiplier);","//vec3 col=color*brightness+multiplier*vec3(0.05,0.07,0.2);","//gl_FragColor=vec4(col , 1.0);","vec3 col = pow(color, vec3(gamma_correction))*final_colour_scale; //ContrastSaturationBrightness(color, 0.9, 1.4); // Adjust contrast / brightness","float a = 1.01 - 1.01*multiplier.r;","gl_FragColor = vec4(col, a);","}"].join("\n"),e}(),IFLWindyParticlesShader=function(){function e(){this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap,{diffuseMultiplier:{type:"f",value:2},alphaMultiplier:{type:"f",value:.3},windMin:{type:"v2",value:new THREE.Vector2(-400,-800)},windSize:{type:"v2",value:new THREE.Vector2(1e3,1e3)},windDirection:{type:"v3",value:new THREE.Vector3(1,0,0)},tWindForce:{type:"t",value:null},windScale:{type:"f",value:10},time:{type:"f",value:0}}])}return e.prototype.uniforms=null,e.prototype.vertexShader=["uniform float size;","uniform float scale;","uniform vec2 windMin;","uniform vec2 windSize;","uniform vec3 windDirection;","uniform sampler2D tWindForce;","uniform float windScale;","uniform float time;","attribute float speed;","varying float fSpeed;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {","vec4 mvPosition;","vec4 wpos = modelMatrix * vec4( position, 1.0 );","wpos.z = -wpos.z;","vec2 totPos = wpos.xz - windMin;","vec2 windUV = totPos / windSize;","float vWindForce = texture2D(tWindForce,windUV).x;","float windMod = (1.0 - vWindForce) * windScale;","vec4 pos = vec4(position , 1.0);","pos.x += windMod * windDirection.x;","pos.y += windMod * windDirection.y;","pos.z += windMod * windDirection.z;","mvPosition = modelViewMatrix *  pos;","fSpeed = speed;","float fSize = size * (1.0 + sin(time * speed));","#ifdef USE_SIZEATTENUATION","gl_PointSize = fSize * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = fSize;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),e.prototype.fragmentShader=["uniform vec3 psColor;","uniform float opacity;","uniform float diffuseMultiplier;","uniform float alphaMultiplier;","varying float fSpeed;","uniform float time;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );","#ifdef USE_MAP","gl_FragColor = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ) * diffuseMultiplier;","gl_FragColor.w = alphaMultiplier * (1.0 + sin(time * fSpeed));","#endif",THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),e}(),IFLLoader=function(){function e(){this.getNeedsUpdateFlag=__bind(this.getNeedsUpdateFlag,this),this.geometryAttributeEnabled=__bind(this.geometryAttributeEnabled,this),this.doParseLibrary=__bind(this.doParseLibrary,this),this.onXHRReadyStatusChange=__bind(this.onXHRReadyStatusChange,this),this.onXHRProgress=__bind(this.onXHRProgress,this),this.onWorkerMessage=__bind(this.onWorkerMessage,this),this.texCache={},this.matCache={},this.geometryLib=[],this.t=(new Date).getTime()}return e.prototype.IFLVertexAttribute={POSITION:0,UV:1,NORMALS:2,TANGENTS:3,BINORMALS:4,TEX_TANGENTS:5,TEX_BINORMALS:6,COLOR:7,JOINT_0:8,JOINT_1:9,JOINT_2:10,JOINT_3:11,JOINT_4:12,JOINT_INDICES:13,JOINT_WEIGHTS:14,SECONDARY_UV:15},e.prototype.library=null,e.prototype.callback=null,e.prototype.xhrCallback=null,e.prototype.callbackProgress=null,e.prototype.worker=null,e.prototype.convertTextureIndex=0,e.prototype.t=0,e.prototype.url=null,e.prototype.loadingPhase=0,e.prototype.totalLoadingPhases=3,e.prototype.sky=null,e.prototype.customMaterialInstancer=null,e.prototype.pickableObjects=null,e.prototype.enableMaterialCache=!0,e.prototype.matCache=null,e.prototype.enableTextureCache=!0,e.prototype.texCache=null,e.prototype.geometryLib=null,e.prototype.doCreateModel=!0,e.prototype.debugWarnings=!1,e.prototype.disposed=!1,e.prototype.initWorker=function(){return this.worker=new Worker("/js/workers/iflworker.js"),this.worker.onmessage=this.onWorkerMessage},e.prototype.onWorkerMessage=function(e){var t,n,r;switch(e.data.type){case"console":return console[e.data.action](e.data.msg);case"progress":return t=e.data.data.progress,r=e.data.data.total,n=e.data.subtype,this.handleProgress(t,r);default:return this[e.data.callback](e.data.data)}},e.prototype.handleProgress=function(e,t){var n,r,i,s;if(this.callbackProgress!=null)return s=100/this.totalLoadingPhases,n=s*this.loadingPhase,r=e*s/t,i=n+r,this.callbackProgress(i,100)},e.prototype.load=function(e,t,n){if(this.disposed)return;return this.loadingPhase=0,this.url=e,this.callback=t,this.callbackProgress=n,this.xhr=new XMLHttpRequest,this.xhr.onreadystatechange=this.onXHRReadyStatusChange,this.xhr.onprogress=this.onXHRProgress,this.xhr.open("GET",e,!0),this.xhr.responseType="arraybuffer",this.xhr.send(null)},e.prototype.onXHRProgress=function(e){if(e.lengthComputable)return this.handleProgress(e.loaded,e.total)},e.prototype.onXHRReadyStatusChange=function(){var e,t;if(this.disposed)return;return this.xhr.readyState===this.xhr.DONE&&(this.xhr.status===200||this.xhr.status===0?(e=(t=this.xhr.response)!=null?t:this.xhr.mozResponseArrayBuffer,this.xhrCallback!=null&&this.xhrCallback(e),this.xhrCallback=null,this.decompressLibrary(e)):console.error("[ IFLLoader ]: Couldn't load [ "+url+" ] [ "+this.xhr.status+" ]")),null},e.prototype.decompressLibrary=function(e){if(this.disposed)return;if(e==null||e.length===0)throw"Error Loading File, length is 0";return this.t=(new Date).getTime(),this.loadingPhase++,this.initWorker(),this.worker.postMessage({type:"inflate",data:e,callback:"parseLibrary"}),null},e.prototype.parseLibrary=function(e){var t;if(this.disposed)return;if(e==null||e.length===0)throw"Error Decompressing Library, length is 0";return t=((new Date).getTime()-this.t)/1e3,this.debugWarnings&&console.log("["+this.url+"] decompression time: "+t+" , raw data length: "+e.length),this.loadingPhase++,this.t=(new Date).getTime(),this.worker.postMessage({type:"kill"}),this.initWorker(),this.rawData=e,this.timer=setTimeout(this.doParseLibrary,500),null},e.prototype.doParseLibrary=function(){var e;if(this.disposed)return;return clearTimeout(this.timer),(e=this.worker)!=null&&e.postMessage({type:"convert_library",data:this.rawData,callback:"onLibraryParsed"}),null},e.prototype.onLibraryParsed=function(e){var t,n,r,i,s,o;if(this.disposed)return;e==null&&"Error Parsing library, is null",this.library=e,r=((new Date).getTime()-this.t)/1e3,this.debugWarnings&&console.log("["+this.url+"] Library Parse time: "+r);for(n in this.IFLLibraryFuncs)this.library[n]=this.IFLLibraryFuncs[n];this.library._contentByID={},o=this.library._content;for(i=0,s=o.length;i<s;i++)t=o[i],this.library._contentByID[t._reference.id]=t;return this.t=(new Date).getTime(),this.worker.postMessage({type:"kill"}),this.initWorker(),this.convertTextures(),null},e.prototype.convertTextures=function(){var e,t,n,r,i,s;if(this.disposed)return;for(t=n=r=this.convertTextureIndex,i=this.library._content.length;n<i;t=n+=1){if(this.library._content[t].iflType==="IFLBitmap"){e=this.library._content[t],this.convertTextureIndex=t+1,e._hasOriginalByteArray?this.worker.postMessage({type:"parse_jpg",image:e._savedBytes,w:e._width,h:e._height,callback:"onTextureConverted"}):this.worker.postMessage({type:"convert_argb",image:e._savedBytes,w:e._width,h:e._height,callback:"onTextureConverted"});return}this.handleProgress(t,this.library._content.length)}return this.doCreateModel?this.createModel():(this.callback(this,null),this.callbackProgress!=null&&this.callbackProgress(100,100),(s=this.worker)!=null&&s.postMessage({type:"kill"})),null},e.prototype.onTextureConverted=function(e){var t;if(this.disposed)return;t=this.library._content[this.convertTextureIndex-1];if(e==null)throw"Bitmap "+t._reference.id+" contains invalid data";return t.converted=e,this.convertTextures(),null},e.prototype.createModel=function(e){var t,n,r,i,s,o;if(this.disposed)return;this.debugWarnings&&console.log("["+this.url+"] convert textures time: "+((new Date).getTime()-this.t)/1e3),this.t=(new Date).getTime(),t=new THREE.Object3D,r=this.library.getRootNodes();for(i=0,s=r.length;i<s;i++)n=r[i],t.add(this.convertNode(n));return this.debugWarnings&&console.log("["+this.url+"] convert node time: "+((new Date).getTime()-this.t)/1e3),e||(this.callback(this,t),this.callbackProgress!=null&&this.callbackProgress(100,100)),(o=this.worker)!=null&&o.postMessage({type:"kill"}),t},e.prototype.convertNode=function(e){var t,n,r,i,s,o,u;switch(e.iflType){case"IFLMesh":i=this.convertMesh(e);break;default:i=new THREE.Object3D}i.name=e._reference.id,i.matrix=this.convertMatrix4(e._transformMatrix),i.scale.getScaleFromMatrix(i.matrix),r=(new THREE.Matrix4).extractRotation(i.matrix),i.rotation.setEulerFromRotationMatrix(i.matrix,i.eulerOrder),i.position.getPositionFromMatrix(i.matrix),u=e.childIDs;for(s=0,o=u.length;s<o;s++)n=u[s],t=this.library.getContent(n.id),t&&i.add(this.convertNode(t));return i},e.prototype.convertMatrix4=function(e){return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},e.prototype.convertMesh=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;f=e.verticesDecomposed._data[this.IFLVertexAttribute.POSITION],v=e.verticesDecomposed._data[this.IFLVertexAttribute.UV],v==null&&this.debugWarnings&&console.warn("Mesh "+e._reference.id+" has no UVs"),c=e.verticesDecomposed._data[this.IFLVertexAttribute.SECONDARY_UV],a=e.verticesDecomposed._data[this.IFLVertexAttribute.NORMALS],a==null&&this.debugWarnings&&console.warn("Mesh "+e._reference.id+" has no Normals"),d=e.verticesDecomposed._data[this.IFLVertexAttribute.TEX_TANGENTS],r=e.verticesDecomposed._data[this.IFLVertexAttribute.COLOR],n=0,r!=null&&(n=e.verticesDecomposed._vertexAttributeLengths[this.IFLVertexAttribute.COLOR]),p=e.verticesDecomposed._data[this.IFLVertexAttribute.JOINT_WEIGHTS],h=e.verticesDecomposed._data[this.IFLVertexAttribute.JOINT_INDICES],o=p!=null&&h!=null,f.length<65535&&!o&&e.subMeshes.length===1&&!this.pickableObjects[e._reference.id]&&c==null?i=this.convertBufferGeometry(e,f,v,a,d,r,n,o,p,h,c):i=this.convertGeometry(e,f,v,a,d,r,n,o,p,h,c),i.hasTangents=d!=null,this.geometryLib.push(i),u=e.subMeshes.length===1?i.materials[0]:new THREE.MeshFaceMaterial,u!=null&&(u.skinning=o),o?l=new THREE.SkinnedMesh(i,u):l=new THREE.Mesh(i,u);if(o){y=l.geometry.bones;for(s=m=0,g=y.length;m<g;s=++m)t=y[s],l.boneInverses[s]=t.invBindMatrix}return l.castShadow=l.receiveShadow=!0,this.pickableObjects[e._reference.id]===!0&&(l.pickable=!0),l},e.prototype.convertBufferGeometry=function(e,t,n,r,i,s,o,u,a,f,l){var c,h,p;return c=new THREE.BufferGeometry,c.dynamic=!1,h=e.subMeshes[0].indexBuffer._rawData,c.attributes={},c.attributes.index={itemSize:1,array:new Int16Array(h.length),numItems:h.length},c.attributes.index.array.set(h),c.attributes.position={itemSize:3,array:t,numItems:t.length},n&&(c.attributes.uv={itemSize:2,array:n,numItems:n.length}),r&&(c.attributes.normal={itemSize:3,array:r,numItems:r.length}),s&&(c.attributes.color={itemSize:o,array:s,numItems:s.length}),i&&(c.attributes.tangent={itemSize:3,array:i,numItems:i.length}),c.offsets=[{start:0,count:h.length,index:0}],p=this.convertMaterial(e.subMeshes[0],e._reference.id),c.materials=[p],c},e.prototype.convertGeometry=function(e,t,n,r,i,s,o,u,a,f,l){var c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft;$="",t.length>=65535&&($+="[Vertices > 65535]"),u&&($+="[Is Skinned Mesh]"),e.subMeshes.length>1&&($+="[Has Submeshes]"),this.pickableObjects[e._reference.id]===!0&&($+="[Is Marked as Pickable]"),l!=null&&($+="[Has Second UVs]"),this.debugWarnings&&console.warn("["+this.url+"] Warning: ["+e._reference.id+"] is not using BufferGeometry (faster method) because "+$),S=new THREE.Geometry,S.dynamic=!1,l!=null&&(S.faceVertexUvs[1]=[]),m=[],d=[],h=[],v=[],c=[],p={},z={},I=0;if(!t)return new THREE.Object3D;for(x=et=0,ot=t.length;et<ot;x=et+=3)u?(W=new THREE.Vector3(t[x],t[x+1],t[x+2]),S.vertices.push(W),V=W.lengthSq(),V>I&&(I=V)):(q=t[x],R=t[x+1],U=t[x+2],p[q+"_"+R+"_"+U]||(W=new THREE.Vector3(q,R,U),V=W.lengthSq(),V>I&&(I=V),p[q+"_"+R+"_"+U]={index:S.vertices.length,vertex:W},S.vertices.push(p[q+"_"+R+"_"+U].vertex)),z[x/3]=p[q+"_"+R+"_"+U].index);S.boundingSphere={radius:Math.sqrt(I)};if(u){Q=e.verticesDecomposed._vertexAttributeLengths[this.IFLVertexAttribute.JOINT_INDICES];if(Q<=2)for(x=tt=0,ut=f.length;0<=ut?tt<ut:tt>ut;x=tt+=Q)J=Math.floor(x+Q/2),S.skinWeights.push(new THREE.Vector4(a[x],a[J],0,0)),S.skinIndices.push(new THREE.Vector4(f[x],f[J],0,0));S.bones=this.convertBones(e),S.animation=this.convertAnimations(S.bones,e)}b=new THREE.UV(0,0),at=e.subMeshes;for(Y=nt=0,it=at.length;nt<it;Y=++nt){G=at[Y],F=this.convertMaterial(G,e._reference.id),F.skinning=u,Z=F.switchUVs===!0,S.materials.push(F),B=G.indexBuffer._rawData;for(j=rt=0,st=B.length,ft=3;rt<st;j=rt+=ft)T=B[j],L=B[j+1],_=B[j+2],N=T*2,A=L*2,D=_*2,C=T*3,O=L*3,P=_*3,k=T*4,M=L*4,H=_*4,u?g=new THREE.Face3(T,L,_,null,null,Y):g=new THREE.Face3(z[T],z[L],z[_],null,null,Y),y=S.faces.length,X=Z?1:0,K=Z?0:1,E=S.faceVertexUvs[X][y]=[],n!=null?(E.push(m[N]?m[N]:m[N]=new THREE.UV(n[N],n[N+1])),E.push(m[A]?m[A]:m[A]=new THREE.UV(n[A],n[A+1])),E.push(m[D]?m[D]:m[D]=new THREE.UV(n[D],n[D+1]))):(E.push(b),E.push(b),E.push(b)),l!=null&&(w=S.faceVertexUvs[K][y]=[],w.push(d[N]?d[N]:d[N]=new THREE.UV(l[N],l[N+1])),w.push(d[A]?d[A]:d[A]=new THREE.UV(l[A],l[A+1])),w.push(d[D]?d[D]:d[D]=new THREE.UV(l[D],l[D+1]))),r!=null&&(g.vertexNormals.push(h[C]?h[C]:h[C]=new THREE.Vector3(r[C],r[C+1],r[C+2])),g.vertexNormals.push(h[O]?h[O]:h[O]=new THREE.Vector3(r[O],r[O+1],r[O+2])),g.vertexNormals.push(h[P]?h[P]:h[P]=new THREE.Vector3(r[P],r[P+1],r[P+2]))),i!=null&&(g.vertexTangents.push(v[C]?v[C]:v[C]=new THREE.Vector4(i[C],i[C+1],i[C+2],1)),g.vertexTangents.push(v[O]?v[O]:v[O]=new THREE.Vector4(i[O],i[O+1],i[O+2],1)),g.vertexTangents.push(v[P]?v[P]:v[P]=new THREE.Vector4(i[P],i[P+1],i[P+2],1))),s!=null&&(o===3&&(g.vertexColors.push(c[C]?c[C]:c[C]=(new THREE.Color).setRGB(s[C],s[C+1],s[C+2])),g.vertexColors.push(c[O]?c[O]:c[O]=(new THREE.Color).setRGB(s[O],s[O+1],s[O+2])),g.vertexColors.push(c[P]?c[P]:c[P]=(new THREE.Color).setRGB(s[P],s[P+1],s[P+2]))),o===4&&(g.vertexColors.push(c[k]?c[k]:c[k]=(new THREE.Color).setRGB(s[k],s[k+1],s[k+2])),g.vertexColors.push(c[M]?c[M]:c[M]=(new THREE.Color).setRGB(s[M],s[M+1],s[M+2])),g.vertexColors.push(c[H]?c[H]:c[H]=(new THREE.Color).setRGB(s[H],s[H+1],s[H+2])))),S.faces.push(g)}try{S.computeCentroids()}catch(lt){this.debugWarnings&&console.warn("["+this.url+"] error computing centroids for "+e._reference.id)}try{S.computeFaceNormals()}catch(lt){this.debugWarnings&&console.warn("["+this.url+"] error computing face normals for "+e._reference.id)}try{S.computeTangents()}catch(lt){this.debugWarnings&&console.warn("["+this.url+"] error computing tangents for "+e._reference.id)}return S},e.prototype.convertBones=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;d=[],h=[],n=[],r=e.jointBindings;for(o=x=0,A=r.length;x<A;o=x+=1){f=this.library.getContent(r[o].jointID.id);if(f==null)return null;h[f._reference.id]=o,n[o]=f._reference.id,d.push(f)}for(T=0,k=d.length;T<k;T++){l=d[T];if(!this.library.findJointParent(l)){y=l;break}}i=this.convertMatrix4(e.bindPoseMatrix),E=[],E.name=y.id,p=[],S;for(o=N=0,O=r.length;N<O;o=N+=1)S={},S.name=d[o]._reference.id,c=this.convertMatrix4(d[o]._transformMatrix),a=this.convertMatrix4(r[o].inverseBindMatrix),s=c.decompose(),S.pos=[s[0].x,s[0].y,s[0].z],S.rotq=[s[1].x,s[1].y,s[1].z,s[1].w],p[S.name]=E.length,S.invBindMatrix=a,S.jointMatrix=c,E.push(S);for(o=C=0,M=r.length;C<M;o=C+=1)S=E[o],m=this.library.findJointParent(d[o]),m==null?S.parent=-1:m.iflType==="IFLJoint"?p[m._reference.id]!==void 0?S.parent=
p[m._reference.id]:S.parent=-1:S.parent=-1;for(o=L=0,_=r.length;L<_;o=L+=1)S=E[o],t=S.invBindMatrix.clone(),w=this.setScale1(t),t.getInverse(t),o!==0?(v=E[S.parent],t.multiply(v.invBindMatrix,t),u=this.library.findParent(this.library.getContent(S.name)),u.iflType!=="IFLJoint"&&this.prependNonJointParents(t,u)):t.multiply(i,t),s=t.decompose(),g=[s[0].x,s[0].y,s[0].z],b=[s[1].x,s[1].y,s[1].z,s[1].w],S.pos=g,S.rotq=b;return E},e.prototype.prependNonJointParents=function(e,t){var n,r,i;return r=this.convertMatrix4(t._transformMatrix),i=(new THREE.Matrix4).multiply(r,e),e.copy(i),n=this.library.findParent(t),n.iflType!=="IFLJoint"&&this.prependNonJointParents(e,n),null},e.prototype.setScale1=function(e){var t,n,r;return t=(new THREE.Vector3(e.elements[0],e.elements[1],e.elements[2])).length(),n=(new THREE.Vector3(e.elements[4],e.elements[5],e.elements[6])).length(),r=(new THREE.Vector3(e.elements[8],e.elements[9],e.elements[10])).length(),e.elements[0]/=t,e.elements[1]/=t,e.elements[2]/=t,e.elements[4]/=n,e.elements[5]/=n,e.elements[6]/=n,e.elements[8]/=r,e.elements[9]/=r,e.elements[10]/=r,e.elements[12]/=t,e.elements[13]/=n,e.elements[14]/=r,e.elements[15]=1,new THREE.Vector3(t,n,r)},e.prototype.findJointParent=function(e,t){var n,r,i,s,o;if(t==null)return null;o=t.childIDs;for(i=0,s=o.length;i<s;i++){n=o[i];if(n.id===e._reference.id)return t;r=findJointParent(e,this.library.getContent(n.id));if(r)return r}return null},e.prototype.convertAnimations=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D;i=this.library.getAnimationsForSkinJoints(t),v=[],s=this.convertMatrix4(t.bindPoseMatrix),i.length===0&&(i[0]={_reference:{id:"fake"},tracks:[]});for(u=N=0;N<1;u=N+=1){r={},r.name=t._reference.id+"_"+i[u]._reference.id,r.fps=30,r.hierarchy=[],E=0;for(f=C=0,O=e.length;C<O;f=C+=1){S=this.getTrackForJoint(e[f],i[u]),g=e[f].jointMatrix.decompose(),p=0,y=e[f].pos,b=e[f].rotq;if(S!=null){x={},x.parent=e[f].parent,x.name="track_"+e[f].name,x.keys=[],m=S.sampler,T=S.end-S.start,d=m.times.length,w=T/d*1e3;for(a=k=0,M=m.times.length;k<M;a=k+=1)l={},l.time=m.times[a],p=Math.max(l.time,p),E=Math.max(p,E),l.pos=[m.positions[a].x,m.positions[a].y,m.positions[a].z],l.rot=[m.orientations[a].x,m.orientations[a].y,m.orientations[a].z,m.orientations[a].w],l.scl=[1,1,1],x.keys.push(l)}else{console.log("no track for joint "+e[f].name+" creating a fake one"),n=i[u],m=n.tracks.length>0?n.tracks[0].sampler:{times:[0,1]},x={},x.name="fake_track_"+e[f].name,x.parent=e[f].parent,x.keys=[];for(a=L=0,_=m.times.length;L<_;a=L+=1)l={},l.time=m.times[a],p=Math.max(l.time,p),E=Math.max(p,E),l.pos=[y[0],y[1],y[2]],l.rot=[b[0],b[1],b[2],b[3]],l.scl=[1,1,1],x.keys.push(l)}r.length=p,r.hierarchy.push(x)}for(f=A=0,D=r.hierarchy.length;A<D;f=A+=1)c=r.hierarchy[f].keys,h=c[c.length-1],o=c[0],h.time<E&&c.push({time:E,pos:h.pos,rot:h.rot,scl:h.scl}),o.time>0&&c.unshift({time:0,pos:o.pos,rot:o.rot,scl:o.scl});r.length=E,v.push(r)}return v[0]},e.prototype.getTrackForJoint=function(e,t){var n,r,i;for(n=r=0,i=t.tracks.length;r<i;n=r+=1)if(t.tracks[n].target.id===e.name)return t.tracks[n];return null},e.prototype.convertMaterial=function(e,t){var n,r;r=e.material._reference.id;if(!this.matCache[r]||!this.enableMaterialCache)this.customMaterialInstancer!=null?(n=this.customMaterialInstancer.apply(this,[e,t]),n!=null?this.matCache[r]=n:this.matCache[r]=this.convertGenericMaterial(e)):this.matCache[r]=this.convertGenericMaterial(e);return this.matCache[r]},e.prototype.getMaterialParams=function(e){var t;return t={color:e.material.diffuse.uintValue,ambient:e.material.ambient.uintValue,specular:e.material.specular.uintValue,map:this.getSubmeshTexture(e.diffuseTextures),normalMap:this.getSubmeshTexture(e.normalTextures),specularMap:this.getSubmeshTexture(e.specularTextures),lightMap:null,bumpMap:null,reflectivity:e.material.reflectivity,shininess:e.material.shininess,opacity:e.material.transparency!==0&&e.material.transparency!==1?1-e.material.transparency:1},t},e.prototype.convertGenericMaterial=function(e){var t,n;return n=this.getMaterialParams(e),t=new THREE.MeshLambertMaterial(n),n.map&&(t.transparent=n.map.transparent),t},e.prototype.getSubmeshTexture=function(e){return e.length>0?this.getTexture(e[0].id,!1):null},e.prototype.getTexture=function(e){var t,n;return n=this.library.getContent(e),n==null?(this.debugWarnings&&console.warn("["+this.url+"] Texture "+e+" not found"),null):(n.converted!=null?this.texCache[n._reference.id]==null||!this.enableTextureCache?this.texCache[n._reference.id]=t=new THREE.DataTexture(n.converted,n._width,n._height,n._hasOriginalByteArray?THREE.RGBFormat:THREE.RGBAFormat):t=this.texCache[n._reference.id]:this.debugWarnings&&console.warn("["+this.url+"] Texture "+e+" was not converted"),t&&(t.needsUpdate=!0,t.flipY=!1,t.transparent=n.transparent),t)},e.prototype.disabledGeometryAttributes=[],e.prototype.disabledGeometryAttributesValues=[],e.prototype.geometryAttributeEnabled=function(e,t){var n,r,i,s,o,u,a,f,l;if(!t){this.disabledGeometryAttributes=[],this.disabledGeometryAttributesValues=[],a=this.geometryLib;for(i=0,o=a.length;i<o;i++)n=a[i],((f=n.attributes)!=null?f[e]:void 0)!=null&&(this.disabledGeometryAttributes.push(n),this.disabledGeometryAttributesValues.push(n.attributes[e]),n.attributes[e]=null,n[this.getNeedsUpdateFlag(e)]=!0)}else{l=this.disabledGeometryAttributes;for(r=s=0,u=l.length;s<u;r=++s)n=l[r],n.attributes[e]=this.disabledGeometryAttributesValues[r],n[this.getNeedsUpdateFlag(e)]=!0}return null},e.prototype.getNeedsUpdateFlag=function(e){switch(e){case"colors":return"colorsNeedUpdate";case"vertices":return"verticesNeedUpdate";case"uv":return"uvsNeedUpdate";case"uv2":return"uvsNeedUpdate";case"normals":return"normalsNeedUpdate"}return null},e.prototype.dispose=function(){var e,t,n,r;(t=this.worker)!=null&&(t.onmessage=function(){return console.log("["+this.url+"] Message aborted")});try{(n=this.xhr)!=null&&n.abort()}catch(i){}try{(r=this.worker)!=null&&r.terminate()}catch(i){}for(e in this)delete this[e];return console.log("LOADER DISPOSED"),this.disposed=!0,null},e.prototype.IFLLibraryFuncs={getContent:function(e){return this._contentByID[e]},getRootNodes:function(){return this.getRootNodesIn(this._content)},isIFLNode:function(e){return e.iflType==="IFLNode"||e.iflType==="IFLJoint"||e.iflType==="IFLMesh"||e.iflType==="IFLMeshContainer"||e.iflType==="IFLLight"||e.iflType==="IFLCamera"},getDiffuseTexture:function(e){return this.getContent(e._diffuseTextures[0].id)},getRootNodesIn:function(e){var t,n,r,i,s,o,u,a,f,l;r=[],i=[];for(o=0,a=e.length;o<a;o++){s=e[o];if(!this.isIFLNode(s))continue;r.indexOf(s._reference.id)===-1&&i.push(s._reference.id),l=s.childIDs;for(u=0,f=l.length;u<f;u++)n=l[u],i.indexOf(n.id)!==-1&&i.splice(i.indexOf(n.id),1),r.push(n.id)}return function(){var e,n,r;r=[];for(t=e=0,n=i.length;e<n;t=e+=1)r.push(this.getContent(i[t]));return r}.call(this)},isRoot:function(e){return this.isRootWithin(e,this._content)},isRootWithin:function(e,t){var n,r,i,s,o,u,a;for(i=0,o=t.length;i<o;i++){r=t[i];if(this.isIFLNode(r)){a=r.childIDs;for(s=0,u=a.length;s<u;s++){n=a[s];if(n.id===e)return!1}}}return!0},findParent:function(e,t){var n,r,i,s,o,u,a,f,l,c;if(t==null){o=this.getRootNodes();for(u=0,f=o.length;u<f;u++){s=o[u],i=this.findParent(e,s);if(i!=null)return i}}else{c=t.childIDs;for(a=0,l=c.length;a<l;a++){r=c[a];if(r.id===e._reference.id)return t;n=this.getContent(r.id);if(n){i=this.findParent(e,n);if(i!=null)return i}}}return null},getAnimationsForSkinJoints:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;u=[],n=[],v=e.jointBindings;for(f=0,h=v.length;f<h;f++){r=v[f],i=r.jointID,o=this.getAnimationsForID(i.id,!1);if(o!=null)for(l=0,p=o.length;l<p;l++){s=o[l],n[s._reference.id]||(n[s._reference.id]={tracks:[],iflType:"IFLAnimation"},n[s._reference.id]._reference={id:s._reference.id,iflType:"IFLID"},u.push(n[s._reference.id])),t=n[s._reference.id],m=s.tracks;for(c=0,d=m.length;c<d;c++)a=m[c],t.tracks.indexOf(a)===-1&&t.tracks.push(a)}}return u},getAnimationsForID:function(e){var t,n,r,i,s,o,u,a,f;n=[],f=this._content;for(s=0,u=f.length;s<u;s++){t=f[s];if(t.iflType!=="IFLAnimation")continue;i=t.tracks;for(o=0,a=i.length;o<a;o++)r=i[o],r.target.id===e&&n.indexOf(t)===-1&&n.push(t)}return n.length>0?n:null},findJointParent:function(e){var t,n,r,i,s,o,u,a;u=this._content;for(r=0,s=u.length;r<s;r++){n=u[r];if(this.isIFLNode(n)){a=n.childIDs;for(i=0,o=a.length;i<o;i++){t=a[i];if(t.id===e._reference.id)return n.iflType==="IFLJoint"?n:this.findJointParent(n)}}}return null}},e}(),IFLHotspotManager=function(){function e(){}return e.prototype.settings=null,e.prototype.scene=null,e.prototype.camera=null,e.prototype.materialManager=null,e.prototype.localeTexture=null,e.prototype.hotspots=null,e.prototype.clickedHotspot=null,e.prototype.hotspotRolloutAlpha=1,e.prototype.dispose=function(){return this.settings=null,this.scene=null,this.camera=null,this.materialManager=null,this.localeTexture=null,this.hotspots=null,this.clickedHotspot=null},e.prototype.update=function(e){var t,n,r,i;if(this.hotspots!=null){i=this.hotspots;for(n=0,r=i.length;n<r;n++)t=i[n],t.lookAt(this.camera.position)}},e.prototype.handleMouseUp=function(e,t){var n,r,i,s,o,u;if(this.hotspots!=null){u=this.hotspots;for(s=0,o=u.length;s<o;s++){n=u[s],r=e[n.name]!=null?e[n.name]:!1,i=t[n.name]!=null?t[n.name]:!1;if(i!==!1&&r!==!1&&this.is3DMouseClick(i,r))return this.clickedHotspot=n.link,!0}}return!1},e.prototype.hotspotsAlpha=function(e){var t,n,r,i;i=this.hotspots;for(n=0,r=i.length;n<r;n++)t=i[n],t.rollovered?(new TWEEN.Tween(t.material)).to({opacity:e},500).start():(new TWEEN.Tween(t.material)).to({opacity:e},500).start();return null},e.prototype.is3DMouseClick=function(e,t){var n;return(e!=null?e.point:void 0)==null||(t!=null?t.point:void 0)==null?!1:(n=e.point.distanceTo(t.point),Math.abs(n)<2)},e.prototype.zoomInHotspot=function(e,t,n){var r,i;switch(e){case"cutout":return Analytics.track("scene3D_1_title_cutout"),SoundController.send("cutout_zoom_in"),i=new THREE.Vector3(this.settings.cutout.middle.position[0],this.settings.cutout.middle.position[1],this.settings.cutout.middle.position[2]),r=new THREE.Vector3(this.settings.cutout.middle.lookat[0],this.settings.cutout.middle.lookat[1],this.settings.cutout.middle.lookat[2]),this.interactiveCameraTween(n.currentLookAt,i,r,50,1500).onComplete(t),this.hotspotsAlpha(0),n.currentLookAt=r.clone(),!0;case"music":return SoundController.send("musicbox_zoom_in"),Analytics.track("scene3D_1_title_music"),i=new THREE.Vector3(this.settings.music.position[0],this.settings.music.position[1],this.settings.music.position[2]),r=new THREE.Vector3(this.settings.music.lookat[0],this.settings.music.lookat[1],this.settings.music.lookat[2]),this.interactiveCameraTween(n.currentLookAt,i,r,50,1500).onComplete(t),this.hotspotsAlpha(0),n.currentLookAt=r.clone(),!0;case"zoetrope":return SoundController.send("zoetrope_zoom_in"),Analytics.track("scene3D_2_title_zoe"),i=new THREE.Vector3(this.settings.zoetrope.position[0],this.settings.zoetrope.position[1],this.settings.zoetrope.position[2]),r=new THREE.Vector3(this.settings.zoetrope.lookat[0],this.settings.zoetrope.lookat[1],this.settings.zoetrope.lookat[2]),this.interactiveCameraTween(n.currentLookAt,i,r,50,1500).onComplete(t),this.hotspotsAlpha(0),n.currentLookAt=r.clone(),!0}return!1},e.prototype.interactiveCameraTween=function(e,t,n,r,i){var s,o,u,a=this;if(this.camera==null)return;if(this.camera.position==null)return;return o={positionX:this.camera.position.x,positionY:this.camera.position.y,positionZ:this.camera.position.z,lookAtX:e.x,lookAtY:e.y,lookAtZ:e.z,fov:this.camera.fov},s={positionX:t.x,positionY:t.y,positionZ:t.z,lookAtX:n.x,lookAtY:n.y,lookAtZ:n.z,fov:r},u=(new TWEEN.Tween(o)).to(s,i).easing(TWEEN.Easing.Quadratic.InOut),u.onUpdate(function(){return a.camera.fov=o.fov,a.camera.updateProjectionMatrix(),a.camera.position.x=o.positionX,a.camera.position.y=o.positionY,a.camera.position.z=o.positionZ,a.camera.updateMatrix(),a.camera.lookAt(new THREE.Vector3(o.lookAtX,o.lookAtY,o.lookAtZ)),a.camera.updateMatrix()}),u.start(),u},e.prototype.init=function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;this.settings=e,this.scene=t,this.materialManager=n,this.localeTexture=r,this.camera=i,this.hotspots=[],T=this.settings.hotspots;for(y=0,E=T.length;y<E;y++){s=T[y],s.overrideMap!=null&&s.overrideMap.length>0?(v=THREE.ImageUtils.loadCompressedTexture(s.overrideMap),o=!0):(m=s.localizedTexture!=null?s.localizedTexture:s.link,o=!1,c=this.localeTexture.get(m),f=c.canvas,l=c.bound,u=f.width-l.width,p=u/f.width,v=new THREE.Texture(f),v.needsUpdate=!0,v.offset.x=v.offset.y=p/2,v.repeat.x=v.repeat.y=1-p),h=new THREE.MeshBasicMaterial({map:v,lights:!1,transparent:!0,opacity:this.hotspotRolloutAlpha,side:THREE.DoubleSide}),this.materialManager.matLib.push(h),this.materialManager.texLib.push(h.map),a=new THREE.PlaneGeometry(s.size,s.size),d=new THREE.Mesh(a,h);if(s.reverse===!0){N=a.vertices;for(b=0,S=N.length;b<S;b++)g=N[b],g.x=-g.x}if(o===!0){C=a.vertices;for(w=0,x=C.length;w<x;w++)g=C[w],g.y=-g.y}d.rollovered=!1,d.pickable=s.disabled===!0?!1:!0,d.name=s.name,d.link=s.link,d.position.set(s.position[0],s.position[1],s.position[2]),this.hotspots.push(d),this.scene.add(d)}return null},e}(),IFLMaterialManager=function(){function e(e){this.vertexColorsEnabled=__bind(this.vertexColorsEnabled,this),this.changeNormalScale=__bind(this.changeNormalScale,this),this.changeFresnelPower=__bind(this.changeFresnelPower,this),this.instanceFresnelMaterial=__bind(this.instanceFresnelMaterial,this),this.instanceFresnelDoubleLightmapMaterial=__bind(this.instanceFresnelDoubleLightmapMaterial,this),this.instanceSimpleDobleLightmapMaterial=__bind(this.instanceSimpleDobleLightmapMaterial,this),this.instanceSimpleMaterial=__bind(this.instanceSimpleMaterial,this),this.instanceMeshBasicMaterial=__bind(this.instanceMeshBasicMaterial,this),this.instanceTerrainMaterial=__bind(this.instanceTerrainMaterial,this),this.instanceMaterial=__bind(this.instanceMaterial,this),this.onTextureComplete=__bind(this.onTextureComplete,this),this.onTextureProgress=__bind(this.onTextureProgress,this),e!=null&&this.init(e),this.texLib=[],this.matLib=[]}return e.prototype.params=null,e.prototype.matLib=null,e.prototype.texLib=null,e.prototype.onProgress=null,e.prototype.onComplete=null,e.prototype.ddsBasePath=null,e.prototype.jpgBasePath=null,e.prototype.auxBasePath=null,e.prototype.pickables=null,e.prototype.loadTextureIndex=0,e.prototype.loadTextures=null,e.prototype.loadedTextures=null,e.prototype.renderer=null,e.prototype.skyCubeTexture=null,e.prototype.skyCubePath=null,e.prototype.skyCubeFormat=null,e.prototype.enableDiffuse=!0,e.prototype.materialInstancerNames=null,e.prototype.textureQuality=null,e.prototype.loadingPercentages=null,e.prototype.init=function(e){var t,n;return this.params=e,this.textureQuality=e.textureQuality!=null?e.textureQuality:"med",this.loadTextures=e.loadTextures!=null?e.loadTextures:[],this.pickables=e.pickables!=null?e.pickables:{},this.onProgress=e.onProgress!=null?e.onProgress:{},this.onComplete=e.onComplete!=null?e.onComplete:{},this.ddsBasePath=e.ddsBasePath!=null?e.ddsBasePath:"",this.auxBasePath=e.auxBasePath!=null?e.auxBasePath:"",this.jpgBasePath=e.jpgBasePath!=null?e.jpgBasePath:"",n=this.ddsBasePath.indexOf("#QUALITY#"),n!==-1&&(this.ddsBasePath=this.ddsBasePath.substr(0,n)+this.textureQuality),t=this.auxBasePath.indexOf("#QUALITY#"),t!==-1&&(this.auxBasePath=this.auxBasePath.substr(0,t)+this.textureQuality),this.renderer=e.renderer!=null?e.render:null,this.skyCubePath=e.skyCubePath!=null?e.skyCubePath:"/",this.skyCubeFormat=e.skyCubeFormat!=null?e.skyCubeFormat:".png",this.materialInstancerNames=e.materialInstancerNames!=null?e.materialInstancerNames:{"default":"instanceSimpleMaterial"},null},e.prototype.load=function(){var e,t,n,r,i,s;n=[this.skyCubePath+"posx"+this.skyCubeFormat,this.skyCubePath+"negx"+this.skyCubeFormat,this.skyCubePath+"posy"+this.skyCubeFormat,this.skyCubePath+"negy"+this.skyCubeFormat,this.skyCubePath+"negz"+this.skyCubeFormat,this.skyCubePath+"posz"+this.skyCubeFormat],this.skyCubeTexture=THREE.ImageUtils.loadTextureCube(n),this.skyCubeTexture.format=THREE.RGBFormat,this.loadedTextures=[],this.loadingPercentages=[],s=this.loadTextures;for(e=r=0,i=s.length;r<i;e=++r)t=s[e],t.indexOf(".dds")!==-1?CustomImageUtils.loadCompressedTexture(""+this.ddsBasePath+"/"+t,null,this.onTextureComplete,this.onTextureProgress,null,!1,e):CustomImageUtils.loadTexture(""+this.jpgBasePath+"/"+t,null,this.onTextureComplete,this.onTextureProgress,null,e);return null},e.prototype.onTextureProgress=function(e,t){var n,r,i,s,o,u;r=e/(1/this.loadTextures.length),this.loadingPercentages[t]=e,s=0;for(n=o=0,u=this.loadTextures.length;o<u;n=o+=1)i=this.loadingPercentages[n],s+=i!=null?i:0;return s/=this.loadTextures.length,typeof this.onProgress=="function"?this.onProgress(s):void 0},e.prototype.numLoadedTextures=0,e.prototype.onTextureComplete=function(e,t){this.loadedTextures[t]=e,this.numLoadedTextures++;if(this.numLoadedTextures===this.loadTextures.length){typeof this.onComplete=="function"&&this.onComplete();return}},e.prototype.getPreloadedTexture=function(e){var t;return t=this.loadTextures.indexOf(e),t===-1?e.indexOf(".dds")!==-1?CustomImageUtils.loadCompressedTexture(""+this.ddsBasePath+"/"+e):CustomImageUtils.loadTexture(""+this.jpgBasePath+"/"+e):this.loadedTextures[t]},e.prototype.instanceMaterial=function(e,t){var n,r,i;while(t.indexOf("1")===t.length-1)t=t.substr(0,t.length-1);i=this.materialInstancerNames;for(r in i){n=i[r];if(t.toLowerCase().indexOf(r.toLowerCase())!==-1){switch(n){case"simple":return this.instanceSimpleMaterial(e,t);case"simple_doublelightmap":return this.instanceSimpleDobleLightmapMaterial(e,t);case"terrain":return this.instanceTerrainMaterial(e,t);case"meshbasic":return this.instanceMeshBasicMaterial(e,t);case"fresnel":return this.instanceFresnelMaterial(e,t);case"fresnel_doublelightmap":return this.instanceFresnelDoubleLightmapMaterial(e,t)}break}}return this.instanceSimpleMaterial(e,t)},e.prototype.applyMaterialOverrides=function(e,t){var n,r,i,s,o;n=this.getMaterialOverrides(t);for(r in n)i=n[r],e[r]!=null&&(e[r]=i),(s=e.uniforms)!=null&&(o=s[r])!=null&&(o.value=i);return null},e.prototype.getMaterialOverrides=function(e){var t,n,r,i,s,o;n=[],o=this.params.materialOverrides;for(t in o){s=o[t];if(e.toLowerCase().indexOf(t.toLowerCase())!==-1)for(r in s)i=s[r],n[r]=i}return n},e.prototype.instanceTerrainMaterial=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;return f=this.getMaterialOverrides(t),h=new IFLTerrainLambertShader,p=THREE.UniformsUtils.clone(h.uniforms),p.ambient.value=new THREE.Color(16777215),p.diffuse.value=new THREE.Color(16777215),n=this.getPreloadedTexture("terrain_blend.dds"),u=this.getPreloadedTexture("terrain_lightmap.dds"),r=this.getPreloadedTexture("terrain_base.dds"),o=this.getPreloadedTexture("terrain_diffuseR.dds"),s=this.getPreloadedTexture("terrain_diffuseG.dds"),i=this.getPreloadedTexture("terrain_diffuseB.dds"),r.anisotropy=o.anisotropy=s.anisotropy=i.anisotropy=16,this.texLib.push(r),this.texLib.push(o),this.texLib.push(s),this.texLib.push(i),this.texLib.push(n),r.flipY=n.flipY=u.flipY=o.flipY=s.flipY=i.flipY=!1,r.wrapS=r.wrapT=THREE.RepeatWrapping,o.wrapS=o.wrapT=THREE.RepeatWrapping,s.wrapS=s.wrapT=THREE.RepeatWrapping,i.wrapS=i.wrapT=THREE.RepeatWrapping,p.map.value=r,p.lightMap.value=u,p.tBlendmap.value=n,p.tDiffuseR.value=o,p.tDiffuseG.value=s,p.tDiffuseB.value=i,c=20,f.offset_repeat!=null&&(c=f.offset_repeat.z),p.offsetRepeat.value=new THREE.Vector4(0,0,c,c),p.offsetRepeatR.value=new THREE.Vector4(0,0,c,c),p.offsetRepeatG.value=new THREE.Vector4(0,0,c,c),p.offsetRepeatB.value=new THREE.Vector4(0,0,c,c),p.lightMapMultiplier.value=2,l={fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:p},a=new THREE.ShaderMaterial(l),a.map=r,a.lightMap=u,a.fog=!0,this.applyMaterialOverrides(a,t),this.matLib.push(a),a},e.prototype.instanceMeshBasicMaterial=function(e,t){var n,r;return n=new THREE.MeshBasicMaterial({map:this.getPreloadedTexture(""+t+"_diff.dds")}),(r=n.map)!=null&&(r.flipY=!1),n.side=THREE.DoubleSide,n.fog=!1,n.lights=!1,this.texLib.push(n.map),this.matLib.push(n),this.applyMaterialOverrides(n,t),n},e.prototype.instanceSimpleMaterial=function(e,t){var n,r,i,s,o,u;return s=new IFLBasicShader,o=s.uniforms,i={},i.fragmentShader=s.fragmentShader,i.vertexShader=s.vertexShader,i.uniforms=o,n=new THREE.ShaderMaterial(i),n.side=THREE.DoubleSide,n.lights=!1,n.fog=!0,n.alphaTest=.5,n.enableIllustration=!1,o.diffuse.value=new THREE.Color(16777215),r=this.getMaterialOverrides(t),r["overrideMap"]!=null?r.overrideMap!=="null"&&(o.map.value=n.map=this.getPreloadedTexture(r.overrideMap)):o.map.value=n.map=this.getPreloadedTexture(""+t+"_diff.dds"),(u=o["map"].value)!=null&&(u.flipY=!1),o.diffuseMultiplier.value=1,this.texLib.push(n.map),this.matLib.push(n),this.applyMaterialOverrides(n,t),n.enableIllustration!==!1&&(o.lightMap.value=n.lightMap=this.getPreloadedTexture(n.enableIllustration),n.lightMap.flipY=!1),n},e.prototype.instanceSimpleDobleLightmapMaterial=function(e,t){var n,r,i,s,o,u;return s=new IFLBasicShaderDoubleLightmap,o=s.uniforms,i={},i.fragmentShader=s.fragmentShader,i.vertexShader=s.vertexShader,i.uniforms=o,n=new THREE.ShaderMaterial(i),n.side=THREE.DoubleSide,n.lights=!1,n.fog=!0,n.alphaTest=.5,n.enableIllustration=!1,n.enableIllustration2=!1,o.diffuse.value=new THREE.Color(16777215),r=this.getMaterialOverrides(t),r["overrideMap"]!=null?r.overrideMap!=="null"&&(o.map.value=n.map=this.getPreloadedTexture(r.overrideMap)):o.map.value=n.map=this.getPreloadedTexture(""+t+"_diff.dds"),(u=o["map"].value)!=null&&(u.flipY=!1),o.diffuseMultiplier.value=1,this.texLib.push(n.map),this.matLib.push(n),this.applyMaterialOverrides(n,t),n.enableIllustration!==!1&&(o.lightMap.value=n.lightMap=this.getPreloadedTexture(n.enableIllustration),n.lightMap.flipY=!1),n.enableIllustration2!==!1&&(o.lightMap2.value=n.lightMap2=this.getPreloadedTexture(n.enableIllustration2),n.lightMap2.flipY=!1),n},e.prototype.instanceFresnelDoubleLightmapMaterial=function(e,t){var n,r,i,s,o,u,a,f,l;return o=new IFLPhongFresnelShaderDoubleLightMap,u=o.uniforms,s={},s.fragmentShader=o.fragmentShader,s.vertexShader=o.vertexShader,s.uniforms=u,n=new THREE.ShaderMaterial(s),n.side=THREE.DoubleSide,n.lights=!1,n.alphaTest=.5,n.fog=!0,n.enableIllustration=!1,n.enableIllustration2=!1,n.switchUVs=!1,u.diffuse.value=new THREE.Color(16777215),u.ambient.value=new THREE.Color(16777215),u.specular.value=new THREE.Color(16777215),i=this.getMaterialOverrides(t),r=t,i["overrideMap"]!=null&&(t=i.overrideMap),u.map.value=n.map=this.getPreloadedTexture(""+t+"_diff.dds"),u.envMap.value=n.envMap=this.skyCubeTexture,u.specularMap.value=n.specularMap=CustomImageUtils.loadCompressedTexture(""+this.auxBasePath+"/"+t+"_spec.dds"),u.tAux.value=CustomImageUtils.loadCompressedTexture(""+this.auxBasePath+"/"+t+"_aux.dds"),u.envmapMultiplier.value=5,u.diffuseMultiplier.value=1,t=r,(a=n.map)!=null&&(a.flipY=!1),(f=n.specularMap)!=null&&(f.flipY=!1),(l=u["tAux"].value)!=null&&(l.flipY=!1),this.texLib.push(u.tAux.value),this.texLib.push(u.specularMap.value),this.texLib.push(u.envMap.value),this.texLib.push(u.map.value),this.matLib.push(n),this.applyMaterialOverrides(n,t),n.enableIllustration!==!1&&(u.lightMap.value=n.lightMap=this.getPreloadedTexture(n.enableIllustration),n.lightMap.flipY=!1),n.enableIllustration2!==!1&&(u.lightMap2.value=n.lightMap2=this.getPreloadedTexture(n.enableIllustration2),n.lightMap2.flipY=!1),n},e.prototype.instanceFresnelMaterial=function(e,t){var n,r,i,s,o,u,a,f,l;return o=new IFLPhongFresnelShader,u=o.uniforms,s={},s.fragmentShader=o.fragmentShader,s.vertexShader=o.vertexShader,s.uniforms=u,n=new THREE.ShaderMaterial(s),n.side=THREE.DoubleSide,n.lights=!1,n.alphaTest=.5,n.fog=!0,n.enableIllustration=!1,n.switchUVs=!1,u.diffuse.value=new THREE.Color(16777215),u.ambient.value=new THREE.Color(16777215),u.specular.value=new THREE.Color(16777215),i=this.getMaterialOverrides(t),r=t,i["overrideMap"]!=null&&(t=i.overrideMap),u.map.value=n.map=this.getPreloadedTexture(""+t+"_diff.dds"),u.envMap.value=n.envMap=this.skyCubeTexture,u.specularMap.value=n.specularMap=CustomImageUtils.loadCompressedTexture(""+this.auxBasePath+"/"+t+"_spec.dds"),u.tAux.value=CustomImageUtils.loadCompressedTexture(""+this.auxBasePath+"/"+t+"_aux.dds"),u.envmapMultiplier.value=5,u.diffuseMultiplier.value=1,t=r,(a=n.map)!=null&&(a.flipY=!1),(f=n.specularMap)!=null&&(f.flipY=!1),(l=u["tAux"].value)!=null&&(l.flipY=!1),this.texLib.push(u.tAux.value),this.texLib.push(u.specularMap.value),this.texLib.push(u.envMap.value),this.texLib.push(u.map.value),this.matLib.push(n),this.applyMaterialOverrides(n,t),n.enableIllustration!==!1&&(u.lightMap.value=n.lightMap=this.getPreloadedTexture(n.enableIllustration),n.lightMap.flipY=!1),n},e.prototype.changeFresnelPower=function(e){var t,n,r,i,s,o;i=this.matLib;for(n=0,r=i.length;n<r;n++)t=i[n],(s=t.uniforms)!=null&&(o=s.mFresnelPower)!=null&&(o.value=e);return null},e.prototype.changeNormalScale=function(e){var t,n,r,i,s,o;i=this.matLib;for(n=0,r=i.length;n<r;n++)t=i[n],(s=t.uniforms)!=null&&(o=s.normalScale)!=null&&o.value.set(e,e);return null},e.prototype.disabledVertexColors=[],e.prototype.vertexColorsEnabled=function(e){var t,n,r,i,s,o,u,a;if(!e){this.disabledVertexColors=[],u=this.matLib;for(r=0,s=u.length;r<s;r++)t=u[r],t.vertexColors===THREE.VertexColors&&(t.vertexColors=THREE.NoColors,t.needsUpdate=!0,this.disabledVertexColors.push(t))}else{a=this.disabledVertexColors;for(i=0,o=a.length;i<o;i++)n=a[i],n.vertexColors=THREE.VertexColors,n.needsUpdate=!0}return null},e.prototype.dispose=function(e){var t,n,r,i,s,o,u,a;if(this.matLib!=null){u=this.matLib;for(r=0,s=u.length;r<s;r++)t=u[r],t!=null&&e.deallocateMaterial(t)}if(this.texLib!=null){a=this.texLib;for(i=0,o=a.length;i<o;i++)n=a[i],n!=null&&e.deallocateTexture(n)}return e.deallocateTexture(this.skyCubeTexture),this.matLib=null,this.texLib=null,this.onProgress=null,this.onComplete=null,null},e}(),IFLModelManager=function(){function e(){this.localCallBack=__bind(this.localCallBack,this),this.batchLoadingPhaseManager=__bind(this.batchLoadingPhaseManager,this)}return e.prototype.BatchLoadingPhase={SETTINGS:0,MATERIALS:1,MATERIALS_DONE:2,MODELS:3},e.prototype.BatchState={RUNNING:0,PAUSED:1,COMPLETED:2},e._instance=null,e.prototype.modelLibraries={},e.prototype.batchLoadTextureIndex=0,e.prototype.batchLoadTextures=[],e.prototype.batchDDSPath=null,e.prototype.batchJPGPath=null,e.prototype.cachingTextures=!0,e.prototype.batchLoader=null,e.prototype.batchLoadingIndex=-1,e.prototype.batchLoadingPhaseIndex=0,e.prototype.batchLoadingSettings={},e.prototype.batchSettings=null,e.prototype.batchMaterialManager=null,e.prototype.batchLoader=null,e.prototype.oz=null,e.prototype.state=null,e.prototype.loader=null,e.prototype.urlLoading=null,e.prototype.prefetchEnabled=!0,e.getInstance=function(){return this._instance==null&&(this._instance=new this,this._instance.init()),this._instance},e.prototype.init=function(){return this.oz=(window||document).oz,this.state=this.BatchState.PAUSED,CustomImageUtils.cacheTextures=!0,this.batchLoadingSettings=["/models/s001_settings.json","/models/s002_settings.json","/models/s003_settings.json"]},e.prototype.batchLoadingPhaseManager=function(e){var t,n,r;if(!this.prefetchEnabled)return;if(this.state===this.BatchState.PAUSED)return;switch(this.batchLoadingPhaseIndex){case this.BatchLoadingPhase.SETTINGS:return this.batchSettings=e,this.modelLibraries[this.batchSettings.modelURL]!=null?this.nextBatchLoading():(this.batchLoadingPhaseIndex=this.BatchLoadingPhase.MATERIALS,r=this.oz.appView.textureQuality,this.batchLoadTextures=this.batchSettings.loadTextures!=null?this.batchSettings.loadTextures:[],this.batchDDSPath=this.batchSettings.ddsBasePath!=null?this.batchSettings.ddsBasePath:"",this.batchJPGPath=this.batchSettings.jpgBasePath!=null?this.batchSettings.jpgBasePath:"",t=this.batchDDSPath.indexOf("#QUALITY#"),t!==-1&&(this.batchDDSPath=this.batchDDSPath.substr(0,t)+r),this.batchLoadTextureIndex=-1,this.batchLoadingPhaseManager());case this.BatchLoadingPhase.MATERIALS:return this.batchLoadTextureIndex++,this.batchLoadTextureIndex<this.batchLoadTextures.length&&this.cachingTextures?(n=this.batchLoadTextures[this.batchLoadTextureIndex],n.indexOf(".dds")!==-1?CustomImageUtils.loadCompressedTexture(""+this.batchDDSPath+"/"+n,null,this.batchLoadingPhaseManager,null,null,!0):CustomImageUtils.loadTexture(""+this.batchJPGPath+"/"+n,null,this.batchLoadingPhaseManager)):(this.batchLoadingPhaseIndex=this.BatchLoadingPhase.MATERIALS_DONE,this.batchLoadingPhaseManager());case this.BatchLoadingPhase.MATERIALS_DONE:return this.batchLoadingPhaseIndex=this.BatchLoadingPhase.MODELS,this.batchLoader=new IFLLoader,this.batchLoader.enableMaterialCache=!1,this.batchLoader.enableTextureCache=!1,this.batchLoader.doCreateModel=!1,this.batchLoader.pickableObjects=this.batchSettings.pickables,this.batchLoader.customMaterialInstancer=null,this.batchLoader.load(this.batchSettings.modelURL,this.batchLoadingPhaseManager,null);case this.BatchLoadingPhase.MODELS:return this.modelLibraries[this.batchSettings.modelURL]=this.batchLoader.library,this.nextBatchLoading()}},e.prototype.nextBatchLoading=function(){if(this.state===this.BatchState.PAUSED)return;return this.batchLoadingIndex++,this.batchLoadingIndex<this.batchLoadingSettings.length?(this.batchLoadingPhaseIndex=this.BatchLoadingPhase.SETTINGS,$.ajax({url:this.batchLoadingSettings[this.batchLoadingIndex],dataType:"json",success:this.batchLoadingPhaseManager})):this.state=this.BatchState.COMPLETED},e.prototype.resume=function(){return this.state=this.BatchState.RUNNING,this.nextBatchLoading()},e.prototype.pause=function(){var e,t;this.state=this.BatchState.PAUSED;try{(e=this.batchLoader)!=null&&e.dispose()}catch(n){}try{return(t=this.loader)!=null?t.dispose():void 0}catch(n){}},e.prototype.load=function(e,t,n,r,i){this.urlLoading=n,this.modelLibraries[n]!=null?(console.log("CACHED library"),this.loader=new IFLLoader,this.loader.enableMaterialCache=!1,this.loader.enableTextureCache=!1,this.loader.pickableObjects=e,this.loader.customMaterialInstancer=t,this.loader.callback=r,this.loader.callbackProgress=i,this.loader.library=this.modelLibraries[n],this.loader.doCreateModel=!1,typeof r=="function"&&r(this.loader,null)):(this.pause(),this.loader=new IFLLoader,this.loader.enableMaterialCache=!1,this.loader.enableTextureCache=!1,this.loader.pickableObjects=e,this.loader.customMaterialInstancer=t,this.loader.finalCallBack=r,this.loader.doCreateModel=!1,this.loader.load(n,this.localCallBack,i))},e.prototype.localCallBack=function(e,t){this.modelLibraries[this.urlLoading]=e.library,e.finalCallBack(e,t);if(this.state!==this.BatchState.COMPLETED)return this.resume()},e.prototype.dispose=function(){var e;return(e=this.loader)!=null?e.dispose():void 0},e.prototype.cacheTextures=function(e){return this.cachingTextures=e,CustomImageUtils.cacheTextures=e},e}(),IFLWindGenerator=function(){function e(){this.windDirection=new THREE.Vector3(1,0,0),this.noiseMap=new THREE.WebGLRenderTarget(64,64,{minFilter:THREE.LinearMipmapLinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat}),this.noiseShader=new IFLNoiseShader,this.noiseShader.uniforms.vScale.value.set(2,2),this.noiseScene=new THREE.Scene,this.noiseCameraOrtho=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4),this.noiseCameraOrtho.position.z=100,this.noiseScene.add(this.noiseCameraOrtho),this.noiseMaterial=new THREE.ShaderMaterial({fragmentShader:this.noiseShader.fragmentShader,vertexShader:this.noiseShader.vertexShader,uniforms:this.noiseShader.uniforms,lights:!1}),this.noiseQuadTarget=new THREE.Mesh(new THREE.PlaneGeometry(window.innerWidth,window.innerHeight,100,100),this.noiseMaterial),this.noiseQuadTarget.name="noise_quad_target",this.noiseQuadTarget.position.z=-9e3,this.noiseScene.add(this.noiseQuadTarget)}return e.prototype.enabled=!0,e.prototype.noiseMap=null,e.prototype.noiseShader=null,e.prototype.noiseScene=null,e.prototype.noiseMaterial=null,e.prototype.noiseCameraOrtho=null,e.prototype.noiseQuadTarget=null,e.prototype.noiseRenderTarget=null,e.prototype.noiseSpeed=.005,e.prototype.noiseOffsetSpeed=.1,e.prototype.windDirection=null,e.prototype.update=function(e,t){if(!this.enabled)return;return this.noiseShader.uniforms.fTime.value+=t*this.noiseSpeed,this.noiseShader.uniforms.vOffset.value.x-=t*this.noiseOffsetSpeed*this.windDirection.x,this.noiseShader.uniforms.vOffset.value.y+=t*this.noiseOffsetSpeed*this.windDirection.z,e.render
(this.noiseScene,this.noiseCameraOrtho,this.noiseMap,!1),null},e.prototype.dispose=function(e){var t,n,r,i;e.deallocateRenderTarget(this.noiseMap),e.deallocateMaterial(this.noiseMaterial),e.deallocateObject(this.noiseQuadTarget),i=this.noiseScene.children;for(n=0,r=i.length;n<r;n++)t=i[n],this.noiseScene.remove(t);return this.noiseScene.__webglObjects=null,this.noiseScene.__objects=null,this.noiseScene.__objectsRemoved=null,this.noiseScene.children=[],null},e}(),IFLAutomaticPerformanceAdjust=function(){function e(){this.steps=[],this.reset()}return e.prototype.maxFrameTime=1/15,e.prototype.emergencyFramerate=1/9,e.prototype.MAXSAMPLES=400,e.prototype.tickindex=0,e.prototype.ticksum=0,e.prototype.ticklist=null,e.prototype.steps=null,e.prototype.ignoreticks=0,e.prototype.resetTime=0,e.prototype.update=function(e){var t,n,r,i,s,o,u;this.resetTime+=e,t=this.calcAverageFrametime(e),this.steps.sort(function(e,t){return t.priority-e.priority}),n=this.tickindex>this.MAXSAMPLES/2,i=this.resetTime>2e4,u=this.steps;for(s=0,o=u.length;s<o;s++){r=u[s];if(r.enabled&&(n||i)){t>this.maxFrameTime&&(r.enabled=!1,r.disableFunc!=null?r.disableFunc():r.object[r.property]=!1,console.info("[IFLAutomaticPerformanceAdjust] Disabled "+r.name+" as average Frame time ["+t+"] is above maximum ["+this.maxFrameTime+"] after ["+this.tickindex+"] ticks out of ["+this.MAXSAMPLES+"]"),this.reset());break}}},e.prototype.reset=function(){var e,t,n;this.resetTime=0,this.ignoreticks=0,this.tickindex=0,this.ticksum=0,this.ticklist=[];for(e=t=0,n=this.MAXSAMPLES;t<n;e=t+=1)this.ticklist[e]=0},e.prototype.calcAverageFrametime=function(e){this.ignoreticks++;if(this.ignoreticks>10)return this.ticksum-=this.ticklist[this.tickindex],this.ticksum+=e,this.ticklist[this.tickindex]=e,++this.tickindex===this.MAXSAMPLES&&(this.tickindex=0),this.ticksum/this.MAXSAMPLES;return},e}(),IFLCameraPathInteraction=function(){function e(e){this.camera=e,this.cameraPositionPoints=[],this.cameraLookatPoints=[],this.currentLookAt=new THREE.Vector3,this.normalVector=new THREE.Vector3,this.transformedVector=new THREE.Vector3,this.interpolationVector=new THREE.Vector3,this.lookDeviationY=new ElasticNumber,this.lookDeviationX=new ElasticNumber,this.bobSpeed=new ElasticNumber,this.motionspeedelastic=new ElasticNumber,this.lookDeviationY.spring=this.lookDeviationX.spring=this.bobSpeed.spring=.0015,this.lookDeviationY.damping=this.lookDeviationX.damping=this.bobSpeed.damping=.07,this.motionspeedelastic.spring=.002,this.motionspeedelastic.damping=.07,this.lookRectangle=new THREE.Rectangle,this.lookRectangle.containsPoint=function(e,t){return e>this.getLeft()&&e<this.getRight()&&t>this.getTop()&&t<this.getBottom()}}return e.prototype.cameraPositionPoints=null,e.prototype.cameraLookatPoints=null,e.prototype.lookDeviationY=null,e.prototype.lookDeviationX=null,e.prototype.bobSpeed=null,e.prototype.currentLookAt=null,e.prototype.motionspeedelastic=null,e.prototype.lookRectangle=null,e.prototype.normalVector=null,e.prototype.transformedVector=null,e.prototype.interpolationVector=null,e.prototype.camera=null,e.prototype.motionspeed=0,e.prototype.maxspeed=.14,e.prototype.maxYLookDeviation=15,e.prototype.maxXLookDeviation=50,e.prototype.constantSpeed=!1,e.prototype.minIndex=0,e.prototype.maxIndex=95,e.prototype.currentIndex=20,e.prototype.currentProgress=0,e.prototype.delta=0,e.prototype.APP_WIDTH=800,e.prototype.APP_HEIGHT=600,e.prototype.APP_HALF_X=400,e.prototype.APP_HALF_Y=300,e.prototype.mouseX=0,e.prototype.mouseY=0,e.prototype.forcePathYLookAt=0,e.prototype.forcePathYPosition=0,e.prototype.mouseEnabled=!0,e.prototype.update=function(e,t,n){var r,i,s;return this.mouseX=t,this.mouseY=n,this.delta=e,this.normalMouseInteraction(),s=this.maxXLookDeviation/6,this.lookRectangle.set(s,0,this.maxXLookDeviation-s,this.maxYLookDeviation),r=this.lookDeviationX._value+this.maxXLookDeviation/2,i=this.calcMotionSpeed(r,s),this.cameraPositionPoints&&this.cameraLookatPoints&&(this.advanceProgress(i),this.camera.position.copy(this.interpolate(this.cameraPositionPoints)),this.camera.updateMatrix(),this.currentLookAt=this.interpolate(this.cameraLookatPoints),this.camera.lookAt(this.currentLookAt),this.camera.updateMatrix(),this.normalVector.set(0,0,0),this.camera.matrix.multiplyVector3(this.normalVector),this.transformedVector.set(this.lookDeviationX._value,this.lookDeviationY._value,0),this.camera.matrix.multiplyVector3(this.transformedVector),this.transformedVector.subSelf(this.normalVector),this.currentLookAt.addSelf(this.transformedVector),this.camera.lookAt(this.currentLookAt),this.camera.updateMatrix()),null},e.prototype.advanceProgress=function(e){var t,n;this.constantSpeed?(t=this.cameraPositionPoints[this.currentIndex].distanceTo(this.cameraPositionPoints[this.currentIndex+1]),this.currentProgress+=e*this.delta*100/t):this.currentProgress+=e*this.delta*100,this.currentProgress<0&&(n=Math.abs(Math.floor(this.currentProgress)),this.currentIndex-=n,this.currentProgress=this.currentProgress+n),this.currentProgress>1&&(n=Math.floor(this.currentProgress),this.currentIndex+=n,this.currentProgress=this.currentProgress-n);if(this.currentIndex>this.maxIndex)return this.currentIndex=this.maxIndex,this.currentProgress=1;if(this.currentIndex<this.minIndex)return this.currentIndex=this.minIndex,this.currentProgress=0},e.prototype.calcMotionSpeed=function(e,t){var n;return n=0,e>this.lookRectangle.getRight()?n=(e-this.lookRectangle.getRight())*this.maxspeed/t:e<this.lookRectangle.getLeft()&&(n=(e-this.lookRectangle.getLeft())*this.maxspeed/t),n*Math.abs(n)},e.prototype.goToIndexAndPosition=function(e){return this.currentIndex=Math.floor(e),this.currentProgress=e-this.currentIndex,null},e.prototype.findNearestPathPoint=function(){var e,t,n,r,i,s,o,u,a,f;o=this.camera.position.clone(),n=1e13,i=null,r=-1,f=this.cameraPositionPoints;for(t=u=0,a=f.length;u<a;t=++u)s=f[t],e=Math.abs(s.distanceTo(o)),e<n&&(i=s,n=e,r=t);return r>this.maxIndex&&(r=this.maxIndex),r<this.minIndex&&(r=this.minIndex),r},e.prototype.swipeMouseInteraction=function(){var e,t,n,r;return n=0,r=0,this.mouseDown&&!this.mouseLeft&&(n=(this.mouseDownPoint.x-this.mouseX)/25,r=-(this.mouseDownPoint.y-this.mouseY)/25,n*=this.delta*100,r*=this.delta*100,e=Math.min(this.maxXLookDeviation,Math.max(-this.maxXLookDeviation,this.lookDeviationX._value+n)),t=Math.min(this.maxYLookDeviation,Math.max(-this.maxYLookDeviation,this.lookDeviationY._value+r)),this.lookDeviationX.aimAt(e),this.lookDeviationY.aimAt(t)),this.lookDeviationY.step(this.delta),this.lookDeviationX.step(this.delta),this.lookDeviationX._value=Math.min(this.maxXLookDeviation,Math.max(-this.maxXLookDeviation,this.lookDeviationX._value)),this.lookDeviationY._value=Math.min(this.maxYLookDeviation,Math.max(-this.maxYLookDeviation,this.lookDeviationY._value)),null},e.prototype.normalMouseInteraction=function(){var e,t,n,r;return this.mouseEnabled===!0?(e=this.mouseX,t=this.mouseY,n=this.mouseX+this.APP_HALF_X,r=this.mouseY+this.APP_HALF_Y):(e=0,t=0,n=this.APP_HALF_X,r=this.APP_HALF_Y),this.lookDeviationY.aimAt(-(t*this.maxYLookDeviation)/this.APP_HALF_Y),this.lookDeviationX.aimAt(e*this.maxXLookDeviation/this.APP_HALF_X),this.lookDeviationY.step(this.delta),this.lookDeviationX.step(this.delta),this.lookDeviationX._value=Math.min(this.maxXLookDeviation,Math.max(-this.maxXLookDeviation,this.lookDeviationX._value)),this.lookDeviationY._value=Math.min(this.maxYLookDeviation,Math.max(-this.maxYLookDeviation,this.lookDeviationY._value)),null},e.prototype.p1=new THREE.Vector3,e.prototype.p2=new THREE.Vector3,e.prototype.interpolate=function(e){return this.p1.copy(e[this.currentIndex]),this.p2.copy(e[this.currentIndex+1]),e===this.cameraPositionPoints&&(this.p1.y+=this.forcePathYPosition,this.p2.y+=this.forcePathYPosition),e===this.cameraLookatPoints&&(this.p1.y+=this.forcePathYLookAt,this.p2.y+=this.forcePathYLookAt),this.interpolationVector.sub(this.p2,this.p1),this.interpolationVector.multiplyScalar(this.currentProgress),this.interpolationVector.addSelf(this.p1)},e.prototype.handleResize=function(e,t){return this.APP_WIDTH=e,this.APP_HEIGHT=t,this.APP_HALF_X=this.APP_WIDTH/2,this.APP_HALF_Y=this.APP_HEIGHT/2,null},e}(),IFLOzifyParticleSystem=function(){function e(e,t,n){this.finalize=__bind(this.finalize,this),this.updateParticles=__bind(this.updateParticles,this),this.centerMesh=e,this.scene=t,this.initParticleSystem(n)}return e.prototype.centerMesh=null,e.prototype.scene=null,e.prototype.particleSystem=null,e.prototype.startTime=null,e.prototype.initParticleSystem=function(e){var t,n,r,i,s,o,u,a,f,l,c,h=this;a=new IFLWindyParticlesShader,a.uniforms.windScale.value=0,a.uniforms.diffuseMultiplier.value=2,a.uniforms.alphaMultiplier.value=0,u={},u.fragmentShader=a.fragmentShader,u.vertexShader=a.vertexShader,u.uniforms=a.uniforms,u.attributes={speed:{type:"f",value:[]}},o=new THREE.ShaderMaterial(u),o.map=a.uniforms.map.value=THREE.ImageUtils.loadTexture("/models/textures/particles/ozify.png"),o.size=a.uniforms.size.value=.5,o.transparent=!0,o.blending=THREE.AdditiveBlending,o.depthWrite=!1,o.scale=a.uniforms.scale.value=e/2,o.sizeAttenuation=!0,this.centerMesh.geometry.computeBoundingBox(),t=this.centerMesh.geometry.boundingBox,n=new THREE.Vector3,n.x=t.min.x+(t.max.x-t.min.x)/2,n.y=t.min.y+(t.max.y-t.min.y)/2,n.z=t.min.z+(t.max.z-t.min.z)/2,l=(t.max.x-t.min.x)*(t.max.z-t.min.z),r=500*l/43,i=new THREE.Geometry,i.centroid=n,i.vertices=[];for(s=c=0;0<=r?c<r:c>r;s=0<=r?++c:--c)f=new THREE.Vector3,f.x=f.startX=this.randRange(t.min.x-2,t.max.x+2),f.y=f.startY=this.randRange(t.min.y-2,t.max.y+2),f.z=f.startZ=this.randRange(t.min.z-2,t.max.z+2),f.speedX=.001+Math.random()*.005,f.speedY=.001+Math.random()*.005,f.speedZ=.001+Math.random()*.005,f.randSpreadX=.001+Math.random()*.002,f.randSpreadY=.001+Math.random()*.002,f.randSpreadZ=.001+Math.random()*.002,f.CCW=Math.random()>.5?1:-1,u.attributes.speed.value[s]=1+Math.random()*10,i.vertices.push(f);return this.particleSystem=new THREE.ParticleSystem(i,o),this.particleSystem.position.copy(this.centerMesh.position),this.particleSystem.rotation.copy(this.centerMesh.rotation),this.scene.add(this.particleSystem),(new TWEEN.Tween(a.uniforms.alphaMultiplier)).to({value:.2},1e3).onUpdate(this.updateParticles).onComplete(function(){return(new TWEEN.Tween(a.uniforms.alphaMultiplier)).to({value:0},1e3).onUpdate(h.updateParticles).onComplete(h.finalize).easing(TWEEN.Easing.Cubic.InOut).start()}).easing(TWEEN.Easing.Cubic.InOut).start(),this.startTime=Date.now()},e.prototype.updateParticles=function(){var e,t,n,r,i,s,o,u,a,f,l,c;i=Date.now()-this.startTime,this.particleSystem.material.uniforms.time.value=i/1e3,c=this.particleSystem.geometry.vertices;for(f=0,l=c.length;f<l;f++)a=c[f],s=i*a.speedX,o=i*a.speedY,u=i*a.speedZ,t=i*a.randSpreadX,n=i*a.randSpreadY,r=i*a.randSpreadZ,e=new THREE.Vector3(a.startX,a.startY,a.startZ),e.sub(e,this.particleSystem.geometry.centroid),e.normalize(),e.x*=t,e.y*=n,e.z*=r,a.x=a.startX+e.x+Math.sin(s)*a.CCW,a.y=a.startY+e.y+Math.sin(o)*a.CCW,a.z=a.startZ+e.z+Math.sin(u)*a.CCW;return this.particleSystem.geometry.verticesNeedUpdate=!0},e.prototype.finalize=function(){return this.scene.remove(this.particleSystem),this.scene=null,this.particleSystem=null,this.centerMesh=null},e.prototype.randRange=function(e,t){return Math.random()*(t-e+1)+e},e}(),BatchLoadModel=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.defaults={id:null,list:null},t}(Backbone.Model),LocaleModel=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.defaults={lang:null,strings:null},t}(Backbone.Model),SpriteSheetModel=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.defaults={frames:null,animations:null,images:null},t.prototype.id=null,t}(Backbone.Model),TemplateModel=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.defaults={id:"",text:""},t}(Backbone.Model),CollectionBatchLoad=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.model=BatchLoadModel,t}(Backbone.Collection),CollectionSpriteSheets=function(e){function t(){return this.get=__bind(this.get,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.model=SpriteSheetModel,t.prototype.add=function(e,n){var r;return r=JSON.parse(e.result),r.id=e.id,t.__super__.add.call(this,r,n)},t.prototype.get=function(e,t){var n,r,i;return r=this.where({id:e})[0],i={},n=window.oz.baseAssets.get(r.id+"Assets"),i.image=n.src,i.fullSize=[n.result.width,n.result.height],window.devicePixelRatio===2&&(i.image2x=window.oz.baseAssets.get(r.id+"Assets2x").src),i.frame=r.get("animations")[t][0],i.coord=r.get("frames")[i.frame],i.x=i.coord[0],i.y=i.coord[1],i.width=i.coord[2],i.height=i.coord[3],i},t}(Backbone.Collection),CollectionTemplates=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.model=TemplateModel,t}(Backbone.Collection),Router=function(e){function t(){return this.navigateTo=__bind(this.navigateTo,this),this.hashChanged=__bind(this.hashChanged,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.EVENT_HASH_CHANGED="EVENT_HASH_CHANGED",t.prototype.firstEnter=!0,t.prototype.showInstructions=!0,t.prototype.routes={":area":"hashChanged",":area/":"hashChanged","/:area":"hashChanged","/:area/":"hashChanged","*actions":"hashChanged"},t.prototype.start=function(){return Backbone.history.start({pushState:!0,root:window.oz.BASE_PATH}),null},t.prototype.hashChanged=function(e,n){var r;return this.area=e!=null?e:null,this.sub=n!=null?n:null,this.firstEnter&&this.area!==""&&this.area!==null&&(this.showInstructions=!1,this.firstEnter=!1),r=this.area.indexOf("?"),r!==-1&&(this.area=this.area.substr(0,r)),this.trigger(t.EVENT_HASH_CHANGED,this.area,this.sub),null},t.prototype.navigateTo=function(e,n){n==null&&(n=!0);if(!n){this.trigger(t.EVENT_HASH_CHANGED,e);return}return window.oz.appView.showMap(e===""),e.charAt(e.length-1)!=="/"&&(e+="/"),this.navigate(e,{trigger:!0}),null},t}(Backbone.Router),AssetLoader=function(){function e(){this.handleFileError=__bind(this.handleFileError,this),this.handleFileLoaded=__bind(this.handleFileLoaded,this),this.handleOverallProgress=__bind(this.handleOverallProgress,this),this.loadFiles=__bind(this.loadFiles,this),_.extend(this,Backbone.Events),this.preload=new createjs.PreloadJS,this.preload.onFileLoad=this.handleFileLoaded,this.preload.onError=this.handleFileError,this.preload.onProgress=this.handleOverallProgress,this.preload.setMaxConnections(5),null}return e.prototype.preload=null,e.prototype.loadFiles=function(e){var t;while(e.length>0)t=e.shift(),t.retina!=null?window.devicePixelRatio===2&&this.preload.loadFile(t):this.preload.loadFile(t);return null},e.prototype.handleOverallProgress=function(e){return this.trigger(PreloaderEvents.PROGRESS,e),null},e.prototype.handleFileLoaded=function(e){return this.trigger(PreloaderEvents.COMPLETE,e),null},e.prototype.handleFileError=function(e){return this.trigger(PreloaderEvents.FAIL,e),null},e}(),PreloaderEvents=function(){function e(){}return e.COMPLETE="onComplete",e.PROGRESS="onProgress",e.FAIL="onFail",e}(),MusicBoxSequencer=function(){function e(){}return e.data=null,e.playing=!1,e.animationTimer=null,e.animationDuration=1e3/3,e.initialize=function(t){return e.data=t,e.playing||e.play(),null},e.toggle=function(){return e.playing?e.stop():e.play(),null},e.play=function(t){return e.playing=!0,e.playAudioLoop(t),null},e.stop=function(){return e.playing=!1,e.stopAudioLoop(),null},e.playAudioLoop=function(t){var n;return n=e.animationDuration,t?e.colNo=t:e.colNo=e.data.cols.length/2,e.doLoopAudio(),e.loopAudio=setInterval(e.doLoopAudio,n),null},e.doLoopAudio=function(t){var n,r,i;t==null&&(t=e.data.cols.length-1),e.colNo>t&&(e.colNo=0),n=e.data.cols[e.colNo],r=0;while(r<n.rows.length)i=n.rows[r],e.playSound(e.colNo,i),r++;r=0;while(r<e.data.loops.length)e.playLoopSound(e.data.loops[r]),r++;return e.colNo++,null},e.playLoopSound=function(t){var n;return n="",t.step?e.colNo%t.step===0&&(n=t.event):t.col!=null&&e.colNo===t.col&&(n=t.event),n!==""&&SoundController.send(t.event),null},e.stopAudioLoop=function(){return clearInterval(e.loopAudio),null},e.playSound=function(t,n){return SoundController.send(e.getSoundEvent(t,n)),null},e.getSoundEvent=function(t,n){return e.data.notes[e.data.dimensions.lines-1-n].event},e.transitionTo=function(t,n,r){var i;return SoundController.userLoopLonger=r,t?(e.data=r,i=n<12?n+12+r.dimensions.cols/2:n-12+r.dimensions.cols/2,e.play(i)):e.initialize(r),null},e}.call(this),SoundController=function(){function e(){}return e.xmlLink=null,e.mp3link=null,e.swfLink=null,e.loaded=!1,e.progress=0,e.holding=[],e.userPaused=!1,e.userLoop=null,e.userLoopLonger=null,e.active=!1,e.onBatchComplete=null,e.prototype.batchLoaded=!1,e.init=function(t){return t?(e.xmlLink="http://soundcontroller.se/unit9/oz/config.xml",e.mp3link="http://soundcontroller.se/unit9/oz/mp3s/",e.swfLink="http://soundcontroller.se/unit9/oz/",require(["http://soundcontroller.se/unit9/oz/scsound.js"],e.onLibLoaded)):(e.xmlLink="/sounds/config.xml",e.mp3link="/sounds/",e.swfLink="/sounds/",require(["/js/vendor/scsound.js"],e.onLibLoaded))},e.onLibLoaded=function(){return e.active?SCSound.initialize(e.xmlLink,e.mp3link,e.swfLink,e.onloadcomplete,e.onloadprogress,e.onbatchloaded):e.progress=100},e.onloadprogress=function(t){return e.progress=Math.round(t.toFixed(2)*100)},e.onloadcomplete=function(){return e.loaded=!0,e.send("landing_start")},e.onbatchloaded=function(){if(e.onBatchComplete!=null)return typeof e.onBatchComplete!="string"?(e.send(e.onBatchComplete[0]),e.onBatchComplete=e.onBatchComplete[1]):(e.send(e.onBatchComplete),e.onBatchComplete!=="musicbox_shared"?e.playBackgroundMusic():e.batchLoaded=!0,e.onBatchComplete=null)},e.send=function(t,n){n!=null&&(e.onBatchComplete=n);if(e.active)return e.loaded?SCSound.send(t):e.holding.push(t)},e.paused=function(t){if(e.userPaused)return;return e.userPaused=t,e.send("sound_off")},e.resume=function(t){t==null&&(t=!1);if(t){e.userPaused=!1,e.send("sound_on");return}if(e.userPaused)return;return e.userPaused=!1,e.send("sound_on")},e.oz=function(){return(window||document).oz},e.playBackgroundMusic=function(){return e.userLoop?MusicBoxSequencer.initialize(e.userLoopLonger):MusicBoxSequencer.initialize(JSON.parse(e.oz().baseAssets.get("loopbg").result))},e.preview=function(e){return MusicBoxSequencer.initialize(e)},e.stopBackgroundMusic=function(){return MusicBoxSequencer.stop()},e.transition=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v;r=JSON.parse(e.oz().baseAssets.get("loopbg").result),c=e.userLoop,s=[];for(u=h=0,d=r.dimensions.cols;0<=d?h<d:h>d;u=0<=d?++h:--h)s[u]={rows:[]};for(u=p=0,v=c.cols.length;0<=v?p<v:p>v;u=0<=v?++p:--p){o=c.cols[u],a=0,i=u<12?u+c.dimensions.cols/2:u-c.dimensions.cols/2,l=[];while(a<o.rows.length)f=o.rows[a],a++,l.push(f);s[i+r.dimensions.cols/2]={rows:l}}return r.cols=s,MusicBoxSequencer.transitionTo(t,n,r)},e}.call(this),Analytics=function(){function e(){}return e.tags=null,e.started=!1,e.tagsFlood=null,e.GA_ACCOUNT="37524215-3",e.start=function(){return window._gaq=window._gaq||[["_setAccount","UA-"+e.GA_ACCOUNT],["_trackPageview"]],e.tags=JSON.parse(window.oz.baseAssets.get("trackingTags").result),e.tagsFlood=JSON.parse(window.oz.baseAssets.get("trackingTagsFloodlight").result),e.started=!0,null},e.track=function(t,n){var r,i,s,o,u;e.started||e.start();if(t){i=[],i.push("_trackEvent"),s=e.tags[t];if(s!=null){for(r=o=0,u=s.length;0<=u?o<u:o>u;r=0<=u?++o:--o)i.push(s[r]);window._gaq.push(i)}}return n&&e.trackFloodlight(n),null},e.trackFloodlight=function(t){var n,r,i,s,o;return s=$("#floodlightTrack"),s.length>0&&s.remove(),r=Math.random()+"",n=r*1e13,i=e.tagsFlood[t].cat,o=$('<img id="floodlightTrack" />'),o.attr({src:"http://3944448.fls.doubleclick.net/activityi;src=3944448;type=googl379;cat="+i+";ord="+n+"?",width:1,height:1,style:"visibility:hidden; position: absolute; top:0; left:0"}),$("body").prepend(o),null},e}.call(this),MathUtils=function(){function e(){}return e.lerp=function(e,t,n){return t+(n-t)*e},e.norm=function(e,t,n){return(e-t)/(n-t)},e.map=function(t,n,r,i,s){return e.lerp(e.norm(t,n,r),i,s)},e}.call(this),QueryString=function(){function e(){}return e.get=function(e){var t,n,r;return e?(e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n="[\\?&]"+e+"=([^&#]*)",t=new RegExp(n),r=t.exec(window.location.search),r===null?"":decodeURIComponent(r[1].replace(/\+/g," "))):""},e}.call(this),BrowserDetection=function(){function r(){this.onError=__bind(this.onError,this),this.onSuccess=__bind(this.onSuccess,this),this.compare=__bind(this.compare,this),this.browser=BrowserDetect.browser,this.browserVersion=BrowserDetect.version}var e,t,n;return e=null,t=null,n=Modernizr.webgl,r.prototype.init=function(){return this.compare()},r.prototype.compare=function(){var e;if(this.browser==="Chrome"&&n)return this.onSuccess();if(this.browser==="Chrome"&&!n)return this.onError({message:"Chrome_NoWebGL_message",buttons:["Chrome_NoWebGL_button1","Chrome_NoWebGL_button2"]});if(this.browser==="Firefox"&&n)return this.onError({message:"FF4_Safari_WebGLmessage",buttons:["FF4_Safari_WebGL_button1","FF4_Safari_WebGL_button2"]});if(this.browser==="Firefox"&&!n)return this.onError({message:"FF4_noWebGL_message",buttons:["FF4_noWebGL_button1","FF4_noWebGL_button2"]});if(this.browser==="Explorer"&&(this.browserVersion===6||this.browserVersion===7||this.browserVersion===8||this.browserVersion===9))return this.onError({message:"Explorer_OldVersion_message",buttons:["Explorer_OldVersion_button1"]});if(this.browser==="Safari"&&n)return this.onError({message:"FF4_Safari_WebGLmessage",buttons:["FF4_Safari_WebGL_button1","FF4_Safari_WebGL_button2"]});if(this.browser==="Safari"&&!n)return this.onError({message:"Safari_message",buttons:["Safari_button1"]});window.WebGLRenderingContext||this.onError({message:"NoWebGLRenderingContext_message",buttons:["NoWebGLRenderingContext_button1","NoWebGLRenderingContext_button2"]}),e=canvas.getContext("webgl");if(!e)return this.onError({message:"NoWebGL_message",buttons:["NoWebGL_button1","NoWebGL_button2"]})},r.prototype.onSuccess=function(){return this.onError({message:"Chrome_NoWebGL_message",buttons:["Chrome_NoWebGL_button1","Chrome_NoWebGL_button2"]})},r.prototype.onError=function(e){},r}(),ElasticNumber=function(){function e(){this.spring=.03,this.damping=.3,this._vale=0,this._aim=0,this._vel=0,this.roundToInt=!1,this.maxdelta=.3,this.deltaScale=100,this.threshold=.01}return e.prototype.spring=0,e.prototype.damping=0,e.prototype._value=0,e.prototype._aim=0,e.prototype._vel=0,e.prototype.roundToInt=!1,e.prototype.maxdelta=0,e.prototype.deltaScale=0,e.prototype.threshold=0,e.prototype.aimAt=function(e){return this._aim=e},e.prototype.step=function(e){var t,n,r;return n=this._aim-this._value,t=n*this.spring-this._vel*this.damping,r=Math.min(e,this.maxdelta)*this.deltaScale,this._vel+=t*r,this._value=this._value+this._vel},e}(),Filter=function(){function e(){}return e.getPixels=function(t){var n,r;return n=e.getCanvas(t.width,t.height),r=n.getContext("2d"),r.drawImage(t,0,0),r.getImageData(0,0,n.width,n.height)},e.getCanvas=function(e,t){var n;return n=document.createElement("canvas"),n.width=e,n.height=t,n},e.filterImage=function(t,n,r){var i,s,o,u;i=[e.getPixels(n)];for(s=o=2,u=arguments.length;2<=u?o<u:o>u;s=2<=u?++o:--o)i.push(arguments[s]);return t.apply(null,i)},e.saturation=function(e,t){var n,r,i,s,o,u,a,f;i=e.data;for(o=a=0,f=i.length;a<f;o=a+=4)u=i[o],s=i[o+1],r=i[o+2],n=(u+s+r)/3,t>0?(u+=(n-u)*(1-1/(1.001-t)),s+=(n-s)*(1-1/(1.001-t)),r+=(n-r)*(1-1/(1.001-t))):(u+=(n-u)*-t,s+=(n-s)*-t,r+=(n-r)*-t),i[o]=u,i[o+1]=s,i[o+2]=r;return e},e.brightnessContrast=function(e,t,n){var r,i,s,o,u,a,f;i=e.data;for(o=a=0,f=i.length;a<f;o=a+=4)u=i[o],s=i[o+1],r=i[o+2],u+=t,s+=t,r+=t,n>0?(u=(u-.5)/(1-n)+.5,s=(s-.5)/(1-n)+.5,r=(r-.5)/(1-n)+.5):(u=(u-.5)*(1+n)+.5,s=(s-.5)*(1+n)+.5,r=(r-.5)*(1+n)+.5),i[o]=u,i[o+1]=s,i[o+2]=r;return e},e}.call(this),Requester=function(){function e(){}return e.requests=[],e.request=function(e){var t;return t=$.ajax({url:e.url,type:e.type?e.type:"POST",data:e.data?e.data:null,dataType:e.dataType?e.dataType:"json",contentType:e.contentType?e.contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:e.processData!==null&&e.processData!==void 0?e.processData:!0}),t.done(e.done),t.fail(e.fail),null},e.send=function(e,t){var n,r,i,s;n=new FormData;for(r in t)i=t[r],n.append(r,i);return s=new XMLHttpRequest,s.open("POST",e,!0),s.onload=function(e){return console.log(e)},s.send(n),null},e.shortURL=function(t,n,r){return e.request({url:"https://www.googleapis.com/urlshortener/v1/url",type:"POST",data:JSON.stringify({longUrl:t}),done:n,fail:r,dataType:"json",contentType:"application/json"}),null},e.addImage=function(t,n,r,i){return e.request({url:"/api/image/add",type:"POST",data:{image:encodeURI(t),kind:n},done:r,fail:i}),null},e.addMusic=function(t,n,r){return e.request({url:"/api/music/",type:"POST",data:{data:t},done:n,fail:r}),null},e.getMusic=function(t,n,r){return e.request({url:"/api/music/"+t,type:"GET",data:null,done:n,fail:r}),null},e}.call(this),BaseAssets=function(){function e(){this.onFileComplete=__bind(this.onFileComplete,this),this.onFail=__bind(this.onFail,this),this.onProgress=__bind(this.onProgress,this),this.get=__bind(this.get,this),this.onCollectionError=__bind(this.onCollectionError,this),this.onCollectionSuccess=__bind(this.onCollectionSuccess,this),this.init=__bind(this.init,this),this.loadBatch=__bind(this.loadBatch,this),_.extend(this,Backbone.Events),null}return e.prototype.preloader=null,e.prototype.loadedAssets=null,e.prototype.collection=null,e.prototype.batches=null,e.prototype.loadedBatches=null,e.prototype.batchesToLoad=null,e.prototype.loadBatch=function(e){var t,n,r,i;this.batches=e,this.batchesToLoad=[],i=this.batches;for(n=0,r=i.length;n<r;n++)t=i[n],this.loadedBatches.toString().indexOf(t)===-1&&(this.batchesToLoad.push(t),this.preloader.loadFiles(this.collection.where({id:t})[0].get("list")));return this.batchesToLoad.length===0&&this.trigger("COMPLETE"),null},e.prototype.init=function(e){return this.batches=e,this.loadedBatches=[],this.batchesToLoad=[],this.preloader=new AssetLoader,this.preloader.on(PreloaderEvents.COMPLETE,this.onFileComplete),this.preloader.on(PreloaderEvents.PROGRESS,this.onProgress),this.preloader.on(PreloaderEvents.FAIL,this.onFail),this.collection=new CollectionBatchLoad,this.collection.url="/js/assetList.json",this.collection.fetch({success:this.onCollectionSuccess,error:this.onCollectionError}),null},e.prototype.onCollectionSuccess=function(e){return this.loadBatch(this.batches),null},e.prototype.onCollectionError=function(e){return null},e.prototype.get=function(e){return this.loadedAssets[e]},e.prototype.onProgress=function(e){return this.trigger("PROGRESS",e),null},e.prototype.onFail=function(e){return null},e.prototype.onFileComplete=function(e){switch(e.type){case"json":e.src.indexOf("/ss/")>-1&&(window||document).oz.ss.add(e)}return this.preloader.preload._numItems===this.preloader.preload._numItemsLoaded&&(this.loadedAssets=e.target._loadedItemsById,this.loadedBatches=this.loadedBatches.concat(this.batchesToLoad),this.trigger("COMPLETE",this.loadedAssets)),null},e}(),Locale=function(){function e(){this.get=__bind(this.get,this),this.loadBackup=__bind(this.loadBackup,this),this.onSuccess=__bind(this.onSuccess,this),_.extend(this,Backbone.Events),this.lang=(navigator.language||navigator.userLanguage).toLowerCase(),$.ajax({url:"/api/localisation/desktop/"+this.lang,dataType:"json",success:this.onSuccess,error:this.loadBackup}),null}return e.prototype.lang=null,e.prototype.data=null,e.prototype.onSuccess=function(e){var t;return t=null,e.responseText?t=JSON.parse(e.responseText):t=e,this.data=new LocaleModel(t),this.trigger("complete"),null},e.prototype.loadBackup=function(){var e=this;return $.ajax({url:"/locale/en/strings.txt",dataType:"text",complete:this.onSuccess,error:function(){return console.log("error on loading backup")}}),null},e.prototype.get=function(e){return this.data.get("strings")[e]||""},e}(),Share=function(){function e(){}return e.openWin=function(e,t,n){var r,i;return r=screen.availWidth-t>>1,i=screen.availHeight-n>>1,window.open(e,"","top="+i+",left="+r+",width="+t+",height="+n+",location=no,menubar=no"),null},e.plus=function(t){return e.openWin("https://plus.google.com/share?url="+t,650,385),null},e.facebook=function(t,n){var r;return r=encodeURIComponent(n),e.openWin("http://www.facebook.com/share.php?u="+t+"&t="+r,600,300),null},e.twitter=function(t,n){var r;return r=encodeURIComponent(n),e.openWin("http://twitter.com/intent/tweet/?text="+r+"&url="+t,600,300),null},e.renren=function(t){return e.openWin("http://share.renren.com/share/buttonshare.do?link="+t,600,300),null},e.weibo=function(t){return e.openWin("http://service.weibo.com/share/share.php?url="+t+"&language=zh_cn",600,300),null},e}.call(this),Templates=function(){function e(e){this.get=__bind(this.get,this),this.parseXML=__bind(this.parseXML,this),_.extend(this,Backbone.Events),this.parseXML(e),null}return e.prototype.templates=null,e.prototype.parseXML=function(e){var t;return t=[],$(e).find("template").each(function(e,n){return t.push(new TemplateModel({id:$(n).attr("id").toString(),text:$.trim($(n).text())}))}),this.templates=new CollectionTemplates(t),null},e.prototype.get=function(e){var t;return t=this.templates.where({id:e}),t=t[0].get("text"),$.trim(t)},e}(),Abstract=function(e){function t(){return this.oz=__bind(this.oz,this),this.onAssetsComplete=__bind(this.onAssetsComplete,this),this.onUnLock=__bind(this.onUnLock,this),this.onLock=__bind(this.onLock,this),this.onLockMouseMove=__bind(this.onLockMouseMove,this),this.pointerLockChange=__bind(this.pointerLockChange,this),this.releasePointLock=__bind(this.releasePointLock,this),this.pointLock=__bind(this.pointLock,this),this.onAssetsProgress=__bind(this.onAssetsProgress,this),this.onAssetsInitLoading=__bind(this.onAssetsInitLoading,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.mouseEnabled=__bind(this.mouseEnabled,this),this.show=__bind(this.show,this),this.hide=__bind(this.hide,this),this.onResize=__bind(this.onResize,this),this.remove=__bind(this.remove,this),this.addChild=__bind(this.addChild,this),this.dispose=__bind(this.dispose,this),this.move=__bind(this.move,this),this.empty=__bind(this.empty,this),this.render=__bind(this.render,this),this.pause=__bind(this.pause,this),this.resume=__bind(this.resume,this),this.update=__bind(this.update,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.el=null,t.prototype.id=null,t.prototype.children=null,t.prototype.template=null,t.prototype.templateVars=null,t.prototype.assetsBatch=null,t.prototype.paused=!0,t.prototype.displayMode="",t.prototype.visible=!0,t.prototype.cssTransitionClass=null,t.prototype.initialize=function(){var e;return this.children=[],this.template&&(e=_.template(this.oz().templates.get(this.template)),this.setElement(e(this.templateVars))),this.id&&this.$el.attr("id",this.id),this.className&&this.$el.addClass(this.className),this.init(),this.assetsBatch!=null&&(this.onAssetsInitLoading(),this.oz().baseAssets.on("COMPLETE",this.onAssetsComplete),this.oz().baseAssets.on("PROGRESS",this.onAssetsProgress),this.oz().baseAssets.loadBatch(this.assetsBatch)),this.paused=!1,null},t.prototype.init=function(){return null},t.prototype.update=function(){var e,t,n,r;r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],e.update();return null},t.prototype.resume=function(){var e,t,n,r;this.paused=!1,r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],e.resume!=null&&e.resume(),e.$el.resume();return null},t.prototype.pause=function(){var e,t,n,r;this.paused=!0,r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],e.pause!=null&&e.pause(),e.$el.pause();return null},t.prototype.render=function(){var e,t,n,r;r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],e.render();return null},t.prototype.empty=function(){var e,t,n,r;r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],e&&(e.dispose!=null&&e.dispose(),e.empty!=null&&e.empty(),this.remove(e));return this.children=[],this.$el.empty(),null},t.prototype.move=function(e,t){return this.$el.css({left:e,top:t}),null},t.prototype.dispose=function(){var e;return e=$(this.$el.children()[0]).attr("id")||$(this.$el.children()[0]).attr("class")||this.$el.html()||this.$el.attr("class")||this.$el.attr("style"),console.error
("don't forget to override dispose -> "+e),null},t.prototype.addChild=function(e,t){var n;return t==null&&(t=!1),e.el&&this.children.push(e),n=e.el?e.$el:e,t?this.$el.prepend(n):this.$el.append(n),null},t.prototype.remove=function(e){var t;if(e==null)return;return t=e.el?e.$el:$(e),t&&e.dispose(),t&&this.children.indexOf(e)!==-1&&this.children.splice(this.children.indexOf(e),1),t.remove(),null},t.prototype.onResize=function(e){var t,n,r,i;i=this.children;for(n=0,r=i.length;n<r;n++)t=i[n],t.onResize&&t.onResize();return null},t.prototype.hide=function(e,t,n,r,i){var s=this;return e==null&&(e=!1),t==null&&(t=null),n==null&&(n=400),r==null&&(r="linear"),i==null&&(i=!1),this.$el.hasClass("button_alpha_enabled")&&(this.$el.removeClass("button_alpha_enabled"),this.cssTransitionClass="button_alpha_enabled"),this.visible=!1,e?this.$el.stop().animate({opacity:0},{duration:n,ease:r,complete:function(){typeof t=="function"&&t();if(i)return s.$el.css({visibility:"hidden"})}}):(this.$el.css({opacity:0}),i&&this.$el.css({visibility:"hidden"})),null},t.prototype.show=function(e,t,n,r){var i=this;return e==null&&(e=!1),t==null&&(t=null),n==null&&(n=400),r==null&&(r="linear"),this.visible=!0,this.$el.css({visibility:"visible"}),e?this.$el.stop().animate({opacity:1},n,r,function(){typeof t=="function"&&t();if(i.cssTransitionClass)return i.$el.addClass(i.cssTransitionClass),i.cssTransitionClass=null}):this.$el.css({opacity:1}),null},t.prototype.mouseEnabled=function(e){return this.$el.css({"pointer-events":e?"auto":"none"}),null},t.prototype.onEnterFrame=function(){var e,t,n,r;r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],!this.paused&&e&&e.paused===!1&&typeof e.onEnterFrame=="function"&&e.onEnterFrame();return null},t.prototype.onAssetsInitLoading=function(){return null},t.prototype.onAssetsProgress=function(){return null},t.prototype.pointLock=function(){var e;return this.pointLocked||($(document).bind("pointerlockchange",this.pointerLockChange),$(document).bind("mozpointerlockchange",this.pointerLockChange),$(document).bind("webkitpointerlockchange",this.pointerLockChange),e=$("body")[0],e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock()),null},t.prototype.releasePointLock=function(){var e;return $(document).unbind("pointerlockchange",this.pointerLockChange),$(document).unbind("mozpointerlockchange",this.pointerLockChange),$(document).unbind("webkitpointerlockchange",this.pointerLockChange),$(document).unbind("mousemove",this.onLockMouseMove),e=document,e.exitPointerLock=e.exitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,e.exitPointerLock(),null},t.prototype.pointerLockChange=function(e){return document.mozPointerLockElement===$("body")[0]||document.webkitPointerLockElement===$("body")[0]?($(document).bind("mousemove",this.onLockMouseMove),this.onLock()):(this.releasePointLock(),$(document).unbind("mousemove",this.onLockMouseMove),this.onUnLock()),null},t.prototype.onLockMouseMove=function(e){return null},t.prototype.onLock=function(){return this.pointLocked=!0,console.log("POINTLOCK"),null},t.prototype.onUnLock=function(){return console.log("POINTUNLOCK"),this.pointLocked=!1,null},t.prototype.onAssetsComplete=function(){return this.oz().baseAssets.off("COMPLETE",this.onAssetsComplete),this.oz().baseAssets.off("PROGRESS",this.onAssetsProgress),null},t.prototype.oz=function(){return(window||document).oz},t}(Backbone.View),AbstractButton=function(e){function t(){return this.oz=__bind(this.oz,this),this.show=__bind(this.show,this),this.hide=__bind(this.hide,this),this.pause=__bind(this.pause,this),this.resume=__bind(this.resume,this),this.dispose=__bind(this.dispose,this),this.changeLabel=__bind(this.changeLabel,this),this.onclick=__bind(this.onclick,this),this.onout=__bind(this.onout,this),this.onover=__bind(this.onover,this),this.disable=__bind(this.disable,this),this.enable=__bind(this.enable,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.el=null,t.prototype.id=null,t.prototype.label=null,t.prototype.template=null,t.prototype.templateVars=null,t.prototype.tagName="button",t.prototype.className="abstractbutton",t.prototype.classButton=null,t.prototype.classAnimated=null,t.prototype.initialize=function(){var e;return this.template&&(e=_.template(this.oz().templates.get(this.template)),this.setElement(e(this.templateVars))),this.id&&this.$el.attr("id",this.id),this.className&&this.$el.addClass(this.className),this.classAnimated&&this.$el.addClass(this.classAnimated),navigator.appVersion.indexOf("Win")!==-1&&this.$el.css({padding:"7px 20px 8px 20px"}),this.label!=null&&this.$el.append(this.label),this.init(),null},t.prototype.init=function(){return null},t.prototype.enable=function(){return this.$el.css({cursor:"pointer","pointer-events":"auto"}),this.$el.removeClass("disabled"),this.$el.mouseover(this.onover),this.$el.mouseout(this.onout),this.$el.bind("click",this.onclick),null},t.prototype.disable=function(){return this.$el.css({cursor:"default","pointer-events":"none"}),this.$el.addClass("disabled"),this.$el.unbind("mouseover"),this.$el.unbind("mouseout"),this.$el.unbind("click"),null},t.prototype.onover=function(){return this.$el.addClass("over"),null},t.prototype.onout=function(){return this.$el.removeClass("over"),null},t.prototype.onclick=function(){return null},t.prototype.changeLabel=function(e){return this.$el.html(e),null},t.prototype.dispose=function(){var e;return e=$(this.$el.children()[0]).attr("id")||$(this.$el.children()[0]).attr("class")||this.$el.html(),null},t.prototype.resume=function(){return null},t.prototype.pause=function(){return null},t.prototype.hide=function(e,t){return e==null&&(e=!1),t==null&&(t=null),this.visible=!1,e?this.$el.animate({opacity:0},400,"linear",t):this.$el.css({opacity:0}),null},t.prototype.show=function(e,t){return e==null&&(e=!1),t==null&&(t=null),this.visible=!0,e?this.$el.animate({opacity:1},400,"linear",t):this.$el.css({opacity:1}),null},t.prototype.oz=function(){return(window||document).oz},t}(Backbone.View),AbstractChapter=function(e){function t(){return this.addChapterInstructions=__bind(this.addChapterInstructions,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="div",t.prototype.className="area",t.prototype.chapterInstructions=null,t.prototype.addChapterInstructions=function(){return this.chapterInstructions=new InstructionsChapter,this.addChild(this.chapterInstructions),null},t}(Abstract),AbstractScene=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.hideShare=__bind(this.hideShare,this),this.addShare=__bind(this.addShare,this),this.onClose=__bind(this.onClose,this),this.onResize=__bind(this.onResize,this),this.removeCloseButton=__bind(this.removeCloseButton,this),this.addCloseButton=__bind(this.addCloseButton,this),this.debugBoundary=__bind(this.debugBoundary,this),this.flashIconHelper=__bind(this.flashIconHelper,this),this.removeCameraHelper=__bind(this.removeCameraHelper,this),this.addCameraHelper=__bind(this.addCameraHelper,this),this.addLayout=__bind(this.addLayout,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="div",t.prototype.className="scene",t.prototype.instructions=null,t.prototype.closeBtn=null,t.prototype.boundaries=null,t.prototype.boundary=null,t.prototype.addLayout=function(e,t,n){var r,i=this;return n==null&&(n=null),this.instructions=new Instructions({assetID:e,localeID:t}),this.addChild(this.instructions),this.boundaries=n,((r=this.boundaries)!=null?r.debug:void 0)&&this.debugBoundary(this.boundaries),$(window).bind("click",function(e){var t,n;if(!i.instructions.active){if(!i.boundaries)return i.onClose();t=$(window).width()/2-i.boundaries.w/2,n=$(window).height()/2-i.boundaries.h/2;if(!(e.pageX>=t&&e.pageX<=t+i.boundaries.w&&e.pageY>=n&&e.pageY<=n+i.boundaries.h))return i.onClose()}}),null},t.prototype.addCameraHelper=function(){return this.helpIconContainer=$('<div class="camera_allow_help"/>'),this.helpCameraIcon=new SSAsset("interface","allow_web"),this.helpIconContainer.append(this.helpCameraIcon.$el),this.flashIconHelper(),this.addChild(this.helpIconContainer),null},t.prototype.removeCameraHelper=function(){return this.helpIconContainer.stop(),this.helpIconContainer.remove(),null},t.prototype.flashIconHelper=function(){var e=this;return this.helpIconContainer.animate({opacity:0},500,function(){return e.helpIconContainer.animate({opacity:1},500,e.flashIconHelper)}),null},t.prototype.debugBoundary=function(e){return this.boundary=$("<div></div>"),this.boundary.css({position:"absolute",width:e.w,height:e.h,top:"50%",left:"50%","margin-left":-Math.round(e.w/2),"margin-top":-Math.round(e.h/2),"z-index":1,border:"1px solid red"}),this.addChild(this.boundary),null},t.prototype.addCloseButton=function(){var e;return this.closeBtn=(new Abstract).setElement("<div class='sceneClose'></div>"),this.closeBtn.dispose=function(){return null},this.closeBtn.$el.addClass("button_alpha_enabled"),this.addChild(this.closeBtn),e=new SSAsset("interface","button_close"),this.closeBtn.addChild(e),e.$el.css({width:""+(parseInt(e.$el.css("width"))+2)+"px",height:""+(e.$el.height()+1)+"px","background-position-y":""+(parseFloat(e.$el.css("background-position-y"))+1)+"px"}),null},t.prototype.removeCloseButton=function(){return this.remove(this.closeBtn),null},t.prototype.onResize=function(){var e;return this.boundaries!=null&&this.boundaries.adjustH!=null&&(this.boundaries.h=$(window).height()-this.boundaries.adjustH,(e=this.boundary)!=null&&e.css({height:this.boundaries.h,"margin-top":-Math.round(this.boundaries.h/2)})),t.__super__.onResize.call(this),null},t.prototype.onClose=function(){return this.oz().appView["static"].page instanceof LandingPause||($(".scene3d").css({"-webkit-filter":"blur(0px)"}),this.oz().router.navigateTo("")),null},t.prototype.addShare=function(){return this.trigger("showShare"),null},t.prototype.hideShare=function(){return this.trigger("hideShare"),null},t.prototype.dispose=function(){return $(window).unbind("click"),null},t}(Abstract),Base3DChapter=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.onWorldLoaded=__bind(this.onWorldLoaded,this),this.onWorldProgress=__bind(this.onWorldProgress,this),this.onCameraReady=__bind(this.onCameraReady,this),this.changeView=__bind(this.changeView,this),this.onResize=__bind(this.onResize,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.onTouchMove=__bind(this.onTouchMove,this),this.onTouchStart=__bind(this.onTouchStart,this),this.onTouchEnd=__bind(this.onTouchEnd,this),this.onMouseMove=__bind(this.onMouseMove,this),this.onMouseLeave=__bind(this.onMouseLeave,this),this.onMouseEnter=__bind(this.onMouseEnter,this),this.onKeyUp=__bind(this.onKeyUp,this),this.onKeyDown=__bind(this.onKeyDown,this),this.onMouseUp=__bind(this.onMouseUp,this),this.onMouseDown=__bind(this.onMouseDown,this),this.onMouseClick=__bind(this.onMouseClick,this),this.onDOFChange=__bind(this.onDOFChange,this),this.onColorCorrectionChange=__bind(this.onColorCorrectionChange,this),this.onFogColorChange=__bind(this.onFogColorChange,this),this.initGUI=__bind(this.initGUI,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.guicontainer=null,t.prototype.camera=null,t.prototype.scene=null,t.prototype.renderer=null,t.prototype.controls=null,t.prototype.clock=null,t.prototype.renderTarget=null,t.prototype.composer=null,t.prototype.APP_HEIGHT=800,t.prototype.APP_WIDTH=600,t.prototype.APP_HALF_X=400,t.prototype.APP_HALF_Y=300,t.prototype.mouseX=0,t.prototype.mouseY=0,t.prototype.enableMouse=!0,t.prototype.mouseDown=!1,t.prototype.mouseLeft=!1,t.prototype.lensFlare=null,t.prototype.skyCubeTexture=null,t.prototype.skyCube=null,t.prototype.pointer=null,t.prototype.pickMouse=null,t.prototype.projector=null,t.prototype.gui=null,t.prototype.hud=null,t.prototype.params={cameraFOV:50,colorCorrectionPow:"#2e3359",colorCorrectionPowM:1.4,colorCorrectionMul:"#e3d1d1",colorCorrectionMulM:1.6,colorCorrectionSaturation:-50,colorCorrectionSaturationColors:"#b15858",bloomPower:.39,fogcolor:"#caa46f"},t.prototype.colorCorrection=null,t.prototype.effectBloom=null,t.prototype.renderModel=null,t.prototype.dofpost=null,t.prototype.autoPerformance=null,t.prototype.renderResolutionMultiplier=1,t.prototype.keyMultiplier=0,t.prototype.keyDowns=[],t.prototype.elasticVirtMouseX=null,t.prototype.elasticVirtMouseY=null,t.prototype.lastKeyPress=0,t.prototype.pickableObjects=null,THREE.Frustum.prototype.contains=function(e){var t,n,r,i,s,o,u;t=0,s=this.planes,r=e.customFrustumMatrix!=null?e.customFrustumMatrix:e.matrixWorld,i=r.elements,o=-e.geometry.boundingSphere.radius*r.getMaxScaleOnAxis();for(n=u=0;u<6;n=u+=1){t=s[n].x*i[12]+s[n].y*i[13]+s[n].z*i[14]+s[n].w;if(t<=o)return!1}return!0},t.prototype.init=function(){var e=this;this.clock=new THREE.Clock,this.pickMouse={x:0,y:0},this.elasticVirtMouseX=new ElasticNumber,this.elasticVirtMouseY=new ElasticNumber,this.elasticVirtMouseX.spring=this.elasticVirtMouseY.spring=.0015,this.elasticVirtMouseX.damping=this.elasticVirtMouseY.damping=.07,this.projector=new THREE.Projector,this.APP_WIDTH=$(window).width(),this.APP_HEIGHT=$(window).height(),this.renderer=new THREE.WebGLRenderer({canvas:this.oz().appView.renderCanvas3D,antialias:!1}),this.renderer.autoClear=!1,this.renderer.setSize(this.APP_WIDTH,this.APP_HEIGHT),this.renderer.setClearColorHex(0,1),this.camera=new THREE.PerspectiveCamera(50,this.APP_WIDTH/this.APP_HEIGHT,10,1e5),this.camera.name="mainCamera",this.scene=new THREE.Scene,this.scene.fog=new THREE.Fog(parseInt("0x"+this.params.fogcolor.substr(1)),0,689);switch(this.oz().appView.displayQuality){case"hi":this.renderResolutionMultiplier=1;break;case"med":this.renderResolutionMultiplier=.5;break;case"low":this.renderResolutionMultiplier=.4}return document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1),this.$el.bind("click",this.onMouseClick),this.$el.bind("mousedown",this.onMouseDown),this.$el.bind("mouseup",this.onMouseUp),this.$el.bind("mousemove",this.onMouseMove),this.$el.bind("mouseleave",this.onMouseLeave),this.$el.bind("mouseenter",this.onMouseEnter),this.$el.bind("touchstart",this.onTouchStart),this.$el.bind("touchend",this.onTouchEnd),this.$el.bind("touchmove",this.onTouchMove),this.hud=new Hud(this.renderer,this.APP_WIDTH,this.APP_HEIGHT,!1,!1),this.initComposer(),this.initDOF(),this.autoPerformance=new IFLAutomaticPerformanceAdjust,this.autoPerformance.steps.push({name:"DOF",object:this.dofpost,property:"enabled",enabled:this.dofpost.enabled,priority:100}),this.autoPerformance.steps.push({name:"FXAA",object:this.fxaa,property:"enabled",enabled:this.fxaa.enabled,priority:100}),this.autoPerformance.steps.push({name:"Resolution = 1",enabled:this.renderResolutionMultiplier>.7?!0:!1,priority:1,disableFunc:function(){return e.renderResolutionMultiplier=.7}}),this.autoPerformance.steps.push({name:"Resolution = 0.7",enabled:this.renderResolutionMultiplier>.5?!0:!1,priority:0,disableFunc:function(){return e.renderResolutionMultiplier=.5}})},t.prototype.initComposer=function(){var e;return this.renderTarget=new THREE.WebGLRenderTarget(this.APP_WIDTH,this.APP_HEIGHT),this.renderTarget.generateMipmaps=!1,this.composer=new THREE.EffectComposer(this.renderer,this.renderTarget),this.composer.enabled=!0,this.renderModel=new THREE.RenderPass(this.scene,this.camera,null,!1,!1),this.effectBloom=new THREE.BloomPass(.39),this.effectBloom.enabled=!0,e=new IFLColorCorrectionShader,this.colorCorrection=new THREE.ShaderPass(e),this.colorCorrection.uniforms.enableVolumetricLight.value=0,this.fxaa=new THREE.ShaderPass(THREE.ShaderExtras.fxaa),this.fxaa.enabled=this.oz().appView.displayQuality==="hi"?!0:!1,this.fxaa.uniforms.resolution.value=new THREE.Vector2(1/this.APP_WIDTH,1/this.APP_HEIGHT),this.composer.addPass(this.renderModel),this.composer.addPass(this.effectBloom),this.composer.addPass(this.fxaa),this.composer.addPass(this.colorCorrection),this.colorCorrection.renderToScreen=!0},t.prototype.initDOF=function(){var e,t;return this.dofpost={enabled:this.oz().appView.dofEnabled,focus:.68,aperture:.019,maxblur:.007,camerafar:500,cameranear:.1},this.dofpost.material_depth=new THREE.MeshDepthMaterial,this.dofpost.scene=new THREE.Scene,this.dofpost.camera=new THREE.OrthographicCamera(this.APP_WIDTH/-2,this.APP_WIDTH/2,this.APP_HEIGHT/2,this.APP_HEIGHT/-2,-1e4,1e4),this.dofpost.camera.position.z=100,this.dofpost.camera.name="dofCamera",this.dofpost.scene.add(this.dofpost.camera),t={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat},this.dofpost.rtTextureDepth=new THREE.WebGLRenderTarget(this.APP_WIDTH,this.APP_HEIGHT,t),this.dofpost.rtTextureColor=new THREE.WebGLRenderTarget(this.APP_WIDTH,this.APP_HEIGHT,t),e=THREE.BokehShader,this.dofpost.bokeh_uniforms=THREE.UniformsUtils.clone(e.uniforms),this.dofpost.bokeh_uniforms.tDepth.value=this.dofpost.rtTextureDepth,this.dofpost.bokeh_uniforms.focus.value=this.dofpost.focus,this.dofpost.bokeh_uniforms.aperture.value=this.dofpost.aperture,this.dofpost.bokeh_uniforms.maxblur.value=this.dofpost.maxblur,this.dofpost.bokeh_uniforms.aspect.value=this.APP_WIDTH/this.APP_HEIGHT,this.dofpost.materialBokeh=new THREE.ShaderMaterial({uniforms:this.dofpost.bokeh_uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.dofpost.quad=new THREE.Mesh(new THREE.PlaneGeometry(this.APP_WIDTH,this.APP_HEIGHT),this.dofpost.materialBokeh),this.dofpost.quad.position.z=-1e3,this.dofpost.scene.add(this.dofpost.quad)},t.prototype.initGUI=function(e){var t,n,r,i,s=this;return this.gui=new dat.GUI({width:400,autoPlace:!1,load:e}),this.gui.remember(this.scene.fog),this.gui.remember(this.params),this.gui.remember(this.colorCorrection.uniforms.vignetteOffset),this.gui.remember(this.colorCorrection.uniforms.vignetteDarkness),this.gui.remember(this.dofpost),this.gui.remember(this.fxaa),this.gui.remember(this.effectBloom),this.gui.remember(this.effectBloom.screenUniforms.opacity),r=this.gui.addFolder("Fog"),r.add(this.scene.fog,"near",0,1e3).name("Fog Near"),r.add(this.scene.fog,"far",100,2e3).name("Fog Far"),r.addColor(this.params,"fogcolor").name("Fog Color").onChange(this.onFogColorChange),i=this.gui.addFolder("Post Processing"),n=i.addFolder("Color Correction"),n.addColor(this.params,"colorCorrectionPow").name("Color Power").onChange(this.onColorCorrectionChange),n.add(this.params,"colorCorrectionPowM",0,2).name("Color Power Intensity").onChange(this.onColorCorrectionChange),n.addColor(this.params,"colorCorrectionMul").name("Color Multiplier").onChange(this.onColorCorrectionChange),n.add(this.params,"colorCorrectionMulM",0,2).name("Color Multiplier Intensity").onChange(this.onColorCorrectionChange),n.add(this.params,"colorCorrectionSaturation",-100,100).name("Saturation").onChange(this.onColorCorrectionChange),n.addColor(this.params,"colorCorrectionSaturationColors").name("Saturated Colors").onChange(this.onColorCorrectionChange),n.add(this.colorCorrection.uniforms.vignetteOffset,"value",0,10).name("Vignette Offset"),n.add(this.colorCorrection.uniforms.vignetteDarkness,"value",0,10).name("Vignette Darkness"),t=i.addFolder("DOF"),t.add(this.dofpost,"enabled").name("Enable DOF"),t.add(this.dofpost,"focus",0,3).name("DOF Focus").onChange(this.onDOFChange),t.add(this.dofpost,"aperture",.001,.04).name("DOF Aperture").onChange(this.onDOFChange),t.add(this.dofpost,"maxblur",0,.03).name("DOF MaxBlur").onChange(this.onDOFChange),t.add(this.dofpost,"cameranear",0,100).name("DOF Camera Near"),t.add(this.dofpost,"camerafar",100,5e3).name("DOF Camera Far"),i.add(this.composer,"enabled").name("Enable PostProcessing"),i.add(this,"renderResolutionMultiplier",.1,1).step(.1).name("Resolution").onChange(function(e){return s.onResize()}),i.add(this.fxaa,"enabled").name("Enable FXAA"),i.add(this.effectBloom,"enabled").name("Enable Bloom"),i.add(this.effectBloom.screenUniforms.opacity,"value",0,10).name("Bloom Power"),this.guicontainer=$("<div/>"),this.guicontainer.dispose=function(){},this.guicontainer.css({position:"absolute",right:"0px",top:"0px"}),this.guicontainer.append(this.gui.domElement)},t.prototype.onFogColorChange=function(e){return this.scene.fog.color.copy(this.stringToColor(e))},t.prototype.onColorCorrectionChange=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;if(this.colorCorrection==null)return;return o=this.params.colorCorrectionPowM,a=this.stringToColor(this.params.colorCorrectionPow),l=1-a.r,f=1-a.g,u=1-a.b,this.colorCorrection.uniforms.powRGB.value.set(o*l,o*f,o*u),t=this.params.colorCorrectionMulM,r=this.stringToColor(this.params.colorCorrectionMul),s=r.r,i=r.g,n=r.b,this.colorCorrection.uniforms.mulRGB.value.set(t*s,t*i,t*n),c=-this.params.colorCorrectionSaturation/100,p=this.stringToColor(this.params.colorCorrectionSaturationColors),v=1-p.r,d=1-p.g,h=1-p.b,this.colorCorrection.uniforms.saturation.value.set(c*v,c*d,c*h,1)},t.prototype.stringToColor=function(e){var t,n,r;return r=e.substr(1),n=parseInt("0x"+r),t=new THREE.Color,t.setHex(n),t},t.prototype.onDOFChange=function(e){return this.dofpost.bokeh_uniforms.focus.value=this.dofpost.focus,this.dofpost.bokeh_uniforms.aperture.value=this.dofpost.aperture,this.dofpost.bokeh_uniforms.maxblur.value=this.dofpost.maxblur},t.prototype.onMouseClick=function(e){!this.enableMouse},t.prototype.onMouseDown=function(e){if(!this.enableMouse)return;return this.mouseDown=!0},t.prototype.onMouseUp=function(e){if(!this.enableMouse)return;return this.mouseDown=!1},t.prototype.onKeyDown=function(e){if(!this.enableMouse)return;return e.ctrlKey&&e.keyCode===73&&this.guicontainer!=null&&(this.GUIADDED=!0,this.oz().appView.addChild(this.guicontainer)),e.ctrlKey&&e.keyCode===66&&(this.capturer?(console.log("Video URL (paste in browser): "+this.capturer.save()),this.capturer=null):(this.capturer=new CCapture({framerate:30}),this.capturer.start())),this.keyDowns[e.keyCode]=!0,this.lastKeyPress=this.clock.oldTime},t.prototype.onKeyUp=function(e){if(!this.enableMouse)return;return this.keyDowns[e.keyCode]=!1,this.lastKeyPress=this.clock.oldTime},t.prototype.onMouseEnter=function(e){return this.mouseLeft=!1},t.prototype.onMouseLeave=function(e){return this.mouseLeft=!0},t.prototype.onMouseMove=function(e){if(!this.enableMouse)return;return this.mouseX=e.pageX-this.APP_HALF_X,this.mouseY=e.pageY-this.APP_HALF_Y,this.pickMouse.x=e.clientX/this.APP_WIDTH*2-1,this.pickMouse.y=-(e.clientY/this.APP_HEIGHT)*2+1},t.prototype.onTouchEnd=function(e){if(!this.enableMouse)return;return this.mouseDown=!1},t.prototype.onTouchStart=function(e){if(!this.enableMouse)return;this.mouseDown=!0;if(e.touches.length===1)return e.preventDefault(),this.mouseX=e.touches[0].pageX-this.APP_HALF_X,this.mouseY=e.touches[0].pageY-this.APP_HALF_Y},t.prototype.onTouchMove=function(e){if(!this.enableMouse)return;if(e.touches.length===1)return e.preventDefault(),this.mouseX=e.touches[0].pageX-this.APP_HALF_X,this.mouseY=e.touches[0].pageY-this.APP_HALF_Y},t.prototype.handleVirtualMouse=function(){var e,t;e=!1,t=!1,this.keyDowns[38]===!0&&(t=!0,this.elasticVirtMouseY.aimAt(-this.APP_HEIGHT/2)),this.keyDowns[40]===!0&&(t=!0,this.elasticVirtMouseY.aimAt(this.APP_HEIGHT/2)),this.keyDowns[37]===!0&&(e=!0,this.elasticVirtMouseX.aimAt(-this.APP_WIDTH/2)),this.keyDowns[39]===!0&&(e=!0,this.elasticVirtMouseX.aimAt(this.APP_WIDTH/2)),e||this.elasticVirtMouseX.aimAt(0),t||this.elasticVirtMouseY.aimAt(0),this.elasticVirtMouseY.step(this.delta),this.elasticVirtMouseX.step(this.delta);if(this.clock.oldTime-this.lastKeyPress<1e3)return this.mouseX=this.elasticVirtMouseX._value,this.mouseY=this.elasticVirtMouseY._value},t.prototype.onEnterFrame=function(){return this.delta=this.clock.getDelta(),this.handleVirtualMouse(),this.autoPerformance.update(this.delta),TWEEN.update(),THREE.AnimationHandler.update(this.delta),this.updateControls(),null},t.prototype.updateControls=function(){return this.controls!=null&&this.enableMouse&&(!this.controls.hasOwnProperty("enabled")||this.controls.hasOwnProperty("enabled")&&this.controls.enabled)&&this.controls.update(this.delta),null},t.prototype.emptyRenderPluginPost=[],t.prototype.doRender=function(){var e,t,n;return this.dofpost.enabled?(this.composer.enabled?(this.colorCorrection.renderToScreen=!1,this.renderer.clearTarget(this.renderTarget,!0,!0,!0),this.composer.render(this.delta)):(this.renderer.clearTarget(this.renderTarget,!0,!0,!0),this.renderer.render(this.scene,this.camera,this.dofpost.rtTextureColor)),this.pPost=this.renderer.renderPluginsPost,this.renderer.renderPluginsPost=this.emptyRenderPluginPost,this.scene.overrideMaterial=this.dofpost.material_depth,e=this.camera.far,t=this.camera.near,this.camera.far=this.dofpost.camerafar,this.camera.near=this.dofpost.cameranear,this.camera.updateProjectionMatrix(),this.renderer.render(this.scene,this.camera,this.dofpost.rtTextureDepth,!0),this.camera.far=e,this.camera.near=t,this.camera.updateProjectionMatrix(),this.scene.overrideMaterial=null,this.composer.enabled?(n=0,this.fxaa.enabled&&n++,n%2===0?this.dofpost.bokeh_uniforms.tColor.value=this.composer.renderTarget1:this.dofpost.bokeh_uniforms.tColor.value=this.composer.renderTarget2):this.dofpost.bokeh_uniforms.tColor.value=this.dofpost.rtTextureColor,this.renderer.render(this.dofpost.scene,this.dofpost.camera,null,!0),this.renderer.renderPluginsPost=this.pPost):this.composer.enabled?(this.colorCorrection.renderToScreen=!0,this.renderer.clearTarget(this.renderTarget,!0,!0,!0),this.composer.render(this.delta)):this.renderer.render(this.scene,this.camera,null,!0)},t.prototype.onResize=function(){var e,t,n,r,i;this.APP_WIDTH=$(window).width(),this.APP_HEIGHT=$(window).height(),this.APP_HALF_X=this.APP_WIDTH/2,this.APP_HALF_Y=this.APP_HEIGHT/2,this.camera.aspect=this.APP_WIDTH/this.APP_HEIGHT,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.APP_WIDTH,this.APP_HEIGHT),this.fxaa.uniforms.resolution.value=new THREE.Vector2(1/(this.APP_WIDTH*this.renderResolutionMultiplier),1/(this.APP_HEIGHT*this.renderResolutionMultiplier)),t={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat},this.dofpost.rtTextureDepth=new THREE.WebGLRenderTarget(this.APP_WIDTH*this.renderResolutionMultiplier/2,this.APP_HEIGHT*this.renderResolutionMultiplier/2,t),this.dofpost.bokeh_uniforms.tDepth.value=this.dofpost.rtTextureDepth,this.dofpost.rtTextureColor=new THREE.WebGLRenderTarget(this.APP_WIDTH*this.renderResolutionMultiplier,this.APP_HEIGHT*this.renderResolutionMultiplier,t),this.dofpost.bokeh_uniforms.aspect.value=this.APP_WIDTH/this.APP_HEIGHT,this.hud.resize(this.APP_WIDTH,this.APP_HEIGHT),this.composer!=null&&(this.renderTarget=new THREE.WebGLRenderTarget(this.APP_WIDTH*this.renderResolutionMultiplier,this.APP_HEIGHT*this.renderResolutionMultiplier),this.renderTarget.generateMipmaps=!1,this.composer.reset(this.renderTarget));if(this.lensFlare!=null){i=this.lensFlare.lensFlares;for(n=0,r=i.length;n<r;n++)e=i[n],e.originalSize!=null&&(e.size=e.originalSize*this.renderResolutionMultiplier)}},t.prototype.pause=function(){return t.__super__.pause.call(this),this.enableMouse=!1,this.autoPerformance.reset(),$("body").css("cursor","auto")},t.prototype.resume=function(){return t.__super__.resume.call(this),this.enableMouse=!0,this.autoPerformance.reset()},t.prototype.changeView=function(e){return null},t.prototype.onCameraReady=function(){return this.oz().appView.onCameraReady()},t.prototype.onWorldProgress=function(e){return this.trigger("onWorldProgress",e)},t.prototype.onWorldLoaded=function(){return this.trigger("onWorldLoaded")},t.prototype.handleAnimatedSprites=function(){var e,t,n,r,i,s,o,u,a,f;if(this.animatedSprites){f=this.animatedSprites;for(u=0,a=f.length;u<a;u++)o=f[u],o.material.time+=this.delta,o.material.time>o.material.frametime&&(o.material.time=0,o.material.spritenum+=1,o.material.spritenum===o.material.totalframes&&(o.material.spritenum=0),n=o.material.spritenum%o.material.spritex,r=Math.floor(o.material.spritenum/o.material.spritex),e=n/o.material.spritex,t=r/o.material.spritey,i=1/o.material.spritex,s=1/o.material.spritey,o.material.uniforms&&o.material.uniforms.offsetRepeat&&(o.material.uniforms.offsetRepeat.value.x=e,o.material.uniforms.offsetRepeat.value.y=t,o.material.uniforms.offsetRepeat.value.z=i,o.material.uniforms.offsetRepeat.value.w=s),o.material.map.offset.x=e,o.material.map.offset.y=t,o.material.map.repeat.x=i,o.material.map.repeat.y=s)}return null},t.prototype.cursorPointer=!1,t.prototype.handlePointer=function(){var e,t;if(!this.isGoingToInteractive){e=!1;for(t in this.mouseOverObjects){e=!0;break}if(e){if(!this.cursorPointer)return $("body").css("cursor","pointer"),this.cursorPointer=!0}else if(this.cursorPointer)return this.cursorPointer=!1,$("body").css("cursor","auto")}else if(this.cursorPointer)return this.cursorPointer=!1,$("body").css("cursor","auto")},t.prototype.pickingIntersections=[],t.prototype.checkPicking=function(){var e,t,n,r,i,s;if(this.sceneDescendants==null)return;this.pickVector.set(this.pickMouse.x,this.pickMouse.y,1),this.projector.unprojectVector(this.pickVector,this.camera),this.pickVector.subSelf(this.camera.position),this.pickVector.normalize(),this.pickRay.origin.copy(this.camera.position),this.pickRay.direction.copy(this.pickVector),n=this.pickRay.intersectObjects(this.pickableObjects),r=[];for(e=i=0,s=n.length;i<s;e=++i)t=n[e],r[t.object.name]=t;return r},t.prototype.gotoPositionOnPath=function(e){var t,n,r=this;return this.settings.navigationPoints[e]?(t={pos:this.mouseInteraction.currentIndex+this.mouseInteraction.currentProgress},n=(new TWEEN.Tween(t)).to({pos:this.settings.navigationPoints[e].index},2e3).easing(TWEEN.Easing.Cubic.InOut),n.onUpdate(function(){return r.mouseInteraction.goToIndexAndPosition(t.pos)}),n.start(),!0):!1},t.prototype.randRange=function(e,t){return Math.random()*(t-e+1)+e},t.prototype.dispose=function(){var e,t,n,r,i,s;$("body").css("cursor","auto"),this.$el.unbind("click",this.onMouseClick),this.$el.unbind("mousedown",this.onMouseDown),this.$el.unbind("mouseup",this.onMouseUp),this.$el.unbind("mousemove",this.onMouseMove),this.$el.unbind("mouseleave",this.onMouseLeave),this.$el.unbind("mouseenter",this.onMouseEnter),this.$el.unbind("touchstart",this.onTouchStart),this.$el.unbind("touchend",this.onTouchEnd),this.$el.unbind("touchmove",this.onTouchMove),document.removeEventListener("keydown",this.onKeyDown,!1),document.removeEventListener("keyup",this.onKeyUp,!1),this.renderer.deallocateRenderTarget(this.renderTarget),this.renderer.deallocateRenderTarget(this.dofpost.rtTextureDepth),this.renderer.deallocateRenderTarget(this.dofpost.rtTextureColor),this.renderer.deallocateRenderTarget(this.composer.renderTarget1),this.renderer.deallocateRenderTarget(this.composer.renderTarget2),this.renderer.deallocateObject(this.dofpost.quad),this.renderer.deallocateMaterial(this.dofpost.materialBokeh),this.renderer.deallocateMaterial(this.dofpost.material_depth),t=this.renderer.info.memory,e=this.scene.getDescendants();for(i=0,s=e.length;i<s;i++){r=e[i];if(t.geometries===0)break;this.renderer.deallocateObject(r)}this.oz().appView.remove(this.guicontainer);for(n in this){try{this[n].dispose()}catch(o){}delete this[n]}return this},t}(AbstractChapter),Carnival=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.onResize=__bind(this.onResize,this),this.changeView=__bind(this.changeView,this),this.onMouseUp=__bind(this.onMouseUp,this),this.onMouseDown=__bind(this.onMouseDown,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.onShowDebugPathChange=__bind(this.onShowDebugPathChange,this),this.onWindEnabledChange=__bind(this.onWindEnabledChange,this),this.instanceWorld=__bind(this.instanceWorld,this),this.show=__bind(this.show,this),this.advanceLoading=__bind(this.advanceLoading,this),this.onSceneLoaded=__bind(this.onSceneLoaded,this),this.onSceneProgress=__bind(this.onSceneProgress,this),this.onTextureComplete=__bind(this.onTextureComplete,this),this.onTextureProgress=__bind(this.onTextureProgress,this),this.onSettingsLoaded=__bind(this.onSettingsLoaded,this),this.render=__bind(this.render,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.settings=null,t.prototype.loadedScene=null,t.prototype.mouseInteraction=null,t.prototype.hotspotManager=null,t.prototype.materialManager=null,t.prototype.enableRender=!1,t.prototype.debugPaths=null,t.prototype.mouseDownObjects=null,t.prototype.mouseUpObjects=null,t.prototype.mouseOverObjects=null,t.prototype.lastMouseX=0,t.prototype.lastMouseY=0,t.prototype.mouseDownPoint=null,t.prototype.mouseUpPoint=
null,t.prototype.isGoingToInteractive=!1,t.prototype.currentView=null,t.prototype.currentCutout=null,t.prototype.dustSystems=null,t.prototype.dustSystemMinX=-300,t.prototype.dustSystemMinY=0,t.prototype.dustSystemMinZ=-200,t.prototype.dustSystemMaxX=80,t.prototype.dustSystemMaxY=100,t.prototype.dustSystemMaxZ=80,t.prototype.windGenerator=null,t.prototype.cutoutsDynamicTextures=null,t.prototype.animatedSprites=null,t.prototype.audiolistener=null,t.prototype.isInIntro=!0,t.prototype.nearPoint=null,t.prototype.showTime=-1,t.prototype.pickVector=null,t.prototype.pickRay=null,t.prototype.sceneDescendants=null,t.prototype.minIndex=0,t.prototype.maxIndex=75,t.prototype.dandelionsSettings=null,t.prototype.dustSettings=null,t.prototype.initialOptimization=!1,t.prototype.init=function(){return this.mouseDownPoint=new THREE.Vector2,this.mouseUpPoint=new THREE.Vector2,this.dandelionsSettings=[],this.dustSettings=[],this.addChapterInstructions(),IFLModelManager.getInstance().cacheTextures(this.oz().appView.enablePrefetching),IFLModelManager.getInstance().prefetchEnabled=this.oz().appView.enablePrefetching,this.animatedSprites=[],this.dustSystems=[],this.mouseDownObjects=[],this.mouseUpObjects=[],this.mouseOverObjects=[],this.pickVector=new THREE.Vector3,this.pickRay=new THREE.Ray,t.__super__.init.call(this),this.renderer.gammaInput=!1,this.renderer.gammaOutput=!1,this.renderer.sortObjects=!1,this.renderer.shadowMapEnabled=!1,this.renderer.shadowMapSoft=!1,this.camera.position.x=100,this.camera.position.y=100,this.camera.position.z=100,this.camera.fov=35,this.camera.near=1,this.camera.far=5e3,this.camera.target=new THREE.Vector3(0,0,0),this.mouseInteraction=new IFLCameraPathInteraction(this.camera),this.mouseInteraction.maxIndex=170,this.mouseInteraction.currentIndex=0,this.mouseInteraction.mouseEnabled=!1,SoundController.active&&(this.audiolistener=new THREE.AudioListenerObject(this.camera),this.audiolistener.position.set(0,150,400),this.scene.add(this.audiolistener)),this.oz().appView.debugMode&&(this.controls=new THREE.FlyControls(this.camera,this.oz().appView.wrapper.el),this.controls.movementSpeed=20,this.controls.rollSpeed=.05,this.controls.enabled=!1,this.controls.dragToLook=!0,this.camera.useQuaternion=!1),this.materialManager=new IFLMaterialManager,this.hotspotManager=new IFLHotspotManager,this.params.cameraFOV=this.camera.fov,this.params.fogcolor="#2c2016",this.scene.fog.far=1065,this.scene.fog.near=0,this.scene.fog.color.copy(this.stringToColor(this.params.fogcolor)),this.params.colorCorrectionPow="#2e3359",this.params.colorCorrectionPowM=1.4,this.params.colorCorrectionMul="#edc9a4",this.params.colorCorrectionMulM=1.5,this.params.colorCorrectionSaturation=-50,this.params.colorCorrectionSaturationColors="#524b4b",this.dofpost.focus=this.dofpost.bokeh_uniforms.focus.value=.97,this.dofpost.aperture=this.dofpost.bokeh_uniforms.aperture.value=.009,this.dofpost.maxblur=this.dofpost.bokeh_uniforms.maxblur.value=.007,this.dofpost.cameranear=.001,this.dofpost.camerafar=956,this.params.bloomPower=this.effectBloom.screenUniforms.opacity.value=.75,this.effectBloom.enabled=!0,this.debugPaths=new THREE.Object3D,this.windGenerator=new IFLWindGenerator,this.windGenerator.enabled=this.oz().appView.displayQuality!=="low"?!0:!1,this.colorCorrection.uniforms.vignetteOffset.value=1,this.colorCorrection.uniforms.vignetteDarkness.value=1.3,this.oz().appView.debugMode&&this.initGUI(),this.onColorCorrectionChange(),this.autoPerformance.steps.push({name:"Wind",enabled:this.windGenerator.enabled,priority:50,disableFunc:this.onWindEnabledChange}),this.onResize(),this.lastMouseY=this.mouseY+this.APP_HALF_Y,this.lastMouseX=this.mouseX+this.APP_HALF_X,this},t.prototype.render=function(){return t.__super__.render.apply(this,arguments),$.ajax({url:"/models/s001_settings.json",dataType:"json",success:this.onSettingsLoaded})},t.prototype.onSettingsLoaded=function(e){var t,n,r,i,s;this.settings=e;for(t=n=0,i=e.positions.length;n<i;t=n+=3)this.mouseInteraction.cameraPositionPoints.push(new THREE.Vector3(e.positions[t],e.positions[t+1],e.positions[t+2]));for(t=r=0,s=e.lookAt.length;r<s;t=r+=3)this.mouseInteraction.cameraLookatPoints.push(new THREE.Vector3(e.lookAt[t],e.lookAt[t+1],e.lookAt[t+2]));return e.renderer=this.renderer,e.onProgress=this.onTextureProgress,e.onComplete=this.onTextureComplete,e.textureQuality=this.oz().appView.textureQuality,this.materialManager.init(e),this.materialManager.load(),IFLModelManager.getInstance().load(this.settings.pickables,this.materialManager.instanceMaterial,this.settings.modelURL,this.onSceneLoaded,this.onSceneProgress),this},t.prototype.sceneLoadedPerc=0,t.prototype.sceneLoaded=!1,t.prototype.textureLoadedPerc=0,t.prototype.textureLoaded=!1,t.prototype.loadingDone=!1,t.prototype.onTextureProgress=function(e){return this.textureLoadedPerc=e,this.advanceLoading(),this},t.prototype.onTextureComplete=function(){return this.textureLoaded=!0,this.advanceLoading(),this},t.prototype.onSceneProgress=function(e,t){return this.sceneLoadedPerc=e/t,this.advanceLoading(),this},t.prototype.onSceneLoaded=function(e,t){return SoundController.send("load_scene_1",["load_scene_5","scene_carnival_start"]),this.sceneLoaded=!0,this.loader=e,this.advanceLoading(),this},t.prototype.advanceLoading=function(){var e;e=this.sceneLoadedPerc*.5+this.textureLoadedPerc*.5,this.onWorldProgress(e),this.textureLoaded===!0&&this.sceneLoaded===!0&&!this.loadingDone&&(this.loadingDone=!0,this.instanceWorld(),this.onWorldProgress(1),this.onWorldLoaded())},t.prototype.show=function(){return this.showTime=Date.now(),t.__super__.show.apply(this,arguments)},t.prototype.instanceWorld=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;this.loadedScene=this.loader.createModel(!0),this.createBirdFlocks(),this.initOrganCharacters(),this.cutoutsDynamicTextures=[],s=this.loadedScene.getDescendants();for(l=0,p=s.length;l<p;l++){o=s[l],((m=o.material)!=null?(g=m.uniforms)!=null?g.tWindForce:void 0:void 0)!=null&&o.material.vertexColors===THREE.VertexColors&&(o.material.uniforms.tWindForce.value=this.windGenerator.noiseMap,o.material.uniforms.windDirection.value.copy(this.windGenerator.windDirection)),(o.name==="characterCutouts_spec_right"||o.name==="characterCutouts_spec_middle"||o.name==="characterCutouts_spec_left")&&this.cutoutsDynamicTextures.push(o),o.name.toLowerCase().indexOf("signpost_simple")!==-1&&(o.position.x=20,o.position.z=-28),u=null;if(this.settings.customBounds!=null){for(n in this.settings.customBounds)if(o.name.toLowerCase().indexOf(n)!==-1){u=this.settings.customBounds[n];break}u!=null&&(r=u.position,i=u.radius,o.customFrustumMatrix=new THREE.Matrix4,o.customFrustumMatrix.setPosition(new THREE.Vector3(r[0],r[1],r[2])),o.geometry.boundingSphere.radius=i)}if(this.oz().appView.displayQuality!=="hi"){e=["grass","branch"],a=!1;for(c=0,d=e.length;c<d;c++){t=e[c];if(o.name.toLowerCase().indexOf(t.toLowerCase())!==-1){a=!0;break}}a||this.scene.add(o)}else this.scene.add(o)}this.initSun(),this.oz().appView.showInterface&&this.hotspotManager.init(this.settings,this.scene,this.materialManager,this.oz().localeTexture,this.camera),this.initDustSystems(),this.onResize(),this.setupIntroParams(),this.sceneDescendants=this.scene.getDescendants(),this.pickableObjects=[],y=this.sceneDescendants;for(h=0,v=y.length;h<v;h++)f=y[h],f.pickable===!0&&this.pickableObjects.push(f);return this.enableRender=!0,this.doInitialOptimizationPass(),null},t.prototype.doInitialOptimizationPass=function(){var e;return this.initialOptimization=!0,this.mouseInteraction.currentIndex=120,e=this.camera.fov,this.camera.fov=120,this.camera.updateProjectionMatrix(),this.onEnterFrame(),this.camera.fov=e,this.camera.updateProjectionMatrix(),this.mouseInteraction.currentIndex=0,this.initialOptimization=!1,this.onEnterFrame(),null},t.prototype.setupIntroParams=function(){return this.introParams=[{object:this.camera,param:"fov",min:25,max:this.camera.fov},{object:this.mouseInteraction,param:"maxXLookDeviation",min:30,max:this.mouseInteraction.maxXLookDeviation},{object:this.mouseInteraction,param:"maxYLookDeviation",min:10,max:this.mouseInteraction.maxYLookDeviation},{object:this.scene.fog,param:"near",min:237,max:this.scene.fog.near},{object:this.scene.fog,param:"far",min:1065,max:this.scene.fog.far},{type:"color",object:this.params,param:"fogcolor",min:"#252c16",max:this.params.fogcolor},{object:this.colorCorrection.uniforms.vignetteOffset,param:"value",min:0,max:this.colorCorrection.uniforms.vignetteOffset.value},{object:this.effectBloom.screenUniforms.opacity,param:"value",min:.77,max:this.effectBloom.screenUniforms.opacity.value},{type:"color",object:this.params,param:"colorCorrectionPow",min:"#1d2f50",max:this.params.colorCorrectionPow},{object:this.params,param:"colorCorrectionPowM",min:1.4,max:this.params.colorCorrectionPowM},{type:"color",object:this.params,param:"colorCorrectionMul",min:"#d2a669",max:this.params.colorCorrectionMul},{object:this.params,param:"colorCorrectionMulM",min:2,max:this.params.colorCorrectionMulM},{type:"color",object:this.params,param:"colorCorrectionSaturationColors",min:"#9b9fa0",max:this.params.colorCorrectionSaturationColors},{object:this.params,param:"colorCorrectionSaturation",min:-51,max:this.params.colorCorrectionSaturation}]},t.prototype.initOrganCharacters=function(){var e,t,n,r,i,s,o,u,a;i=new IFLBasicShader,n={},n.fragmentShader=i.fragmentShader,n.vertexShader=i.vertexShader,n.uniforms=i.uniforms,t=new THREE.ShaderMaterial(n),t.map=i.uniforms.map.value=this.materialManager.getPreloadedTexture("organ_characters.dds"),t.map.wrapS=t.map.wrapT=THREE.RepeatWrapping,i.uniforms.diffuseMultiplier.value=.5,t.transparent=!0,t.side=THREE.DoubleSide,t.time=0,t.spritenum=0,t.totalframes=2,t.spritex=1,t.spritey=2,t.frametime=1,this.materialManager.matLib.push(t),e=new THREE.PlaneGeometry(12,12,1,1),a=e.faceVertexUvs[0][0];for(o=0,u=a.length;o<u;o++)s=a[o],s.v=1-s.v;return r=new THREE.Mesh(e,t),r.name="organ_characters",r.position.set(-8.5,22,-75),r.rotation.y=-0.37,this.animatedSprites.push(r),this.scene.add(r),null},t.prototype.createBirdFlocks=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;e=new THREE.PlaneGeometry(10,10,1,1),h=e.faceVertexUvs[0][0];for(f=0,c=h.length;f<c;f++)a=h[f],a.v=1-a.v;u=this.materialManager.getPreloadedTexture("bird.dds"),o=new IFLBasicShader,i={},i.fragmentShader=o.fragmentShader,i.vertexShader=o.vertexShader,i.uniforms=o.uniforms,r=this.oz().appView.displayQuality!=="low"?50:25;for(t=l=0;l<r;t=l+=1)n=new THREE.ShaderMaterial(i),n.map=o.uniforms.map.value=u,n.transparent=!0,n.time=0,n.spritenum=Math.round(this.randRange(0,8)),n.totalframes=8,n.spritex=4,n.spritey=2,n.frametime=1/15,this.materialManager.matLib.push(n),s=new THREE.Mesh(e,n),s.position.set(this.randRange(-1e3,1e3),this.randRange(100,350),this.randRange(-1e3,-400)),s.originalPosition=s.position.clone(),s.name="bird_"+t,s.isBird=!0,this.scene.add(s),this.animatedSprites.push(s);return this},t.prototype.initDustSystems=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;for(s=d=0;d<5;s=d+=1){h=new IFLWindyParticlesShader,f={},f.fragmentShader=h.fragmentShader,f.vertexShader=h.vertexShader,f.uniforms=h.uniforms,f.attributes={speed:{type:"f",value:[]}},u=new THREE.ShaderMaterial(f),u.map=h.uniforms.map.value=CustomImageUtils.loadCompressedTexture("/models/textures/particles/dust"+s+".dds"),u.size=h.uniforms.size.value=Math.random(),u.scale=h.uniforms.scale.value=this.APP_HEIGHT/2,u.transparent=!0,u.sizeAttenuation=!0,u.blending=THREE.AdditiveBlending,this.materialManager.matLib.push(u),this.materialManager.texLib.push(u.map),h.uniforms.tWindForce.value=this.windGenerator.noiseMap,i=new THREE.Geometry,i.vertices=[],a=this.oz().appView.displayQuality!=="low"?300:150;for(o=v=0;v<a;o=v+=1)c={},p=new THREE.Vector3,p.x=c.startX=this.randRange(this.dustSystemMinX,this.dustSystemMaxX),p.y=c.startY=this.randRange(this.dustSystemMinY,this.dustSystemMaxY),p.z=c.startZ=this.randRange(this.dustSystemMinZ,this.dustSystemMaxZ),c.speed=f.attributes.speed.value[o]=1+Math.random()*10,c.sinX=Math.random(),c.sinXR=Math.random()<.5?1:-1,c.sinY=Math.random(),c.sinYR=Math.random()<.5?1:-1,c.sinZ=Math.random(),c.sinZR=Math.random()<.5?1:-1,c.rangeX=Math.random()*5,c.rangeY=Math.random()*5,c.rangeZ=Math.random()*5,c.vert=p,i.vertices.push(p),this.dustSettings.push(c);l=new THREE.ParticleSystem(i,u),this.dustSystems.push(l),this.scene.add(l)}r=new IFLDandelionParticlesShader,f={},f.fragmentShader=r.fragmentShader,f.vertexShader=r.vertexShader,f.uniforms=r.uniforms,f.attributes={rotation:{type:"f",value:[]}},n=new THREE.ShaderMaterial(f),n.map=r.uniforms.map.value=CustomImageUtils.loadCompressedTexture("/models/textures/particles/dandelion.dds"),n.size=r.uniforms.size.value=2,n.scale=r.uniforms.scale.value=this.APP_HEIGHT/2,n.transparent=!0,n.sizeAttenuation=!0,this.materialManager.matLib.push(n),this.materialManager.texLib.push(n.map),t=new THREE.Geometry,t.vertices=[],a=this.oz().appView.displayQuality!=="low"?200:100;for(o=m=0;m<a;o=m+=1)c={},e=new THREE.Vector3,e.x=c.startX=this.randRange(this.dustSystemMinX,this.dustSystemMaxX),e.y=c.startY=this.randRange(this.dustSystemMinY,this.dustSystemMaxY),e.z=c.startZ=this.randRange(this.dustSystemMinZ,this.dustSystemMaxZ),c.speed=.001+Math.random()*.003,c.CCW=Math.random()>.5,c.rotation=f.attributes.rotation.value[o]=Math.random()*(Math.PI/4),t.vertices.push(e),this.dandelionsSettings.push(c);return this.dandelionParticleSystem=new THREE.ParticleSystem(t,n),this.scene.add(this.dandelionParticleSystem),this},t.prototype.initGUI=function(e){var n=this;return t.__super__.initGUI.call(this,e),this.gui.add({value:-2.5},"value",-5,20).name("Fresnel Power").onChange(this.materialManager.changeFresnelPower),this.gui.add({value:this.windGenerator.enabled},"value").name("Enable Wind").onChange(this.onWindEnabledChange),this.gui.add(this.mouseInteraction,"constantSpeed").name("Use Constant Speed"),this.gui.add(this.mouseInteraction,"maxspeed",0,2).name("Maximum slide speed"),this.gui.add(this.mouseInteraction,"maxYLookDeviation",0,100).name("Maximum Y Look"),this.gui.add(this.mouseInteraction,"maxXLookDeviation",0,100).name("Maximum X Look"),this.gui.add({value:!1},"value").name("Show Camera Paths").onChange(this.onShowDebugPathChange),this.gui.add(this.controls,"enabled").name("Exit Camera Path").onChange(function(e){return n.camera.useQuaternion=e}),this},t.prototype.onWindEnabledChange=function(e){var t;return t=e==null?!1:e!=null&&e===!0?!0:!1,this.materialManager.vertexColorsEnabled(t),this.windGenerator.enabled=t,this.loader.geometryAttributeEnabled("color",t)},t.prototype.onShowDebugPathChange=function(e){return e?this.scene.add(this.debugPaths):this.scene.remove(this.debugPaths),this},t.prototype.createDebugPath=function(e){var t,n,r,i,s,o,u,a;o=new THREE.Object3D,r=new THREE.Geometry,i=new THREE.Line(r),o.add(i);for(n=u=0,a=e.length;u<a;n=++u)s=e[n],t=new THREE.Mesh(new THREE.SphereGeometry(.1,3,2),new THREE.MeshBasicMaterial({wireframe:!0,color:16711680,lights:!1})),t.name="debugPathNode_"+n,t.position.copy(s),o.add(t),r.vertices.push(s);return this.debugPaths.add(o),this},t.prototype.initSun=function(){var e,t,n,r,i,s,o,u,a,f=this;n=CustomImageUtils.loadCompressedTexture(this.settings.sun.mainSprite),t=CustomImageUtils.loadCompressedTexture(this.settings.sun.flareSprite),this.materialManager.texLib.push(n),this.materialManager.texLib.push(t),this.lensFlare=new THREE.LensFlare(n,this.settings.sun.size,0,THREE.AdditiveBlending,new THREE.Color(16777215)),this.lensFlare.position.set(this.settings.sun.position[0],this.settings.sun.position[1],this.settings.sun.position[2]),u=this.settings.sun.flares;for(r=0,s=u.length;r<s;r++)e=u[r],this.lensFlare.add(t,e[0],e[1],THREE.AdditiveBlending);a=this.lensFlare.lensFlares;for(i=0,o=a.length;i<o;i++)e=a[i],e.originalSize=e.size;return this.lensFlare.customUpdateCallback=function(t){var n,r,i,s,o;n=-t.positionScreen.x*2,r=-t.positionScreen.y*2,o=t.lensFlares;for(i=0,s=o.length;i<s;i++)e=o[i],e.x=t.positionScreen.x+n*e.distance,e.y=t.positionScreen.y+r*e.distance,e.rotation=0;return t.lensFlares[2].y+=.025,t.lensFlares[3].rotation=t.positionScreen.x*.5+45*Math.PI/180},this.scene.add(this.lensFlare),this},t.prototype.onEnterFrame=function(){if(!this.enableRender)return;t.__super__.onEnterFrame.apply(this,arguments),this.adjustInitialSettings(),this.mouseOverObjects=this.checkPicking(),this.handlePointer(),this.initialOptimization||this.introCameraManagement(),this.handleAnimatedSprites(),this.moveBirds(),this.hotspotManager.update(this.delta),this.moveDandelions(),this.moveDust(),this.handleMultiCamera(),this.renderer.clear(),this.windGenerator.update(this.renderer,this.delta),this.doRender();if(this.capturer)return this.capturer.capture(this.oz().appView.renderCanvas3D)},t.prototype.handleMultiCamera=function(){return this.isGoingToInteractive?this.camera.matrixAutoUpdate=!1:(this.controls==null||this.controls!=null&&!this.controls.enabled)&&this.enableMouse?(this.camera.matrixAutoUpdate=!1,this.mouseInteraction.update(this.delta,this.mouseX,this.mouseY)):this.camera.matrixAutoUpdate=!0},t.prototype.adjustInitialSettings=function(){this.windinitialSettings==null&&(this.windinitialSettings=0),this.windinitialSettings===2?(this.onWindEnabledChange(this.windGenerator.enabled),this.windinitialSettings++):this.windinitialSettings++;if(this.showTime!==-1&&Date.now()-this.showTime>300)return this.showTime=-1,this.mouseInteraction.mouseEnabled=!0},t.prototype.colorIntroParam="color",t.prototype.introCameraManagement=function(){var e,t,n,r,i,s,o,u;if(this.mouseInteraction.currentIndex<this.maxIndex&&!this.isGoingToInteractive){this.mouseInteraction.minIndex=this.minIndex,e=this.mouseInteraction.currentIndex+this.mouseInteraction.currentProgress,o=this.introParams;for(n=0,i=o.length;n<i;n++)t=o[n],t.type!==this.colorIntroParam?this.adjustIntroParam(t.object,t.param,t.min,t.max,e,this.minIndex,this.maxIndex):this.adjustIntroColor(t.object,t.param,t.min,t.max,e,this.minIndex,this.maxIndex);this.camera.updateProjectionMatrix(),this.onFogColorChange(this.params.fogcolor),this.onColorCorrectionChange()}else if(this.passedIntro!==!0){u=this.introParams;for(r=0,s=u.length;r<s;r++)t=u[r],t.type!==this.colorIntroParam?this.adjustIntroParam(t.object,t.param,t.min,t.max,this.maxIndex,this.minIndex,this.maxIndex):this.adjustIntroColor(t.object,t.param,t.min,t.max,this.maxIndex,this.minIndex,this.maxIndex);this.mouseInteraction.minIndex=this.maxIndex,this.passedIntro=!0,this.oz().appView.showMenu()}return null},t.prototype.moveBirds=function(){var e,t,n,r;r=this.animatedSprites;for(t=0,n=r.length;t<n;t++){e=r[t];if(e.isBird!==!0)continue;e.position.x+=.5*this.delta*100,e.position.x>2e3&&(e.position.x=this.randRange(-2e3,-1e3)),e.lookAt(this.camera.position)}return null},t.prototype.moveDandelions=function(){var e,t,n,r,i,s;if(this.dandelionParticleSystem){s=this.dandelionParticleSystem.geometry.vertices;for(t=r=0,i=s.length;r<i;t=++r)e=s[t],n=this.dandelionsSettings[t],e.rotation=this.dandelionParticleSystem.material.attributes.rotation.value[t]=Math.PI/4*Math.sin(this.clock.oldTime*n.speed),n.CCW?(e.x=n.startX-Math.cos(this.clock.oldTime*n.speed*.01)*50,e.y=n.startY-Math.sin(this.clock.oldTime*n.speed*.01)*50):(e.x=n.startX+Math.cos(this.clock.oldTime*n.speed*.01)*50,e.y=n.startY+Math.sin(this.clock.oldTime*n.speed*.01)*50);this.dandelionParticleSystem.material.attributes.rotation.needsUpdate=!0,this.dandelionParticleSystem.geometry.verticesNeedUpdate=!0}return null},t.prototype.moveDust=function(){var e,t,n,r,i,s,o,u,a;u=this.dustSettings;for(r=0,s=u.length;r<s;r++)t=u[r],n=t.vert,t.sinX=t.sinX+.002*t.speed*t.sinXR,t.sinY=t.sinY+.002*t.speed*t.sinYR,t.sinZ=t.sinZ+.002*t.speed*t.sinZR,n.x=t.startX+Math.sin(t.sinX)*t.rangeX,n.y=t.startY+Math.sin(t.sinY)*t.rangeY,n.z=t.startZ+Math.sin(t.sinZ)*t.rangeZ;a=this.dustSystems;for(i=0,o=a.length;i<o;i++)e=a[i],e.material.uniforms.time.value+=this.delta,e.geometry.verticesNeedUpdate=!0;return!1},t.prototype.adjustIntroParam=function(e,t,n,r,i,s,o){var u,a;return a=r-n,u=o-s,e[t]=n+i*a/u,this},t.prototype.adjustIntroColor=function(e,t,n,r,i,s,o){var u,a,f,l,c;return l=this.stringToColor(n),a=this.stringToColor(r),c=l.r+i*(a.r-l.r)/(o-s),f=l.g+i*(a.g-l.g)/(o-s),u=l.b+i*(a.b-l.b)/(o-s),l.r=c,l.g=f,l.b=u,e[t]="#"+l.getHex().toString(16),this},t.prototype.changeCutout=function(e){var t,n,r;if(this.currentView!=="cutout"||this.currentCutout===e)return;return n=new THREE.Vector3(this.settings.cutout[e].position[0],this.settings.cutout[e].position[1],this.settings.cutout[e].position[2]),t=new THREE.Vector3(this.settings.cutout[e].lookat[0],this.settings.cutout[e].lookat[1],this.settings.cutout[e].lookat[2]),r=new THREE.Vector3(this.settings.cutout[this.currentCutout].lookat[0],this.settings.cutout[this.currentCutout].lookat[1],this.settings.cutout[this.currentCutout].lookat[2]),this.hotspotManager.interactiveCameraTween(r,n,t,50,500),this.currentCutout=e,this},t.prototype.onMouseDown=function(e){t.__super__.onMouseDown.call(this);if(!this.enableMouse)return;if(this.controls!=null&&this.controls.enabled)return;return this.mouseDownPoint.set(this.mouseX,this.mouseY),this.mouseDownObjects=this.checkPicking(),this},t.prototype.onMouseUp=function(e){var n,r,i,s,o,u,a,f,l;t.__super__.onMouseUp.call(this);if(!this.enableMouse)return;if(this.controls!=null&&this.controls.enabled)return;this.mouseUpPoint.set(this.mouseX,this.mouseY),this.mouseUpObjects=this.checkPicking();if(!this.isGoingToInteractive&&this.hotspotManager.handleMouseUp(this.mouseUpObjects,this.mouseDownObjects))if(this.currentView===this.hotspotManager.clickedHotspot)this.oz().router.navigateTo(this.currentView),this.hotspotManager.zoomInHotspot(this.currentView,this.onCameraReady,this.mouseInteraction)&&(this.currentView==="cutout"&&(this.currentCutout="middle"),this.isGoingToInteractive=!0);else{r="";switch(this.hotspotManager.clickedHotspot.toLowerCase()){case"zoetrope":r="carnival2",this.oz().router.navigateTo(r,!1);break;default:r=this.hotspotManager.clickedHotspot,this.oz().router.navigateTo(r)}}if(this.settings!=null)for(u in this.settings.ozificables){i=this.mouseUpObjects[u]!=null?this.mouseUpObjects[u]:!1,s=this.mouseDownObjects[u]!=null?this.mouseDownObjects[u]:!1;if(s!==!1&&i!==!1&&this.hotspotManager.is3DMouseClick(s,i)){o=this.settings.ozificables[u],l=this.sceneDescendants;for(a=0,f=l.length;a<f;a++){n=l[a];if(n.name!==o.target)continue;n.ozified!==!0?(SoundController.send("ozzification_on"),(new TWEEN.Tween(n.material.uniforms.lightmapBlend)).to({value:1},2e3).start(),new IFLOzifyParticleSystem(s.object,this.scene,this.APP_HEIGHT),n.ozified=!0):n.ozified===!0&&(SoundController.send("ozzification_off"),(new TWEEN.Tween(n.material.uniforms.lightmapBlend)).to({value:0},2e3).start(),n.ozified=!1);break}break}}return this},t.prototype.changeView=function(e){var t,n,r,i=this;if(e===this.currentView)return;this.currentView=e;if(e===null){this.resume(),this.onEnterFrame(),this.hotspotManager.hotspotsAlpha(1),r=this.settings.navigationPoints[this.hotspotManager.clickedHotspot].index,n=this.mouseInteraction.cameraPositionPoints[r].clone(),t=this.mouseInteraction.cameraLookatPoints[r].clone(),this.mouseInteraction.currentIndex=r,this.mouseInteraction.currentProgress=.5,this.mouseInteraction.lookDeviationX._value=0,this.mouseInteraction.lookDeviationY._value=0,this.mouseInteraction.bobSpeed._value=0,this.hotspotManager.interactiveCameraTween(this.mouseInteraction.currentLookAt,n,t,35,1500).onComplete(function(){return i.isGoingToInteractive=!1,i.nearPoint=null}),this.hotspotManager.clickedHotspot=null;return}return this.hotspotManager.clickedHotspot===this.currentView?this.hotspotManager.zoomInHotspot(e,this.onCameraReady,this.mouseInteraction)&&(e==="cutout"&&(this.currentCutout="middle"),this.isGoingToInteractive=!0):this.gotoPositionOnPath(e)||this.oz().router.navigateTo(e),this},t.prototype.cutoutsUpdatedOnce=!1,t.prototype.updateCutoutsTexture=function(e){var t,n,r,i,s;n=null,this.cutoutsUpdatedOnce||(n=new THREE.Texture(e),n.needsUpdate=!0,n.flipY=!1),s=this.cutoutsDynamicTextures;for(r=0,i=s.length;r<i;r++)t=s[r],this.cutoutsUpdatedOnce||(t.material.lightMap=t.material.uniforms.lightMap.value=n),t.material.lightMap.image=e,t.material.lightMap.needsUpdate=!0;return this.cutoutsUpdatedOnce=!0,this},t.prototype.onResize=function(){var e,n,r,i,s;t.__super__.onResize.apply(this,arguments),this.mouseInteraction.handleResize(this.APP_WIDTH,this.APP_HEIGHT);if(this.materialManager&&this.materialManager.matLib){i=this.materialManager.matLib;for(n=0,r=i.length;n<r;n++)e=i[n],((s=e.uniforms)!=null?s.scale:void 0)!=null&&(e.uniforms.scale.value=this.APP_HEIGHT/2*this.renderResolutionMultiplier)}return this},t.prototype.dispose=function(){var e,n,r,i,s,o,u,a;(i=this.materialManager)!=null&&i.dispose(this.renderer),delete this.materialManager,(s=this.loader)!=null&&s.dispose(),delete this.loader,(o=this.windGenerator)!=null&&o.dispose(this.renderer),delete this.windGenerator,(u=this.hotspotManager)!=null&&u.dispose(),delete this.hotspotManager,a=this.scene.children;for(n=0,r=a.length;n<r;n++)e=a[n],this.scene.remove(e);return this.scene.__webglObjects=null,this.scene.__objects=null,this.scene.__objectsRemoved=null,this.scene.children=[],this.dustSystems=null,this.animatedSprites=null,t.__super__.dispose.apply(this,arguments),this},t}(Base3DChapter),Carnival2=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.onResize=__bind(this.onResize,this),this.onMouseUp=__bind(this.onMouseUp,this),this.onMouseDown=__bind(this.onMouseDown,this),this.changeView=__bind(this.changeView,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.onShowDebugPathChange=__bind(this.onShowDebugPathChange,this),this.onWindEnabledChange=__bind(this.onWindEnabledChange,this),this.instanceWorld=__bind(this.instanceWorld,this),this.advanceLoading=__bind(this.advanceLoading,this),this.show=__bind(this.show,this),this.onSceneLoaded=__bind(this.onSceneLoaded,this),this.onSceneProgress=__bind(this.onSceneProgress,this),this.onTextureComplete=__bind(this.onTextureComplete,this),this.onTextureProgress=__bind(this.onTextureProgress,this),this.onSettingsLoaded=__bind(this.onSettingsLoaded,this),this.render=__bind(this.render,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.settings=null,t.prototype.loadedScene=null,t.prototype.mouseInteraction=null,t.prototype.hotspotManager=null,t.prototype.materialManager=null,t.prototype.enableRender=!1,t.prototype.debugPaths=null,t.prototype.mouseOverObjects=null,t.prototype.mouseDownObjects=null,t.prototype.mouseUpObjects=null,t.prototype.lastMouseX=0,t.prototype.lastMouseY=0,t.prototype.mouseDownPoint=new THREE.Vector2,t.prototype.mouseUpPoint=new THREE.Vector2,t.prototype.isGoingToInteractive=!1,t.prototype.currentView=null,t.prototype.currentCutout=null,t.prototype.dustSystems=null,t.prototype.dustSystemMinX=-170,t.prototype.dustSystemMinY=0,t.prototype.dustSystemMinZ=-200,t.prototype.dustSystemMaxX=80,t.prototype.dustSystemMaxY=100,t.prototype.dustSystemMaxZ=30,t.prototype.windGenerator=null,t.prototype.audiolistener=null,t.prototype.occlusionBuffer=null,t.prototype.animatedSprites=null,t.prototype.nearPoint=null,t.prototype.pickVector=null,t.prototype.pickRay=null,t.prototype.sceneDescendants=null,t.prototype.dustSettings=[],t.prototype.sceneLoadedPerc=0,t.prototype.sceneLoaded=!1,t.prototype.textureLoadedPerc=0,t.prototype.textureLoaded=!1,t.prototype.loadingDone=!1,t.prototype.init=function(){return IFLModelManager.getInstance().cacheTextures(this.oz().appView.enablePrefetching),IFLModelManager.getInstance().prefetchEnabled=this.oz().appView.enablePrefetching,t.__super__.init.apply(this,arguments),this.pickVector=new THREE.Vector3,this.pickRay=new THREE.Ray,this.animatedSprites=[],this.dustSystems=[],this.mouseDownObjects=[],this.mouseUpObjects=[],this.mouseOverObjects=[],this.renderer.gammaInput=!1,this.renderer.gammaOutput=!1,this.renderer.sortObjects=!1,this.renderer.shadowMapEnabled=!1,this.renderer.shadowMapSoft=!1,this.camera.position.x=100,this.camera.position.y=100,this.camera.position.z=100,this.camera.fov=35,this.camera.near=1,this.camera.far=7e3,this.camera.target=new THREE.Vector3(0,0,0),this.mouseInteraction=new IFLCameraPathInteraction(this.camera),this.mouseInteraction.maxXLookDeviation=40,SoundController.active&&(this.audiolistener=new THREE.AudioListenerObject(this.camera),this.audiolistener.position.set(0,150,400),this.scene.add(this.audiolistener)),this.oz().appView.debugMode&&(this.controls=new THREE.FlyControls(this.camera,this.oz().appView.wrapper.el),this.controls.movementSpeed=100,this.controls.rollSpeed=.5,this.controls.enabled=!1,this.controls.dragToLook=!0,this.camera.useQuaternion=!1),this.materialManager=new IFLMaterialManager,this.hotspotManager=new IFLHotspotManager,this.params.cameraFOV=this.camera.fov,this.params.fogcolor="#180f20",this.scene.fog.far=757,this.scene.fog.near=0,this.scene.fog.color.copy(this.stringToColor(this.params.fogcolor)),this.params.colorCorrectionPow="#2f2869",this.params.colorCorrectionPowM=2,this.params.colorCorrectionMul="#bea38b",this.params.colorCorrectionMulM=1.8,this.params.colorCorrectionSaturation=-52,this.params.colorCorrectionSaturationColors="#11263e",this.dofpost.focus=this.dofpost.bokeh_uniforms.focus.value=.97,this.dofpost.aperture=this.dofpost.bokeh_uniforms.aperture.value=.009,this.dofpost.maxblur=this.dofpost.bokeh_uniforms.maxblur.value=.007,this.dofpost.cameranear=.001,this.dofpost.camerafar=956,this.params.bloomPower=this.effectBloom.screenUniforms.opacity.value=.75,this.effectBloom.enabled=!0,this.debugPaths=new THREE.Object3D,this.windGenerator=new IFLWindGenerator,this.windGenerator.enabled=this.oz().appView.displayQuality!=="low"?!0:!1,this.colorCorrection.uniforms.vignetteOffset.value=.2,this.colorCorrection.uniforms.vignetteDarkness.value=1,this.oz().appView.debugMode&&this.initGUI(),this.onColorCorrectionChange(),this.autoPerformance.steps.push({name:"Wind",enabled:this.windGenerator.enabled,priority:50,disableFunc:this.onWindEnabledChange}),this.onResize(),this.lastMouseY=this.mouseY+this.APP_HALF_Y,this.lastMouseX=this.mouseX+this.APP_HALF_X,this},t.prototype.render=function(){return t.__super__.render.apply(this,arguments),$.ajax({url:"/models/s002_settings.json",dataType:"json",success:this.onSettingsLoaded})},t.prototype.onSettingsLoaded=function(e){var t,n,r,i,s;this.settings=e;for(t=n=0,i=e.positions.length;n<i;t=n+=3)this.mouseInteraction.cameraPositionPoints.push(new THREE.Vector3(e.positions[t],e.positions[t+1],e.positions[t+2]));for(t=r=0,s=e.lookAt.length;r<s;t=r+=3)this.mouseInteraction.cameraLookatPoints.push(new THREE.Vector3(e.lookAt[t],e.lookAt[t+1],e.lookAt[t+2]));return e.renderer=this.renderer,e.onProgress=this.onTextureProgress,e.onComplete=this.onTextureComplete,e.textureQuality=this.oz().appView.textureQuality,this.materialManager.init(e),this.materialManager.load(),IFLModelManager.getInstance().load(this.settings.pickables,this.materialManager.instanceMaterial,this.settings.modelURL,this.onSceneLoaded,this.onSceneProgress),this},t.prototype.onTextureProgress=function(e){return this.textureLoadedPerc=e,this.advanceLoading(),this},t.prototype.onTextureComplete=function(){return this.textureLoaded=!0,this.advanceLoading(),this},t.prototype.onSceneProgress=function(e,t){return this.sceneLoadedPerc=e/t,this.advanceLoading(),this},t.prototype.onSceneLoaded=function(e,t){return this.oz().appView.firstTime?SoundController.send("load_scene_1",["load_scene_5","scene_carnival_start"]):SoundController.send("load_scene_2","scene_carnival2_start"),this.sceneLoaded=!0,this.loader=e,this.advanceLoading(),this},t.prototype.show=function(){return this.instanceWorld(),this.oz().appView.showMenu(),t.__super__.show.apply(this,arguments)},t.prototype.advanceLoading=function(){var e;e=this.sceneLoadedPerc*.5+this.textureLoadedPerc*.5,this.onWorldProgress(e);if(this.textureLoaded===!0&&this.sceneLoaded===!0&&!this.loadingDone)return this.loadingDone=!0,this.onWorldProgress(1),this.onWorldLoaded()},t.prototype.instanceWorld=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;this.loadedScene=this.loader.createModel(!0),this.dofpost.enabled&&(u=new THREE.Mesh(new THREE.PlaneGeometry(27.958,20.505,1,1),new THREE.MeshBasicMaterial({transparent:!0,opacity:0,color:16711680})),u.rotation.set(0,.778347033,0),u.position.set(13.615,13.477,-114.834),this.scene.add(u)),h=[],r=0,o=this.loadedScene.getDescendants();for(p=0,m=o.length;p<m;p++){a=o[p],((b=a.material)!=null?(w=b.uniforms)!=null?w.tWindForce:void 0:void 0)!=null&&a.material.vertexColors===THREE.VertexColors&&(a.material.uniforms.tWindForce.value=this.windGenerator.noiseMap
,a.material.uniforms.windDirection.value.copy(this.windGenerator.windDirection)),a.name.toLowerCase().indexOf("zoetrope")!==-1&&(this.zoe=a),a.name.toLowerCase().indexOf("zfg_spec")!==-1&&(this.pole=a),a.name.toLowerCase().indexOf("vol_main")!==-1&&(r%2===0&&this.loadedScene.remove(a),r++),f=null;if(this.settings.customBounds!=null){for(n in this.settings.customBounds)if(a.name.toLowerCase().indexOf(n)!==-1){f=this.settings.customBounds[n];break}f!=null&&(i=f.position,s=f.radius,a.customFrustumMatrix=new THREE.Matrix4,a.customFrustumMatrix.setPosition(new THREE.Vector3(i[0],i[1],i[2])),a.geometry.boundingSphere.radius=s)}if(this.oz().appView.displayQuality!=="hi"){e=["grass","branch"],l=!1;for(d=0,g=e.length;d<g;d++){t=e[d];if(a.name.toLowerCase().indexOf(t.toLowerCase())!==-1){l=!0;break}}l||this.scene.add(a)}else this.scene.add(a)}this.initOcclusionScene(),this.initProjection(),this.initSun(),this.oz().appView.showInterface&&this.hotspotManager.init(this.settings,this.scene,this.materialManager,this.oz().localeTexture,this.camera),this.initDustSystems(),this.oz().appView.zoetropeTexture!=null&&this.updateFilmTexture(this.oz().appView.zoetropeTexture),this.sceneDescendants=this.scene.getDescendants(),this.pickableObjects=[],E=this.sceneDescendants;for(v=0,y=E.length;v<y;v++)c=E[v],c.pickable===!0&&this.pickableObjects.push(c);return this.enableRender=!0,this.onResize()},t.prototype.initProjection=function(){var e;return this.projectionmat=new THREE.MeshBasicMaterial({lights:!1,blending:THREE.AdditiveBlending,transparent:!0,map:this.materialManager.getPreloadedTexture("projection.dds"),side:THREE.DoubleSide,opacity:.5}),this.projectionmat.map.generateMipmaps=!1,this.projectionmat.map.magFilter=THREE.LinearFilter,this.projectionmat.map.minFilter=THREE.LinearFilter,this.projectionmat.map.wrapS=this.projectionmat.map.wrapT=THREE.RepeatWrapping,this.projectionmat.time=0,this.projectionmat.spritenum=0,this.projectionmat.totalframes=12,this.projectionmat.spritex=3,this.projectionmat.spritey=4,this.projectionmat.frametime=.1,this.materialManager.matLib.push(this.projectionmat),this.materialManager.texLib.push(this.projectionmat.map),e=new THREE.PlaneGeometry(20,20,1,1),this.projection=new THREE.Mesh(e,this.projectionmat),this.projection.name="zoetrope_projection",this.projection.position.set(144.999,16.892,-126.195),this.projection.rotation.set(-Math.PI,-0.171845118,0),this.animatedSprites.push(this.projection),this.scene.add(this.projection)},t.prototype.initOcclusionScene=function(){var e,t,n,r,i,s;return this.occlusionScene=new THREE.Scene,t=new THREE.MeshBasicMaterial({color:0,map:null}),n=new THREE.MeshBasicMaterial({color:15921358,map:null}),s=new THREE.Mesh(this.zoe.geometry,t),s.name="occlusion_zoetrope",r=new THREE.Mesh(this.pole.geometry,t),r.name="occlusion_pole",this.occlusionScene.add(s),this.occlusionScene.add(r),this.light2=new THREE.Mesh(new THREE.SphereGeometry(1.8),n),this.light2.name="occlusion_light",this.light2.position.set(134.18,14.428,-80.7),this.light2.scale.y=.6,this.occlusionScene.add(this.light2),this.occlusionBuffer=new THREE.WebGLRenderTarget(this.APP_WIDTH/2,this.APP_HEIGHT/2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat}),this.colorCorrection.uniforms.tVolumetricLight.value=this.occlusionBuffer,this.occlusionComposer=new THREE.EffectComposer(this.renderer,this.occlusionBuffer),i=new THREE.RenderPass(this.occlusionScene,this.camera),this.occlusion_hblur=new THREE.ShaderPass(THREE.ShaderExtras.horizontalTiltShift),this.occlusion_vblur=new THREE.ShaderPass(THREE.ShaderExtras.verticalTiltShift),e=2,this.occlusion_hblur.uniforms.h.value=e/this.APP_WIDTH*2,this.occlusion_vblur.uniforms.v.value=e/this.APP_HEIGHT*2,this.occlusionComposer.addPass(i),this.occlusionComposer.addPass(this.occlusion_hblur),this.occlusionComposer.addPass(this.occlusion_vblur),this.occlusionComposer.addPass(this.occlusion_hblur),this.occlusionComposer.addPass(this.occlusion_vblur)},t.prototype.initDustSystems=function(){var e,t,n,r,i,s,o,u,a,f,l,c;for(t=l=0;l<5;t=l+=1){a=new IFLWindyParticlesShader,s={},s.fragmentShader=a.fragmentShader,s.vertexShader=a.vertexShader,s.uniforms=a.uniforms,s.attributes={speed:{type:"f",value:[]}},r=new THREE.ShaderMaterial(s),r.map=a.uniforms.map.value=CustomImageUtils.loadCompressedTexture("/models/textures/particles/dust"+t+".dds"),r.size=a.uniforms.size.value=Math.random(),r.scale=a.uniforms.scale.value=this.APP_HEIGHT/2,r.transparent=!0,r.sizeAttenuation=!0,r.blending=THREE.AdditiveBlending,this.materialManager.matLib.push(r),this.materialManager.texLib.push(r.map),a.uniforms.tWindForce.value=this.windGenerator.noiseMap,e=new THREE.Geometry,e.vertices=[],i=this.oz().appView.displayQuality!=="low"?300:150;for(n=c=0;c<i;n=c+=1)u={},f=new THREE.Vector3,f.x=u.startX=this.randRange(this.dustSystemMinX,this.dustSystemMaxX),f.y=u.startY=this.randRange(this.dustSystemMinY,this.dustSystemMaxY),f.z=u.startZ=this.randRange(this.dustSystemMinZ,this.dustSystemMaxZ),u.speed=s.attributes.speed.value[n]=1+Math.random()*10,u.sinX=Math.random(),u.sinXR=Math.random()<.5?1:-1,u.sinY=Math.random(),u.sinYR=Math.random()<.5?1:-1,u.sinZ=Math.random(),u.sinZR=Math.random()<.5?1:-1,u.rangeX=Math.random()*5,u.rangeY=Math.random()*5,u.rangeZ=Math.random()*5,u.vert=f,e.vertices.push(f),this.dustSettings.push(u);o=new THREE.ParticleSystem(e,r),this.dustSystems.push(o),this.scene.add(o)}return null},t.prototype.initGUI=function(e){var n=this;return t.__super__.initGUI.call(this,e),this.gui.add({value:-2.5},"value",-5,20).name("Fresnel Power").onChange(this.materialManager.changeFresnelPower),this.gui.add({value:1},"value",0,10).name("Normal Scale").onChange(this.materialManager.changeNormalScale),this.gui.add({value:this.windGenerator.enabled},"value").name("Enable Wind").onChange(this.onWindEnabledChange),this.gui.add(this.mouseInteraction,"constantSpeed").name("Use Constant Speed"),this.gui.add(this.mouseInteraction,"maxspeed",0,2).name("Maximum slide speed"),this.gui.add(this.mouseInteraction,"maxYLookDeviation",0,100).name("Maximum Y Look"),this.gui.add(this.mouseInteraction,"maxXLookDeviation",0,100).name("Maximum X Look"),this.gui.add({value:!1},"value").name("Show Camera Paths").onChange(this.onShowDebugPathChange),this.gui.add(this.controls,"enabled").name("Exit Camera Path").onChange(function(e){return n.camera.useQuaternion=e}),this},t.prototype.onWindEnabledChange=function(e){var t;return t=e==null?!1:e!=null&&e===!0?!0:!1,this.materialManager.vertexColorsEnabled(t),this.windGenerator.enabled=t,this.loader.geometryAttributeEnabled("color",t)},t.prototype.onShowDebugPathChange=function(e){return e?this.scene.add(this.debugPaths):this.scene.remove(this.debugPaths),this},t.prototype.createDebugPath=function(e){var t,n,r,i,s,o,u,a;o=new THREE.Object3D,r=new THREE.Geometry,i=new THREE.Line(r),o.add(i);for(n=u=0,a=e.length;u<a;n=++u)s=e[n],t=new THREE.Mesh(new THREE.SphereGeometry(.1,3,2),new THREE.MeshBasicMaterial({wireframe:!0,color:16711680,lights:!1})),t.name="debugPathNode_"+n,t.position.copy(s),o.add(t),r.vertices.push(s);return this.debugPaths.add(o),this},t.prototype.initSun=function(){var e,t,n,r,i,s,o,u,a,f=this;n=CustomImageUtils.loadCompressedTexture(this.settings.sun.mainSprite),t=CustomImageUtils.loadCompressedTexture(this.settings.sun.flareSprite),this.materialManager.texLib.push(n),this.materialManager.texLib.push(t),this.lensFlare=new THREE.LensFlare(n,this.settings.sun.size,0,THREE.AdditiveBlending,new THREE.Color(16777215)),this.lensFlare.position.set(this.settings.sun.position[0],this.settings.sun.position[1],this.settings.sun.position[2]),u=this.settings.sun.flares;for(r=0,s=u.length;r<s;r++)e=u[r],this.lensFlare.add(t,e[0],e[1],THREE.AdditiveBlending);a=this.lensFlare.lensFlares;for(i=0,o=a.length;i<o;i++)e=a[i],e.originalSize=e.size;return this.lensFlare.customUpdateCallback=function(t){var n,r,i,s,o;n=-t.positionScreen.x*2,r=-t.positionScreen.y*2,o=t.lensFlares;for(i=0,s=o.length;i<s;i++)e=o[i],e.x=t.positionScreen.x+n*e.distance,e.y=t.positionScreen.y+r*e.distance,e.rotation=0;return t.lensFlares[2].y+=.025,t.lensFlares[3].rotation=t.positionScreen.x*.5+45*Math.PI/180},this.scene.add(this.lensFlare),this},t.prototype.onEnterFrame=function(){if(!this.enableRender)return;t.__super__.onEnterFrame.apply(this,arguments),this.updateInitialSettings(),this.mouseOverObjects=this.checkPicking(),this.handlePointer(),this.handleAnimatedSprites(),this.hotspotManager.update(this.delta),this.moveDust(),this.handleMultiCamera(),this.renderer.clear(),this.windGenerator.update(this.renderer,this.delta),this.updateOcclusionScene(),this.doRender();if(this.capturer)return this.capturer.capture(this.oz().appView.renderCanvas3D)},t.prototype.handleMultiCamera=function(){return this.isGoingToInteractive?this.camera.matrixAutoUpdate=!1:(this.controls==null||this.controls!=null&&!this.controls.enabled)&&this.enableMouse?(this.camera.matrixAutoUpdate=!1,this.mouseInteraction.update(this.delta,this.mouseX,this.mouseY)):this.camera.matrixAutoUpdate=!0},t.prototype.updateInitialSettings=function(){return this.windinitialSettings==null&&(this.windinitialSettings=0),this.windinitialSettings===2?(this.onWindEnabledChange(this.windGenerator.enabled),this.windinitialSettings++):this.windinitialSettings++,null},t.prototype.moveDust=function(){var e,t,n,r,i,s,o,u,a;u=this.dustSettings;for(r=0,s=u.length;r<s;r++)t=u[r],n=t.vert,t.sinX=t.sinX+.002*t.speed*t.sinXR,t.sinY=t.sinY+.002*t.speed*t.sinYR,t.sinZ=t.sinZ+.002*t.speed*t.sinZR,n.x=t.startX+Math.sin(t.sinX)*t.rangeX,n.y=t.startY+Math.sin(t.sinY)*t.rangeY,n.z=t.startZ+Math.sin(t.sinZ)*t.rangeZ;a=this.dustSystems;for(i=0,o=a.length;i<o;i++)e=a[i],e.material.uniforms.time.value+=this.delta,e.geometry.verticesNeedUpdate=!0;return!1},t.prototype.updateOcclusionScene=function(){var e,t,n;return this.occlusionScene!=null&&(this.mouseInteraction.currentIndex>50||this.currentView!==null?(this.light2.updateMatrixWorld(),n=this.light2.position.clone(),t=this.projector.projectVector(n,this.camera),t.x=(1+t.x)/2,t.y=(1+t.y)/2,this.colorCorrection.uniforms.volumetricLightX.value=t.x,this.colorCorrection.uniforms.volumetricLightY.value=t.y,this.occlusion_hblur.uniforms.r.value=-1,this.occlusion_vblur.uniforms.r.value=-1,e=(1+Math.sin(this.clock.oldTime/700))/2,this.light2.scale.x=this.light2.scale.z=.9+e*.1,this.colorCorrection.uniforms.enableVolumetricLight.value=1,this.renderer.clearTarget(this.occlusionBuffer,!0),this.occlusionComposer.render()):this.colorCorrection.uniforms.enableVolumetricLight.value=0),null},t.prototype.updateFilmTexture=function(e){return e!=null&&(this.oz().appView.zoetropeTexture=e),this.projectionmat&&(this.user_projection_tex=new THREE.Texture(e),this.user_projection_tex.flipY=!1,this.user_projection_tex.needsUpdate=!0,this.projectionmat.uniforms!=null&&(this.projectionmat.uniforms.map.value=this.user_projection_tex),this.projectionmat.map=this.user_projection_tex),this},t.prototype.changeView=function(e){var t,n,r,i=this;if(e===this.currentView)return;this.currentView=e;if(e===null){this.resume(),this.onEnterFrame(),this.hotspotManager.hotspotsAlpha(1),r=this.mouseInteraction.findNearestPathPoint(),n=this.mouseInteraction.cameraPositionPoints[r].clone(),t=this.mouseInteraction.cameraLookatPoints[r].clone(),this.mouseInteraction.currentIndex=r,this.mouseInteraction.currentProgress=.5,this.mouseInteraction.lookDeviationX._value=0,this.mouseInteraction.lookDeviationY._value=0,this.mouseInteraction.bobSpeed._value=0,this.hotspotManager.interactiveCameraTween(this.mouseInteraction.currentLookAt,n,t,35,1500).onComplete(function(){return i.isGoingToInteractive=!1,i.nearPoint=null}),this.hotspotManager.clickedHotspot=null;return}return this.hotspotManager.clickedHotspot===this.currentView?this.hotspotManager.zoomInHotspot(e,this.onCameraReady,this.mouseInteraction)&&(this.isGoingToInteractive=!0):this.gotoPositionOnPath(e)||this.oz().router.navigateTo(e),this},t.prototype.onMouseDown=function(e){t.__super__.onMouseDown.call(this);if(!this.enableMouse)return;if(this.controls!=null&&this.controls.enabled)return;return this.mouseDownPoint.set(this.mouseX,this.mouseY),this.mouseDownObjects=this.checkPicking(),this},t.prototype.onMouseUp=function(e){var n,r,i,s,o,u,a,f,l;t.__super__.onMouseUp.call(this);if(!this.enableMouse)return;if(this.controls!=null&&this.controls.enabled)return;this.mouseUpPoint.set(this.mouseX,this.mouseY),this.mouseUpObjects=this.checkPicking();if(this.hotspotManager.handleMouseUp(this.mouseUpObjects,this.mouseDownObjects))if(this.currentView===this.hotspotManager.clickedHotspot)this.oz().router.navigateTo(this.currentView),this.hotspotManager.zoomInHotspot(this.currentView,this.onCameraReady,this.mouseInteraction)&&(this.isGoingToInteractive=!0);else{r="";switch(this.hotspotManager.clickedHotspot.toLowerCase()){case"music":r="carnival",this.oz().router.navigateTo(r,!1);break;case"storm":r="carnival3",this.oz().router.navigateTo(r,!1);break;default:r=this.hotspotManager.clickedHotspot,this.oz().router.navigateTo(r)}}if(this.settings!=null)for(u in this.settings.ozificables){i=this.mouseUpObjects[u]!=null?this.mouseUpObjects[u]:!1,s=this.mouseDownObjects[u]!=null?this.mouseDownObjects[u]:!1;if(s!==!1&&i!==!1&&this.hotspotManager.is3DMouseClick(s,i)){o=this.settings.ozificables[u],l=this.sceneDescendants;for(a=0,f=l.length;a<f;a++){n=l[a];if(n.name!==o.target)continue;n.ozified!==!0?(SoundController.send("ozzification_on"),(new TWEEN.Tween(n.material.uniforms.lightmapBlend)).to({value:1},2e3).start(),new IFLOzifyParticleSystem(s.object,this.scene,this.APP_HEIGHT),n.ozified=!0):n.ozified===!0&&(SoundController.send("ozzification_off"),(new TWEEN.Tween(n.material.uniforms.lightmapBlend)).to({value:0},2e3).start(),n.ozified=!1);break}break}}return this},t.prototype.onResize=function(){var e,n,r,i,s;t.__super__.onResize.apply(this,arguments),this.mouseInteraction.handleResize(this.APP_WIDTH,this.APP_HEIGHT);if(this.materialManager&&this.materialManager.matLib){i=this.materialManager.matLib;for(n=0,r=i.length;n<r;n++)e=i[n],((s=e.uniforms)!=null?s.scale:void 0)!=null&&(e.uniforms.scale.value=this.APP_HEIGHT/2*this.renderResolutionMultiplier)}return this},t.prototype.dispose=function(){var e,n,r,i,s,o,u,a,f,l,c;(o=this.materialManager)!=null&&o.dispose(this.renderer),delete this.materialManager,(u=this.loader)!=null&&u.dispose(),delete this.loader,(a=this.windGenerator)!=null&&a.dispose(this.renderer),delete this.windGenerator,(f=this.hotspotManager)!=null&&f.dispose(),delete this.hotspotManager,l=this.scene.children;for(n=0,i=l.length;n<i;n++)e=l[n],this.scene.remove(e);this.scene.__webglObjects=null,this.scene.__objects=null,this.scene.__objectsRemoved=null,this.scene.children=[],c=this.occlusionScene.children;for(r=0,s=c.length;r<s;r++)e=c[r],this.occlusionScene.remove(e);return this.occlusionScene.__webglObjects=null,this.occlusionScene.__objects=null,this.occlusionScene.__objectsRemoved=null,this.occlusionScene.children=[],this.dustSystems=null,this.animatedSprites=null,t.__super__.dispose.apply(this,arguments),this},t}(Base3DChapter),Carnival3=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.onResize=__bind(this.onResize,this),this.onMouseUp=__bind(this.onMouseUp,this),this.onMouseDown=__bind(this.onMouseDown,this),this.changeView=__bind(this.changeView,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.onShowDebugPathChange=__bind(this.onShowDebugPathChange,this),this.onWindEnabledChange=__bind(this.onWindEnabledChange,this),this.instanceWorld=__bind(this.instanceWorld,this),this.advanceLoading=__bind(this.advanceLoading,this),this.show=__bind(this.show,this),this.onSceneLoaded=__bind(this.onSceneLoaded,this),this.onSceneProgress=__bind(this.onSceneProgress,this),this.onTextureComplete=__bind(this.onTextureComplete,this),this.onTextureProgress=__bind(this.onTextureProgress,this),this.onSettingsLoaded=__bind(this.onSettingsLoaded,this),this.render=__bind(this.render,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.settings=null,t.prototype.loadedScene=null,t.prototype.mouseInteraction=null,t.prototype.hotspotManager=null,t.prototype.materialManager=null,t.prototype.enableRender=!1,t.prototype.debugPaths=null,t.prototype.mouseDownObjects=null,t.prototype.mouseUpObjects=null,t.prototype.mouseOverObjects=null,t.prototype.lastMouseX=0,t.prototype.lastMouseY=0,t.prototype.mouseDownPoint=new THREE.Vector2,t.prototype.mouseUpPoint=new THREE.Vector2,t.prototype.isGoingToInteractive=!1,t.prototype.currentView=null,t.prototype.currentCutout=null,t.prototype.dustSystems=null,t.prototype.dustSystemMinX=-100,t.prototype.dustSystemMaxX=400,t.prototype.dustSystemMinY=0,t.prototype.dustSystemMaxY=100,t.prototype.dustSystemMinZ=-200,t.prototype.dustSystemMaxZ=30,t.prototype.windGenerator=null,t.prototype.audiolistener=null,t.prototype.animatedSprites=null,t.prototype.nearPoint=null,t.prototype.pickVector=null,t.prototype.pickRay=null,t.prototype.sceneDescendants=null,t.prototype.init=function(){return IFLModelManager.getInstance().cacheTextures(this.oz().appView.enablePrefetching),IFLModelManager.getInstance().prefetchEnabled=this.oz().appView.enablePrefetching,t.__super__.init.apply(this,arguments),this.pickVector=new THREE.Vector3,this.pickRay=new THREE.Ray,this.animatedSprites=[],this.dustSystems=[],this.mouseDownObjects=[],this.mouseUpObjects=[],this.mouseOverObjects=[],this.renderer.gammaInput=!1,this.renderer.gammaOutput=!1,this.renderer.sortObjects=!1,this.renderer.shadowMapEnabled=!1,this.renderer.shadowMapSoft=!1,this.camera.position.x=100,this.camera.position.y=100,this.camera.position.z=100,this.camera.fov=35,this.camera.near=1,this.camera.far=5e3,this.camera.target=new THREE.Vector3(0,0,0),this.mouseInteraction=new IFLCameraPathInteraction(this.camera),this.mouseInteraction.maxXLookDeviation=40,SoundController.active&&(this.audiolistener=new THREE.AudioListenerObject(this.camera),this.audiolistener.position.set(0,150,400),this.scene.add(this.audiolistener)),this.oz().appView.debugMode&&(this.controls=new THREE.FlyControls(this.camera,this.oz().appView.wrapper.el),this.controls.movementSpeed=20,this.controls.rollSpeed=.05,this.controls.enabled=!1,this.controls.dragToLook=!0,this.camera.useQuaternion=!1),this.materialManager=new IFLMaterialManager,this.hotspotManager=new IFLHotspotManager,this.params.cameraFOV=this.camera.fov,this.params.fogcolor="#180f20",this.scene.fog.far=757,this.scene.fog.near=0,this.scene.fog.color.copy(this.stringToColor(this.params.fogcolor)),this.params.colorCorrectionPow="#443f72",this.params.colorCorrectionPowM=2,this.params.colorCorrectionMul="#989898",this.params.colorCorrectionMulM=1.7,this.params.colorCorrectionSaturation=-34,this.params.colorCorrectionSaturationColors="#162c46",this.dofpost.focus=this.dofpost.bokeh_uniforms.focus.value=.97,this.dofpost.aperture=this.dofpost.bokeh_uniforms.aperture.value=.009,this.dofpost.maxblur=this.dofpost.bokeh_uniforms.maxblur.value=.007,this.dofpost.cameranear=.001,this.dofpost.camerafar=956,this.params.bloomPower=this.effectBloom.screenUniforms.opacity.value=.19,this.effectBloom.enabled=!0,this.debugPaths=new THREE.Object3D,this.windGenerator=new IFLWindGenerator,this.windGenerator.noiseSpeed=.09,this.windGenerator.enabled=this.oz().appView.displayQuality!=="low"?!0:!1,this.colorCorrection.uniforms.vignetteOffset.value=.2,this.colorCorrection.uniforms.vignetteDarkness.value=1,this.oz().appView.debugMode&&this.initGUI(),this.onColorCorrectionChange(),this.autoPerformance.steps.push({name:"Wind",enabled:this.windGenerator.enabled,priority:50,disableFunc:this.onWindEnabledChange}),this.onResize(),this.lastMouseY=this.mouseY+this.APP_HALF_Y,this.lastMouseX=this.mouseX+this.APP_HALF_X,this},t.prototype.render=function(){return t.__super__.render.apply(this,arguments),$.ajax({url:"/models/s003_settings.json",dataType:"json",success:this.onSettingsLoaded})},t.prototype.onSettingsLoaded=function(e){var t,n,r,i,s;this.settings=e;for(t=n=0,i=e.positions.length;n<i;t=n+=3)this.mouseInteraction.cameraPositionPoints.push(new THREE.Vector3(e.positions[t],e.positions[t+1],e.positions[t+2]));for(t=r=0,s=e.lookAt.length;r<s;t=r+=3)this.mouseInteraction.cameraLookatPoints.push(new THREE.Vector3(e.lookAt[t],e.lookAt[t+1],e.lookAt[t+2]));return e.renderer=this.renderer,e.onProgress=this.onTextureProgress,e.onComplete=this.onTextureComplete,e.textureQuality=this.oz().appView.textureQuality,this.materialManager.init(e),this.materialManager.load(),IFLModelManager.getInstance().load(this.settings.pickables,this.materialManager.instanceMaterial,this.settings.modelURL,this.onSceneLoaded,this.onSceneProgress),this},t.prototype.sceneLoadedPerc=0,t.prototype.sceneLoaded=!1,t.prototype.textureLoadedPerc=0,t.prototype.textureLoaded=!1,t.prototype.loadingDone=!1,t.prototype.onTextureProgress=function(e){return this.textureLoadedPerc=e,this.advanceLoading(),this},t.prototype.onTextureComplete=function(){return this.textureLoaded=!0,this.advanceLoading(),this},t.prototype.onSceneProgress=function(e,t){return this.sceneLoadedPerc=e/t,this.advanceLoading(),this},t.prototype.onSceneLoaded=function(e,t){return SoundController.send("load_scene_3","scene_carnival3_start"),this.sceneLoaded=!0,this.loader=e,this.advanceLoading(),this},t.prototype.show=function(){return this.instanceWorld(),this.oz().appView.showMenu(),t.__super__.show.apply(this,arguments)},t.prototype.advanceLoading=function(){var e;e=this.sceneLoadedPerc*.5+this.textureLoadedPerc*.5,this.onWorldProgress(e);if(this.textureLoaded===!0&&this.sceneLoaded===!0&&!this.loadingDone)return this.loadingDone=!0,this.onWorldProgress(1),this.onWorldLoaded()},t.prototype.instanceWorld=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;this.loadedScene=this.loader.createModel(!0),s=this.loadedScene.getDescendants();for(l=0,p=s.length;l<p;l++){o=s[l],((m=o.material)!=null?(g=m.uniforms)!=null?g.tWindForce:void 0:void 0)!=null&&o.material.vertexColors===THREE.VertexColors&&(o.material.uniforms.tWindForce.value=this.windGenerator.noiseMap,o.material.uniforms.windDirection.value.copy(this.windGenerator.windDirection)),u=null;if(this.settings.customBounds!=null){for(n in this.settings.customBounds)if(o.name.toLowerCase().indexOf(n)!==-1){u=this.settings.customBounds[n];break}u!=null&&(r=u.position,i=u.radius,o.customFrustumMatrix=new THREE.Matrix4,o.customFrustumMatrix.setPosition(new THREE.Vector3(r[0],r[1],r[2])),o.geometry.boundingSphere.radius=i)}if(this.oz().appView.displayQuality!=="hi"){e=["grass","branch"],a=!1;for(c=0,d=e.length;c<d;c++){t=e[c];if(o.name.toLowerCase().indexOf(t.toLowerCase())!==-1){a=!0;break}}a||this.scene.add(o)}else this.scene.add(o)}this.initTornado(),this.initSun(),this.oz().appView.showInterface&&this.hotspotManager.init(this.settings,this.scene,this.materialManager,this.oz().localeTexture,this.camera),this.initDustSystems(),this.enableRender=!0,this.onResize(),this.sceneDescendants=this.scene.getDescendants(),this.pickableObjects=[],y=this.sceneDescendants,b=[];for(h=0,v=y.length;h<v;h++)f=y[h],f.pickable===!0&&b.push(this.pickableObjects.push(f));return b},t.prototype.initTornado=function(){var e,t,n,r,i,s;this.tornadomaterial=new THREE.MeshBasicMaterial({lights:!1,transparent:!0,map:this.materialManager.getPreloadedTexture("storm_animation.dds"),side:THREE.DoubleSide,fog:!1}),this.tornadomaterial.map.wrapS=this.tornadomaterial.map.wrapT=THREE.RepeatWrapping,this.tornadomaterial.map.flipY=!1,this.tornadomaterial.time=0,this.tornadomaterial.spritenum=0,this.tornadomaterial.totalframes=16,this.tornadomaterial.spritex=4,this.tornadomaterial.spritey=4,this.tornadomaterial.frametime=.01,this.materialManager.matLib.push(this.tornadomaterial),this.materialManager.texLib.push(this.tornadomaterial.map),t=940,e=new THREE.PlaneGeometry(t,t,10,10),this.tornado=new THREE.Mesh(e,this.tornadomaterial),this.tornado.name="tornado_animated",this.tornado.tornadoSize=t,this.tornado.position.set(835,470,-4100),this.animatedSprites.push(this.tornado),this.materialManager.texLib.push(this.tornadomaterial.map),this.materialManager.matLib.push(this.tornadomaterial),s=e.vertices;for(r=0,i=s.length;r<i;r++)n=s[r],n.y=-n.y,n.origX=n.x,n.origY=n.y,n.origZ=n.z;return this.scene.add(this.tornado)},t.prototype.initDustSystems=function(){var e,t,n,r,i,s,o,u,a,f,l;for(t=f=0;f<5;t=++f){u=new IFLWindyParticlesShader,s={},s.fragmentShader=u.fragmentShader,s.vertexShader=u.vertexShader,s.uniforms=u.uniforms,s.attributes={speed:{type:"f",value:[]}},r=new THREE.ShaderMaterial(s),r.map=u.uniforms.map.value=CustomImageUtils.loadCompressedTexture("/models/textures/particles/dust"+t+".dds"),r.size=u.uniforms.size.value=Math.random(),r.scale=u.uniforms.scale.value=this.APP_HEIGHT/2,r.transparent=!0,r.sizeAttenuation=!0,r.blending=THREE.AdditiveBlending,this.materialManager.matLib.push(r),this.materialManager.texLib.push(r.map),u.uniforms.tWindForce.value=this.windGenerator.noiseMap,e=new THREE.Geometry,e.vertices=[],i=this.oz().appView.displayQuality!=="low"?300:150;for(n=l=0;0<=i?l<i:l>i;n=0<=i?++l:--l)a=new THREE.Vector3,a.x=a.startX=this.randRange(this.dustSystemMinX,this.dustSystemMaxX),a.y=a.startY=this.randRange(this.dustSystemMinY,this.dustSystemMaxY),a.z=a.startZ=this.randRange(this.dustSystemMinZ,this.dustSystemMaxZ),a.speed=1+Math.random()*10,s.attributes.speed.value[n]=a.speed,a.sinX=Math.random(),a.sinXR=Math.random()<.5?1:-1,a.sinY=Math.random(),a.sinYR=Math.random()<.5?1:-1,a.sinZ=Math.random(),a.sinZR=Math.random()<.5?1:-1,a.rangeX=Math.random()*5,a.rangeY=Math.random()*5,a.rangeZ=Math.random()*5,e.vertices.push(a);o=new THREE.ParticleSystem(e,r),this.dustSystems.push(o),this.scene.add(o)}return this},t.prototype.initGUI=function(e){var n=this;return t.__super__.initGUI.call(this,e),this.gui.add({value:-2.5},"value",-5,20).name("Fresnel Power").onChange(this.materialManager.changeFresnelPower),this.gui.add({value:1},"value",0,10).name("Normal Scale").onChange(this.materialManager.changeNormalScale),this.gui.add({value:this.windGenerator.enabled},"value").name("Enable Wind").onChange(this.onWindEnabledChange),this.gui.add(this.mouseInteraction,"constantSpeed").name("Use Constant Speed"),this.gui.add(this.mouseInteraction,"maxspeed",0,2).name("Maximum slide speed"),this.gui.add(this.mouseInteraction,"maxYLookDeviation",0,100).name("Maximum Y Look"),this.gui.add(this.mouseInteraction,"maxXLookDeviation",0,100).name("Maximum X Look"),this.gui.add({value:!1},"value").name("Show Camera Paths").onChange(this.onShowDebugPathChange),this.gui.add(this.controls,"enabled").name("Exit Camera Path").onChange(function(e){return n.camera.useQuaternion=e}),this},t.prototype.onWindEnabledChange=function(e){var t;return t=e==null?!1:e!=null&&e===!0?!0:!1,this.materialManager.vertexColorsEnabled(t),this.windGenerator.enabled=t,this.loader.geometryAttributeEnabled("color",t)},t.prototype.onShowDebugPathChange=function(e){return e?this.scene.add(this.debugPaths):this.scene.remove(this.debugPaths),this},t.prototype.createDebugPath=function(e){var t,n,r,i,s,o,u,a;o=new THREE.Object3D,r=new THREE.Geometry,i=new THREE.Line(r),o.add(i);for(n=u=0,a=e.length;u<a;n=++u)s=e[n],t=new THREE.Mesh(new THREE.SphereGeometry(.1,3,2),new THREE.MeshBasicMaterial({wireframe:!0,color:16711680,lights:!1})),t.name="debugPathNode_"+n,t.position.copy(s),o.add(t),r.vertices.push(s);return this.debugPaths.add(o),this},t.prototype.initSun=function(){var e,t,n,r,i,s,o,u,a,f=this;n=CustomImageUtils.loadCompressedTexture(this.settings.sun.mainSprite),t=CustomImageUtils.loadCompressedTexture(this.settings.sun.flareSprite),this.materialManager.texLib.push(n),this.materialManager.texLib.push(t),this.lensFlare=new THREE.LensFlare(n,this.settings.sun.size,0,THREE.AdditiveBlending,new THREE.Color(16777215)),this.lensFlare.position.set(this.settings.sun.position[0],this.settings.sun.position[1],this.settings.sun.position[2]),u=this.settings.sun.flares;for(r=0,s=u.length;r<s;r++)e=u[r],this.lensFlare.add(t,e[0],e[1],THREE.AdditiveBlending);a=this.lensFlare.lensFlares;for(i=0,o=a.length;i<o;i++)e=a[i],e.originalSize=e.size;return this.lensFlare.customUpdateCallback=function(t){var n,r,i,s,o;n=-t.positionScreen.x*2,r=-t.positionScreen.y*2,o=t.lensFlares;for(i=0,s=o.length;i<s;i++)e=o[i],e.x=t.positionScreen.x+n*e.distance,e.y=t.positionScreen.y+r*e.distance,e.rotation=0;return t.lensFlares[2].y+=.025,t.lensFlares[3].rotation=t.positionScreen.x*.5+45*Math.PI/180},this.scene.add(this.lensFlare),this},t.prototype.onEnterFrame=function(){var e,n,r;if(!this.enableRender)return;if(this.disposed===!0)return;t.__super__.onEnterFrame.apply(this,arguments),this.updateInitialSettings(),this.mouseOverObjects=this.checkPicking(),this.handlePointer(),this.handleAnimatedSprites(),this.moveTornado(),(e=this.hotspotManager)!=null&&e.update(this.delta),this.moveDust(),this.handleMultiCamera(),(n=this.renderer)!=null&&n.clear(),(r=this.windGenerator)!=null&&r.update(this.renderer,this.delta),this.renderer&&this.doRender();if(this.capturer)return this.capturer.capture(this.oz().appView.renderCanvas3D)},t.prototype.handleMultiCamera=function(){var e,t,n,r;return this.isGoingToInteractive?(r=this.camera)!=null&&(r.matrixAutoUpdate=!1):(this.controls==null||this.controls!=null&&!this.controls.enabled)&&this.enableMouse?((e=this.camera)!=null&&(e.matrixAutoUpdate=!1),(t=this.mouseInteraction)!=null&&t.update(this.delta,this.mouseX,this.mouseY)):(n=this.camera)!=null&&(n.matrixAutoUpdate=!0),null},t.prototype.updateInitialSettings=function(){return this.windinitialSettings==null&&(this.windinitialSettings=0),this.windinitialSettings===2?(this.onWindEnabledChange(this.windGenerator.enabled),this.windinitialSettings++):this.windinitialSettings++,null},t.prototype.moveDust=function(){var e,t,n,r,i,s,o,u;if(this.dustSystems){o=this.dustSystems;for(n=0,i=o.length;n<i;n++){e=o[n],e.material.uniforms.time.value+=this.delta,u=e.geometry.vertices;for(r=0,s=u.length;r<s;r++)t=u[r],t.sinX=t.sinX+.002*t.speed*t.sinXR*10,t.sinY=t.sinY+.002*t.speed*t.sinYR*10,t.sinZ=t.sinZ+.002*t.speed*t.sinZR*10,t.x+=this.delta*t.speed*5,t.x>this.dustSystemMaxX&&(t.x=this.randRange(this.dustSystemMinX-200,this.dustSystemMinX)),t.y=t.startY+Math.sin(t.sinY)*t.rangeY,t.z=t.startZ+Math.sin(t.sinZ)*t.rangeZ;e.geometry.verticesNeedUpdate=!0}}return null},t.prototype.moveTornado=function(){var e,t,n,r,i;if(this.tornado){i=this.tornado.geometry.vertices;for(n=0,r=i.length;n<r;n++)t=i[n],e=this.tornado.tornadoSize/2-Math.abs(t.origY),t.x=t.origX+Math.sin(this.clock.oldTime/1500)*(e/9),t.y=t.origY+Math.sin(this.clock.oldTime/2e3)*(e/7);this.tornado.geometry.verticesNeedUpdate=!0}return null},t.prototype.changeView=function(e){return this.gotoPositionOnPath(e)||this.oz().router.navigateTo(e),this},t.prototype.onMouseDown=function(e){t.__super__.onMouseDown.call(this);if(!this.enableMouse)return;if(this.controls!=null&&this.controls.enabled)return;return this.mouseDownPoint.set(this.mouseX,this.mouseY),this.mouseDownObjects=this.checkPicking(),this},t.prototype.onMouseUp=function(e){var n,r,i,s,o,u,a,f,l,c,h,p=this;t.__super__.onMouseUp.call(this);if(!this.enableMouse)return;if(this.controls!=null&&this.controls.enabled)return;this.mouseUpPoint.set(this.mouseX,this.mouseY),this.mouseUpObjects=this.checkPicking();if(this.mouseUpObjects==null||this.mouseDownObjects==null)return;if(this.hotspotManager.handleMouseUp(this.mouseUpObjects,this.mouseDownObjects)&&this.hotspotManager.clickedHotspot==="storm"){this.hotspotManager.hotspotsAlpha(0),SoundController.send("storm_zoom_in"),this.isGoingToInteractive=!0,f=new THREE.Vector3(140,20,-300),a=new THREE.Vector3(120,55,-400),this.hotspotManager.interactiveCameraTween(this.mouseInteraction.currentLookAt,f,a,35,3500).onComplete(function(){return p.oz().router.navigateTo(p.hotspotManager.clickedHotspot)});return}if(this.hotspotManager.handleMouseUp(this.mouseUpObjects,this.mouseDownObjects))if(this.currentView===this.hotspotManager.clickedHotspot)this.oz().router.navigateTo(this.currentView),this.hotspotManager.zoomInHotspot(this.currentView,this.onCameraReady,this.mouseInteraction)&&(this.isGoingToInteractive=!0);else{r="";switch(this.hotspotManager.clickedHotspot.toLowerCase()){case"zoetrope":r="carnival2",this.oz().router.navigateTo(r,!1);break;default:r=this.hotspotManager.clickedHotspot,this.oz().router.navigateTo(r)}}if(this.settings!=null)for(u in this.settings.ozificables){i=this.mouseUpObjects[u]!=null?this.mouseUpObjects[u]:!1,s=this.mouseDownObjects[u]!=null?this.mouseDownObjects[u]:!1;if(s!==!1&&i!==!1&&this.hotspotManager.is3DMouseClick(s,i)){o=this.settings.ozificables[u],h=this.sceneDescendants;for(l=0,c=h.length;l<c;l++){n=h[l];if(n.name!==o.target)
continue;n.ozified!==!0?(SoundController.send("ozzification_on"),(new TWEEN.Tween(n.material.uniforms.lightmapBlend)).to({value:1},2e3).start(),new IFLOzifyParticleSystem(s.object,this.scene,this.APP_HEIGHT),n.ozified=!0):n.ozified===!0&&(SoundController.send("ozzification_off"),(new TWEEN.Tween(n.material.uniforms.lightmapBlend)).to({value:0},2e3).start(),n.ozified=!1);break}break}}return this},t.prototype.onResize=function(){var e,n,r,i,s;t.__super__.onResize.apply(this,arguments),this.mouseInteraction.handleResize(this.APP_WIDTH,this.APP_HEIGHT);if(this.materialManager&&this.materialManager.matLib){i=this.materialManager.matLib;for(n=0,r=i.length;n<r;n++)e=i[n],((s=e.uniforms)!=null?s.scale:void 0)!=null&&(e.uniforms.scale.value=this.APP_HEIGHT/2*this.renderResolutionMultiplier)}return this},t.prototype.dispose=function(){var e,n,r,i,s,o,u,a;this.disposed=!0,(i=this.materialManager)!=null&&i.dispose(this.renderer),delete this.materialManager,(s=this.loader)!=null&&s.dispose(),delete this.loader,(o=this.windGenerator)!=null&&o.dispose(this.renderer),delete this.windGenerator,(u=this.hotspotManager)!=null&&u.dispose(),delete this.hotspotManager,a=this.scene.children;for(n=0,r=a.length;n<r;n++)e=a[n],this.scene.remove(e);return this.scene.__webglObjects=null,this.scene.__objects=null,this.scene.__objectsRemoved=null,this.scene.children=[],this.dustSystems=null,this.animatedSprites=null,t.__super__.dispose.apply(this,arguments),this},t}(Base3DChapter),Final=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.changeView=__bind(this.changeView,this),this.onWorldProgress=__bind(this.onWorldProgress,this),this.cleanloading=__bind(this.cleanloading,this),this.render=__bind(this.render,this),this.showVideo=__bind(this.showVideo,this),this.resume=__bind(this.resume,this),this.pause=__bind(this.pause,this),this.videoEnded=__bind(this.videoEnded,this),this.playVideo=__bind(this.playVideo,this),this.fadeIn=__bind(this.fadeIn,this),this.changeState=__bind(this.changeState,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.simulate=null,t.prototype.content=null,t.prototype.init=function(){return this.$el.addClass("final"),this.oz().appView.showMap(!1),this.oz().appView.footer.shareMenu.hideSoundButton(),this.changeState("menu"),null},t.prototype.changeState=function(e){var t,n=this;if(this.content){this.content.$el.animate({opacity:0},{duration:800,complete:function(){return n.remove(n.content),n.content=null,n.changeState(e)}});return}switch(e){case"transitionVideo":this.content=(new Abstract).setElement("<div class='video'><video width='320' height='240' src=''></video></div>"),this.content.dispose=function(){return null},this.addChild(this.content),this.playVideo(),this.fadeIn();break;case"menu":$(window).unbind("blur",this.looseFocus),this.content=(new Abstract).setElement("<div class='finalmenu stormImage'><div class='blackOverlay'></div></div>"),this.content.dispose=function(){return null},this.addChild(this.content),this.content.$el.css({opacity:0}),t=new LandingFinal("finalHeader","finalSub"),this.content.addChild(t),t.render(this.fadeIn),this.oz().appView.logo.showGoogleLogos(),this.oz().appView.footer.showMenu(!0)}return null},t.prototype.fadeIn=function(){var e=this;return this.content.$el.animate({opacity:1},{duration:800,complete:function(){return e.$el.css({"background-color":"#000000"})}}),null},t.prototype.playVideo=function(){var e;return Analytics.track("transition_start_video","Google_OZ_ViewPayoff_Movie_EngagementClick"),e=this.content.$el.find("video")[0],this.content.$el.find("video").attr("src","/videos/eoe.webm"),e.load(),e.play(),e.addEventListener("ended",this.videoEnded,!1),null},t.prototype.videoEnded=function(e){var t;return Analytics.track("transition_end_video"),t=this.content.$el.find("video")[0],t.removeEventListener("ended",this.videoEnded,!1),t.src="",this.changeState("menu"),null},t.prototype.pause=function(){var e;return t.__super__.pause.call(this),e=this.content.$el.find("video")[0],e!=null&&e.pause(),null},t.prototype.resume=function(){var e;return t.__super__.resume.call(this),e=this.content.$el.find("video")[0],e!=null&&e.play(),null},t.prototype.showVideo=function(){var e,t=this;return e=new VideoPlayer,this.oz().appView.wrapper.addChild(e,!0),SoundController.send("trailer_start"),this.content.hide(!0,function(){return t.content.$el.css({display:"none"})}),e.show(!0),this.oz().appView.logo.hideGoogleLogos(),this.oz().appView.footer.mainMenu.hide(!0),this.oz().appView.footer.cr.show(!0),this.oz().appView.footer.shareMenu.hide(!0),null},t.prototype.render=function(){var e=this;return this.simulate=setInterval(function(){return e.onWorldProgress(1)},400),null},t.prototype.cleanloading=function(){return clearInterval(this.simulate),null},t.prototype.onWorldProgress=function(e){return this.trigger("onWorldProgress",e),null},t.prototype.changeView=function(){return null},t.prototype.dispose=function(){return this.remove(this.transitionVideo),null},t}(AbstractScene),Payoff=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.showVideo=__bind(this.showVideo,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="payoff",t.prototype.init=function(){return $(window).unbind("blur",this.looseFocus),this.video=new VideoPlayer,this.addChild(this.video),this.video.hide(),this.oz().appView.changeOpening("final",{title:"finalHeader",cta:"finalSub"}),this.oz().appView.logo.showGoogleLogos(),this.oz().appView.footer.showMenu(),null},t.prototype.showVideo=function(){return this.show(!0),this.video.show(!0),null},t.prototype.dispose=function(){return null},t}(AbstractChapter),Cutout=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.moveCamera=__bind(this.moveCamera,this),this.backButtonClick=__bind(this.backButtonClick,this),this.nextButtonClick=__bind(this.nextButtonClick,this),this.enableButtons=__bind(this.enableButtons,this),this.changeButtonsState=__bind(this.changeButtonsState,this),this.showShareBox=__bind(this.showShareBox,this),this.requestSaveDone=__bind(this.requestSaveDone,this),this.fail=__bind(this.fail,this),this.shareClick=__bind(this.shareClick,this),this.onPolaroidOz=__bind(this.onPolaroidOz,this),this.takePicture=__bind(this.takePicture,this),this.tryAgainClick=__bind(this.tryAgainClick,this),this.addShareButtons=__bind(this.addShareButtons,this),this.addTakePictureButtons=__bind(this.addTakePictureButtons,this),this.onKeyPress=__bind(this.onKeyPress,this),this.addInterface=__bind(this.addInterface,this),this.startRenderVideo=__bind(this.startRenderVideo,this),this.restoreMenu=__bind(this.restoreMenu,this),this.onCamFailClose=__bind(this.onCamFailClose,this),this.onCamFail=__bind(this.onCamFail,this),this.render=__bind(this.render,this),this.onAssetsComplete=__bind(this.onAssetsComplete,this),this.onClose=__bind(this.onClose,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.video=null,t.prototype.canvas=null,t.prototype.charStd=null,t.prototype.coords=null,t.prototype.prevButton=null,t.prototype.nextButton=null,t.prototype.takePicButton=null,t.prototype.cameraViewFinder=null,t.prototype.vignette=null,t.prototype.current=1,t.prototype.state=0,t.prototype.textureSize=null,t.prototype.camSize=null,t.prototype.polaroid=null,t.prototype.init=function(){return this.camSize=[186,140],this.coords=[],this.textureSize=[429,595],this.coords.push({xx:0,yy:0,o:0,x:this.textureSize[0]/2+30,y:this.textureSize[1]/2}),this.coords.push({xx:0,yy:this.textureSize[1],o:-90*(Math.PI/180),x:295,y:775}),this.coords.push({xx:this.textureSize[0],yy:0,o:0,x:this.textureSize[0]+this.textureSize[0]/2+30,y:this.textureSize[1]/2}),this.render(),null},t.prototype.onClose=function(){return this.oz().appView["static"].page instanceof LandingPause||(Analytics.track("cutout_close_section"),SoundController.send("cutout_end"),this.restoreMenu(),this.canvas.paused=!0,this.canvas.renderTexture(!0),this.oz().appView.share.hide(),this.oz().appView.subLoader.hide(),t.__super__.onClose.call(this)),null},t.prototype.onAssetsComplete=function(){return this.render(),t.__super__.onAssetsComplete.call(this),null},t.prototype.render=function(){var e=this;return this.oz().appView.footer.mainMenu.$el.css({display:"none"}),this.oz().appView.logo.disable(),this.addLayout("instructions_cutout","cutoutSub",{w:800,h:$(window).height(),debug:!1,adjustH:50}),this.instructions.show(!0,function(){return e.addCameraHelper(),e.video=e.oz().cam,e.video.on("CAM_READY",e.startRenderVideo),e.video.on("CAM_FAIL",e.onCamFail),e.video.init()}),Analytics.track("cutout_enter_page"),null},t.prototype.onCamFail=function(){var e,t,n=this;return this.removeCameraHelper(),e=new SSAsset("interface","instructions_warning"),e.css({margin:"0 auto"}),this.instructions.hide(!1),this.instructions.$el.find(".box").find("#c22").empty(),this.instructions.$el.find(".box").find("#c22").append(e.$el),this.instructions.$el.find(".box").find("#c22").append("<p>"+this.oz().locale.get("no_webcam_copy")+"</p>"),t=new SSAsset("interface","pause_bottom"),t.css({margin:"0 auto"}),this.instructions.$el.find(".box").find("#c22").append(t.$el),this.instructions.show(!0,function(){return $("body").bind("click",n.onCamFailClose)}),null},t.prototype.onCamFailClose=function(){return $("body").unbind("click",this.onCamFailClose),Analytics.track("cutout_deny_camera"),SoundController.send("cutout_end"),this.restoreMenu(),this.video.off("CAM_READY",this.startRenderVideo),this.video.off("CAM_FAIL",this.onCamFail),this.video.dispose(),this.oz().router.navigateTo(""),null},t.prototype.restoreMenu=function(){return this.oz().appView.footer.mainMenu.$el.css({display:""}),this.oz().appView.footer.mainMenu.show(!0),this.oz().appView.logo.enable(),null},t.prototype.startRenderVideo=function(e){var t=this;return this.removeCameraHelper(),Analytics.track("cutout_allow_camera","Google_OZ_HoleInFace_EngagementClick"),this.addCloseButton(),this.polaroid=new CutoutPolaroid,this.polaroid.on("onPolaroidOz",this.onPolaroidOz),this.addChild(this.polaroid),this.flash=$('<div class="cutout_flash" />'),this.addChild(this.flash),this.$el.animate({"background-color":"rgba(0,0,0,0)"},500,function(){return t.video.off("CAM_READY",t.startRenderVideo),t.video.off("CAM_FAIL",t.onCamFail),t.instructions.hide(!0,t.addInterface)}),null},t.prototype.addInterface=function(){return SoundController.send("cutout_start"),this.remove(this.instructions),this.canvas=new CutoutCanvas,this.addChild(this.canvas),this.canvas.setup({textureS:this.textureSize,camSize:this.camSize,coords:this.coords[this.current],videoSrc:this.video.get(),img:this.oz().baseAssets.get("cutout_normal").result,imgOz:this.oz().baseAssets.get("cutout_oz").result}),this.contButtonsCont=(new Abstract).setElement($("<div/>")),this.contButtonsCont.$el.addClass("cutout_button_container_center"),this.contButtonsCont.dispose=function(){return null},this.addChild(this.contButtonsCont),this.contButtons=(new Abstract).setElement($("<div/>")),this.contButtons.$el.addClass("cutout_button_container"),this.contButtons.dispose=function(){return null},this.contButtonsCont.addChild(this.contButtons),this.addTakePictureButtons(),this.addShare(),null},t.prototype.onKeyPress=function(e){return e.which===32&&(e.preventDefault(),this.takePicture()),null},t.prototype.addTakePictureButtons=function(){return this.$el.css({background:"rgba(0,0,0,0)"}),this.state=0,this.contButtons.empty(),this.prevButton=new SSAsset("interface","button_prev"),this.prevButton.$el.addClass("button_alpha_enabled"),this.prevButton.$el.bind("click",this.backButtonClick),this.prevButton.$el.css({"margin-right":"15px"}),this.nextButton=new SSAsset("interface","button_next"),this.nextButton.$el.addClass("button_alpha_enabled"),this.nextButton.$el.bind("click",this.nextButtonClick),this.nextButton.$el.css({"margin-left":"15px"}),this.takePicButton=new SimpleButton("pictureBtn",this.oz().locale.get("cutoutPicBtn")),this.takePicButton.on("click",this.takePicture),this.contButtons.addChild(this.prevButton),this.contButtons.addChild(this.takePicButton),this.contButtons.addChild(this.nextButton),$(window).bind("keypress",this.onKeyPress),this.canvas.reset(),null},t.prototype.addShareButtons=function(){return this.state=1,this.contButtons.empty(),this.polaroid.addShareButtons(this.shareClick,this.tryAgainClick),this.$el.css({background:"rgba(0,0,0,0)"}),null},t.prototype.tryAgainClick=function(){var e=this;return this.polaroid.shareButton.off("click"),this.polaroid.tryAgainButton.off("click"),this.oz().appView.pauseEnabled=!0,Analytics.track("cutout_take_another"),this.contButtonsCont.hide(!0,function(){return $(".scene3d").css({"-webkit-filter":"blur(0px)"}),e.canvas.reset(),e.addTakePictureButtons(),e.changeButtonsState(),e.polaroid.animateOut(function(){return e.contButtonsCont.show(!0,null,300)})}),null},t.prototype.takePicture=function(){var e=this;return this.oz().appView.pauseEnabled=!1,$(".scene3d").css({"-webkit-filter":"blur(10px)"}),Analytics.track("cutout_take_picture"),SoundController.send("cutout_photo"),$(window).unbind("keypress",this.onKeyPress),this.polaroid.update(this.canvas.getPhoto(!0),this.canvas.getPhoto(!0,!0)),this.contButtonsCont.hide(!0,null,200,"linear",!0),this.flash.animate({opacity:1},100,function(){return e.flash.animate({opacity:0},400,function(){return e.polaroid.animateIn()})}),null},t.prototype.onPolaroidOz=function(e){return this.addShareButtons(),null},t.prototype.shareClick=function(){var e;return this.polaroid.shareButton.off("click"),this.polaroid.tryAgainButton.off("click"),Analytics.track("cutout_click_share"),this.oz().appView.subLoader.show(!0),e=this.canvas.getPhoto(!1,!0),Requester.addImage(e,"cutout",this.requestSaveDone,this.fail),null},t.prototype.fail=function(){return this.tryAgainClick(),this.oz().appView.subLoader.showError(),null},t.prototype.requestSaveDone=function(e){var t;return t=window.location.origin+"/preview/cutout/"+e.result.id,Requester.shortURL(t,this.showShareBox,this.fail),null},t.prototype.showShareBox=function(e){return this.oz().appView.subLoader.hide(),this.$el.css({"background-color":"rgba(0,0,0,.6)"}),this.oz().appView.share.show({title:this.oz().locale.get("cutoutCTA"),sub:this.oz().locale.get("shareBoxSubCutout"),back:this.oz().locale.get("shareBoxBackCutout"),link:e.id,backCall:this.tryAgainClick,type:"cutout"}),null},t.prototype.changeButtonsState=function(){return this.enableButtons(),this.current===2&&(this.nextButton.mouseEnabled(!1),this.nextButton.$el.addClass("button_alpha_disabled"),this.nextButton.$el.css({visibility:"hidden"})),this.current===0&&(this.prevButton.mouseEnabled(!1),this.prevButton.$el.addClass("button_alpha_disabled"),this.prevButton.$el.css({visibility:"hidden"})),null},t.prototype.enableButtons=function(){return this.nextButton.mouseEnabled(!0),this.nextButton.$el.removeClass("button_alpha_disabled"),this.nextButton.$el.css({visibility:"visible"}),this.prevButton.mouseEnabled(!0),this.prevButton.$el.removeClass("button_alpha_disabled"),this.prevButton.$el.css({visibility:"visible"}),null},t.prototype.nextButtonClick=function(){return this.current++,this.changeButtonsState(),this.moveCamera(),this.canvas.changeCamera(this.coords[this.current]),null},t.prototype.backButtonClick=function(){return this.current--,this.changeButtonsState(),this.moveCamera(),this.canvas.changeCamera(this.coords[this.current]),null},t.prototype.moveCamera=function(){SoundController.send("cutout_switch");switch(this.current){case 0:this.oz().appView.area.changeCutout("left");break;case 1:this.oz().appView.area.changeCutout("middle");break;case 2:this.oz().appView.area.changeCutout("right")}return null},t.prototype.dispose=function(){var e;return this.oz().appView.pauseEnabled=!0,t.__super__.dispose.call(this),this.instructions=null,(e=this.video)!=null&&e.dispose(),null},t}(AbstractScene),CutoutCanvas=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.getPhoto=__bind(this.getPhoto,this),this.reset=__bind(this.reset,this),this.createTextureWebCam=__bind(this.createTextureWebCam,this),this.renderTexture=__bind(this.renderTexture,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.resume=__bind(this.resume,this),this.pause=__bind(this.pause,this),this.changeCamera=__bind(this.changeCamera,this),this.setup=__bind(this.setup,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.ctx=null,t.prototype.cutout=null,t.prototype.cutout_oz=null,t.prototype.textureImgOz=null,t.prototype.textureImg=null,t.prototype.coord=null,t.prototype.canvas=null,t.prototype.camCanvas=null,t.prototype.camCtx=null,t.prototype.paused=!0,t.prototype.camSize=null,t.prototype.textureSize=null,t.prototype.className="cutout_canvas",t.prototype.photoCanvas=null,t.prototype.photoCtx=null,t.prototype.photoCanvasTemp=null,t.prototype.photoCtxTemp=null,t.prototype.colorCorrectCanvas=null,t.prototype.colorCorrectCtx=null,t.prototype.paused=!0,t.prototype.init=function(){return this.canvas=document.createElement("canvas"),this.canvas.width=1024,this.canvas.height=1024,this.ctx=this.canvas.getContext("2d"),this.camCanvas=document.createElement("canvas"),this.camCanvas.width=1024,this.camCanvas.height=1024,this.camCtx=this.camCanvas.getContext("2d"),$(this.canvas).css({"z-index":99,position:"absolute",width:"1024px",height:"1024px",top:"-90000px",left:"-90000px"}),$("body").append($(this.canvas)),null},t.prototype.setup=function(e){return this.coord=e.coords,this.camSize=e.camSize,this.textureSize=e.textureS,this.cutout=e.img,this.cutout_oz=e.imgOz,null},t.prototype.changeCamera=function(e){return Analytics.track("cutout_change_camera"),this.coord=e,this.paused=!1,null},t.prototype.pause=function(){},t.prototype.resume=function(){},t.prototype.onEnterFrame=function(){if(this.paused)return;return this.renderTexture(),null},t.prototype.renderTexture=function(e){return e==null&&(e=!1),this.canvas=this.createTextureWebCam(this.ctx,this.canvas,!1,e),this.oz().appView.area.updateCutoutsTexture(this.canvas),null},t.prototype.createTextureWebCam=function(e,t,n,r){return r==null&&(r=!1),e.clearRect(0,0,1024,1024),e.setTransform(1,0,0,1,0,0),e.save(),r===!1&&(this.coord.o!==0?(e.translate(this.coord.x,this.coord.y+this.camSize[0]),e.rotate(this.coord.o),e.drawImage(this.oz().cam.flipImage(),this.camSize[0]>>1,-(this.camSize[1]>>1),this.camSize[0],this.camSize[1])):(e.rotate(this.coord.o),e.translate(this.coord.x,this.coord.y),e.drawImage(this.oz().cam.flipImage(),-(this.camSize[0]>>1),-(this.camSize[1]>>1),this.camSize[0],this.camSize[1])),e.restore()),e.translate(0,0),e.rotate(0),e.drawImage(n?this.cutout_oz:this.cutout,0,0),t},t.prototype.reset=function(){return this.paused=!1,null},t.prototype.getPhoto=function(e,t){var n;return e==null&&(e=!1),t==null&&(t=!1),this.camCanvas=this.createTextureWebCam(this.camCtx,this.camCanvas,t),this.renderTexture(),this.photoCanvas=document.createElement("canvas"),this.photoCtx=this.photoCanvas.getContext("2d"),this.photoCanvasTemp=document.createElement("canvas"),this.photoCtxTemp=this.photoCanvasTemp.getContext("2d"),this.coord.o!==0?(this.photoCanvasTemp.width=this.textureSize[1],this.photoCanvasTemp.height=this.textureSize[0],this.photoCanvas.width=this.textureSize[0],this.photoCanvas.height=this.textureSize[1],n=this.camCtx.getImageData(this.coord.xx,this.coord.yy,this.textureSize[1],this.textureSize[0]),this.photoCtxTemp.putImageData(n,0,0),this.photoCtx.translate(this.photoCanvas.height-166,0),this.photoCtx.rotate(90*(Math.PI/180)),this.photoCtx.drawImage(this.photoCanvasTemp,0,0)):(this.photoCanvasTemp.width=this.textureSize[0],this.photoCanvasTemp.height=this.textureSize[1],this.photoCanvas.width=this.textureSize[0],this.photoCanvas.height=this.textureSize[1],n=this.camCtx.getImageData(this.coord.xx,this.coord.yy,this.textureSize[0],this.textureSize[1]),this.photoCtxTemp.putImageData(n,0,0),this.photoCtx.drawImage(this.photoCanvasTemp,0,0)),this.paused=!0,e?this.photoCanvas:this.image=this.photoCanvas.toDataURL("image/jpeg").slice("data:image/jpeg;base64,".length)},t.prototype.dispose=function(){return $(this.canvas).remove(),this.photoCanvas=this.photoCtx=this.photoCanvasTemp=this.photoCtxTemp=null,null},t.prototype.colorCorrectCam=function(e){var t,n,r,i,s;this.colorCorrectCanvas.width=e.width,this.colorCorrectCanvas.height=e.height,this.colorCorrectCtx.drawImage(e,0,0),r=this.colorCorrectCtx.getImageData(0,0,e.width,e.height),t=r.data;for(n=i=0,s=t.length;i<s;n=i+=4)t[n]*=1.6,t[n+1]*=1.6,t[n+2]*=1.6;return this.colorCorrectCtx.putImageData(r,0,0),this.colorCorrectCanvas},t}(Abstract),CutoutPolaroid=function(e){function t(){return this.onClick=__bind(this.onClick,this),this.update=__bind(this.update,this),this.animateOut=__bind(this.animateOut,this),this.animateIn=__bind(this.animateIn,this),this.addShareButtons=__bind(this.addShareButtons,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="cutout_polaroid",t.prototype.tagName="div",t.prototype.container=null,t.prototype.mask=null,t.prototype.canvasOz=null,t.prototype.canvasNormal=null,t.prototype.ctxNormal=null,t.prototype.ctxOz=null,t.prototype.fluf1=null,t.prototype.title=null,t.prototype.fluf2=null,t.prototype.mainContainer=null,t.prototype.containerButtons=null,t.prototype.shareButton=null,t.prototype.tryAgainButton=null,t.prototype.init=function(){return this.mouseEnabled(!1),this.mainContainer=$('<div class="cutout_polaroid_cell"/>'),this.addChild(this.mainContainer),this.titleContainer=(new Abstract).setElement($('<div class="cutout_polaroid_title_container"/>')),this.fluf1=new SSAsset("interface","instructions_flourish_top"),this.fluf1.$el.css({margin:"0 auto"}),this.titleContainer.addChild(this.fluf1),this.title=$("<p>"+this.oz().locale.get("shareBoxTitleCutout")+"</>"),this.titleContainer.addChild(this.title),this.fluf2=new SSAsset("interface","instructions_flourish"),this.fluf2.$el.css({margin:"0 auto"}),this.titleContainer.addChild(this.fluf2),this.mainContainer.append(this.titleContainer.$el),this.container=$('<div class="cutout_polaroid_cont" />'),this.mask=$('<div class="cutout_polaroid_mask" />'),this.canvasNormal=document.createElement("canvas"),this.canvasNormal.width=438,this.canvasNormal.height=526,this.ctxNormal=this.canvasNormal.getContext("2d"),this.mask.append(this.canvasNormal),this.canvasOz=document.createElement("canvas"),this.canvasOz.width=438,this.canvasOz.height=526,this.ctxOz=this.canvasOz.getContext("2d"),this.mask.append(this.canvasOz),this.container.append(this.mask),this.container.append(this.oz().baseAssets.get("cutout_polaroid").result),this.mainContainer.append(this.container),this.containerButtons=(new Abstract).setElement($("<div/>")),this.containerButtons.hide(!1),this.containerButtons.$el.css({visibility:"hidden"}),this.tryAgainButton=new SimpleButton("tryAgainBtn",this.oz().locale.get("cutoutTry")),this.tryAgainButton.$el.css({"margin-right":"20px"}),this.shareButton=new SimpleButton("shareCutoutBtn",this.oz().locale.get("cutoutShare")),this.containerButtons.addChild(this.tryAgainButton),this.containerButtons.addChild(this.shareButton),this.mainContainer.append(this.containerButtons.$el),null},t.prototype.addShareButtons=function(e,t){var n;return this.containerButtons.$el.css({visibility:"visible"}),this.shareButton.on("click",e),this.tryAgainButton.on("click",t),n=Math.max(this.shareButton.$el.width(),this.tryAgainButton.$el.width()),this.shareButton.$el.width(n),this.tryAgainButton.$el.width(n),this.containerButtons.show(!0),null},t.prototype.animateIn=function(e){var t=this;return this.show(!0,function(){return t.$el.css({cursor:"pointer"}),t.$el.bind("click",t.onClick),t.mouseEnabled(!0),typeof e=="function"?e():void 0}),null},t.prototype.animateOut=function(e){var t=this;return this.shareButton.off("click"),this.tryAgainButton.off("click"),this.mouseEnabled(!1),this.containerButtons.hide(!0),this.hide(!0,function(){return typeof e=="function"&&e(),t.hide(!1),t.$el.css({visibility:!1}),t.containerButtons.$el.css({visibility:"hidden"})}),null},t.prototype.update=function(e,t){return $(this.canvasOz).css({opacity:0}),this.ctxOz.clearRect(0,0,this.canvasOz.width,this.canvasOz.height),this.ctxOz.drawImage(t,0,0),this.ctxNormal.clearRect(0,0,this.canvasNormal.width,this.canvasNormal.height),this.ctxNormal.drawImage(e,0,0),null},t.prototype.onClick=function(){var e=this;return this.$el.unbind("click",this.onClick),this.$el.css({cursor:"auto"}),this.titleContainer.hide(!0,null,200),$(this.canvasOz).animate({opacity:1},700,function(){return e.trigger("onPolaroidOz")}),null},t}(Abstract),ThumbCutout=function(e){function t(){return this.initAnimation=__bind(this.initAnimation,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.fullImg=null,t.prototype.thumb=null,t.prototype.polaroid=null,t.prototype.src=null,t.prototype.initialize=function(e){var t=this;return this.setElement($(".wrapper")),this.fullImg=$("<div/>"),this.fullImg.addClass("imgAnim"),this.thumb=$(".wrapper img"),this.fullImg.append(this.thumb),this.$el.append(this.fullImg),this.thumb.bind("load",function(){return t.polaroid=new Image,t.polaroid.onload=function(){return t.thumb.addClass("imgLoaded"),t.fullImg.append(t.polaroid),t.initAnimation()},t.polaroid.src="/img/preview/cutout_polaroid.png"}),this.src="",window.location.href.indexOf(":8888")>-1?this.src="/img/preview/1.jpeg":this.src="/api/image/get/"+e,this.thumb.attr({src:this.src}),this.fullImg.on("webkitAnimationEnd",function(){return $(document).trigger("thumbTransitionEnded")}),null},t.prototype.initAnimation=function(){return this.fullImg.addClass("img"),null},t}(Backbone.View),Loading=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.onClick=__bind(this.onClick,this),this.onMouseMove=__bind(this.onMouseMove,this),this.hide=__bind(this.hide,this),this.onAnimateOut=__bind(this.onAnimateOut,this),this.onAnimateIn=__bind(this.onAnimateIn,this),this.update=__bind(this.update,this),this.render=__bind(this.render,this),this.changeCopy=__bind(this.changeCopy,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.angleX=0,t.prototype.angleY=0,t.prototype.card=null,t.prototype.copy=null,t.prototype.state=0,t.prototype.timerChange=null,t.prototype.out=!1,t.prototype.particles=null,t.prototype.containerCopy=null,t.prototype.top=null,t.prototype.bottom=null,t.prototype.copySwitcher=null,t.prototype.c=null,t.prototype.t=null,t.prototype.s=null,t.prototype.x=null,t.prototype.y=null,t.prototype.visible=null,t.prototype.disclaimer=[{s:"loading_magician",t:4},{s:"loading_wizard",t:4},{s:"loading_copy",t:4},{s:"loading_uncover",t:4}],t.prototype.currentDisclaimer=0,t.prototype.init=function(){return this.particles=new Particles(1,20,80,{x:0,y:0,w:$(window).innerWidth(),h:$(window).innerHeight()}),this.addChild(this.particles),this.particles.hide(),setTimeout(this.particles.show,500,!0),this.card=new LoadingCard,this.addChild(this.card),this.$el.addClass("landingPage"),this.containerCopy=$('<div class="loadingCopy"/>'),this.top=new SSAsset("interface","swosh_up"),this.top.$el.css({margin:"0 auto"}),this.containerCopy.append(this.top.$el),this.copy=$('<div class="loadingCardCopy"><div></div></div>'),this.containerCopy.append(this.copy),this.bottom=new SSAsset("interface","swosh_down"),this.bottom.$el.css({margin:"0 auto"}),this.containerCopy.append(this.bottom.$el),this.addChild(this.containerCopy),this.render(),null},t.prototype.changeCopy=function(){var e=this;return this.c=this.disclaimer[this.currentDisclaimer].s,this.t=this.disclaimer[this.currentDisclaimer].t,this.copy.animate({opacity:"0"},200,"linear",function(){return e.s=e.oz().locale.get(e.c),e.copy.find("div").html(e.s.toUpperCase()),e.copy.animate({opacity:"1"},200)}),this.currentDisclaimer++,this.currentDisclaimer>=this.disclaimer.length&&(this.currentDisclaimer=0),this.copySwitcher=setTimeout(this.changeCopy,this.t*1e3),null},t.prototype.render=function(){return this.card.animateIn(this.onAnimateIn),null},t.prototype.update=function(e){return this.card.update(e),null},t.prototype.onAnimateIn=function(){var e=this;return this.changeCopy(),$(window).bind("mousemove",this.onMouseMove),$(window).bind("click",this.onClick),this.containerCopy.animate({opacity:1},500,"linear",function(){return e.timerChange=setTimeout(e.onClick,8e3,null),e.oz().appView.footer.shareMenu.render()}),null},t.prototype.onAnimateOut=function(e){var t=this;return this.out=!0,clearInterval(this.timerChange),clearInterval(this.copySwitcher),$(window).unbind("mousemove",this.onMouseMove),$(window).unbind("click",this.onClick),this.containerCopy.animate({opacity:0},700,"linear",function(){return t.card.animateOut(function(){return t.containerCopy.remove(),t.remove(t.card),e()})}),null},t.prototype.hide=function(e,t){return e==null&&(e=!1),t==null&&(t=null),this.visible=!1,e?this.$el.animate({opacity:0},800,"linear",t):this.$el.css({opacity:0}),null},t.prototype.onMouseMove=function(e){if(!this.paused)return this.x=(e.clientX-$(window).innerWidth()/2)/40,this.y=(e.clientY-$(window).innerHeight()/2)/35,this.angleX+=(this.x-this.angleX)*.075,this.angleY+=(this.y-this.angleY)*.075,this.angleX=this.angleX%360,this.angleY=this.angleY%360,this.card.transform(this.angleX,this.angleY),null;return},t.prototype.onClick=function(e){if(this.out)return;return clearInterval(this.timerChange),this.timerChange=setTimeout(this.onClick,8e3),this.card.toggleTopple(),null},t.prototype.dispose=function(){return this.particles.pause(),this.remove(this.particles),clearInterval(this.timerChange),null},t}(AbstractScene),LoadingCard=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.resetRotation=__bind(this.resetRotation,this),this.animateOut=__bind(this.animateOut,this),this.animateIn=__bind(this.animateIn,this),this.transform=__bind(this.transform,this),this.update=__bind(this.update,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="card",t.prototype.frontImage=null,t.prototype.containerFront=null,t.prototype.containerBack=null,t.prototype.cardWidth=228,t.prototype.cardHeight=333,t.prototype.counter=0,t.prototype.flipped=!1,t.prototype.flipping=!1,t.prototype.percTop=null,t.prototype.percBot=null,t.prototype.rotation=null,t.prototype.angle=null,t.prototype.init=function(){return this.containerFront=new SSAsset("interface","preloader_front"),this.containerFront.addChild($('<span class="percLoadingTop">00%</span>')),this.containerFront.addChild($('<span class="percLoadingBottom">00%</span>')),this.containerFront.$el.addClass("cardImg"),this.containerBack=new SSAsset("interface","preloader_back"),this.containerBack.$el.addClass("cardImgBack"),this.containerFront.$el.css({display:"none"}),this.percTop=this.containerFront.$el.find(".percLoadingTop"),this.percBot=this.containerFront.$el.find(".percLoadingBottom"),this.addChild(this.containerFront),this.addChild(this.containerBack)},t.prototype.update=function(e){var t;if(e===NaN||e===Infinity)e=0;return e>=99&&(e=99),t=e<10?"0"+e.toFixed(0):e.toFixed(0),this.percTop.html(t+"%"),this.percBot.html(t+"%")},t.prototype.transform=function(e,t,n,r,i){return n==null&&(n=0),r==null&&(r="linear"),i==null&&(i=null),this.$el.transition({perspective:this.cardHeight,rotateY:e,rotateX:t},n,r,i)},t.prototype.animateIn=function(e){var t=this;return SoundController.send("card_in"),this.transform(-360,-20),this.$el.transition({scale:0},0),this.$el.transition({perspective:this.cardHeight,rotateY:-270,scale:.5},400,"in",function(){return t.containerFront.css({display:"block"}),t.containerBack.css({display:"none"}),t.$el.transition({perspective:t.cardHeight,rotateY:0,rotateX:0,scale:1},500,"ease",e)})},t.prototype.animateOut=function(e){var t=this;return SoundController.send("card_out"),this.$el.transition({perspective:this.cardHeight,rotateY:0,rotateX:-90,scale:1},600,"in",function(){return t.containerFront.css({display:"none"}),t.containerBack.css({display:"block"}),t.$el.transition({perspective:t.cardHeight,rotateY:90,rotateX:-180,scale:.8},200,"linear",function(){return t.containerFront.css({display:"block"}),t.containerBack.css({display:"none"}),t.$el.transition({perspective:t.cardHeight,rotateY:270,rotateX:-150,scale:.6},200,"out",e)})})},t.prototype.toggleTopple=function(e){var t=this;if(this.flipping)return;return SoundController.send("card_flip"
),this.rotation=this.getRotationDegrees(),this.flipping=!0,this.containerBack.$el.transition({rotate:this.rotation},function(){return t.resetRotation,typeof e=="function"?e(t.flipped?1:0):void 0}),this.containerFront.$el.transition({rotate:this.rotation},this.resetRotation)},t.prototype.resetRotation=function(){return this.flipped===!1&&(this.containerBack.$el.transition({rotate:0},0),this.containerFront.$el.transition({rotate:0},0)),this.flipping=!1},t.prototype.getRotationDegrees=function(){return this.angle=this.flipped?359:180,this.flipped=!this.flipped,this.angle},t.prototype.dispose=function(){return this},t}(Abstract),MusicBox=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.onClose=__bind(this.onClose,this),this.restore=__bind(this.restore,this),this.goShare=__bind(this.goShare,this),this.onDone=__bind(this.onDone,this),this.pauseState=__bind(this.pauseState,this),this.playState=__bind(this.playState,this),this.advance=__bind(this.advance,this),this.instructionsDismiss=__bind(this.instructionsDismiss,this),this.createMusicStep=__bind(this.createMusicStep,this),this.cancel=__bind(this.cancel,this),this.addCreateMusicButton=__bind(this.addCreateMusicButton,this),this.looseFocus=__bind(this.looseFocus,this),this.render=__bind(this.render,this),this.init=__bind(this.init,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.data=null,t.prototype.initialize=function(){return SoundController.userLoop?this.data=SoundController.userLoop:this.data=JSON.parse(this.oz().baseAssets.get("loopstart").result),t.__super__.initialize.call(this)},t.prototype.init=function(){return this.addLayout("instructions_music","musicInstructions",{w:757,h:$(window).height(),debug:!1,adjustH:0}),this.container=(new Abstract).setElement('<div class="musicbox"/>'),this.container.dispose=function(){},this.addChild(this.container),$(window).bind("blur",this.looseFocus),this.render(),null},t.prototype.render=function(){return this.oz().appView.footer.mainMenu.$el.css({display:"none"}),this.oz().appView.logo.disable(),this.instructions.active=!0,this.createMusicStep(),null},t.prototype.looseFocus=function(){var e;return(e=this.table)!=null&&e.stop(),null},t.prototype.addCreateMusicButton=function(){var e;return this.addCloseButton(),e=!1,this.containerFirst?(this.containerFirst.$el.empty(),$("body").unbind("click",this.instructionsDismiss),e=!1):(this.containerFirst=(new Abstract).setElement('<div class="musicbox_firstButtonContainer"/>'),this.containerFirst.dispose=function(){},e=!0),this.containerFirstButton=(new Abstract).setElement('<div class="musicbox_createMusicContainer"/>'),this.containerFirstButton.dispose=function(){},this.containerFirstButton.addChild(new SSAsset("interface","pause_left")),this.buttonEnter=new SimpleButton("createMusic",this.oz().locale.get("music_create_music_button")),this.buttonEnter.$el.addClass("button_alpha_enabled"),this.buttonEnter.on("click",this.createMusicStep),this.containerFirstButton.addChild(this.buttonEnter),this.containerFirstButton.addChild(new SSAsset("interface","pause_right")),this.containerFirst.addChild(this.containerFirstButton.$el),this.container.addChild(this.containerFirst),this.containerFirst.hide(),this.containerFirst.show(!0),this.$el.css({"background-color":"rgba(0, 0, 0, 0.0)"}),this.closeBtn.$el.bind("click",this.cancel),null},t.prototype.cancel=function(){return this.closeBtn.$el.unbind("click"),this.onClose(!0),this.$el.css({"background-color":"rgba(0, 0, 0, 0.6)"}),null},t.prototype.createMusicStep=function(){var e=this;return Analytics.track("music_enter_page","Google_OZ_Music Box"),this.instructions.show(!0,function(){return $("body").bind("click",e.instructionsDismiss)}),null},t.prototype.instructionsDismiss=function(){return $("body").unbind("click",this.instructionsDismiss),this.instructions.hide(!0,this.advance),null},t.prototype.advance=function(){return this.remove(this.instructions),this.addCloseButton(),SoundController.stopBackgroundMusic(),SoundController.send("musicbox_start"),this.top=new SSAsset("interface","music_top"),this.top.$el.css({margin:"25px auto"}),this.container.addChild(this.top),this.table=new MusicBoxTable(this.data),this.table.on("SHARE",this.goShare),this.table.on("fail",this.onDone),this.table.on("playState",this.playState),this.table.on("pauseState",this.pauseState),this.container.addChild(this.table),this.table.addLine(),this.bottomContainer=$('<div class="musicbox_bottomContainer"/>'),this.playBtn=new SSAsset("interface","button_play"),this.playBtn.$el.css({width:""+(parseInt(this.playBtn.$el.css("width"))+1)+"px"}),this.pauseBtn=new SSAsset("interface","button_pause"),this.pauseBtn.$el.css({width:""+(parseInt(this.pauseBtn.$el.css("width"))+1)+"px"}),this.pauseBtn.hide(),this.playPauseBtn=(new Abstract).setElement($("<div class='musicbox_autoplay'/>")),this.playPauseBtn.$el.on("click",this.table.togglePlay),this.playPauseBtn.addChild(this.playBtn),this.playPauseBtn.addChild(this.pauseBtn),this.playPauseBtn.$el.css({position:"relative"}),this.bottom=new SSAsset("interface","music_bottom"),this.bottom.$el.css({margin:"0 auto"}),this.bottomContainer.append(this.bottom.$el),this.bottomContainer.append(this.playPauseBtn.$el),this.container.addChild(this.bottomContainer),this.buttons=new MusicButtons,this.buttons.on("doneAct",this.onDone),this.buttons.on("goShare",this.table.goShare),this.container.addChild(this.buttons),this.buttons.render(),null},t.prototype.playState=function(){return this.playBtn.hide(!0),this.pauseBtn.show(!0),null},t.prototype.pauseState=function(){return this.playBtn.show(!0),this.pauseBtn.hide(!0),null},t.prototype.onDone=function(){return this.table.saveUserLoop(),SoundController.transition(this.table.playing,this.table.colNo),this.table.stop(),this.onClose(),null},t.prototype.goShare=function(e){return this.oz().appView.pauseEnabled=!1,this.container.$el.animate({opacity:0},300,"linear"),this.oz().appView.share.show({title:this.oz().locale.get("music_nice_tune"),sub:this.oz().locale.get("music_share_disclaimer"),back:this.oz().locale.get("music_make_another"),link:e,backCall:this.restore,type:"music"}),null},t.prototype.restore=function(){return this.oz().appView.pauseEnabled=!0,this.container.$el.animate({opacity:1},300,"linear"),null},t.prototype.onClose=function(e){e==null&&(e=!1);if(!(this.oz().appView["static"].page instanceof LandingPause))return t.__super__.onClose.call(this),e||(this.table.saveUserLoop(),SoundController.transition(this.table.playing,this.table.colNo),this.table.stop()),Analytics.track("music_close_section"),SoundController.send("musicbox_end"),this.oz().appView.footer.mainMenu.$el.css({display:""}),this.oz().appView.logo.enable(),this.oz().appView.share.hide()},t.prototype.dispose=function(){return this.oz().appView.pauseEnabled=!0,$(window).unbind("blur",this.looseFocus),this.instructions=null,t.__super__.dispose.call(this),null},t}(AbstractScene),MusicBoxGrid=function(e){function t(){return this.activateCell=__bind(this.activateCell,this),this.cellClick=__bind(this.cellClick,this),this.buildTable=__bind(this.buildTable,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.template="musicbox-grid",t.prototype.table=null,t.prototype.data=null,t.prototype.init=function(){return this.table=this.$el.find("table"),null},t.prototype.buildTable=function(e){var t,n,r,i,s,o,u,a,f;this.data=e,n=$("<tbody></tbody>");for(r=o=0,a=this.data.dimensions.lines;0<=a?o<a:o>a;r=0<=a?++o:--o){s=$("<tr></tr>");for(i=u=0,f=this.data.dimensions.cols;0<=f?u<f:u>f;i=0<=f?++u:--u)t=$("<td data-note='"+r+"' data-col='"+i+"' id='"+i+"-"+r+"'></td>"),s.append(t),$.inArray(r,this.data.cols[i].rows)>-1&&this.activateCell(t);n.append(s)}return this.table.append(n),this.render(),null},t.prototype.events={"click td":"cellClick"},t.prototype.cellClick=function(e){return Analytics.track("music_click_note"),this.activateCell($(e.currentTarget)),this.oz().appView.subArea.table.playing&&($(e.currentTarget).hasClass("on")?this.oz().appView.subArea.table.addChord($(e.currentTarget).attr("data-col"),$(e.currentTarget).attr("data-note")):this.oz().appView.subArea.table.removeChord($(e.currentTarget).attr("data-col"),$(e.currentTarget).attr("data-note"))),null},t.prototype.activateCell=function(e){return e.toggleClass("on"),null},t}(Abstract),MusicBoxTable=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.checkCell=__bind(this.checkCell,this),this.cleanFlash=__bind(this.cleanFlash,this),this.removeChord=__bind(this.removeChord,this),this.addChord=__bind(this.addChord,this),this.exportSong=__bind(this.exportSong,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.saveUserLoop=__bind(this.saveUserLoop,this),this.playLoop=__bind(this.playLoop,this),this.playCell=__bind(this.playCell,this),this.checkColumn=__bind(this.checkColumn,this),this.cloneTable=__bind(this.cloneTable,this),this.removeTable=__bind(this.removeTable,this),this.resetTimer=__bind(this.resetTimer,this),this.stop=__bind(this.stop,this),this.play=__bind(this.play,this),this.togglePlay=__bind(this.togglePlay,this),this.fail=__bind(this.fail,this),this.showShareBox=__bind(this.showShareBox,this),this.musicSaved=__bind(this.musicSaved,this),this.goShare=__bind(this.goShare,this),this.addLine=__bind(this.addLine,this),this.init=__bind(this.init,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.template="musicbox-table",t.prototype.playing=!1,t.prototype.tempo=1/3,t.prototype.cellWidth=31,t.prototype.colNo=0,t.prototype.initialize=function(e){return this.data=e,t.__super__.initialize.call(this),null},t.prototype.init=function(){var e,t,n,r;this.clock=new THREE.Clock,this.grid=new MusicBoxGrid,this.grid.buildTable(this.data),this.container=this.$el.find(".grid-mask"),this.container.append(this.grid.$el),e=(new Abstract).setElement('<div class="chordsList"></div>');for(t=n=0,r=this.data.notes.length;0<=r?n<r:n>r;t=0<=r?++n:--n)e.$el.prepend(this.data.notes[t].label),t<this.data.notes.length-1&&e.$el.prepend("<br />");return e.dispose=function(){},this.container.append(e.$el),null},t.prototype.addLine=function(){var e;return e=new SSAsset("interface","music_mid_bar"),this.$el.find(".decorated-box").find(".center_bar").append(e.$el),null},t.prototype.goShare=function(){var e;return Analytics.track("music_share"),this.oz().appView.subArea.buttons.share.disable(),this.oz().appView.subLoader.show(!0),e=this.exportSong("col"),e.dimensions={lines:this.data.dimensions.lines,cols:this.data.dimensions.cols},e.notes=this.data.notes,e.loops=this.data.loops,Requester.addMusic(JSON.stringify(e),this.musicSaved,this.fail),null},t.prototype.musicSaved=function(e){var t;return t=window.location.origin+"/preview/music/"+e.result.id,Requester.shortURL(t,this.showShareBox,this.fail),null},t.prototype.showShareBox=function(e){return this.oz().appView.subArea.buttons.share.enable(),this.oz().appView.subLoader.hide(),this.trigger("SHARE",e.id),null},t.prototype.fail=function(){return this.oz().appView.subLoader.showError(),this.trigger("fail"),null},t.prototype.togglePlay=function(){return this.playing?this.stop():this.play(),null},t.prototype.play=function(){return Analytics.track("music_click_play"),SoundController.send("musicbox_play"),this.trigger("playState"),this.colNo=this.data.cols.length/2,this.cloneTable(),this.saveUserLoop(),this.playing=!0,null},t.prototype.stop=function(){return this.playing=!1,Analytics.track("music_click_pause"),SoundController.send("musicbox_pause"),this.trigger("pauseState"),this.resetTimer(),this.grid.$el.animate({"margin-left":0},800,"easeInOutQuad",this.removeTable),null},t.prototype.resetTimer=function(){return this.clock.stop(),this.clock.startTime=0,this.clock.oldTime=0,this.clock.elapsedTime=0},t.prototype.removeTable=function(){var e;return this.$el.find("table").length>1&&(e=$(this.$el.find("table")[0]),e.remove()),$(this.$el.find("table")).removeClass("leftTweak"),null},t.prototype.cloneTable=function(){var e,t;return t=$(this.grid.$el.find("table")[0]),e=t.clone(!0,!0),this.grid.$el.append(e),e.addClass("leftTweak"),this.cleanFlash(e),null},t.prototype.checkColumn=function(){var e,t,n;if(this.lastCol!==this.colNo){this.lastCol=this.colNo,e=this.data.cols[this.colNo],t=0;while(t<e.rows.length)n=e.rows[t],this.animateCell(this.colNo,n),this.playCell(this.colNo,n),t++;t=0;while(t<this.data.loops.length)this.playLoop(this.data.loops[t]),t++}return null},t.prototype.animateCell=function(e,t){var n,r,i,s=this;return e<this.data.cols.length/2&&this.$el.find("table").length>1?i=this.$el.find("table")[1]:i=this.$el.find("table")[0],r=$(i).find("tr")[t],n=$(r).find("td")[e],$(n).stop().addClass("flash"),$(n).delay(400).queue(function(){return $(n).removeClass("flash"),$(n).dequeue()}),null},t.prototype.playCell=function(e,t){return MusicBoxSequencer.playSound(e,t),null},t.prototype.playLoop=function(e){var t;return t="",this.colNo===e.col&&(t=e.event),t!==""&&SoundController.send(e.event),null},t.prototype.saveUserLoop=function(){return this.data.cols=this.exportSong("col").cols,SoundController.userLoop=this.data,null},t.prototype.onEnterFrame=function(){var e,t,n,r,i,s;if(!this.playing)return;return s=this.clock.getElapsedTime()*100/(this.tempo*this.data.dimensions.cols),i=this.grid.$el.width()*s/100,this.grid.$el.css({"margin-left":-i/2}),t=(this.cellWidth*(s/100).toFixed(1)).toFixed(1),r=i+t*2,e=Math.floor(r*(this.data.dimensions.cols-1)/this.grid.$el.width()),e<this.data.dimensions.cols/2?e+=this.data.dimensions.cols/2:e-=this.data.dimensions.cols/2,this.colNo=e,this.checkColumn(),n=6,Math.abs(parseInt(this.grid.$el.css("margin-left")))*2+n>=this.grid.$el.width()&&(this.removeTable(),this.grid.$el.css({"margin-left":0}),this.cloneTable(),this.resetTimer()),null},t.prototype.exportSong=function(e){var t,n,r,i;e||(e="row"),i=$(this.$el.find("table"));if(e==="row"){r={rows:[]},t=0;while(t<this.data.dimensions.lines){r.rows[t]={columns:[]},n=0;while(n<this.data.dimensions.cols)this.checkCell(i,t,n)===!0&&r.rows[t].columns.push(n),n++;t++}}else if(e==="col"){r={cols:[]},t=0;while(t<this.data.dimensions.cols){r.cols[t]={rows:[]},n=0;while(n<this.data.dimensions.lines)this.checkCell(i,n,t)===!0&&r.cols[t].rows.push(n),n++;t++}}return r},t.prototype.addChord=function(e,t){var n;return n=this.$el.find("table"),$(n[0]).find("#"+e+"-"+t).addClass("on"),$(n[1]).find("#"+e+"-"+t).addClass("on"),this.data.cols[e].rows.push(parseInt(t)),null},t.prototype.removeChord=function(e,t){var n,r;return r=this.$el.find("table"),$(r[0]).find("#"+e+"-"+t).removeClass("on"),$(r[1]).find("#"+e+"-"+t).removeClass("on"),n=this.data.cols[e].rows.indexOf(t),this.data.cols[e].rows.splice(n,1),null},t.prototype.cleanFlash=function(e){return e.children().children().children().removeClass("flash"),null},t.prototype.checkCell=function(e,t,n){var r,i;i=$(e.find("tr")[t]),r=$(i.find("td")[n]);if(r)return r.hasClass("on")?!0:!1;throw"Error exporting song: couldn't find specified cell."},t.prototype.dispose=function(){return null},t}(Abstract),MusicButtons=function(e){function t(){return this.togglePlay=__bind(this.togglePlay,this),this.goShare=__bind(this.goShare,this),this.doneAct=__bind(this.doneAct,this),this.render=__bind(this.render,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="div",t.prototype.className="musicbox_button_container",t.prototype.init=function(){return this.left=new SSAsset("interface","pause_left"),this.addChild(this.left),this.done=new SimpleButton("doneMusic",this.oz().locale.get("music_done_button")),this.done.on("click",this.doneAct),this.addChild(this.done),this.share=new SimpleButton("shareTune",this.oz().locale.get("music_share_your_tune")),this.share.on("click",this.goShare),this.addChild(this.share),this.right=new SSAsset("interface","pause_right"),this.addChild(this.right),null},t.prototype.render=function(){var e;return e=Math.max(this.done.$el.width(),this.share.$el.width()),this.share.$el.width(e),this.done.$el.width(e),null},t.prototype.doneAct=function(){return this.trigger("doneAct"),null},t.prototype.goShare=function(){return this.trigger("goShare"),null},t.prototype.togglePlay=function(){return this.trigger("togglePlay"),null},t}(Abstract),ShareScene=function(e){function t(){return this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.shareBox=null,t.prototype.init=function(){return this.$el.css({width:"100%"}),this.$el.css({height:"100%"}),this.$el.css({opacity:0,display:"none",position:"absolute","z-index":10,"background-color":"transparent"}),null},t.prototype.show=function(e){return this.shareBox=new ShareBox(e.title,e.sub,e.back,e.backCall,e.link,e.type),this.shareBox.on("removeShareBox",this.hide),this.addChild(this.shareBox),this.$el.css({display:"table"}),t.__super__.show.call(this,!0),null},t.prototype.hide=function(){var e=this;return t.__super__.hide.call(this,!0,function(){var t;return e.remove(e.shareBox),(t=e.shareBox)!=null&&t.off("removeShareBox"),e.shareBox=null,e.$el.css({display:"none"})}),null},t}(AbstractScene),StormInstructions=function(e){function t(){return this.addLayout=__bind(this.addLayout,this),this.dispose=__bind(this.dispose,this),this.render=__bind(this.render,this),this.hideMe=__bind(this.hideMe,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.id="storm",t.prototype.videoElement=null,t.prototype.video=null,t.prototype.init=function(){return this.render(),this.$el.bind("click",this.hideMe),this.oz().appView.footer.mainMenu.hide(!0),this.hide(),this.show(!0)},t.prototype.hideMe=function(){var e=this;return this.$el.unbind("click",this.hideMe),this.hide(!0,function(){return e.remove(e.instructions),e.oz().appView.wrapper.remove(e.subArea),e.oz().appView.wrapper.remove(e.containerSubArea),e.oz().appView.subArea=null,e.mouseEnabled(!1)}),this.oz().appView.area.activate()},t.prototype.render=function(){return this.addLayout("instructions_balloon","storm_intructions"),t.__super__.render.call(this)},t.prototype.dispose=function(){return this},t.prototype.addLayout=function(e,n){return t.__super__.addLayout.call(this,e,n),this.instructions.show(!0)},t}(AbstractScene),SimpleButton=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.onclick=__bind(this.onclick,this),this.onout=__bind(this.onout,this),this.onover=__bind(this.onover,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.initialize=function(e,n,r){return r==null&&(r="btanimated"),this.id=e,this.label=n,this.classAnimated=r,t.__super__.initialize.call(this)},t.prototype.init=function(){return this.enable()},t.prototype.onover=function(){return t.__super__.onover.call(this)},t.prototype.onout=function(){return t.__super__.onout.call(this)},t.prototype.onclick=function(){return this.trigger("click",this),null},t.prototype.dispose=function(){return null},t}(AbstractButton),Zoetrope=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.restore=__bind(this.restore,this),this.goShare=__bind(this.goShare,this),this.goMakeMovie=__bind(this.goMakeMovie,this),this.next=__bind(this.next,this),this.cleanCameraListeners=__bind(this.cleanCameraListeners,this),this.onDisableCamera=__bind(this.onDisableCamera,this),this.onCamFail=__bind(this.onCamFail,this),this.onEnableCamera=__bind(this.onEnableCamera,this),this.addLayout=__bind(this.addLayout,this),this.onClose=__bind(this.onClose,this),this.render=__bind(this.render,this),this.onAssetsComplete=__bind(this.onAssetsComplete,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.id="zoetrope",t.prototype.container=null,t.prototype.camera=null,t.prototype.image=null,t.prototype.imageFooter=null,t.prototype.instructionsBox=null,t.prototype.init=function(){return this.render(),null},t.prototype.onAssetsComplete=function(){return this.remove(this.loader),t.__super__.onAssetsComplete.call(this),null},t.prototype.render=function(){return Analytics.track("zoe_enter_page","Google_OZ_Zeotrope"),this.addLayout("instructions_zoetrope","zoetrope_intructions",{w:656,h:750,debug:!1}),t.__super__.render.call(this),null},t.prototype.onClose=function(){return this.oz().appView["static"].page instanceof LandingPause||(Analytics.track("zoe_close_section"),SoundController.send("zoetrope_end"),SoundController.send("zoetrope_scene_end"),this.oz().appView.footer.mainMenu.$el.css({display:""}),this.oz().appView.logo.enable(),this.oz().appView.share.hide(),this.oz().appView.subLoader.hide(),t.__super__.onClose.call(this)),null},t.prototype.addLayout=function(e,n,r){var i=this;return SoundController.send("zoetrope_start"),t.__super__.addLayout.call(this,e,n,r),this.oz().appView.footer.mainMenu.$el.css({display:"none"}),this.oz().appView.logo.disable(),this.instructions.show(!0,function(){return i.addCameraHelper(),i.camera=i.oz().cam,i.camera.on("CAM_READY",i.onEnableCamera),i.camera.on("CAM_FAIL",i.onCamFail),i.camera.init()}),null},t.prototype.onEnableCamera=function(){return Analytics.track("zoe_allow_camera"),SoundController.send("zoetrope_scene_start"),this.addCloseButton(),this.cleanCameraListeners(),this.next(),null},t.prototype.onCamFail=function(){var e=this;return this.image=new SSAsset("interface","instructions_warning"),this.image.css({margin:"0 auto"}),this.cleanCameraListeners(),this.instructions.hide(!1),this.instructionsBox=this.instructions.$el.find(".box").find("#c22"),this.instructionsBox.empty(),this.instructionsBox.append(this.image.$el),this.instructionsBox.append("<p>"+this.oz().locale.get("no_webcam_copy")+"</p>"),this.imageFooter=new SSAsset("interface","pause_bottom"),this.imageFooter.css({margin:"0 auto"}),this.instructionsBox.append(this.imageFooter.$el),this.instructions.show(!0,function(){return $("body").bind("click",e.onDisableCamera)}),null},t.prototype.onDisableCamera=function(){return $("body").unbind("click",this.onDisableCamera),Analytics.track("zoe_deny_camera"),this.cleanCameraListeners(),this.onClose(),null},t.prototype.cleanCameraListeners=function(){var e,t;return this.removeCameraHelper(),(e=this.camera)!=null&&e.off("CAM_READY",this.onEnableCamera),(t=this.camera)!=null&&t.off("CAM_FAIL",this.onCamFail),null},t.prototype.next=function(){return this.instructions.hide(!0,this.goMakeMovie),null},t.prototype.goMakeMovie=function(){return this.remove(this.instructions),this.makemovie=new ZoetropeMakeMovie(this.camera),this.makemovie.on("SHARE",this.goShare),this.makemovie.on("fail",this.restore),this.addChild(this.makemovie),null},t.prototype.goShare=function(e){return this.oz().appView.pauseEnabled=!1,this.makemovie.$el.animate({opacity:0},300,"linear"),this.oz().appView.share.show({title:this.oz().locale.get("zoetrope_nice_illusion"),sub:this.oz().locale.get("zoetrope_share_copy"),back:this.oz().locale.get("zoetrope_record_another"),link:e,backCall:this.restore,type:"zoe"}),null},t.prototype.restore=function(){return this.makemovie.off("fail",this.restore),this.oz().appView.pauseEnabled=!0,this.makemovie.$el.animate({opacity:1},300,"linear"),this.makemovie.goTryAgain(!1),null},t.prototype.dispose=function(){var e,n,r;return(e=this.makemovie)!=null&&e.stopRecord(),this.oz().appView.pauseEnabled=!0,t.__super__.dispose.call(this),this.instructions=null,this.cleanCameraListeners(),(n=this.camera)!=null&&n.dispose(),this.camera=null,(r=this.makemovie)!=null&&r.off("SHARE",this.goShare),null},t}(AbstractScene),ZoetropeCountDown=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.done=__bind(this.done,this),this.next=__bind(this.next,this),this.start=__bind(this.start,this),this.stopCountDown=__bind(this.stopCountDown,this),this.startCountDown=__bind(this.startCountDown,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="counter",t.prototype.counter=3,t.prototype.counting=null,t.prototype.numbers=[],t.prototype.circle=null,t.prototype.init=function(){var e,t,n,r;this.numbers=null,this.numbers=[];for(e=n=1,r=this.counter;1<=r?n<=r:n>=r;e=1<=r?++n:--n)t=$("<div>"+e+"</div>"),t.css({fontSize:"0px",opacity:0}),this.numbers.push(t),this.addChild(t);return e=null,this.hold=$("<div>- - -</div>"),this.hold.css({fontSize:"38px",opacity:1,"letter-spacing":"-1px","line-height":"49px"}),this.addChild(this.hold),null},t.prototype.startCountDown=function(){return this.counter=3,this.hold.stop().animate({opacity:0}),this.counting=setInterval(this.start,500),this.start(),null},t.prototype.stopCountDown=function(){var e,t;clearInterval(this.counting);for(e=t=0;t<3;e=++t)this.numbers[e].stop().animate({opacity:0,fontSize:"16px"},400,"easeOutExpo");return e=null,this.hold.stop().animate({opacity:1}),null},t.prototype.start=function(){return this.counter<this.numbers.length&&(this.numbers[this.counter].stop().animate({opacity:0,fontSize:"36px"},400,"easeOutExpo"),this.counter===0&&this.done()),this.counter>0&&(this.numbers[this.counter-1].delay(100).stop().animate({opacity:1,fontSize:"38px"},700,"easeOutBack"),this.counter--),null},t.prototype.next=function(){return this.counter--,null},t.prototype.done=function(){return this.hold.stop().animate({opacity:1}),clearInterval(this.counting),this.trigger("COUNTDOWN_COMPLETE"),null},t.prototype.dispose=function(){return null},t}(Abstract),ZoetropeMakeMovie=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.showShareBox=__bind(this.showShareBox,this),this.fail=__bind(this.fail,this),this.imageSaved=__bind(this.imageSaved,this),this.get3DTexture=__bind(this.get3DTexture,this),this.requestSave=__bind(this.requestSave,this),this.goShare=__bind(this.goShare,this),this.goTryAgain=__bind(this.goTryAgain,this),this.addButtons=__bind(this.addButtons,this),this.recordFrame=__bind(this.recordFrame,this),this.recordOneFrame=__bind(this.recordOneFrame,this),this.completed=__bind(this.completed,this),this.stopRecord=__bind(this.stopRecord,this),this.resume=__bind(this.resume,this),this.pause=__bind(this.pause,this),this.onCountdownComplete=__bind(this.onCountdownComplete,this),this.startRecord=__bind(this.startRecord,this),this.onDone=__bind(this.onDone,this),this.toogleRecord=__bind(this.toogleRecord,this),this.start=__bind(this.start,this),this.updateSettings=__bind(this.updateSettings,this),this.init=__bind(this.init,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.id="makemovie",t.prototype.container=null,t.prototype.controls=null,t.prototype.flourish=null,t.prototype.webcamfeed=null,t.prototype.navContainer=null,t.prototype.record=null,t.prototype.tryagain=null,t.prototype.preview=null,t.prototype.timeline=null,t.prototype.recording=!1,t.prototype.bright=null,t.prototype.contrast=null,t.prototype.camera=null,t.prototype.header=null,t.prototype.headerFlourish=null,t.prototype.bottom=null,t.prototype.bottomFlourish=null,t.prototype.countdown=null,t.prototype.done=null,t.prototype.share=null,t.prototype.rep=null,t.prototype.data=null,t.prototype.scale=null,t.prototype.img=null,t.prototype.canvasTexture=null,t.prototype.ctxTexture=null,t.prototype.canvasRef=null,t.prototype.ctxRef=null,t.prototype.line=null,t.prototype.col=null,t.prototype.imgData=null,t.prototype.w=null,t.prototype.h=null,t.prototype.initialize=function(e){return this.scale=128/600,this.camera=e,t.__super__.initialize.call(this),null},t.prototype.init=function(){return this.container=(new Abstract).setElement("<div class='zoetropeContainer'></div>"),this.container.dispose=function(){return null},this.addChild(this.container),this.header=(new Abstract).setElement("<div class='zoeheader'></div>"),this.header.dispose=function(){return null},this.container.addChild(this.header),this.headerFlourish=new SSAsset("interface","zoe_top"),this.header.addChild(this.headerFlourish),this.webcamfeed=new ZoetropeWebcamFeed(this.camera),this.container.addChild(this.webcamfeed),this.bottom=(new Abstract).setElement("<div class='zoebottom'></div>"),this.bottom.dispose=function(){return null},this.bottomFlourish=new SSAsset("interface","zoe_bottom"),this.bottomFlourish.$el.css({"background-position-y":""+(parseInt(this.bottomFlourish.$el.css("background-position-y"))+1)+"px",height:""+(parseInt(this.bottomFlourish.$el.css("height"))+1)+"px"}),this.bottom.addChild(this.bottomFlourish),this.countdown=new ZoetropeCountDown,this.bottom.addChild(this.countdown),this.timeline=new ZoetropeTimeline(this.webcamfeed.canvas,this.webcamfeed.player),this.timeline.on("REPLACE_THUMB",this.recordOneFrame),this.container.addChild(this.timeline),this.container.addChild(this.bottom),this.navContainer=(new Abstract).setElement("<div class='navContainer'></div>"),this.navContainer.dispose=function(){return null},this.navContainer.hide(),this.addChild(this.navContainer),this.addButtons(),this.$el.css({"margin-top":"-20px",display:"inline-block",position:"relative","z-index":5,opacity:0}),this.$el.animate({opacity:1},800,"linear"),null},t.prototype.updateSettings=function(e){return this.webcamfeed.setBrightness(this.bright.percent),this.webcamfeed.setContrast(this.contrast.percent),null},t.prototype.start=function(){return this.record.enable(),null},t.prototype.toogleRecord=function(){return this.recording?(this.stopRecord(),this.timeline.clear()):this.startRecord(),null},t.prototype.onDone=function(){return this.oz().appView.subArea.onClose(),null},t.prototype.startRecord=function(){return Analytics.track("zoe_click_record"),SoundController.send("zoetrope_recording_start"),this.recording=!0,this.record.changeLabel("<span class='red'>&#149;</span> "+this.oz().locale.get("zoetrope_stop_recording")),this.countdown.on("COUNTDOWN_COMPLETE",this.onCountdownComplete),this.countdown.startCountDown(),null},t.prototype.onCountdownComplete=function(){return this.countdown.stopCountDown(),this.timeline.addFrame(),this.timeline.currentFrame<this.timeline.numberOfPictures?this.rep=setTimeout(this.countdown.startCountDown,1e3):this.completed(),null},t.prototype.pause=function(){return this.recording&&(clearInterval(this.rep),this.countdown.stopCountDown(),this.countdown.off("COUNTDOWN_COMPLETE",this.onCountdownComplete),this.recording=!1),t.__super__.pause.call(this),null},t.prototype.resume=function(){return this.timeline.currentFrame>0&&(this.recording=!0,this.countdown.on("COUNTDOWN_COMPLETE",this.onCountdownComplete),this.countdown.startCountDown()),t.__super__.resume.call(this),null},t.prototype.stopRecord=function(){return Analytics.track("zoe_stop_record"),SoundController.send("zoetrope_recording_stop"),clearInterval(this.rep),this.countdown.stopCountDown(),this.countdown.off("COUNTDOWN_COMPLETE",this.onCountdownComplete),this.recording=!1,this.record.changeLabel("<span>&#149;</span> "+this.oz().locale.get("zoetrope_start_recording")),this.timeline.stop(),null},t.prototype.completed=function(){return this.stopRecord(),this.record.off("click"),this.record.on("click",this.goTryAgain),this.share.enable(),this.done.enable(),this.timeline.setStatus("end"),this.webcamfeed.player.showAndPlay(this.timeline.canvas),this.get3DTexture(),null},t.prototype.recordOneFrame=function(e){var t=this;return Analytics.track("zoe_replace_image"),this.countdown.on("COUNTDOWN_COMPLETE",function(){return t.recordFrame(e)}),this.countdown.startCountDown(),this.webcamfeed.player.stopIt(),this.webcamfeed.player.hide(!0),this.done.disable(),this.share.disable(),this.timeline.disableThumbs(),this.timeline.$el.css({"pointer-events":"none"}),null},t.prototype.recordFrame=function(e){return this.timeline.$el.css({"pointer-events":"auto"}),this.timeline.enableThumbs(),this.countdown.off("COUNTDOWN_COMPLETE"),this.timeline.shotOnFrame(e),this.webcamfeed.player.showAndPlay(this.timeline.canvas),this.done.enable(),this.share.enable(),this.timeline.thumbsArr[e].onOut(),this.get3DTexture(),null},t.prototype.addButtons=function(){var e=this;return this.done=new SimpleButton("done",""+this.oz().locale.get("zoetrope_done_button")),this.done.on("click",this.onDone),this.navContainer.addChild(this.done),this.done.disable(),this.record=new SimpleButton("record","<span>&#149;</span> "+this.oz().locale.get("zoetrope_start_recording")),this.record.on("click",this.toogleRecord),this.navContainer.addChild(this.record),this.share=new SimpleButton("share",""+
this.oz().locale.get("zoetrope_share_movie")),this.share.on("click",this.goShare),this.navContainer.addChild(this.share),this.share.disable(),setTimeout(function(){var t;return t=Math.max(e.done.$el.width(),e.record.$el.width(),e.share.$el.width()),e.done.$el.width(t),e.record.$el.width(t),e.share.$el.width(t),e.navContainer.show(!0)},300),null},t.prototype.goTryAgain=function(e){return e==null&&(e=!0),Analytics.track("zoe_create_another"),this.share.disable(),this.done.disable(),this.webcamfeed.player.stopIt(),this.webcamfeed.player.hide(!0),this.timeline.clear(),this.record.off("click"),this.record.on("click",this.toogleRecord),e&&this.toogleRecord(),null},t.prototype.goShare=function(){return Analytics.track("zoe_share"),this.share.disable(),this.done.disable(),this.oz().appView.subLoader.show(!0),this.requestSave(),null},t.prototype.requestSave=function(){return this.data=this.timeline.canvas[0].toDataURL("image/jpeg").slice("data:image/jpeg;base64,".length),Requester.addImage(this.data,"zoetrope",this.imageSaved,this.fail),null},t.prototype.get3DTexture=function(){var e=this;return this.data=this.timeline.canvas[0].toDataURL("image/jpeg"),this.img=new Image,this.img.onload=function(){var t,n;e.canvasTexture=document.createElement("canvas"),e.canvasTexture.width=384,e.canvasTexture.height=512,e.ctxTexture=e.canvasTexture.getContext("2d"),e.canvasRef=document.createElement("canvas"),e.canvasRef.width=7200,e.canvasRef.height=340,e.ctxRef=e.canvasRef.getContext("2d"),e.ctxRef.scale(e.scale,e.scale),e.ctxRef.drawImage(e.img,0,0),e.line=0,e.col=0;for(t=n=0;n<12;t=++n)e.imgData=e.ctxRef.getImageData(t*600*e.scale,0,600*e.scale,340*e.scale),e.w=e.col*600*e.scale,e.h=28+128*e.line,e.ctxTexture.putImageData(e.imgData,e.w,e.h),e.col===2?(e.col=0,e.line++):e.col++;return e.oz().appView.area.updateFilmTexture(e.canvasTexture)},this.img.src=this.data,null},t.prototype.imageSaved=function(e){return Requester.shortURL(window.location.origin+"/preview/zoe/"+e.result.id,this.showShareBox,this.fail),null},t.prototype.fail=function(){return this.oz().appView.subLoader.showError(),this.trigger("fail"),null},t.prototype.showShareBox=function(e){return this.oz().appView.subLoader.hide(),this.trigger("SHARE",e.id),null},t.prototype.dispose=function(){return this.canvasRef=null,this.canvasTexture=null,this.webcamfeed.dispose(),this.webcamfeed.off("COUNTDOWN_COMPLETE"),this.timeline.off("COMPLETED"),this.timeline.off("REPLACE_THUMB"),null},t}(Abstract),ZoetropePlayer=function(e){function t(){return this.gotoFrame=__bind(this.gotoFrame,this),this.stopIt=__bind(this.stopIt,this),this.play=__bind(this.play,this),this.nextFrame=__bind(this.nextFrame,this),this.showAndPlay=__bind(this.showAndPlay,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="player",t.prototype.data=null,t.prototype.timer=null,t.prototype.transitionTime=100,t.prototype.currentX=0,t.prototype.w=600,t.prototype.numberOfPictures=12,t.prototype.init=function(){return this.$el.css({opacity:0}),null},t.prototype.showAndPlay=function(e){return this.$el.animate({opacity:1},700),this.$el.css({"background-image":"url("+e[0].toDataURL("image/jpeg")+")"}),this.play(),null},t.prototype.nextFrame=function(){return this.$el.css({"background-position-x":""+this.currentX+"px"}),this.currentX-=this.w,this.currentX<=-this.w*this.numberOfPictures&&(this.currentX=0),null},t.prototype.play=function(){var e=this;return clearInterval(this.timer),this.timer=setInterval(function(){return e.nextFrame()},this.transitionTime),null},t.prototype.stopIt=function(){return clearInterval(this.timer),null},t.prototype.gotoFrame=function(e){return this.stopIt(),this.currentX=-(e*this.w),this.$el.css({"background-position-x":""+this.currentX+"px"}),null},t}(Abstract),ZoetropeReplaceLabel=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.hide=__bind(this.hide,this),this.showAt=__bind(this.showAt,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="labelContainer",t.prototype.label=null,t.prototype.init=function(){return this.label=(new Abstract).setElement("<div class='label'></div>"),this.label.dispose=function(){return null},this.label.$el.css({height:this.thumbH}),this.addChild(this.label),this.hide(),this.left=new SSAsset("interface","tooltip_large"),this.left.$el.css({"float":"left",width:"20px"}),this.label.addChild(this.left),this.content=$("<div class='content'><div class='text'>"+this.oz().locale.get("zoetrope_replace")+"</div></div>"),this.label.$el.append(this.content),this.contentBG=new SSAsset("interface","tooltip_large"),this.content.append(this.contentBG.$el),this.contentBG.$el.css({position:"relative",width:"20px","margin-top":"-38px",left:"50%","margin-left":"-7px","z-index":"-1",width:"13px","background-position-x":""+(parseFloat(this.contentBG.$el.css("background-position-x"))-30)+"px"}),this.right=new SSAsset("interface","tooltip_large"),this.label.addChild(this.right),this.right.$el.css({"float":"left",width:"20px","background-position-x":""+(parseFloat(this.right.$el.css("background-position-x"))-52)+"px"}),this.clear=$("div class='clearfix'></div>"),this.label.$el.append(this.clear),null},t.prototype.showAt=function(e){return this.label.$el.stop().animate({opacity:1}),this.label.$el.css({left:""+e+"px"}),null},t.prototype.hide=function(){return this.label.$el.stop().animate({opacity:0}),null},t.prototype.dispose=function(){return null},t}(Abstract),ZoetropeThumb=function(e){function t(){return this.animate=__bind(this.animate,this),this.getRandomColor=__bind(this.getRandomColor,this),this.clear=__bind(this.clear,this),this.draw=__bind(this.draw,this),this.onOut=__bind(this.onOut,this),this.onOver=__bind(this.onOver,this),this.onMouseDown=__bind(this.onMouseDown,this),this.onMouseUp=__bind(this.onMouseUp,this),this.onMouseOut=__bind(this.onMouseOut,this),this.onMouseOver=__bind(this.onMouseOver,this),this.disable=__bind(this.disable,this),this.enable=__bind(this.enable,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="thumb",t.prototype.pos=0,t.prototype.w=0,t.prototype.h=0,t.prototype.id=0,t.prototype.canvas=null,t.prototype.initialize=function(e,n,r,i){return t.__super__.initialize.call(this),this.id=e,this.pos=e*n+i*e,this.w=n,this.h=r,this.$el.css({width:n,height:r,left:this.pos}),this.overlay=(new Abstract).setElement("<div class='overlay'></div>"),this.overlay.$el.css({opacity:0}),this.overlay.dispose=function(){return null},this.addChild(this.overlay),this.camera=new SSAsset("interface","camera_icon"),this.overlay.addChild(this.camera),this.canvas=(new Abstract).setElement("<canvas width='"+n+"' height='"+r+"' ></canvas>"),this.canvas.dispose=function(){return null},this.addChild(this.canvas),this.enable(),null},t.prototype.enable=function(){return this.$el.bind("mouseover",this.onMouseOver),this.$el.bind("mouseout",this.onMouseOut),this.$el.bind("mouseup",this.onMouseUp),this.$el.bind("mousedown",this.onMouseDown),null},t.prototype.disable=function(){return this.$el.unbind("mouseover"),this.$el.unbind("mouseout"),this.$el.unbind("mouseup"),this.$el.unbind("mousedown"),null},t.prototype.onMouseOver=function(){return this.trigger("ON_OVER",this.id,this),null},t.prototype.onMouseOut=function(){return this.trigger("ON_OUT",this.id,this),null},t.prototype.onMouseUp=function(e){return this.trigger("ON_MOUSE_UP",this.id,e.pageX,this),null},t.prototype.onMouseDown=function(e){return this.trigger("ON_MOUSE_DOWN",this.id,e.pageX,this),null},t.prototype.onOver=function(){return this.overlay.$el.stop().animate({opacity:1},400),null},t.prototype.onOut=function(){return this.overlay.$el.stop().animate({opacity:0},400),null},t.prototype.draw=function(e){return this.canvas.$el.css({opacity:"0"}),this.canvas.$el.animate({opacity:1}),this.canvas.$el[0].getContext("2d").drawImage(e,0,0,this.w,this.h),null},t.prototype.clear=function(){return this.canvas.$el[0].getContext("2d").clearRect(0,0,this.w,this.h),null},t.prototype.getRandomColor=function(){var e,t,n,r;n="0123456789ABCDEF".split(""),e="#";for(t=r=0;r<6;t=++r)e+=n[Math.round(Math.random()*15)];return e},t.prototype.animate=function(e,t){var n,r,i,s=this;return r={opacity:e.opacity,brightness:e.brightness},n={opacity:t.opacity,brightness:t.brightness},i=(new TWEEN.Tween(r)).to(n,700),i.easing(TWEEN.Easing.Quadratic.Out),i.onUpdate(function(){return s.canvas.$el.css({opacity:""+r.opacity,"-webkit-filter":"brightness("+r.brightness+"%)"})}),i.start(),null},t}(Abstract),ZoetropeTimeline=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.enableThumbs=__bind(this.enableThumbs,this),this.disableThumbs=__bind(this.disableThumbs,this),this.setStatus=__bind(this.setStatus,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.clear=__bind(this.clear,this),this.stop=__bind(this.stop,this),this.record=__bind(this.record,this),this.upThumb=__bind(this.upThumb,this),this.clickThumb=__bind(this.clickThumb,this),this.outThumb=__bind(this.outThumb,this),this.overThumb=__bind(this.overThumb,this),this.drawOzElement=__bind(this.drawOzElement,this),this.shotOnFrame=__bind(this.shotOnFrame,this),this.addFrame=__bind(this.addFrame,this),this.init=__bind(this.init,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="timeline",t.prototype.canvas=null,t.prototype.recording=!1,t.prototype.webcamfeed=null,t.prototype.player=null,t.prototype.status=null,t.prototype.currentFrame=0,t.prototype.numberOfPictures=12,t.prototype.thumbsArr=[],t.prototype.thumbs=null,t.prototype.thumbslist=null,t.prototype.thumbW=44,t.prototype.thumbH=25,t.prototype.thumbGap=6,t.prototype.progress=null,t.prototype.mouseX=null,t.prototype.thumbToReplace=null,t.prototype.initialize=function(e,n){return this.webcamfeed=e,this.player=n,t.__super__.initialize.call(this),null},t.prototype.init=function(){var e,t,n,r,i;this.label=new ZoetropeReplaceLabel,this.label.$el.css({height:this.thumbH}),this.addChild(this.label,!0),this.thumbs=(new Abstract).setElement("<div class='thumbs'></div>"),this.thumbs.dispose=function(){return null},this.thumbs.$el.css({height:this.thumbH}),this.addChild(this.thumbs),this.thumbslist=(new Abstract).setElement("<div class='list'></div>"),this.thumbslist.dispose=function(){return null},this.thumbs.addChild(this.thumbslist),this.thumbsArr=[];for(e=r=0,i=this.numberOfPictures;0<=i?r<i:r>i;e=0<=i?++r:--r)t=new ZoetropeThumb(e,this.thumbW,this.thumbH,this.thumbGap),t.on("ON_OVER",this.overThumb),t.on("ON_OUT",this.outThumb),t.on("ON_MOUSE_DOWN",this.clickThumb),t.on("ON_MOUSE_UP",this.upThumb),this.thumbslist.addChild(t),this.thumbsArr.push(t);return n=this.numberOfPictures*600,this.canvas=$("<canvas width='"+n+"' height='"+340+"'></canvas>"),this.canvas.css({display:"none"}),this.addChild(this.canvas,!0),null},t.prototype.addFrame=function(){return this.oz().appView.subArea.makemovie.webcamfeed.flash(),this.thumbsArr[this.currentFrame].draw(this.webcamfeed[0]),this.canvas[0].getContext("2d").drawImage(this.webcamfeed[0],this.currentFrame*600,0,600,340),this.drawOzElement(this.currentFrame),this.currentFrame++,null},t.prototype.shotOnFrame=function(e){return this.oz().appView.subArea.makemovie.webcamfeed.flash(),this.thumbsArr[e].draw(this.webcamfeed[0]),this.canvas[0].getContext("2d").drawImage(this.webcamfeed[0],e*600,0,600,340),this.drawOzElement(e),null},t.prototype.drawOzElement=function(e){var t,n;return n="fairy_final_"+(e+1),t=this.oz().baseAssets.get(n).result,this.canvas[0].getContext("2d").drawImage(t,e*600,0,600,340),null},t.prototype.overThumb=function(e,t){var n;return this.status==="end"&&(n=t.$el.position().left-this.label.label.$el.width()/2+29,this.label.showAt(n),this.player.gotoFrame(e),t.onOver()),null},t.prototype.outThumb=function(e,t){return this.status==="end"&&(this.label.hide(),this.player.play(),t.onOut()),null},t.prototype.clickThumb=function(e,t,n){return this.status==="end"&&(this.label.hide(),this.mouseX=t,this.thumbToReplace=e),null},t.prototype.upThumb=function(e,t,n){return this.status==="end"&&this.thumbToReplace===e&&this.mouseX===t&&this.trigger("REPLACE_THUMB",e),null},t.prototype.record=function(){return this.clear(),null},t.prototype.stop=function(){return this.currentFrame=0,null},t.prototype.clear=function(){var e,t,n;this.setStatus("normal"),this.thumbs.$el[0].scrollLeft=0,this.canvas[0].getContext("2d").clearRect(0,0,this.canvas.width(),this.thumbH);for(e=t=0,n=this.numberOfPictures;0<=n?t<n:t>n;e=0<=n?++t:--t)this.thumbsArr[e].clear();return},t.prototype.onEnterFrame=function(){return null},t.prototype.setStatus=function(e){return this.status=e,null},t.prototype.disableThumbs=function(){var e,t,n;for(e=t=0,n=this.numberOfPictures;0<=n?t<n:t>n;e=0<=n?++t:--t)this.thumbsArr[e].disable();return},t.prototype.enableThumbs=function(){var e,t,n;for(e=t=0,n=this.numberOfPictures;0<=n?t<n:t>n;e=0<=n?++t:--t)this.thumbsArr[e].enable();return},t.prototype.dispose=function(){var e,t,n;for(e=t=0,n=this.numberOfPictures;0<=n?t<n:t>n;e=0<=n?++t:--t)this.thumbsArr[e].off("ON_OUT"),this.thumbsArr[e].off("ON_OVER"),this.thumbsArr[e].off("ON_MOUSE_DOWN"),this.thumbsArr[e].off("ON_MOUSE_UP");return},t}(Abstract),ZoetropeWebcamFeed=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.animate=__bind(this.animate,this),this.setContrast=__bind(this.setContrast,this),this.setBrightness=__bind(this.setBrightness,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.addTexture=__bind(this.addTexture,this),this.flash=__bind(this.flash,this),this.init=__bind(this.init,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="webcamfeed",t.prototype.canvas=null,t.prototype.filtered=null,t.prototype.player=null,t.prototype.videoW=640,t.prototype.videoH=360,t.prototype.countdown=null,t.prototype.camera=null,t.prototype.brightness={min:-70,max:70,current:0},t.prototype.contrast={min:-0.7,max:.7,current:0},t.prototype.saturation=0,t.prototype.flasher=null,t.prototype.initialize=function(e){return this.camera=e,t.__super__.initialize.call(this),null},t.prototype.init=function(){return this.flasher=$("<div class='flasher'></div>"),this.addChild(this.flasher),this.flasher.css({opacity:0}),this.canvas=$("<canvas class='videocanvas' width='600' height='340'/>"),this.addChild(this.canvas),this.player=new ZoetropePlayer,this.addChild(this.player,!0),this.canvas[0].getContext("2d").translate(600,0),this.canvas[0].getContext("2d").scale(-1,1),this.camera.get(),null},t.prototype.flash=function(){var e=this;return this.flasher.stop().animate({opacity:.8},{duration:300,complete:function(){return e.flasher.stop().animate({opacity:0},{duration:600})}}),null},t.prototype.addTexture=function(){var e,t=this;return e=new Image,e.onload=function(){return t.texture[0].width=e.width,t.texture[0].height=e.height,t.texture[0].getContext("2d").drawImage(e,0,0,e.width,e.height)},e.src="../img/zoetrope/zoetrope_canvas_texture.png",null},t.prototype.onEnterFrame=function(){return this.canvas[0].getContext("2d").drawImage(this.oz().cam.dom(),0,0,this.canvas.width(),this.canvas.height(),0,0,this.canvas.width(),this.canvas.height()),null},t.prototype.setBrightness=function(e){return this.brightness.current=e*(this.brightness.max-this.brightness.min)/100+this.brightness.min,null},t.prototype.setContrast=function(e){return this.contrast.current=e*(this.contrast.max-this.contrast.min)/100+this.contrast.min,null},t.prototype.animate=function(e,t){var n,r,i,s=this;return r={opacity:e.opacity,brightness:e.brightness},n={opacity:t.opacity,brightness:t.brightness},i=(new TWEEN.Tween(r)).to(n,700),i.easing(TWEEN.Easing.Quadratic.Out),i.onUpdate(function(){return s.canvas.$el.css({opacity:""+r.opacity,"-webkit-filter":"brightness("+r.brightness+"%)"})}),i.start(),null},t.prototype.dispose=function(){return this.canvas.remove(),this.oz().cam.dispose(),null},t}(Abstract),Storm=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.createAxis=__bind(this.createAxis,this),this.v=__bind(this.v,this),this.debugaxis=__bind(this.debugaxis,this),this.onResize=__bind(this.onResize,this),this.flipBalloon=__bind(this.flipBalloon,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.onUnLock=__bind(this.onUnLock,this),this.onLock=__bind(this.onLock,this),this.onLockMouseMove=__bind(this.onLockMouseMove,this),this.onDocumentMouseMove=__bind(this.onDocumentMouseMove,this),this.addPlane=__bind(this.addPlane,this),this.changeView=__bind(this.changeView,this),this.activate=__bind(this.activate,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.clock=null,t.prototype.APP_HEIGHT=800,t.prototype.APP_WIDTH=600,t.prototype.APP_HALF_X=400,t.prototype.APP_HALF_Y=300,t.prototype.mouseX=0,t.prototype.mouseY=0,t.prototype.followX=0,t.prototype.followY=0,t.prototype.cubeRefMesh=null,t.prototype.bal=null,t.prototype.sl1=null,t.prototype.sl2=null,t.prototype.sl3=null,t.prototype.sl4=null,t.prototype.currentScale=.3,t.prototype.speed=1,t.prototype.running=!0,t.prototype.init=function(){var e,t;return this.clock=new THREE.Clock,this.APP_WIDTH=$(window).width(),this.APP_HEIGHT=$(window).height(),this.renderer=new THREE.WebGLRenderer({canvas:this.oz().appView.renderCanvas3D,antialias:!0,clearAlpha:1,clearColor:0}),this.renderer.setSize(this.APP_WIDTH,this.APP_HEIGHT),this.camera=new THREE.PerspectiveCamera(75,this.APP_WIDTH/this.APP_HEIGHT,10,1e5),this.camera.position.set(0,0,40),this.camera.updateMatrix(),this.scene=new THREE.Scene,e=new THREE.AmbientLight(16777215),this.scene.add(e),t=new THREE.CubeGeometry(1,1,1),this.cubeRefMesh=new THREE.Mesh(t,new THREE.MeshLambertMaterial({color:16777215})),this.sl1=this.addPlane(2e3,227,1,1100,0,-80,0,0,0,"/models/textures/stormsky/storm/sl1.png"),this.sl2=this.addPlane(2e3,227,1,1100,0,-90,0,0,0,"/models/textures/stormsky/storm/sl2.png"),this.sl3=this.addPlane(2100,327,1,1e3,0,-100,0,0,0,"/models/textures/stormsky/storm/sl3.png"),this.bal=this.addPlane(212,315,.3,0,0,-150,0,0,0,"/models/textures/stormsky/storm/balloon.png"),this.sl4=this.addPlane(2500,374,1,900,0,-180,0,0,0,"/models/textures/stormsky/storm/sl4.png"),this.scene.add(this.sl1),this.scene.add(this.sl2),this.scene.add(this.sl3),this.scene.add(this.bal),this.scene.add(this.sl4),this.onResize(),this.trigger("onWorldLoaded")},t.prototype.activate=function(){return $("body").bind("click",this.pointLock)},t.prototype.changeView=function(){return this},t.prototype.addPlane=function(e,t,n,r,i,s,o,u,a,f){var l,c,h,p;return c=new THREE.PlaneGeometry(e,t,39,9),p=THREE.ImageUtils.loadTexture(f),h=new THREE.MeshLambertMaterial({color:65408,ambient:16777215,shading:THREE.SmoothShading,map:p,transparent:!0,wireframe:!1,side:THREE.DoubleSide}),l=new THREE.Mesh(c,h),l.scale.x=l.scale.y=l.scale.z=n,l.position.x=r,l.position.y=i,l.position.z=s,l.rotation.x=o,l.rotation.y=u,l.rotation.z=a,l.updateMatrix(),l},t.prototype.initSky=function(){var e,t,n,r,i,s;return r="/models/textures/stormsky/",t=".png",s=[r+"posx"+t,r+"negx"+t,r+"posy"+t,r+"negy"+t,r+"negz"+t,r+"posz"+t],i=THREE.ImageUtils.loadTextureCube(s),i.format=THREE.RGBFormat,e=new IFLSkyCubeShader,e.uniforms.tCube.value=i,e.uniforms.tFlip.value=!0,n=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e.uniforms,depthWrite:!1,side:THREE.BackSide}),this.skyCube=new THREE.Mesh(new THREE.CubeGeometry(1e4,1e4,1e4),n),this.skyCube.name="skyCube",this.scene.add(this.skyCube)},t.prototype.onDocumentMouseMove=function(e){return this.mouseX=e.clientX-this.APP_WIDTH/2,this.mouseY=e.clientY-this.APP_HEIGHT/2},t.prototype.onLockMouseMove=function(e){var t,n,r;return t=e.originalEvent,n=t.movementX||t.mozMovementX||t.webkitMovementX||0,r=t.movementY||t.mozMovementY||t.webkitMovementY||0,this.mouseX+=n*1.2,this.mouseY+=r},t.prototype.onLock=function(){return this},t.prototype.onUnLock=function(){return this.mouseX=0,this.mouseY=0},t.prototype.onEnterFrame=function(){var e,t,n,r;if(this.running){e=this.clock.getDelta(),t=(this.mouseX-this.followX)/10,n=(this.mouseY-this.followY)/10,this.followX+=t,this.followY+=n,this.sl4.position.y=this.followY/40,this.bal.position.y=this.followY/20,this.sl3.position.y=this.followY/30,this.sl2.position.y=this.followY/50,this.sl1.position.y=this.followY/60,this.speed=this.followX/(this.APP_WIDTH/2),this.sl4.position.x-=this.speed,this.sl3.position.x-=this.speed*1.1,this.sl2.position.x-=this.speed*1.2,this.sl1.position.x-=this.speed*1.3;if(this.sl4.position.x<-1150){$("body").unbind("click",this.pointLock),this.running=!1,this.oz().appView.subArea.playVideo(),this.releasePointLock();return}return r=Date.now()*.002,this.bal.rotation.z=-0.2*this.speed,this.bal.rotation.x=.1*Math.cos(r),this.bal.rotation.y=.1*Math.cos(r),this.renderer.clear(),this.renderer.render(this.scene,this.camera),TWEEN.update()}},t.prototype.flipBalloon=function(e){var t,n,r;if(e!==this.currentScale)return t={model:this.bal,scale:this.currentScale},n={scale:e},r=(new TWEEN.Tween(t)).to(n,700),r.easing(TWEEN.Easing.Quadratic.Out),r.onUpdate(function(){return t.model.scale.x=t.scale}),r.start(),this.currentScale=e},t.prototype.onResize=function(){return this.APP_WIDTH=$(window).width(),this.APP_HEIGHT=$(window).height(),this.APP_HALF_X=this.APP_WIDTH/2,this.APP_HALF_Y=this.APP_HEIGHT/2,this.camera.aspect=this.APP_WIDTH/this.APP_HEIGHT,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.APP_WIDTH,this.APP_HEIGHT)},t.prototype.debugaxis=function(e){return this.createAxis(this.v(-e,0,0),this.v(e,0,0),16711680),this.createAxis(this.v(0,-e,0),this.v(0,e,0),65280),this.createAxis(this.v(0,0,-e),this.v(0,0,e),255)},t.prototype.v=function(e,t,n){return new THREE.Vector3(e,t,n)},t.prototype.createAxis=function(e,t,n){var r,i,s;return r=new THREE.Geometry,i=new THREE.Geometry,s=new THREE.LineBasicMaterial({color:n,lineWidth:1}),i.vertices.push(e,t),r=new THREE.Line(i,s),this.scene.add(r)},t.prototype.dispose=function(){return this.releasePointLock(),$("body").unbind("click",this.pointLock),this.renderer=null,this},t}(AbstractChapter),Stormtest=function(e){function t(){return this.onEnterFrame=__bind(this.onEnterFrame,this),this.onResize=__bind(this.onResize,this),this.instanceBasicMaterial=__bind(this.instanceBasicMaterial,this),this.instanceFresnelMaterial=__bind(this.instanceFresnelMaterial,this),this.instanceMaterial=__bind(this.instanceMaterial,this),this.instanceAnimation=__bind(this.instanceAnimation,this),this.onSceneLoaded=__bind(this.onSceneLoaded,this),this.onSceneProgress=__bind(this.onSceneProgress,this),this.onTexLoaded=__bind(this.onTexLoaded,this),this.onWorldProgress=__bind(this.onWorldProgress,this),this.onRestart=__bind(this.onRestart,this),this.randomRange=__bind(this.randomRange,this),this.onKeyDown=__bind(this.onKeyDown,this),this.onLockMouseMove=__bind(this.onLockMouseMove,this),this.onMouseClick=__bind(this.onMouseClick,this),this.changeView=__bind(this.changeView,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.SCENE_SCALE=1/12,t.prototype.CAMERA_DATA_FPS=25,t.prototype.CAMERA_ORBIT_H=.7,t.prototype.CAMERA_ORBIT_V=.5,t.prototype.SPEED_MIN=.5,t.prototype.SPEED_MAX=2,t.prototype.TIME_ENTER_TORNADO=22.2,t.prototype.TIME_END=45,t.prototype.MAX_DROPS=60,t.prototype.MIN_SAMPLES=2,t.prototype.MAX_SAMPLES=16,t.prototype.Q_STR=null,t.prototype.OPTIONS={tornadoRotation:.9,envmapMul:10,envmapMix:.76,envmapPow:.57,specmapMul:.57,specmapPow:.1,cubeX:-126,cubeY:107,cubeZ:51,overrideValues:!1,dropsRatio:.07,dropsScale:1},t.prototype.L_TEX=0,t.prototype.L_TEXNUM=49,t.prototype.L_LOADTEX=0,t.prototype.L_LOADSCENE=0,t.prototype.enableRender=!1,t.prototype.stormAnimTime=0,t.prototype.stormState=0,t.prototype.sceneRT=null,t.prototype.hudRT=null,t.prototype.tornadoSamples=8,t.prototype.tornadoW=null,t.prototype.tornadoH=null,t.prototype.tornadoShader=null,t.prototype.tornadoMaterial=null,t.prototype.tornadoTexture=!0,t.prototype.tornadoRT=null,t.prototype.tornadoFilter=!0,t.prototype.sal2xShader=null,t.prototype.sal2xMaterial=null,t.prototype.texClouds=null,t.prototype.texWhite=null,t.prototype.texDrops=[],t.prototype.drops=[],t.prototype.dropsTime=0,t.prototype.dropsRatio=.15,t.prototype.dropsScale=.7,t.prototype.godrays=null,t.prototype.timeFps=0,t.prototype.fpsCur=0,t.prototype.fpsAcc=0,t.prototype.fpsCount=0,t.prototype.audioListener=null,t.prototype.stormControls=null,t.prototype.cameraPosData=null,t.prototype.cameraTgtData=null,t.prototype.matTranslate=new THREE.Matrix4,t.prototype.matRotX=new THREE.Matrix4,t.prototype.matRotY=new THREE.Matrix4,t.prototype.matInverse=new THREE.Matrix4,t.prototype.matTornado=new THREE.Matrix4,t.prototype.debrisOutside=[],t.prototype.debrisInside=[],t.prototype.debrisOrgan=[],t.prototype.sceneLoaded=!1,t.prototype.textureLoaded=!1,t.prototype.loadingDone=!1,t.prototype.animStarted=!1,t.prototype.animPaused=!1,t.prototype.mousePos={x:0,y:0},t.prototype.curPos={x:0,y:0},t.prototype.prevPos={x:0,y:0},t.prototype.changeView=function(){return this.onCameraReady()},t.prototype.onMouseClick=function(e){if(!this.enableMouse||!this.animStarted)return;return(!this.animPaused||!this.stormControls)&&this.pointLock(),t.__super__.onMouseClick.apply(this,arguments)},t.prototype.onLockMouseMove=function(e){var t,n,r,i;return r=.3,t=400,n=400,i=e.originalEvent,this.prevPos.x+=i.webkitMovementX*r,this.prevPos.y+=i.webkitMovementY*r,this.prevPos.x=UTILS.clamp(this.prevPos.x,-t,t),this.prevPos.y=UTILS.clamp(this.prevPos.y,-n,n),this.mousePos.x=this.prevPos.x/t,this.mousePos.y=this.prevPos.y/n,this.pickMouse.x=e.clientX/this.APP_WIDTH*2-1,this.pickMouse.y=-(e.clientY/this.APP_HEIGHT)*2+1},t.prototype.onKeyDown=function(e){t.__super__.onKeyDown.call(this,e),this.oz().appView.debugMode&&(e.ctrlKey&&e.keyCode===66&&this.onRestart(!0),e.ctrlKey&&e.keyCode===65&&(this.animPaused=!this.animPaused,this.animPaused?(this.releasePointLock(),SoundController.send("storm_scene_pause"),this.CAMERA_ORBIT_H=Math.PI/2,this.CAMERA_ORBIT_V=Math.PI/2.5):(this.pointLock(),SoundController.send("storm_scene_resume"),this.CAMERA_ORBIT_H=.7,this.CAMERA_ORBIT_V=.5)))},t.prototype.randomRangeInt=function(e,t){var n,r,i;return t==null&&(t=0),n=Math.random(),e==null&&(r=[0,e],e=r[0],t=r[1]),e>t&&(i=[t,e],e=i[0],t=i[1]),Math.floor(n*(t-e+1)+e)},t.prototype.randomRange=function(e,t){return Math.random()*(t-e)+e},t.prototype.normalizeAngle=function(e){return Math.atan(Math.sin(e,Math.cos(e)))+Math.PI},t.prototype.animateParam=function(e,t,n,r,i){return n<r?e:n>i?t:UTILS.lerp(UTILS.time01(n,r,i-r),e,t)},t.prototype.initQuality=function(){this.quality=this.oz().appView.displayQuality;switch(this.quality){case"low":this.SCENE_WIDTH=this.APP_WIDTH*.75,this.SCENE_HEIGHT=this.APP_HEIGHT*.75,this.MIN_SAMPLES=8,this.MAX_SAMPLES=16,this.Q_STR="_low";break;case"med":this.SCENE_WIDTH=this.APP_WIDTH*.75,this.SCENE_HEIGHT=this.APP_HEIGHT*.75,this.MIN_SAMPLES=4,this.MAX_SAMPLES=12,this.Q_STR="_low";break;case"hi":this.SCENE_WIDTH=this.APP_WIDTH,this.SCENE_HEIGHT=this.APP_HEIGHT,this.MIN_SAMPLES=4,this.MAX_SAMPLES=12,this.Q_STR=""}this.tornadoSamples=this.MIN_SAMPLES,this.tornadoW=this.APP_WIDTH/this.tornadoSamples,this.tornadoH=this.APP_HEIGHT/this.tornadoSamples,this.hudRT?this.hudRT.resize(this.SCENE_WIDTH,this.SCENE_HEIGHT):this.hudRT=new Hud(this.renderer,this.SCENE_WIDTH,this.SCENE_HEIGHT,!1,!1)},t.prototype.init=function(){return t.__super__.init.apply(this,arguments),document.addEventListener("mouseup",this.onMouseUp,!1),document.addEventListener("mousedown",this.onMouseDown,!1),document.addEventListener("click",this.onMouseClick,!1),this.initQuality(),this.scene.fog.far=1e7,this.renderer.gammaInput=!1,this.renderer.gammaOutput=!1,this.renderer.sortObjects=!0,this.renderer.shadowMapEnabled=!1,this.renderer.shadowMapSoft=!1,this.camera.fov=43,this.camera.near=1,this.camera.far=1e4,this.params.cameraFOV=43,this.params.colorCorrectionPow="#000000",this.params.colorCorrectionPowM=1,this.params.colorCorrectionMul="#FFFFFF",this.params.colorCorrectionMulM=1,this.params.colorCorrectionSaturation=0,this.params.colorCorrectionSaturationColors="#FFFFFF",this.params.bloomPower=.39,this.params.fogcolor="#caa46f",this.effectBloom.enabled=!1,this.colorCorrection.uniforms.vignetteOffset.value=1,this.colorCorrection.uniforms.vignetteDarkness.value=1,this.oz().appView.debugMode&&(this.stormControls=new THREE.FirstPersonControls(this.camera,this.oz().appView.wrapper.el)),this.initCameraData(),this.initSun(),this.loader=new IFLLoader,this.loader.enableMaterialCache=!1,this.loader.enableTextureCache=!1,this.loader.pickableObjects=[],this.loader.customMaterialInstancer=this.instanceMaterial,this.loader.load("/models/storm.if3d",this.onSceneLoaded,this.onSceneProgress),this.onColorCorrectionChange(),this.initGodrays(),this.initTornado(),this.initDrops(),this.oz().appView.debugMode&&this.initGUI(),this.onResize(),this.$el.bind("click",this.onMouseClick),this.$el.bind("mousedown",this.onMouseDown),this.$el.bind("mouseup",this.onMouseUp)},t.prototype.initGodrays=function(){var e,t;return this.godrays={enabled:!1},this.godrays.depthMaterial=new THREE.MeshBasicMaterial({color:16777215,map:null}),this.godrays.depthMaterialSkinned=new THREE.MeshLambertMaterial({color:16777215,ambient:16777215,specular:16777215,skinning:!0,lights:!1}),this.godrays.scene=new THREE.Scene,this.godrays.camera=new THREE.OrthographicCamera(this.SCENE_WIDTH/-2,this.SCENE_WIDTH/2,this.SCENE_HEIGHT/2,this.SCENE_HEIGHT/-2,-1e4,1e4),this.godrays.camera.position.z=1e3,this.godrays.scene.add(this.godrays.camera),t=THREE.ShaderGodRays.godrays_generate,this.godrays.godrayGenUniforms=THREE.UniformsUtils.clone(t.uniforms),this.godrays.materialGodraysGenerate=new THREE.ShaderMaterial({uniforms:this.godrays.godrayGenUniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),e=THREE.ShaderGodRays.godrays_combine,this.godrays.godrayCombineUniforms=THREE.UniformsUtils.clone(e.uniforms),this.godrays.materialGodraysCombine=new THREE.ShaderMaterial({uniforms:this.godrays.godrayCombineUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.godrays.quad=new THREE.Mesh(new THREE.PlaneGeometry(this.SCENE_WIDTH,this.SCENE_HEIGHT),this.godrays.materialGodraysGenerate),this.godrays.quad.position.z=-3e3,this.godrays.scene.add(this.godrays.quad)},t.prototype.initSun=function(){var e,t,n,r,i=this;return t=new THREE.AmbientLight,this.scene.add(t),n=THREE.ImageUtils.loadTexture("/models/textures/lensflare/lensflare0_low.png",null,this.onTexLoaded),r=THREE.ImageUtils.loadTexture("/models/textures/lensflare/hexangle.png",null,this.onTexLoaded),e=new THREE.Color(16777215),this.lensFlare=new THREE.LensFlare(n,1e3,0,THREE.AdditiveBlending,e),this.lensFlare.add(r,60,.6,THREE.AdditiveBlending),this.lensFlare.add(r,70,.7,THREE.AdditiveBlending),this.lensFlare.add(r,120,.9,THREE.AdditiveBlending),this.lensFlare.add(r,70,1,THREE.AdditiveBlending),this.lensFlare.customUpdateCallback=function(e){var t,n,r,i,s,o;n=-e.positionScreen.x*2,r=-e.positionScreen.y*2,o=e.lensFlares;for(i=0,s=o.length;i<s;i++)t=o[i],t.x=e.positionScreen.x+n*t.distance,t.y=e.positionScreen.y+r*t.distance,t.rotation=0;return e.lensFlares[2].y+=.025,e.lensFlares[3].rotation=e.positionScreen.x*.5+45*Math.PI/180}},t.prototype.initTornado=function(){var e,t,n,r;return this.tornadoW=this.SCENE_WIDTH/this.tornadoSamples,this.tornadoH=this.SCENE_HEIGHT/this.tornadoSamples,this.TORNADO_POS=new THREE.Vector3(0,-500*this.SCENE_SCALE,-400*this.SCENE_SCALE),e=this.Q_STR+".png",t="/models/textures/storm/Env/earth_diff_",n=[t+"posx"+e,t+"negx"+e,t+"posy"+e,t+"negy"+e,t+"negz"+e,t+"posz"+e],this.tornadoEnvMap=THREE.ImageUtils.loadTextureCube(n,null,this.onTexLoaded),this.tornadoEnvMap.format=THREE.RGBFormat,t="/models/textures/storm/Env/earth_spec_",n=[t+"posx"+e,t+"negx"+e,t+"posy"+e,t+"negy"+e,t+"negz"+e,t+"posz"+e],this.tornadoSpecMap=THREE.ImageUtils.loadTextureCube(n,null,this.onTexLoaded),this.tornadoSpecMap.format=THREE.RGBFormat,this.tornadoTexture=THREE.ImageUtils.loadTexture("/models/textures/storm/tornado.png",null,this.onTexLoaded),this.tornadoTexture.flipY=!0,this.tornadoTexture.wrapS=this.tornadoTexture.wrapT=THREE.RepeatWrapping,r=!1,this.tornadoShader=r?new IFLTornadoShaderWin:new IFLTornadoShader,this.tornadoMaterial=new THREE.ShaderMaterial({vertexShader:this.tornadoShader.vertexShader,fragmentShader:this.tornadoShader.fragmentShader,uniforms:this.tornadoShader
.uniforms,depthTest:!1,depthWrite:!1,transparent:!0,map:this.tornadoTexture}),this.tornadoMaterial.uniforms.resolution.value=new THREE.Vector2(this.tornadoW,this.tornadoH),this.tornadoMaterial.uniforms.tDiffuse.value=this.tornadoTexture,this.sal2xShader=new IFLSal2x,this.sal2xMaterial=new THREE.ShaderMaterial({vertexShader:this.sal2xShader.vertexShader,fragmentShader:this.sal2xShader.fragmentShader,uniforms:this.sal2xShader.uniforms,depthTest:!1,depthWrite:!1,transparent:!0}),this.sal2xMaterial.uniforms.resolution.value=new THREE.Vector2(this.SCENE_WIDTH,this.SCENE_HEIGHT),this.texWhite=THREE.ImageUtils.loadTexture("/models/textures/white.png",null,this.onTexLoaded)},t.prototype.addClouds=function(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g,y,b,w;Math.seedrandom(o),e.scale.set(e.scale.x*this.SCENE_SCALE,e.scale.y*this.SCENE_SCALE,e.scale.z*this.SCENE_SCALE),this.texClouds||(this.texClouds=[],this.texClouds.push(THREE.ImageUtils.loadCompressedTexture("/models/textures/storm/cloud1"+this.Q_STR+".dds")),this.shaderClouds=new IFLCloudsShader),f=[],d=e.geometry.attributes.position.array;for(l=b=0,w=i-1;b<=w;l=b+=1)c=Math.round(this.randomRange(0,(d.length-1)/3))*3,m=d[c+0]*e.scale.x+e.position.x+this.randomRange(-t,t),g=d[c+1]*e.scale.y+e.position.y+this.randomRange(-n,n),y=d[c+2]*e.scale.z+e.position.z+this.randomRange(-r,r),u=.3,v=0,p={fragmentShader:this.shaderClouds.fragmentShader,vertexShader:this.shaderClouds.vertexShader,uniforms:THREE.UniformsUtils.clone(this.shaderClouds.uniforms),depthTest:!1,depthWrite:!1,alphaTest:.1,transparent:!0,map:this.texClouds[v]},h=new THREE.ShaderMaterial(p),h.uniforms.tDiffuse.value=this.texClouds[v],h.uniforms.scale.value=this.SCENE_SCALE,h.uniforms.alpha.value=this.randomRange(u,u+.15),a=new THREE.Mesh(new THREE.PlaneGeometry(1e3,1e3,1,1,1),h),a.position.x=m,a.position.y=g,a.position.z=y,f.push(a);return f},t.prototype.addCloudsFar=function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m;Math.seedrandom(u),l=[];for(c=v=0,m=o-1;v<=m;c=v+=1)e+=this.randomRange(-r,r),t+=this.randomRange(-i,i),n+=this.randomRange(-s,s),a=.3,d=0,p={fragmentShader:this.shaderClouds.fragmentShader,vertexShader:this.shaderClouds.vertexShader,uniforms:THREE.UniformsUtils.clone(this.shaderClouds.uniforms),depthTest:!1,depthWrite:!1,alphaTest:.1,transparent:!0,map:this.texClouds[d]},h=new THREE.ShaderMaterial(p),h.uniforms.tDiffuse.value=this.texClouds[d],h.uniforms.scale.value=this.SCENE_SCALE,h.uniforms.alpha.value=this.randomRange(a,a+.15),f=new THREE.Mesh(new THREE.PlaneGeometry(1e3,1e3,1,1,1),h),f.position.x=e,f.position.y=t,f.position.z=n,l.push(f);return l},t.prototype.addDebris=function(e,t,n,r,i,s){var o,u;return u=new THREE.Mesh(e.geometry,e.material),u.position.set(n,r,0),u.scale.set(t,t,t),u.speed=this.randomRange(.5,.9),o=new THREE.Object3D,o.speed=i,o.offset=s,o.obj=u,o.add(u),this.scene.add(o),o},t.prototype.addDebrisOutside=function(e,t){var n;return n=this.addDebris(e,t,this.randomRange(32,38),this.randomRange(0,70),this.randomRange(.5,.9),this.randomRange(0,Math.PI*2)),this.debrisOutside.push(n),n},t.prototype.addDebrisInside=function(e,t){var n;return n=this.addDebris(e,t,this.randomRange(8,10),this.randomRange(10,40),this.randomRange(.5,.9),this.randomRange(0,Math.PI*2)),this.debrisInside.push(n),n},t.prototype.addDebrisOrgan=function(e,t,n,r,i,s,o){var u;return u=this.addDebris(e,t,n,r,i,s),this.debrisInside.push(u),u.audio=new THREE.AudioObject(o),u.obj.add(u.audio),u},t.prototype.updateDebris=function(e,t){var n;e.position.set(this.TORNADO_POS.x,0,this.TORNADO_POS.z),e.rotation.y=e.speed*this.stormAnimTime+e.offset,e.front=this.normalizeAngle(e.rotation.y-t)<Math.PI,n=e.obj,n.rotation.x=n.speed*this.stormAnimTime*.39,n.rotation.y=n.speed*this.stormAnimTime*1.23,n.rotation.z=n.speed*this.stormAnimTime*.89},t.prototype.initDrops=function(){var e,t,n;this.texDrops[0]=THREE.ImageUtils.loadCompressedTexture("/models/textures/storm/drop1.dds",null,this.onTexLoaded),this.texDrops[1]=THREE.ImageUtils.loadCompressedTexture("/models/textures/storm/drop2.dds",null,this.onTexLoaded),this.texDrops[2]=THREE.ImageUtils.loadCompressedTexture("/models/textures/storm/drop3.dds",null,this.onTexLoaded),this.texDrops[3]=THREE.ImageUtils.loadCompressedTexture("/models/textures/storm/drop4.dds",null,this.onTexLoaded),this.texDrops[4]=THREE.ImageUtils.loadCompressedTexture("/models/textures/storm/drop5.dds",null,this.onTexLoaded);for(e=t=0,n=this.MAX_DROPS;t<=n;e=t+=1)this.drops[e]={active:!1,time:0,len:0,sprite:0,x:0,y:0}},t.prototype.addDrop=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;d=this.drops;for(h=0,p=d.length;h<p;h++){n=d[h];if(!n.active){a=this.SCENE_WIDTH/2048;switch(this.randomRangeInt(0,3)){case 0:l=0,c=0,t=0;break;case 1:l=this.SCENE_WIDTH,c=0,t=Math.PI/2;break;case 2:l=0,c=this.SCENE_HEIGHT,t=Math.PI*1.5;break;case 3:l=this.SCENE_WIDTH,c=this.SCENE_HEIGHT,t=Math.PI}r=t+this.randomRange(0,Math.PI/2),i=Math.cos(Math.random()*(Math.PI/2))*this.randomRange(0,this.SCENE_WIDTH*.35),o=Math.cos(r)*i,u=Math.sin(r)*i,s=a*this.randomRange(this.dropsScale*.75,this.dropsScale*1.25),f=this.randomRangeInt(0,this.texDrops.length-1),n.sprite=this.texDrops[f],n.w=n.sprite.image.width*s,n.h=n.sprite.image.height*s,n.x=l-n.w*.5+o,n.y=c-n.h*.5+u,n.down=this.randomRange(0,40)*a,n.time=e,n.len=this.randomRange(1.5,4),n.active=!0;return}}},t.prototype.drawDrops=function(e){var t,n,r,i,s,o,u,a,f,l,c;this.hudRT.flipy=!1,this.hudRT.renderTarget=this.sceneRT,c=this.drops;for(f=0,l=c.length;f<l;f++)n=c[f],n.active&&(s=e-n.time,s<n.len?(t=.1,s<t?r=UTILS.time01(s,0,t):r=UTILS.time10(s,t,n.len-t),u=n.x,a=n.y+UTILS.time01(e,n.time+.5,n.len-.5)*n.down,o=n.w,i=n.h,this.hudRT.render(n.sprite,u,a,o,i,0,r)):n.active=!1);this.hudRT.flipy=!0},t.prototype.initGUI=function(){var e,n=this;return t.__super__.initGUI.apply(this,arguments),e=this.gui.addFolder("Tornado"),e.add(this.tornadoMaterial.uniforms.tornado_bounding_radius,"value",10,200).name("Tornado Bounding Radius"),e.add(this.tornadoMaterial.uniforms.light_harshness,"value",0,2).name("Tornado Light Harshness"),e.add(this.tornadoMaterial.uniforms.light_darkness,"value",0,2).name("Tornado Light Darkness"),e.add(this.tornadoMaterial.uniforms.cloud_edge_sharpness,"value",0,2).name("Tornado Edge Sharpness"),e.addColor({value:"#FFFFFF"},"value").name("Tornado Tint").onChange(function(e){var t;return t=n.stringToColor(e),n.tornadoMaterial.uniforms.storm_tint.value.set(t.r,t.g,t.b)}),e.add(this.tornadoMaterial.uniforms.cam_fov,"value",20,180).name("Tornado Fov"),e.add(this.tornadoMaterial.uniforms.final_colour_scale,"value",0,20).name("Tornado Colour Scale"),e.add(this.tornadoMaterial.uniforms.gamma_correction,"value",0,5).name("Tornado Gamma correction"),e.add(this.tornadoMaterial.uniforms.environment_rotation,"value",0,1).name("Tornado Env Rotation"),e.add(this.tornadoMaterial.uniforms.storm_alpha_correction,"value",0,5).name("Tornado Alpha Correction"),e.add(this.tornadoMaterial.uniforms.tornado_density,"value",0,5).name("Tornado Density"),e.add(this.tornadoMaterial.uniforms.tornado_height,"value",10,200).name("Tornado Height"),e.add(this.tornadoMaterial.uniforms.spin_speed,"value",0,5).name("Tornado Spin Speed"),e.add(this.tornadoMaterial.uniforms.base_step_scaling,"value",0,5).name("Tornado Base Step"),e.add(this.tornadoMaterial.uniforms.min_step_size,"value",0,5).name("Tornado Min Step"),e.add(this.OPTIONS,"tornadoRotation",0,Math.PI*2).name("Tornado Rotation"),e.add(this.tornadoMaterial.uniforms.dist_approx,"value",0,5).name("Dist Approx")},t.prototype.onRestart=function(e){this.renderer.sortObjects=!0,this.mousePos={x:0,y:0},this.curPos={x:0,y:0},this.prevPos={x:0,y:0},this.animStarted=!0,this.animPaused=!1,this.stormAnimTime=0,this.stormState=0,this.dropsTime=0,this.balloon.anim.stop(),this.balloon.anim.play(!1,0),this.CAMERA_ORBIT_H=.7,this.CAMERA_ORBIT_V=.5;if(e)return this.pointLock()},t.prototype.activate=function(){Analytics.track("storm_enter_page","Google_OZ_Balloon Ride"),this.onRestart(!1)},t.prototype.pause=function(){t.__super__.pause.apply(this,arguments),SoundController.send("storm_scene_pause"),this.animStarted=!1,this.balloon.anim.timeScale=0},t.prototype.resume=function(){t.__super__.resume.apply(this,arguments),this.animPaused||SoundController.send("storm_scene_resume"),this.animStarted=!0},t.prototype.onWorldProgress=function(){var e;e=this.L_LOADSCENE*.5+this.L_LOADTEX*.5,t.__super__.onWorldProgress.call(this,e),this.textureLoaded&&this.sceneLoaded&&!this.loadingDone&&(this.loadingDone=!0,this.onWorldLoaded(),this.enableRender=!0,this.enableMouse=!0)},t.prototype.onTexLoaded=function(){return this.L_TEX++,this.L_LOADTEX=this.L_TEX/this.L_TEXNUM,this.textureLoaded=this.L_TEX===this.L_TEXNUM,this.onWorldProgress()},t.prototype.onSceneProgress=function(e,t){return this.L_LOADSCENE=e/t,this.onWorldProgress()},t.prototype.onSceneLoaded=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;this.iflscene=t,c=["balloon_simple","floor","earth_sky","oz_sky"],s=["Pipe","Pipe1","Pipe2","Pipe3","Pipe4","wood","wood1","wood2","wood3","wood4","wood5","wood6","wood7","wood8","wood9","Wingback","Wheelbarrow","WagonWheel","TrestleTable","Stool","Seat","RoundTable","FenceE","FenceD","Easel","Door","CrateB","CrateA","Bucket","BrokenWheel","BranchA","Bench","Barrel","ABoard"],r=["Pipe","Pipe1","Pipe2","Pipe3","Pipe4"],i=[],o=this.iflscene.getDescendants();for(p=0,g=o.length;p<g;p++){u=o[p];if(u.name==="foreground_dark_emitter")u.position.y-=55,this.fdclouds=this.addClouds(u,90,35,90,160,!1,"fd49"),this.fdclouds.mesh=u;else if(u.name!=="foreground_tornado_clouds_emitter"&&u.name!=="background_dark_emitter"&&u.name!=="background_light_clouds_emitter"&&u.name!=="background_tornado_clouds_emitter")if(w=u.name,__indexOf.call(c,w)>=0)u.name==="balloon_simple"&&(this.balloon=u),u.name==="floor"&&(this.earth_floor=u),u.name==="earth_sky"&&(this.earth_sky=u),u.name==="oz_sky"&&(this.oz_sky=u),u.position.set(u.position.x*this.SCENE_SCALE,u.position.y*this.SCENE_SCALE,u.position.z*this.SCENE_SCALE),u.scale.set(u.scale.x*this.SCENE_SCALE,u.scale.y*this.SCENE_SCALE,u.scale.z*this.SCENE_SCALE),this.scene.add(u);else if(E=u.name,__indexOf.call(s,E)>=0)i[u.name]=this.addDebrisOutside(u,this.SCENE_SCALE*1.3),this.addDebrisOutside(u,this.SCENE_SCALE*1.3)}this.farclouds=this.addCloudsFar(180,-14,80,80,1,60,25,"far43"),this.instanceAnimation(this.balloon),this.balloon.material.transparent=!0,this.oz().appView.debugMode&&(h=this.gui.addFolder("Scene Options"),h.add(this.OPTIONS,"overrideValues").name("Override Values"),h.add(this.OPTIONS,"envmapMul",0,10).name("Envmap Mul"),h.add(this.OPTIONS,"envmapMix",0,1).name("Envmap Mix"),h.add(this.OPTIONS,"envmapPow",0,5).name("Envmap Pow"),h.add(this.OPTIONS,"specmapMul",0,5).name("Specmap Mul"),h.add(this.OPTIONS,"specmapPow",0,2).name("Specmap Pow"),h.add(this.OPTIONS,"cubeX",-200,200).name("Cube X"),h.add(this.OPTIONS,"cubeY",-200,200).name("Cube Y"),h.add(this.OPTIONS,"cubeZ",-200,200).name("Cube Z"),h.add(this.OPTIONS,"dropsRatio",0,1).name("Drops Ratio"),h.add(this.OPTIONS,"dropsScale",0,2).name("Drops Scale"));for(a=d=0;d<=35;a=d+=1)f=this.randomRangeInt(0,s.length-1),l=i[s[f]].obj,this.addDebrisInside(l,this.SCENE_SCALE*1.3);this.debrisOrgan=[],this.debrisOrgan.push(this.addDebrisOrgan(i.Pipe.obj,this.SCENE_SCALE*1.5,11,20,.7,1,"storm_particle_1")),this.debrisOrgan.push(this.addDebrisOrgan(i.Pipe1.obj,this.SCENE_SCALE*1.5,11,20,.7,1,"storm_particle_2")),this.debrisOrgan.push(this.addDebrisOrgan(i.Pipe2.obj,this.SCENE_SCALE*1.5,8,30,.4,2,"storm_particle_3")),this.debrisOrgan.push(this.addDebrisOrgan(i.Pipe3.obj,this.SCENE_SCALE*1.5,10,40,.6,3,"storm_particle_4")),this.debrisOrgan.push(this.addDebrisOrgan(i.Pipe4.obj,this.SCENE_SCALE*1.5,12,50,.5,4,"storm_particle_5")),S=this.fdclouds;for(v=0,y=S.length;v<y;v++)n=S[v],this.scene.add(n);x=this.farclouds;for(m=0,b=x.length;m<b;m++)n=x[m],this.scene.add(n);return this.sceneLoaded=!0,this.onWorldProgress(),SoundController.send("load_scene_4")},t.prototype.instanceAnimation=function(e){var t,n;if(((n=e.geometry)!=null?n.animation:void 0)!=null)return THREE.AnimationHandler.add(e.geometry.animation),t=new THREE.Animation(e,e.geometry.animation.name),t.JITCompile=!1,t.interpolationType=THREE.AnimationHandler.LINEAR,this.balloon.anim=t},t.prototype.instanceMaterial=function(e,t){var n;return t==="balloon_simple"?n=this.instanceFresnelMaterial(e,t,"Balloon"):t==="floor"?n=this.instanceBasicMaterial(e,t,"earth_floor"+this.Q_STR+".dds"):t==="earth_sky"?n=this.instanceBasicMaterial(e,t,"earth_sky"+this.Q_STR+".dds"):t==="oz_sky"?n=this.instanceBasicMaterial(e,t,"oz_sky"+this.Q_STR+".dds"):t==="wood9"?n=this.instanceFresnelMaterial(e,t,"Wood9"):t==="wood8"?n=this.instanceFresnelMaterial(e,t,"Wood8"):t==="wood7"?n=this.instanceFresnelMaterial(e,t,"Wood7"):t==="wood6"?n=this.instanceFresnelMaterial(e,t,"Wood6"):t==="wood5"?n=this.instanceFresnelMaterial(e,t,"Wood5"):t==="wood4"?n=this.instanceFresnelMaterial(e,t,"Wood4"):t==="wood3"?n=this.instanceFresnelMaterial(e,t,"Wood3"):t==="wood2"?n=this.instanceFresnelMaterial(e,t,"Wood2"):t==="wood1"?n=this.instanceFresnelMaterial(e,t,"Wood1"):t==="wood"?n=this.instanceFresnelMaterial(e,t,"Wood0"):t==="Wingback"?n=this.instanceFresnelMaterial(e,t,"Wingback"):t==="Wheelbarrow"?n=this.instanceFresnelMaterial(e,t,"Wheelbarrow"):t==="WagonWheel"?n=this.instanceFresnelMaterial(e,t,"WagonWheel"):t==="TrestleTable"?n=this.instanceFresnelMaterial(e,t,"TrestleTable"):t==="Stool"?n=this.instanceFresnelMaterial(e,t,"Stool"):t==="Seat"?n=this.instanceFresnelMaterial(e,t,"Seat"):t==="RoundTable"?n=this.instanceFresnelMaterial(e,t,"RoundTable"):t==="Pipe4"?n=this.instanceFresnelMaterial(e,t,"Pipe4"):t==="Pipe3"?n=this.instanceFresnelMaterial(e,t,"Pipe3"):t==="Pipe2"?n=this.instanceFresnelMaterial(e,t,"Pipe2"):t==="Pipe1"?n=this.instanceFresnelMaterial(e,t,"Pipe1"):t==="Pipe"?n=this.instanceFresnelMaterial(e,t,"Pipe0"):t==="FenceE"?n=this.instanceFresnelMaterial(e,t,"FenceE"):t==="FenceD"?n=this.instanceFresnelMaterial(e,t,"FenceD"):t==="Easel"?n=this.instanceFresnelMaterial(e,t,"Easel"):t==="Door"?n=this.instanceFresnelMaterial(e,t,"Door"):t==="CrateB"?n=this.instanceFresnelMaterial(e,t,"CrateB"):t==="CrateA"?n=this.instanceFresnelMaterial(e,t,"CrateA"):t==="Bucket"?n=this.instanceFresnelMaterial(e,t,"Bucket"):t==="BrokenWheel"?n=this.instanceFresnelMaterial(e,t,"BrokenWheel"):t==="BranchA"?n=this.instanceFresnelMaterial(e,t,"BranchA"):t==="Bench"?n=this.instanceFresnelMaterial(e,t,"Bench"):t==="Barrel"?n=this.instanceFresnelMaterial(e,t,"Barrel"):t==="ABoard"?n=this.instanceFresnelMaterial(e,t,"ABoard"):t==="foreground_dark_emitter"?(n=new THREE.MeshNormalMaterial,n.side=THREE.DoubleSide,n.transparent=!0,n.opacity=1,n.depthTest=!1):t==="foreground_tornado_clouds_emitter"?(n=new THREE.MeshNormalMaterial,n.side=THREE.DoubleSide,n.transparent=!0,n.opacity=1,n.depthTest=!1):t==="background_dark_emitter"?(n=new THREE.MeshNormalMaterial,n.side=THREE.DoubleSide,n.transparent=!0,n.opacity=1,n.depthTest=!1):t==="background_light_clouds_emitter"?(n=new THREE.MeshNormalMaterial,n.side=THREE.DoubleSide,n.transparent=!0,n.opacity=1,n.depthTest=!1):t==="background_tornado_clouds_emitter"?(n=new THREE.MeshNormalMaterial,n.side=THREE.DoubleSide,n.transparent=!0,n.opacity=1,n.depthTest=!1):(console.log("Material not found for: "+t),n=new THREE.MeshNormalMaterial),n},t.prototype.instanceFresnelMaterial=function(e,t,n){var r,i,s,o,u;return s="/models/textures/storm/"+n+"/"+n,o=new IFLStormFresnelShader,i={fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:o.uniforms,side:THREE.DoubleSide,lights:!1,alphaTest:.4},r=new THREE.ShaderMaterial(i),u=o.uniforms,u.fresnelPower.value=1,u.map.value=r.map=THREE.ImageUtils.loadCompressedTexture(s+"_Diff"+this.Q_STR+".dds",null,this.onTexLoaded),u.envMap.value=r.envMap=this.tornadoEnvMap,u.specMap.value=r.specMap=this.tornadoSpecMap,u.map.value.flipY=!1,u.envMap.value.flipY=!1,r},t.prototype.instanceBasicMaterial=function(e,t,n){var r,i,s;return s="/models/textures/storm/"+n,r=THREE.ImageUtils.loadCompressedTexture(s,null,this.onTexLoaded),r.flipY=!1,i=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:r}),i},t.prototype.renderScene=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,J,K,Q,G,Y,Z,et,tt,nt;this.curPos.x=UTILS.lerp(.09,this.curPos.x,this.mousePos.x),this.curPos.y=UTILS.lerp(.19,this.curPos.y,this.mousePos.y),m=f=l=p=c=0,this.animPaused?(m=this.stormAnimTime,this.balloon.anim.timeScale=0,this.stormControls.movementSpeed=this.stormControls.mouseDragOn?0:8,this.stormControls.lookSpeed=this.stormControls.mouseDragOn?.08:0,this.stormControls.update(this.delta),this.audioListener.position.set(this.camera.position.x,this.camera.position.y,this.camera.position.z)):(o=this.curPos.x,o<0?c=UTILS.lerp(-o,1,this.SPEED_MIN):c=UTILS.lerp(o,1,this.SPEED_MAX),c=UTILS.clamp(c,this.SPEED_MIN,this.SPEED_MAX),c=this.animPaused||!this.animStarted?0:c*.75,this.stormAnimTime=this.balloon.anim.currentTime,this.balloon.anim.timeScale=c,m=this.stormAnimTime,d=m*this.CAMERA_DATA_FPS,f=UTILS.clamp(Math.floor(d),0,this.cameraPosData.length-2),l=f+1,p=d-f,h=this.cameraLerp(this.camSrc,p,this.cameraPosData[f],this.cameraPosData[l]),v=this.cameraLerp(this.camTgt,p,this.cameraTgtData[f],this.cameraTgtData[l]),e=this.curPos.x*this.CAMERA_ORBIT_H,t=this.curPos.y*this.CAMERA_ORBIT_V,this.camdir.set(h.x-v.x,h.y-v.y,h.z-v.z),this.camv.set(this.camdir.x,this.camdir.y,this.camdir.z),this.camv.normalize(),this.camu.set(this.camera.up.x,this.camera.up.y,this.camera.up.z),this.camr.set(this.camera.up.x,this.camera.up.y,this.camera.up.z),this.camr.crossSelf(this.camv),this.matRotX.makeRotationAxis(this.camr,t),this.matRotX.multiplyVector3(this.camdir),this.matRotX.makeRotationAxis(this.camu,e),this.matRotX.multiplyVector3(this.camdir),this.camera.position.set(this.camdir.x+v.x,this.camdir.y+v.y,this.camdir.z+v.z),this.audioListener.position.set(this.camera.position.x,this.camera.position.y,this.camera.position.z),this.camdir.normalize(),this.camu.set(0,-1,0),this.camu.crossSelf(this.camdir),i=this.curPos.x*10*5/12,v.set(v.x+this.camu.x*i,v.y+this.camu.y*i,v.z+this.camu.z*i),this.camdir.set(v.x,v.y,v.z),this.camera.lookAt(this.camdir),n=Math.atan2(this.camdir.z-this.camera.position.z,this.camdir.x-this.camera.position.x)-Math.PI/2);switch(this.stormState){case 0:this.stormAnimTime>0&&(SoundController.send("storm_start"),this.stormState=1);break;case 1:this.stormAnimTime>this.TIME_ENTER_TORNADO&&(SoundController.send("storm_inside"),this.stormState=2);break;case 2:this.stormAnimTime>this.TIME_END-8&&(SoundController.send("storm_exit"),this.stormState=3)}this.renderer.setClearColorHex(0,1),this.renderer.clear(),this.renderer.setClearColorHex(0,0),this.renderer.clearTarget(this.sceneRT,!0,!0,!1),this.renderer.setClearColorHex(0,0),this.renderer.clearTarget(this.tornadoRT,!0,!1,!1),this.godrays.enabled&&this.renderer.clearTarget(this.godrays.rtTextureColors,!0,!0,!1),this.updateObjects(m,n),this.hudRT.flipy=!0,this.hudRT.renderTarget=this.sceneRT,m<this.TIME_END&&(this.matTranslate.makeTranslation(this.TORNADO_POS.x,this.TORNADO_POS.y,this.TORNADO_POS.z),this.matRotX.makeRotationX(-Math.PI/2),this.matTranslate.multiplySelf(this.matRotX),this.matRotY.makeRotationZ(this.OPTIONS.tornadoRotation),this.matTranslate.multiplySelf(this.matRotY),this.matInverse.getInverse(this.matTranslate),this.matTornado.multiply(this.matInverse,this.camera.matrix),this.tornadoMaterial.uniforms.time.value=this.animPaused?0:this.clock.elapsedTime,this.tornadoMaterial.uniforms.camera_matrix.value=this.matTornado,this.tornadoMaterial.uniforms.resolution.value.set(this.tornadoW,this.tornadoH),this.hudRT.renderTarget=this.tornadoRT,this.hudRT.renderMaterial(this.tornadoMaterial,0,0,this.tornadoW+1,this.tornadoH+1,0,1),this.hudRT.renderTarget=this.sceneRT),this.earth_floor.visible=m<this.TIME_ENTER_TORNADO,this.earth_sky.visible=m<this.TIME_ENTER_TORNADO,this.oz_sky.visible=m>=this.TIME_ENTER_TORNADO,this.balloon.visible=!1,q=this.fdclouds;for(g=0,E=q.length;g<E;g++)r=q[g],r.visible=!1;R=this.farclouds;for(y=0,S=R.length;y<S;y++)r=R[y],r.visible=m<this.TIME_ENTER_TORNADO;X=this.debrisOutside;for(b=0,C=X.length;b<C;b++)s=X[b],s.obj.visible=!s.front&&m<this.TIME_ENTER_TORNADO;V=this.debrisInside;for(w=0,k=V.length;w<k;w++)s=V[w],s.obj.visible=!1;this.godrays.enabled?this.renderer.render(this.scene,this.camera,this.godrays.rtTextureColors):this.renderer.render(this.scene,this.camera,this.sceneRT),m<this.TIME_END&&(u=UTILS.time10(m,this.TIME_END-5,5),this.sal2xMaterial.uniforms.tDiffuse.value=this.tornadoRT,this.sal2xMaterial.uniforms.resolution.value.set(this.SCENE_WIDTH,this.SCENE_HEIGHT),this.sal2xMaterial.uniforms.opacity.value=u,this.tornadoFilter?this.hudRT.renderMaterial(this.sal2xMaterial,0,0,this.SCENE_WIDTH,this.SCENE_HEIGHT,0,u,THREE.NormalBlending,{x:0,y:0,w:this.tornadoW/this.SCENE_WIDTH,h:this.tornadoH/this.SCENE_HEIGHT}):this.hudRT.render(this.tornadoRT,0,0,this.SCENE_WIDTH,this.SCENE_HEIGHT,0,u,THREE.NormalBlending,{x:0,y:0,w:this.tornadoW/this.SCENE_WIDTH,h:this.tornadoH/this.SCENE_HEIGHT})),this.earth_floor.visible=!1,this.earth_sky.visible=!1,this.oz_sky.visible=!1,this.balloon.visible=!1,this.balloon.visible=!0,(m<18||m>30)&&this.scene.add(this.lensFlare),J=this.debrisOutside;for(P=0,L=J.length;P<L;P++)s=J[P],s.obj.visible=s.front&&m<this.TIME_ENTER_TORNADO;if(m>this.TIME_ENTER_TORNADO){K=this.debrisInside;for(H=0,A=K.length;H<A;H++)s=K[H],s.obj.visible=!0}Q=this.fdclouds;for(B=0,O=Q.length;B<O;B++)r=Q[B],r.visible=m<this.TIME_ENTER_TORNADO;G=this.farclouds;for(j=0,M=G.length;j<M;j++)r=G[j],r.visible=!1;this.godrays.enabled?this.renderer.render(this.scene,this.camera,this.godrays.rtTextureColors):this.renderer.render(this.scene,this.camera,this.sceneRT),this.scene.remove(this.lensFlare);if(this.godrays.enabled){Y=this.lensFlare.lensFlares;for(F=0,_=Y.length;F<_;F++)a=Y[F],a.visible=!1;Z=this.ftclouds;for(I=0,D=Z.length;I<D;I++)r=Z[I],r.visible=!1;U=this.farclouds;for(et=0,x=U.length;et<x;et++)r=U[et],r.visible=!1;z=this.debrisOutside;for(tt=0,T=z.length;tt<T;tt++)s=z[tt],s.obj.visible=!1;W=this.debrisInside;for(nt=0,N=W.length;nt<N;nt++)s=W[nt],s.obj.visible=!1;this.renderGodraysDepth(),this.renderGodRays()}m>this.TIME_ENTER_TORNADO-1&&m<this.TIME_ENTER_TORNADO+2&&(u=1,m<this.TIME_ENTER_TORNADO?u=UTILS.time01(m,this.TIME_ENTER_TORNADO-1,1):m>this.TIME_ENTER_TORNADO+1&&(u=UTILS.time10(m,this.TIME_ENTER_TORNADO+1,1)),this.hudRT.render(this.tornadoRT,0,0,this.SCENE_WIDTH,this.SCENE_HEIGHT,0,u,THREE.NormalBlending,{x:0,y:0,w:this.tornadoW/this.SCENE_WIDTH,h:this.tornadoH/this.SCENE_HEIGHT})),this.drawDrops(this.clock.elapsedTime),this.hud.flipy=!0,this.sceneRT&&(this.colorCorrection.material.uniforms.tDiffuse.value=this.sceneRT,this.colorCorrection.material.map=this.sceneRT,this.hud.renderTarget=null,this.hud.renderMaterial(this.colorCorrection.material,0,0,this.APP_WIDTH,this.APP_HEIGHT,0,1)),m>this.TIME_END-2&&(this.hud.renderTarget=null,this.hud.render(this.texWhite,0,0,this.APP_WIDTH,this.APP_HEIGHT,0,UTILS.time01(m,this.TIME_END-2,2))),m>this.TIME_END&&(Analytics.track("storm_end"),SoundController.send("storm_end"),$("body").unbind("click"),document.removeEventListener("mouseup",this.onMouseUp,!1),document.removeEventListener("mousedown",this.onMouseDown,!1),document.removeEventListener("click",this.onMouseClick,!1),this.releasePointLock(),this.enableRender=!1,this.oz().router.navigateTo("final")),this.renderer.sortObjects=!1;if(this.capturer)return this.capturer.capture(this.oz().appView.renderCanvas3D)},t.prototype.updateObjects=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;l=this.TIME_ENTER_TORNADO,a=this.TIME_END,this.OPTIONS.overrideValues?(this.balloon.material.uniforms.envmapMul.value=this.OPTIONS.envmapMul,this.balloon.material.uniforms.envmapMix.value=this.OPTIONS.envmapMix,this.balloon.material.uniforms.envmapPow.value=this.OPTIONS.envmapPow,this.balloon.material.uniforms.specmapMul.value=this.OPTIONS.specmapMul,this.balloon.material.uniforms.specmapPow.value=this.OPTIONS.specmaPow,this.balloon.material.uniforms.cubeX.value=this.OPTIONS.cubeX,this.balloon.material.uniforms.cubeY.value=this.OPTIONS.cubeY,this.balloon.material.uniforms.cubeZ.value=this.OPTIONS.cubeZ):(s=this.animateParam(10,.5,e,l-8,l-1),s=this.animateParam(s,10,e,l+2,a-5),this.balloon.material.uniforms.envmapMul.value=s,i=this.animateParam(.76,.8,e,l-8,l-1),i=this.animateParam(i,.6,e,l+2,a-5),this.balloon.material.uniforms.envmapMix.value=i,this.balloon.material.uniforms.envmapPow.value=.57,this.balloon.material.uniforms.specmapMul.value=.57,this.balloon.material.uniforms.specmapPow.value=.1,this.balloon.material.uniforms.cubeX.value=this.animateParam(-126,-25,e,l-2,l+2),this.balloon.material.uniforms.cubeY.value=this.animateParam(107,200,e,l-2,l+2),this.balloon.material.uniforms.cubeZ.value=this.animateParam(51,200,e,l-2,l+2),this.OPTIONS.envmapMul=this.balloon.material.uniforms.envmapMul.value,this.OPTIONS.envmapMix=this.balloon.material.uniforms.envmapMix.value,this.OPTIONS.envmapPow=this.balloon.material.uniforms.envmapPow.value,this.OPTIONS.specmapMul=this.balloon.material.uniforms.specmapMul.value,this.OPTIONS.specmaPow=this.balloon.material.uniforms.specmapPow.value,this.OPTIONS.cubeX=this.balloon.material.uniforms.cubeX.value,this.OPTIONS.cubeY=this.balloon.material.uniforms.cubeY.value,this.OPTIONS.cubeZ=this.balloon.material.uniforms.cubeZ.value),e<this.TIME_ENTER_TORNADO?(f=l-5,n=this.animateParam(0,-2,e,f,f+4),u=(e-f)*n,this.earth_sky.rotation.y=u,this.earth_floor.rotation.y=u):(this.earth_sky.rotation.y=0,this.earth_floor.rotation.y=0),this.earth_sky.position.y=-200,this.earth_floor.scale.set(200,200,120),v=this.debrisOutside;for(c=0,p=v.length;c<p;c++)r=v[c],this.updateDebris(r,t);m=this.debrisInside;for(h=0,d=m.length;h<d;h++)r=m[h],this.updateDebris(r,t);e<this.TIME_ENTER_TORNADO?this.lensFlare.position.set(-150,120,-300):this.lensFlare.position.set(7,90,-30),this.OPTIONS.overrideValues?(this.dropsRatio=this.OPTIONS.dropsRatio,this.dropsScale=this.OPTIONS.dropsScale):(o=this.animateParam(1,.045,e,l-10,l-7),o=this.animateParam(o,.02,e,l+1,l+3),this.dropsRatio=o,this.dropsScale=.7),e=this.clock.elapsedTime;if(e>0&&e>this.dropsTime)return this.addDrop(e),this.dropsTime=e+this.randomRange(this.dropsRatio*.75,this.dropsRatio*1.25)},t.prototype.renderGodraysDepth=function(){return this.renderer.clearTarget(this.godrays.rtTextureDepth,!1,!1,!1),this.renderer.render(this.scene,this.camera,this.godrays.rtTextureDepth)},t.prototype.renderGodRays=function(){var e,t,n,r,i;return i=new THREE.Vector3,this.projector.projectVector(i,this.camera),i.x=(i.x+1)/2,i.y=(i.y+1)/2,this.godrays.godrayGenUniforms.vSunPositionScreenSpace.value.x=.5,this.godrays.godrayGenUniforms.vSunPositionScreenSpace.value.y=.5,t=1,e=6,n=1,r=t*Math.pow(e,-n),this.godrays.godrayGenUniforms.fStepSize.value=r,this.godrays.godrayGenUniforms.tInput.value=this.godrays.rtTextureDepth,this.godrays.scene.overrideMaterial=this.godrays.materialGodraysGenerate,this.renderer.render(this.godrays.scene,this.godrays.camera,this.godrays.rtTextureGodRays2),n=2,r=t*Math.pow(e,-n),this.godrays.godrayGenUniforms.fStepSize.value=r,this.godrays.godrayGenUniforms.tInput.value=this.godrays.rtTextureGodRays2,this.renderer.render(this.godrays.scene,this.godrays.camera,this.godrays.rtTextureGodRays1),n=3,r=t*Math.pow(e,-n),this.godrays.godrayGenUniforms.fStepSize.value=r,this.godrays.godrayGenUniforms.tInput.value=this.godrays.rtTextureGodRays1,this.renderer.render(this.godrays.scene,this.godrays.camera,this.godrays.rtTextureGodRays2),this.godrays.godrayCombineUniforms.tColors.value=this.godrays.rtTextureColors,this.godrays.godrayCombineUniforms.tColors2.value=this.tornadoRT,this.godrays.godrayCombineUniforms.tGodRays.value=this.godrays.rtTextureGodRays2,this.godrays.scene.overrideMaterial=this.godrays.materialGodraysCombine,this.renderer.render(this.godrays.scene,this.godrays.camera),this.godrays.scene.overrideMaterial=null},t.prototype.onResize=function(){var e,n,r;return t.__super__.onResize.apply(this,arguments),this.initQuality(),(r=this.stormControls)!=null&&r.handleResize(),e={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,depthBuffer:!0},n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,depthBuffer:!1},this.sceneRT=new THREE.WebGLRenderTarget(this.SCENE_WIDTH,this.SCENE_HEIGHT,e),this.tornadoRT=new THREE.WebGLRenderTarget(this.SCENE_WIDTH,this.SCENE_HEIGHT,n)},t.prototype.onEnterFrame=function(){if(!this.enableRender)return;return t.__super__.onEnterFrame.call(this,!0),this.fpsAcc++,this.clock.elapsedTime-this.timeFps>1&&(this.fpsCount++,this.fpsCur=this.fpsAcc/(this.clock.elapsedTime-this.timeFps),this.fpsAcc=0,this.timeFps=this.clock.elapsedTime,this.fpsCount>0&&(this.fpsCur<20&&(this.tornadoSamples=Math.min(this.tornadoSamples+1,this.MAX_SAMPLES)),this.fpsCur>25&&(this.tornadoSamples=Math.max(this.tornadoSamples-1,this.MIN_SAMPLES)),this.tornadoW=this.SCENE_WIDTH/this.tornadoSamples,this.tornadoH=this.SCENE_HEIGHT/this.tornadoSamples)),this.renderScene()},t.prototype.dispose=function(){},t.prototype.cameraLerp=function(e,t,n,r){return e.x=UTILS.lerp(t,n[0],r[0])*this.SCENE_SCALE,e.y=UTILS.lerp(t,n[1],r[1])*this.SCENE_SCALE,e.z=UTILS.lerp(t,n[2],r[2])*this.SCENE_SCALE,e},t.prototype.initCameraData=function(){return this.audioListener=new THREE.AudioListenerObject(this.camera),this.scene.add(this.audioListener),this.camdir=new THREE.Vector3,this.camv=new THREE.Vector3,this.camu=new THREE.Vector3,this.camr=new THREE.Vector3,this.camSrc=new THREE.Vector3,this.camTgt=new THREE.Vector3,this.cameraPosData=[[-1206.71076716,-93.7893524735,-126.831423857],[-1206.24263494,-93.7123166071,-126.732381616],[-1204.84091075,-93.4817583003,-126.435966033],[-1203.44316794,-93.2520187065,-126.140610652],[-1202.04937145,-93.0230911468,-125.846307159],[-1200.66134996,-92.7949169713,-125.553455693],[-1199.27054167,-92.5657336087,-125.260266993],[-1197.88798735,-92.3373535471,-124.969071442],[-1196.51365091,-92.1097702128,-124.679861963],[-1195.14749627,-91.882977079,-124.392632054],[-1193.78110512,-91.6555964463,-124.105614476],[-1192.41992091,-91.4285203869,-123.819958428],[-1191.06686157,-91.2022260792,-123.536280326],[-1189.72189043,-90.976707101,-123.254575847],[-1188.3796441,-90.7510879923,-122.973725408],[-1187.03945591,-90.5252614416,-122.693596564],[-1185.70729669,-90.3002020015,-122.415446146],[-1184.38312911,-90.0759033546,-122.139271988],[-1183.06441229,-89.8519518456,-121.864549681],[-1181.74483207,-89.6273213728,-121.589969701],[-1180.43318178,-89.4034437079,-121.317377115],[-1179.12942341,-89.1803126382,-121.046771873],[-1177.83351881,-88.9579219963,-120.77815447],[-1176.53421843,-88.7344474088,-120.509194029],[-1175.2426707,-88.5116995215,-120.242222692],[-1173.95891164,-88.2896843735,-119.97725806],[-1172.6829023,-88.0683959017,-119.714302681],[-1171.40570899,-87.8463894746,-119.451515597],[-1170.133841,-87.624720492,-119.190261473],[-1168.86965461,-87.4037707393,-118.931041474],[-1167.61310997,-87.1835342579,-118.673860142],[-1166.35731752,-86.962900332,-118.417307187],[-1165.10468869,-86.7422605373,-118.161897873],[-1163.85963016,-86.5223268145,-117.908557907],[-1162.62210106,-86.3030933089,-117.657293744],[-1161.3869718,-86.0837357287,-117.407064422],[-1160.15312217,-85.864076595,-117.15765805],[-1158.92672691,-85.6451107305,-116.910363728],[-1157.70774399,-85.4268323854,-116.665189735],[-1156.49250708,-85.2086545584,-116.42140106],[-1155.27695562,-84.989928783,-116.178184955],[-1154.06873745,-84.7718838351,-115.937130705],[-1152.86780926,-84.5545140692,-115.698248307],[-1151.6716588,-84.3374190307,-115.461043332],[-1150.47390145,-84.119580572,-115.224232426],[-1149.28335064,-83.9024108647,-114.989639837],[-1148.09996166,-83.6859043683,-114.757277154],[-1146.92205463,-83.4697948516,-114.526823228],[-1145.74156217,-83.2527989668,-114.296658189],[-1144.56814326,-83.0364601287,-114.068774057],[-1143.40175162,-82.8207729015,-113.843183868],[-1142.24120568,-82.605551414,-113.619670596],[-1141.0774214,-82.3893546991,-113.396415626],[-1139.92057083,-82.1738037028,-113.175509672],[-1138.77060592,-81.9588930942,-112.956967048],[-1137.62649696,-81.7444619997,-112.740603897],[-1136.47883417,-81.5290224304,-112.524544174],[-1135.33795767,-81.3142176338,-112.310906387],[-1134.20381749,-81.1000423843,-112.099705927],[-1133.07517704,-80.8863039909,-111.890719449],[-1131.9430163,-80.6715809651,-111.68215816],[-1130.81748613,-80.4574821541,-111.476095715],[-1129.69853444,-80.2440024379,-111.27254836],[-1128.58434691,-80.030859093,-111.071178972],[-1127.46703308,-79.8168134748
,-110.870433887],[-1126.35618502,-79.6033819071,-110.672267597],[-1125.25174827,-79.3905593761,-110.476696942],[-1124.15094797,-79.1779135676,-110.283195221],[-1123.04778703,-78.9645077318,-110.090594741],[-1121.95091711,-78.7517061824,-109.900654967],[-1120.86028116,-78.5395040111,-109.713393035],[-1119.7717491,-78.3272584752,-109.528015443],[-1118.68200476,-78.114456354,-109.343894071],[-1117.59836581,-77.9022491605,-109.162516032],[-1116.5207724,-77.6906320928,-108.983898417],[-1115.4433329,-77.478689928,-108.806902403],[-1114.3662229,-77.2664570578,-108.631595548],[-1113.29502083,-77.0548101681,-108.459113947],[-1112.22966373,-76.8437445633,-108.289474257],[-1111.16208082,-76.6320093524,-108.121112638],[-1110.09677305,-76.4203129215,-107.954950675],[-1109.03716282,-76.2091939412,-107.791693553],[-1107.98318382,-75.9986478223,-107.631357055],[-1106.92415734,-75.7870237599,-107.471871591],[-1105.86976556,-75.5758326567,-107.315173064],[-1104.82084691,-75.3652108973,-107.16145478],[-1103.77522,-75.1548272468,-107.010317679],[-1102.72549287,-74.9435460263,-106.860345185],[-1101.68107222,-74.7328308882,-106.713409055],[-1100.64188502,-74.5226774154,-106.569522267],[-1099.60227784,-74.3122206474,-106.427609754],[-1098.56176542,-74.1013951783,-106.287607357],[-1097.52630747,-73.8911284401,-106.150704148],[-1096.4958267,-73.6814161221,-106.016910657],[-1095.46073805,-73.4707925624,-105.884392567],[-1094.42838067,-73.2603966866,-105.754602991],[-1093.40080809,-73.0505526288,-105.627964672],[-1092.37570246,-72.8409133533,-105.50405283],[-1091.34578553,-72.6303733157,-105.38148664],[-1090.32045032,-72.4203827641,-105.262105549],[-1089.29961105,-72.2109375605,-105.145913987],[-1088.2760964,-72.0009511456,-105.031552981],[-1087.25229366,-71.790800228,-104.91950542],[-1086.23276825,-71.5811926675,-104.810668645],[-1085.216775,-71.3720247681,-104.704917102],[-1084.19376368,-71.1617005227,-104.600249025],[-1083.17479858,-70.9519179226,-104.498801683],[-1082.15978409,-70.7426730019,-104.40057058],[-1081.14216438,-70.532981072,-104.304318981],[-1080.12296666,-70.3230116938,-104.210258441],[-1079.10747033,-70.1135786317,-104.119406073],[-1078.09467084,-69.9045413442,-104.031579446],[-1077.07440545,-69.6943744226,-103.94485993],[-1076.05757758,-69.4847427402,-103.861324614],[-1075.04407998,-69.2756425019,-103.780956476],[-1074.02610768,-69.0659087501,-103.702283996],[-1073.00705236,-68.8560689742,-103.625952028],[-1071.991042,-68.6467599198,-103.552738295],[-1070.97491617,-68.4375196459,-103.48204433],[-1069.9526877,-68.2274633376,-103.412742427],[-1068.93320136,-68.0179373199,-103.346487992],[-1067.916336,-67.8089379658,-103.283246847],[-1066.8911117,-67.5988343227,-103.220953864],[-1065.86713078,-67.3890842592,-103.161392539],[-1064.84544209,-67.179860786,-103.104739759],[-1063.81876103,-66.9709357719,-103.049645737],[-1062.78916678,-66.7634747814,-102.996504091],[-1061.76148738,-66.5582033668,-102.946185136],[-1060.73171679,-66.3545280991,-102.897915208],[-1059.69532097,-66.1517796304,-102.850824245],[-1058.66046441,-65.9511803895,-102.806386804],[-1057.62595746,-65.7525584839,-102.764340955],[-1056.58153672,-65.5543961879,-102.722753479],[-1055.53825304,-65.3583430463,-102.683612727],[-1054.49594926,-65.1643820844,-102.646834997],[-1053.4435259,-64.9708774255,-102.61032981],[-1052.39047979,-64.7792454114,-102.575778289],[-1051.33797071,-64.5896658308,-102.543324461],[-1050.27672807,-64.4007793127,-102.511206709],[-1049.21248829,-64.2134445795,-102.480397206],[-1048.14830758,-64.0281228067,-102.451369038],[-1047.07627669,-63.8436609536,-102.422599495],[-1045.99930299,-63.6605007999,-102.394525452],[-1044.92187032,-63.4793144047,-102.367858193],[-1043.83695748,-63.2990847197,-102.341223894],[-1042.74558456,-63.1199776064,-102.31469689],[-1041.6531883,-62.9428053174,-102.289135651],[-1040.55315686,-62.766616377,-102.263225248],[-1039.44557431,-62.5914419406,-102.236848961],[-1038.33634992,-62.4181636578,-102.210921353],[-1037.21879743,-62.2458252069,-102.184096495],[-1036.09302454,-62.0744642699,-102.156236418],[-1034.96492734,-61.9049610738,-102.128220662],[-1033.82725647,-61.7362841214,-102.098582548],[-1032.68111032,-61.5686186991,-102.06733055],[-1031.53188084,-61.4027728557,-102.035218076],[-1030.37126234,-61.2375697702,-102.000568132],[-1029.20231695,-61.0734830729,-101.963700709],[-1028.02943655,-60.9111780351,-101.925151996],[-1026.84276136,-60.7492626388,-101.882945307],[-1025.648295,-60.5886390703,-101.837874064],[-1024.44892838,-60.4297594745,-101.790166135],[-1023.23274545,-60.2709471377,-101.737455919],[-1022.00967202,-60.1136722885,-101.681168394],[-1020.77942726,-59.9579368408,-101.62093032],[-1019.53102668,-59.8022116783,-101.554502822],[-1018.27580543,-59.6481723139,-101.483491257],[-1017.00917583,-59.4952134126,-101.406726649],[-1015.72593943,-59.342648737,-101.322921973],[-1014.43445497,-59.1917327802,-101.233096869],[-1013.12659904,-59.0413702171,-101.135421181],[-1011.80394268,-58.8918549025,-101.029705064],[-1010.47134344,-58.7439514095,-100.916289447],[-1009.11661756,-58.5960068653,-100.792592297],[-1007.74908214,-58.4494309071,-100.659659208],[-1006.36671965,-58.3040277208,-100.516579073],[-1004.96127458,-58.1587271579,-100.361363458],[-1003.54225323,-58.0149816356,-100.194985888],[-1002.10098801,-57.8716806259,-100.015326801],[-1000.6388187,-57.7291390811,-99.8219156953],[-999.16017529,-57.5881161138,-99.6147556433],[-997.660227315,-57.4467442992,-99.3983179938],[-996.161182938,-57.3068547766,-99.1821079338],[-994.657429438,-57.1676401172,-98.9652234154],[-993.14718712,-57.0288340308,-98.7474028563],[-991.638101476,-56.891490484,-98.5299354202],[-990.118066403,-56.7538982546,-98.3108595926],[-988.598006807,-56.6175691907,-98.091997792],[-987.073675235,-56.4818928086,-97.8726799497],[-985.542747547,-56.3465295474,-97.6525556438],[-984.013194401,-56.2125731151,-97.4329454476],[-982.472152226,-56.0782185295,-97.2117901653],[-980.931923438,-55.9451604112,-96.9911060455],[-979.386035419,-55.8124841615,-96.7698718152],[-977.835222746,-55.6802769393,-96.548231524],[-976.284200895,-55.5491755472,-96.3269623081],[-974.72289325,-55.4177723695,-96.1044797107],[-973.16323888,-55.2877011253,-95.8827083217],[-971.59472893,-55.1574974651,-95.6600021156],[-970.024751147,-55.0281646711,-95.4375541383],[-968.450519691,-54.8993002943,-95.214945428],[-966.87030529,-54.7706488361,-94.9919278408],[-965.290055794,-54.6430112352,-94.7694532246],[-963.699690874,-54.514992342,-94.5459709901],[-962.111233546,-54.3882230095,-94.3233732267],[-960.512695164,-54.2610504202,-94.0998224293],[-958.914254203,-54.1348499462,-93.8769137957],[-957.309106965,-54.0086794294,-93.653619644],[-955.700770146,-53.8830037615,-93.4305017588],[-954.088718097,-53.7577368473,-93.2074995551],[-952.470575563,-53.6325423277,-92.984273528],[-950.851324761,-53.5080812545,-92.7615992321],[-949.223469464,-53.3833245806,-92.5383659406],[-947.596728799,-53.25957231,-92.3160565382],[-945.95925689,-53.1352104892,-92.0929168719],[-944.324090101,-53.0119833731,-91.8709144219],[-942.67775005,-52.8880610166,-91.6480657935],[-941.033144963,-52.765166049,-91.4263046162],[-939.378769378,-52.6417380696,-91.2039542825],[-937.724829636,-52.5191325007,-90.9825355678],[-936.062144526,-52.3961044367,-90.7607264892],[-934.398977912,-52.2737456186,-90.5397520802],[-932.727715299,-52.1510237128,-90.3185295668],[-931.055433938,-52.0288690278,-90.0981021032],[-929.375332529,-51.9063602104,-89.8775140671],[-927.694053056,-51.7843669913,-89.6577371134],[-926.004858897,-51.6619788554,-89.4378343075],[-924.314702594,-51.5401042987,-89.2188124664],[-922.616169697,-51.4177450663,-88.99964871],[-920.917262596,-51.2959461367,-88.7814877241],[-919.209153557,-51.1735246157,-88.5631201172],[-917.501626514,-51.0517579424,-88.3459269604],[-915.783713103,-50.9291834732,-88.1284160876],[-914.067217918,-50.8073415723,-87.912233049],[-912.339765574,-50.6845876271,-87.6957091726],[-910.612973472,-50.5624335801,-87.4804491448],[-908.877243394,-50.4396028848,-87.2651771796],[-907.139952038,-50.3170472848,-87.0509108335],[-905.396094691,-50.1940946493,-86.8370034246],[-903.648113063,-50.0710483675,-86.6238056159],[-901.896283773,-49.9479276713,-86.4113769793],[-900.137432686,-49.8243017449,-86.199326926],[-898.377791568,-49.7009657747,-85.9884929188],[-896.607904156,-49.576671279,-85.7776743794],[-894.837885515,-49.4527169117,-85.5682035416],[-893.059538221,-49.3280194579,-85.3590540358],[-891.278092553,-49.2032402894,-85.1509210624],[-889.49236349,-49.0782070451,-84.943678688],[-887.699358652,-48.9525139617,-84.7369803241],[-885.905522763,-48.8269758857,-84.531656456],[-884.101744862,-48.700396061,-84.3266064858],[-882.296017626,-48.5737876543,-84.1228461069],[-880.485331327,-48.4467419832,-83.9200324446],[-878.667619611,-48.3189728735,-83.7179470007],[-876.848433757,-48.1911744527,-83.5172868518],[-875.020444199,-48.062382651,-83.3172064849],[-873.189008889,-47.933265271,-83.1183761292],[-871.354627707,-47.8038640986,-82.920881448],[-869.510893766,-47.6733347017,-82.7240096934],[-867.665111864,-47.5425913613,-82.5286425029],[-865.814264533,-47.411223499,-82.3344629068],[-863.955996993,-47.2789057991,-82.1412409745],[-862.095325642,-47.1462557705,-81.9495789872],[-860.228570973,-47.0127772444,-81.759099414],[-858.355283532,-46.8783870467,-81.5697943092],[-856.479272322,-46.7435451829,-81.382120958],[-854.597222151,-46.6078005407,-81.1957571256],[-852.708531218,-46.4710480749,-81.0106847938],[-850.816840524,-46.3337231712,-80.8273377183],[-848.92017484,-46.1955432833,-80.6455510887],[-847.015825332,-46.0561313868,-80.4650957677],[-845.108257648,-45.9160242647,-80.2864909484],[-843.197332303,-45.775169751,-80.1097757264],[-841.27767078,-45.6328459115,-79.9344718002],[-839.35423268,-45.4896472022,-79.7611539722],[-837.427344166,-45.3455748362,-79.5899318235],[-835.495235381,-45.2003596975,-79.4207237044],[-833.556282487,-45.0537472919,-79.2534873355],[-831.61082835,-44.906132405,-79.08604644],[-829.6556822,-44.7574620666,-78.9158563898],[-827.688883949,-44.6074393145,-78.7428253015],[-825.709883915,-44.455946432,-78.5669981037],[-823.721238721,-44.3032624855,-78.3887002494],[-821.722887894,-44.1493315271,-78.2080131557],[-819.714395368,-43.9940487363,-78.0249851877],[-817.69280492,-43.8369847243,-77.8394495369],[-815.661560442,-43.6785302779,-77.6517956404],[-813.620607766,-43.5186270741,-77.4621032572],[-811.569895204,-43.3572161891,-77.2704518626],[-809.508939772,-43.1941820399,-77.0768854492],[-807.435683568,-43.0292039698,-76.8813239831],[-805.352732442,-42.8625625291,-76.6840630465],[-803.260042917,-42.6941956169,-76.4851795298],[-801.157574535,-42.5240403399,-76.2847497647],[-799.045289964,-42.3520329748,-76.0828494565],[-796.922925792,-42.1780789723,-75.8795367904],[-794.788883228,-42.0019072539,-75.6747738961],[-792.645109265,-41.8237087935,-75.4687808795],[-790.491575247,-41.6434156301,-75.2616291714],[-788.328255713,-41.4609587616,-75.0533891597],[-786.155128404,-41.2762681071,-74.8441300921],[-783.972174256,-41.089272468,-74.633919975],[-781.779377369,-40.8998994912,-74.4228254676],[-779.576724967,-40.7080756318,-74.2109117718],[-777.363773109,-40.5136677908,-73.9982157898],[-775.140457374,-40.3165914717,-73.7847977082],[-772.907394771,-40.1168525672,-73.5707561849],[-770.664578286,-39.9143717703,-73.3561485644],[-768.412003418,-39.7090684093,-73.1410301565],[-766.149668048,-39.5008604225,-72.9254541109],[-763.877572295,-39.2896643367,-72.709471291],[-761.595718356,-39.0753952489,-72.4931301463],[-759.304110334,-38.8579668116,-72.276476585],[-757.002754058,-38.6372912224,-72.0595538471],[-754.691656889,-38.4132792179,-71.8424023774],[-752.370827518,-38.1858400727,-71.6250597015],[-750.040275755,-37.9548816032,-71.4075603032],[-747.700012317,-37.7203101773,-71.1899355046],[-745.350048603,-37.4820307296,-70.9722133511],[-742.990396469,-37.2399467832,-70.7544184991],[-740.621067998,-36.9939604776,-70.5365721101],[-738.242075279,-36.7439726037,-70.3186917499],[-735.853430169,-36.4898826452,-70.1007912947],[-733.455144073,-36.2315888282,-69.8828808438],[-731.047227721,-35.9689881774,-69.6649666411],[-728.629690951,-35.7019765802,-69.4470510043],[-726.202542497,-35.4304488587,-69.2291322638],[-723.765789793,-35.1542988492,-69.0112047115],[-721.319372365,-34.8734091782,-68.7932564105],[-718.863000847,-34.5876405549,-68.5752644523],[-716.396715229,-34.2990498013,-68.3572278728],[-713.920275902,-34.0090933578,-68.139180127],[-711.433675624,-33.7177492693,-67.9211700532],[-708.936906846,-33.4249951495,-67.7032458528],[-706.42996171,-33.1308081635,-67.48545508],[-703.912832032,-32.8351650094,-67.2678446309],[-701.385509298,-32.5380418993,-67.0504607321],[-698.847984646,-32.2394145409,-66.8333489286],[-696.299594677,-31.9391576228,-66.6165392122],[-693.740933629,-31.6373389294,-66.4000907419],[-691.172022791,-31.3339373537,-66.1840477332],[-688.592852384,-31.0289264844,-65.9684529394],[-686.003412201,-30.7222793052,-65.7533483636],[-683.403691588,-30.4139681737,-65.538775244],[-680.793155568,-30.1038851569,-65.3247651236],[-678.171994111,-29.7920322723,-65.1113623835],[-675.540502279,-29.4784266436,-64.8986114287],[-672.898668025,-29.1630379977,-64.6865503285],[-670.246478726,-28.8458353255,-64.4752163065],[-667.583427637,-28.5267123764,-64.2646396202],[-664.909537484,-28.2056424082,-64.0548575286],[-662.225239138,-27.8826593655,-63.8459105542],[-659.530517999,-27.5577291478,-63.637832391],[-656.825213791,-27.2307950342,-63.4306545327],[-654.108573197,-26.9017106533,-63.2244033964],[-651.381452885,-26.5705706163,-63.0191182349],[-648.643835691,-26.2373373434,-62.8148288985],[-645.895432305,-25.9019317191,-62.6115628163],[-643.135675619,-25.5642323822,-62.4093461286],[-640.365359464,-25.2243206888,-62.2082105188],[-637.584463384,-24.8821551786,-62.0081816623],[-634.792149022,-24.537571429,-61.8092826921],[-631.988886815,-24.1905995965,-61.611539585],[-629.174974128,-23.8412429471,-61.4149754948],[-626.349839206,-23.489374147,-61.2196119621],[-623.513373819,-23.134934073,-61.0254704147],[-620.666180259,-22.7779685181,-60.8325696806],[-617.806310048,-22.417788011,-60.6434554073],[-614.932228193,-22.0537568502,-60.4606939206],[-612.04464498,-21.6859238793,-60.284331039],[-609.142863032,-21.3141274043,-60.1144164353],[-606.227144162,-20.938348079,-59.9509944283],[-603.298019226,-20.5586061166,-59.7941050708],[-600.354119554,-20.1776448966,-59.6443342063],[-597.395610822,-19.8051102235,-59.5034517736],[-594.422178538,-19.4414465212,-59.3716172504],[-591.433528236,-19.0863402771,-59.2488571017],[-588.430548538,-18.7396500859,-59.1351866338],[-585.412170052,-18.4009361006,-59.0306399577],[-582.379503485,-18.0700805777,-58.9352286001],[-579.332010187,-17.7467135126,-58.8489806373],[-576.269953968,-17.4305807985,-58.7719145127],[-573.193528856,-17.1214134913,-58.7040479347],[-570.102378621,-16.8188551451,-58.6454044565],[-566.997212755,-16.5227062614,-58.5959917209],[-563.87726231,-16.232539325,-58.5558359403],[-560.743554478,-15.9481954276,-58.5249355644],[-557.59509515,-15.6692045203,-58.5033165499],[-554.433051088,-15.3954221765,-58.4909694309],[-551.256370604,-15.1263616294,-58.4879167022],[-548.066201704,-14.8618695662,-58.4941425042],[-544.861582543,-14.6014656073,-58.5096625377],[-541.643503965,-14.3449669245,-58.5344561662],[-538.411221094,-14.0919199198,-58.5685289928],[-535.165449188,-13.8420943676,-58.6118571754],[-531.905767063,-13.5950811263,-58.6644330887],[-528.632515981,-13.3505874543,-58.7262310836],[-525.345684674,-13.1082636019,-58.7972274766],[-522.045162003,-12.8677419842,-58.877395926],[-518.731412267,-12.6287444078,-58.9666942736],[-515.403813459,-12.3908189473,-59.0650962196],[-512.063096002,-12.153727509,-59.1725441898],[-508.708851778,-11.9170496296,-59.2889972985],[-505.341285952,-11.6804621373,-59.4143972136],[-501.960596709,-11.4436408756,-59.5486800105],[-498.566315138,-11.2061531384,-59.6917890142],[-495.158980259,-10.9677304729,-59.8436417418],[-491.738373481,-10.7279816819,-60.0041644188],[-488.304409579,-10.486537945,-60.1732742981],[-484.859429216,-10.2430877668,-60.351532612],[-481.405320706,-9.997231718,-60.5394791374],[-477.942274284,-9.74862864045,-60.7369709579],[-474.470542572,-9.49694862187,-60.9438577859],[-470.990022505,-9.24180203463,-61.1599896725],[-467.500905048,-8.98284971594,-61.385204824],[-464.003405209,-8.71975797471,-61.61933479],[-460.497508143,-8.4521546863,-61.862208889],[-456.983307715,-8.17968764272,-62.1136481086],[-453.461034532,-7.90203034611,-62.3734648924],[-449.930769227,-7.61883202907,-62.6414680189],[-446.392478904,-7.32972350282,-62.9174617285],[-442.846428597,-7.03439094606,-63.2012394651],[-439.182104949,-6.71236834689,-63.494123876],[-435.29769042,-6.34415227563,-63.7969999962],[-431.205465172,-5.9306658983,-64.1089705517],[-426.916671398,-5.47261511051,-64.4290919598],[-422.441621808,-4.97050990457,-64.7563712532],[-417.789793958,-4.42468301429,-65.0897636328],[-412.969962322,-3.83531594819,-65.4281702622],[-407.990220144,-3.20244438037,-65.7704377301],[-402.858146925,-2.5259919746,-66.1153570162],[-397.580823996,-1.80558772112,-66.4616922426],[-392.16469609,-1.04133715026,-66.8083048917],[-386.615685039,-0.234033549569,-67.1540866062],[-380.939294726,.61541496422,-67.4979245874],[-375.140630238,1.50598533268,-67.8387056858],[-369.22441628,2.43653957459,-68.1753206825],[-363.195015941,3.40582653064,-68.5066686923],[-357.056450002,4.41248518247,-68.8316616342],[-350.813024142,5.45491777706,-69.1492373233],[-344.467822529,6.53162505504,-69.4583460676],[-338.023924667,7.64095735086,-69.7579666011],[-331.485445003,8.78089771553,-70.0471360276],[-324.85407309,9.94983332611,-70.3248855669],[-318.133489557,11.145603469,-70.5903351139],[-311.32535677,12.366394398,-70.8426054912],[-304.432997722,13.6099472149,-71.0809168871],[-297.457403586,14.8744504497,-71.3044738049],[-290.402355946,16.1574331251,-71.5126338086],[-283.268110414,17.4571617526,-71.7046881253],[-276.057765715,18.7712652264,-71.8800963529],[-268.772548,20.0977756058,-72.0383059518],[-261.413679365,21.4347321023,-72.1788201128],[-253.984317637,22.7797865448,-72.3013009941],[-246.484102485,24.1313662263,-72.4052925175],[-238.915877612,25.4872680535,-72.4905642353],[-231.280517277,26.8457520432,-72.5568374833],[-223.578725956,28.2051654613,-72.6038720038],[-215.813638749,29.5634360203,-72.6316358427],[-207.984011849,30.9194291163,-72.6398628588],[-200.09375565,32.2710739123,-72.6286797072],[-192.14150298,33.6173954034,-72.5978923227],[-184.130500084,34.9566180296,-72.5476788101],[-176.059932748,36.2878032451,-72.4779550558],[-167.93285369,37.6093839876,-72.3889720599],[-159.747843031,38.920670565,-72.2806575341],[-151.509104596,40.2200662435,-72.1534348943],[-143.214264776,41.5071809126,-72.0072030055],[-134.866770647,42.7807099023,-71.8423875998],[-126.466496048,44.0400183264,-71.6591297873],[-118.013262097,45.2845309033,-71.4575809999],[-109.510430325,46.5131911032,-71.2382497175],[-100.957299375,47.7256336643,-71.0012838795],[-92.3540708003,48.9213995877,-70.7469305047],[-83.7016777674,50.0999742495,-70.4755263571],[-74.994174221,51.2586200832,-70.270230398],[-66.213489454,52.3903317906,-70.3879166211],[-57.3723608592,53.4942869816,-70.8426892282],[-48.4849075652,54.570346533,-71.6289943484],[-39.5644738659,55.6185569214,-72.7405984545],[-30.6238927748,56.6390926809,-74.1707607383],[-21.6739579465,57.6323980329,-75.9126096866],[-12.7252610654,58.5989546014,-77.9591810539],[-3.78766235052,59.5393274543,-80.3035862562],[5.12906842745,60.4540904864,-82.9389793704],[14.0168151901,61.3439672403,-85.8590444067],[22.8675603787,62.2096682639,-89.0577683235],[31.6735193514,63.0519035857,-92.5295138325],[40.4269260861,63.8713642256,-96.2689855822],[49.120726335,64.6687794003,-100.271555458],[57.7478646692,65.4448548703,-104.533078913],[66.3011103,66.200263047,-109.049847081],[74.7731743052,66.9356563236,-113.81867327],[83.1567136457,67.6516705337,-118.836954496],[91.4439161579,68.3489000667,-124.102492105],[99.6268630387,69.0279287968,-129.613751908],[107.69694862,69.6892966151,-135.369570646],[115.643957548,70.3301360596,-141.370691164],[123.457860304,70.9476207659,-147.618986643],[131.127108401,71.5421772557,-154.114030253],[138.639996512,72.1142548416,-160.856370909],[145.983532975,72.6642666104,-167.846755838],[153.281543234,73.1924767276,-175.155448287],[160.418698427,73.6993231896,-182.740369397],[167.37342754,74.185126781,-190.603388182],[174.121484321,74.65016445,-198.745274266],[180.637968634,75.0947836772,-207.168211894],[186.892615328,75.5191833122,-215.869505106],[192.853574445,75.9236148319,-224.845776937],[198.486057067,76.3083233193,-234.090489941],[203.75146351,76.6735081087,-243.590649089],[208.607400726,77.0193083142,-253.322774114],[213.0082724,77.3457765739,-263.246207668],[216.950933825,77.6552542332,-273.440722125],[220.415415629,77.9498546967,-284.01456164],[223.32651064,78.2292769659,-294.940094902],[225.609094953,78.4934579972,-306.180639163],[227.190972037,78.7425986654,-317.68970537],[227.983176887,79.0288619702,-329.407862868],[227.922503805,79.4495870956,-341.263248319],[227.032712668,79.9988378987,-353.184912973],[225.346732934,80.6668264636,-365.114655354],[222.901124438,81.4432589103,-377.002430196],[219.733459298,82.3177863001,-388.804680769],[215.878194922,83.2807263589,-400.487622534],[211.367469176,84.3228537641,-412.019997434],[206.23048715,85.4354881888,-423.372730748],[200.491175878,86.6108668401,-434.520979246],[194.170747622,87.8416581349,-445.438822985],[187.287399605,89.1209909945,-456.099619144],[179.856194924,90.4424420426,-466.475762688],[171.889822804,91.79987549,-476.537484853],[163.399620711,93.1872485014,-486.251730166],[154.395480908,94.5985920022,-495.582143741],[144.887390902,96.0277401936,-504.487713308],[134.886019187,97.4682149088,-512.922426482],[124.402099943,98.9132741978,-520.835516281],[113.451820931,100.355133668,-528.168625348],[102.052845497,101.785513512,-534.858368246],[90.2320217741,103.194630079,-540.833656195],[78.0213487255,104.571794182,-546.018672053],[65.4675099598,105.904379718,-550.332289108],[52.6283483486,107.178535781,-553.692724512],[39.5776789782,108.379027976,-556.021418085],[26.4063249508,109.489736103,-557.24983893],[13.218123097,110.49479344,-557.327273915],[.127067563253,111.379664362,-556.228701572],[-12.7525560395,112.132732218,-553.959914793],[-25.3165941401,112.74651651,-550.557696917],[-37.4739425592,113.217995672,-546.088836568],[-49.1607011171,113.548983351,-540.637452292],[-60.3355650842,113.74502416,-534.298012074],[-71.1022783193,113.871364132,-527.272913019],[-81.6101709413,114.024557171,-519.778807805],[-91.8181976611,114.21179424,-511.80535857],[-101.675399071,114.440105432,-503.345004337],[-111.124265729,114.71760608,-494.394987993],[-120.100842542,115.053653499,-484.957853084],[-128.535700362,115.459111094,-475.040119252],[-136.353079931,115.946627056,-464.653142923],[-143.468497556,116.530712513,-453.818255952],[-149.787657945,117.229513893,-442.566543805],[-155.207972699,118.062997378,-430.945192983],[-159.623356467,119.051472406,-419.017544384],[-162.924934955,120.215080167,-406.879359025],[-165.011920934,121.57288691,-394.651053168],[-165.803518498,123.139657619,-382.48300236],[-165.255294156,124.922371353,-370.549317345],[-163.375421207,126.916624756,-359.034867061],[-160.232706655,129.105301626,-348.111680956],[-155.950826011,131.460198045,-337.915221325],[-150.690096427,133.946136618,-328.529602729],[-144.621923745,136.526704548,-319.984532519],[-137.913717958,139.166595651,-312.268672801],[-130.706920611,141.837308774,-305.337650033],[-123.120890873,144.515002314,-299.133683693],[-115.258823957,147.178620642,-293.595610879],[-107.193515196,149.814812851,-288.659839355],[-98.9911742249,152.410642772,-284.269655769],[-90.703505763,154.956578397,-280.37316479],[-82.3826985248,157.442039928,-276.924576199],[-74.0638963155,159.861270845,-273.882394696],[-65.7813287616,162.20726002,-271.205873456],[-57.5884148235,164.463689627,-268.866825158],[-49.5144506194,166.62799344,-266.889326609],[-41.613862623,168.691230518,-265.298431285],[-33.9519537823,170.642010062,-264.113676364],[-26.5805801583,172.474273548,-263.352190008],[-19.5869570679,174.171138633,-263.012033923],[-13.0511048639,175.717724609,-263.072576984],[-7.04873770348,177.098625635,-263.483617692],[-1.65563266448,178.293292201,-264.144320485],[3.08807882835,179.284679079,-264.907334169],[7.3644582779,180.136838459,-265.805989239],[11.3482189065,180.923507704,-266.975570247],[15.0238115503,181.64447333,-268.378830078],[18.3885098614,182.30156097,-269.97290679],[21.4521556542,182.898768663,-271.714327408],[24.2342435392,183.44188275,-273.563653951],[26.7582976077,183.949292081,-275.482111164],[29.0503763628,184.438800071,-277.437214765],[31.1371090154,184.916347609,-279.410972141],[33.0420607566,185.38675388,-281.3882134],[34.7852028666,185.854463883,-283.359932584],[36.3831525574,186.322823471,-285.318123102],[37.8495430898,186.794455918,-287.256581995],[39.19545376,187.271363281,-289.170339505],[40.4298581269,187.755021545,-291.055215698],[41.5600441696,188.246464098,-292.907494451],[42.5923159783,188.746166685,-294.722726201],[43.5316186788,189.254504324,-296.497755662],[44.3820198528,189.771629198,-298.229651346],[45.1474938854,190.297205615,-299.914179138],[45.8308435067,190.831079424,-301.548953791],[46.4347990982,191.372781563,-303.130825769],[46.9619928532,191.921608633,-304.656281718],[47.4141868906,192.477054346,-306.123272498],[47.7932390352,193.038355687,-307.529127963],[48.1339764308,193.604671976,-308.88719652],[48.4705967805,194.17510578,-310.213825632],[48.8036091858,194.748760091,-311.511027479],[49.1333041118,195.324720315,-312.780731882],[49.4598773313,195.902011545,-314.02461762],[49.783401166,196.479631763,-315.244230228],[50.103849345,197.056554631,-316.440985117],[50.4211018971,197.631741021,-317.616200248],[50.7349704105,198.204137493,-318.771086391],[51.0452358323,198.772665111,-319.906713057],[51.3516474063,199.33622851,-321.024039531],[51.653934376,199.893716578,-322.123919414],[51.9518147074,200.444003693,-323.20710738],[52.2447623137,200.986102802,-324.274661315],[52.5326317352,201.518781338,-325.326921149],[52.8151413623,202.040882733,-326.36438761],[53.0918160784,202.551376295,-327.387816552],[53.3623068777,203.049154683,-328.397707443],[53.6265359937,203.532928957,-329.394089518],[53.8838848507,204.001786587,-330.377822861],[54.1342227608,204.454489209,-331.34896511],[54.3773785439,204.889829577,-332.307622675],[54.6126646656,205.306987721,-333.25468977],[54.8403948479,205.704419902,-334.189488053],[55.0595901956,206.081553602,-335.113330365],[55.2707179035,206.436735704,-336.02528527],[55.4728327654,206.769401895,-336.926580981],[55.6663461306,207.077939225,-337.816356261],[55.8502588313,207.361856072,-338.695884445],[56.0250773316,207.619453263,-339.564135209],[56.189664274,207.850373198,-340.42254397],[56.3444659879,208.052947091,-341.270131342],[56.4917785734,208.239716319,-342.105565807],[56.6348733605,208.423296044,-342.926482446],[56.7739881528,208.603517647,-343.73284438],[56.9086057556,208.780888909,-344.525733501],[57.0394671364,208.954802845,-345.30435763],[57.166275519,209.125583871,-346.069463322],[57.2890304111,209.293300963,-346.821352743],[57.4081949455,209.45759159,-347.559642117],[57.5234549033,209.618824164,-348.285091468],[57.6349224982,209.776975081,-348.997828766],[57.7429834683,209.9317542,-349.697579277],[57.8474966387,210.083383409,-350.384839407],[57.9483016968,210.232116421,-351.060129358],[58.0458980336,210.377551358,-351.723002603],[58.140346486,210.519719792,-352.373652565],[58.2312962375,210.659082248,-353.012869502],[58.3191000092,210.795384056,-353.640415357],[58.4039670428,210.928512269,-354.256259878],[58.4859623032,211.058503889,-354.860580551],[58.5648031484,211.185771457,-355.454056556],[58.6407861,211.310114609,-356.03652336],[58.7141145554,211.431427161,-356.607949819],[58.7848552757,211.549749598,-357.168500492],[58.8530327644,211.665170344,-357.718398353],[58.9183966031,211.778088311,-358.258260962],[58.9813897459,211.888130387,-358.787700188],[59.0420787194,211.995339007,-359.306869962],[59.100529848,212.099756896,-359.815921635],[59.1568091454,212.201426989,-360.315004102],[59.2107677564,212.300641877,-360.804573229],[59.2625820334,212.39731945,-361.284612566],[59.312432262,212.491368605,-361.755097268],[59.3603818137,212.582832518,-362.216168154],[59.4064933148,212.671754276,-362.667964052],[59.4508285717,212.758176827,-363.110621889],[59.4934485041,212.842142937,-363.544276765],[59.5341807977,212.92397731,-363.969396336],[59.5733119157,213.003448949,-364.385784692],[59.6109142782,213.08058196,-364.793551005],[59.6470443445,213.155418074,-365.192824269],[59.6817574336,213.227998664,-365.583731957],[59.7151076849,213.298364713,-365.966400076],[59.7471480231,213.366556788,-366.340953224],[59.7779301259,213.432615019,-366.707514631],[59.8075017133,213.496582464,-367.066210074],[59.8357518109,213.55870125,-367.417390246],[59.862898229,213.618796151,-367.760930177],[59.8889871783,213.676905469,-368.096948447],[59.9140635277,213.733066981,-368.425562473],[59.9381707934,213.787317927,-368.746888547],[59.9613511297,213.839695003,-369.061041867],[59.983645323,213.890234348,-369.368136573],[60.0050927881,213.938971536,-369.668285783],[60.0257315667,213.985941573,-369.961601619],[60.0455983286,214.031178886,-370.24819524],[60.0647283741,214.074717321,-370.528176874],[60.0831556391,214.116590142,-370.801655841],[60.1009127017,214.156830021,-371.068740583],[60.1180307906,214.195469046,-371.329538689],[60.1344901076,214.232604392,-371.584228269],[60.1503423615,214.268236709,-371.832882041],[60.1656456594,214.302355536,-372.075560874],[60.1804258097,214.334990714,-372.312369394],[60.1947073383,214.3661715,-372.543411487],[60.2085135049,214.395926562,-372.768790325],[60.2218663189,214.424283989,-372.988608387],[60.2347865578,214.451271291,-373.202967482],[60.2472937851,214.476915402,-373.411968769],[60.25940637,214.501242686,-373.615712777],[60.2711415064,214.524278942,-373.814299428],[60.2825152338,214.546049407,-374.007828055],[60.2935424581,214.566578764,-374.196397424],[60.3042369722,214.585891143,-374.38010575],[60.3146114782,214.604010133,-374.55905072],[60.3246776092,214.620958783,-374.733329508],[60.3344459509,214.636759613,-374.903038795],[60.3439260647,214.651434615,-375.06827479],[60.3531265092,214.665005265,-375.229133242],[60.3620548636,214.677492527,-375.385709464],[60.3707177494,214.688916861,-375.538098345],[60.3791208535,214.699298231,-375.686394369],[60.3872689507,214.70865611,-375.830691636],[60.3951659255,214.717009491,-375.97108387],[60.4028147949,214.72437689,-376.107664443],[60.41021773,214.730776359,-376.240526387],[60.4173760782,214.73622549,-376.369762412],[60.4242903847,214.740741423,-376.49546492],[60.4309604134,214.744340855,-376.61772602],[60.4373851684,214.747040049,-376.736637546],[60.4435629142,214.748854838,-376.852291068],[60.449491196,214.749800638,-376.96477791],[60.4551668599,214.749892452,-377.074189161],[60.4605860715,214.749144879,-377.180615692],[60.4657443356,214.747572122,-377.284148167],[60.4706365138,214.745187999,-377.38487706],[60.4752568431,214.742005945,-377.482892665],[60.4795989525,214.738039026,-377.57828511],[60.4836558802,214.733299942,-377.671144371],[60.4874200895,214.727801039,-377.761560282],[60.4908834843,214.721554315,-377.849622549],[60.4940374239,214.714571426,-377.935420763],[60.496872737,214.706863699,-378.019044406],[60.4993797353,214.698442134,-378.100582869],[60.5015482262,214.689317416,-378.180125459],[60.5033675246,214.679499923,-378.257761411],[60.5047901174,214.668870465,-378.333580502],[60.5053305644,214.65575427,-378.407678728],[60.5048271116,214.639630875,-378.480144542],[60.5032621442,214.620495542,-378.551063761],[60.5006171013,214.59834324,-378.620522228],[60.4968724711,214.573168665,-378.688605813],[60.4920077838,214.544966247,-378.755400402],[60.4860016041,214.513730168,-378.820991894],[60.4788315226,214.479454373,-378.885466194],[60.4704741464,214.442132585,-378.948909207],[60.4609050878,214.40175832,-379.011406827],[60.450098953,214.358324902,-379.073044933],[60.4380293286,214.311825477,-379.133909376],[60.424668768,214.262253032,-379.194085969],[60.4099887757,214.209600408,-379.253660479],[60.3939540313,214.153867919,-379.312726881],[60.3765020562,214.095090114,-379.371416523],[60.3576381644,214.033210526,-379.429761735],[60.3373295167,213.968221551,-379.487847922],[60.3155421301,213.90011553,-379.545760369],[60.292240856,213.828884771,-379.603584225],[60.2673893561,213.754521566,-379.661404483],[60.2409500775,213.677018216,-379.719305964],[60.2128842269,213.59636705,-379.777373288],[60.1831517427,213.512560449,-379.835690858
],[60.1517112667,213.425590867,-379.89434283],[60.1185201143,213.335450859,-379.953413087],[60.0835342435,213.242133104,-380.012985215],[60.0467082223,213.145630429,-380.073142465],[60.007995196,213.045935841,-380.133967728],[59.967346852,212.943042551,-380.195543497],[59.9247133848,212.836944002,-380.257951831],[59.8800434587,212.727633905,-380.321274317],[59.8332841705,212.615106265,-380.385592028],[59.7843810107,212.499355413,-380.45098548],[59.7332778234,212.380376046,-380.517534587],[59.6799167665,212.258163255,-380.585318607],[59.6242382694,212.132712566,-380.654416098],[59.5661809914,212.004019973,-380.724904857],[59.5056817789,211.872081986,-380.796861864],[59.4426756215,211.736895662,-380.870363221],[59.3770956087,211.598458653,-380.945484089],[59.3088728852,211.45676925,-381.022298618],[59.2379366065,211.311826427,-381.100879873],[59.1642138941,211.16362989,-381.181299764],[59.087629791,211.012180126,-381.263628962],[59.0081072172,210.857478456,-381.347936817],[58.9255669255,210.699527086,-381.434291267],[58.8399274578,210.538329164,-381.522758752],[58.7513021784,210.373888277,-381.610856197],[58.6598309344,210.206209044,-381.696051948],[58.5654596223,210.035309729,-381.778352372],[58.4681115088,209.861236228,-381.857794535],[58.3677789927,209.683946437,-381.93431431],[58.264412621,209.503450391,-382.007905894],[58.1579612949,209.319759521,-382.078564029],[58.0483722609,209.132886735,-382.146284027],[57.9355911031,208.942846489,-382.211061798],[57.8195617391,208.749654872,-382.272893872],[57.7002264183,208.553329693,-382.331777431],[57.5775257233,208.353890563,-382.387710335],[57.4513985747,208.151358989,-382.440691152],[57.3217822392,207.945758468,-382.490719191],[57.1886123422,207.737114583,-382.537794531],[57.0518228836,207.525455105,-382.581918052],[56.9113462589,207.310810097,-382.623091474],[56.7671132849,207.093212021,-382.661317386],[56.6190532304,206.872695854,-382.696599286],[56.4670938527,206.649299198,-382.728941614],[56.3111614401,206.423062403,-382.758349791],[56.1511808605,206.194028688,-382.78483026],[55.9870756175,205.962244271,-382.80839052],[55.8193562843,205.727495495,-382.829104957],[55.6485400443,205.489552312,-382.847052859],[55.4745582555,205.24844025,-382.862250543],[55.2973408903,205.004187027,-382.874715219],[55.116816601,204.756822654,-382.884465023],[54.9329127931,204.506379557,-382.891519051],[54.7455557081,204.252892694,-382.895897397],[54.5546705153,203.996399676,-382.897621185],[54.3601814144,203.736940896,-382.896712612],[54.1620117487,203.474559657,-382.893194982],[53.9600841301,203.209302311,-382.887092745],[53.7543205769,202.941218391,-382.878431539],[53.5446426645,202.670360756,-382.867238226],[53.3309716914,202.396785733,-382.853540938],[53.1132288591,202.120553268,-382.837369113],[52.8913350164,201.841726369,-382.818753958],[52.6652057971,201.560363536,-382.797733087],[52.4347612681,201.276533778,-382.774341765],[52.1999240806,200.990313177,-382.748615053],[51.9606179527,200.701782217,-382.720589537],[51.7167679637,200.411025941,-382.690303362],[51.4683008714,200.11813411,-382.657796282],[51.2151454536,199.823201366,-382.623109696],[50.957232875,199.526327384,-382.586286698],[50.6944970809,199.227617028,-382.547372112],[50.4268712575,198.927185288,-382.506418238],[50.1542779228,198.625169923,-382.463499804],[49.876685016,198.321664437,-382.418633957],[49.5940421208,198.016795899,-382.371872841],[49.3063040083,197.710697263,-382.323270528],[49.0134312146,197.403507475,-382.272883053],[48.7153906518,197.095371578,-382.220768446],[48.4121562526,196.786440794,-382.166986762],[48.1037096512,196.476872591,-382.111600106],[47.7900408983,196.166830735,-382.054672662],[47.4711492112,195.856485311,-381.996270712],[47.1470437583,195.546012729,-381.936462651],[46.8177444775,195.235595695,-381.875318999],[46.4832829261,194.925423154,-381.812912412],[46.1437031621,194.615690197,-381.74931768],[45.7990626526,194.306597938,-381.684611723],[45.4494332081,193.998353337,-381.618873582],[45.0949019376,193.691168994,-381.552184397],[44.7355722204,193.385262885,-381.484627382],[44.3715646896,193.080858049,-381.416287788],[44.0030182207,192.778182228,-381.347252857],[43.6300909176,192.47746744,-381.277611767],[43.2529610884,192.178949501,-381.20745556],[42.8718282018,191.882867481,-381.136877065],[42.4869138123,191.589463096,-381.065970806],[42.0984624435,191.298980039,-380.994832889],[41.7067424177,191.011663241,-380.923560885],[41.3120466155,190.727758069,-380.852253688],[40.9146931538,190.447509463,-380.781011365],[40.5150259633,190.17116101,-380.70993498],[40.1134152518,189.898953958,-380.639126412],[39.7102578355,189.631126184,-380.568688144],[39.3010321278,189.373831094,-380.505844925],[38.8811376041,189.133359668,-380.457972991],[38.450898106,188.910167248,-380.425393033],[38.010671465,188.7047284,-380.408412323],[37.560763874,188.517641109,-380.407446922],[37.1015433992,188.349491881,-380.422856877],[36.6335714882,188.200695337,-380.454755454],[36.1573425175,188.0718099,-380.503382234],[35.6733848805,187.963416767,-380.568955494],[35.1822607591,187.876121225,-380.651670225],[34.6843345911,187.810847828,-380.752028323],[34.1802197407,187.768285748,-380.870193685],[33.6707844605,187.748868834,-381.005981284],[33.1567077861,187.753344123,-381.159492318],[32.6381700435,187.783209689,-381.331555154],[32.1164620038,187.838584133,-381.521412027],[31.5921686428,187.920612143,-381.729324198],[31.0658866105,188.03054435,-381.955539137],[30.5388541832,188.168839458,-382.199383907],[30.0113958915,188.337388049,-382.461496711],[29.485002898,188.536519664,-382.740837757],[28.9601295318,188.768255214,-383.037854353],[28.4359284801,189.032259443,-383.351389283],[27.9103605019,189.329001947,-383.681019921],[27.383671069,189.659665813,-384.026082824],[26.8563358581,190.025387166,-384.385664842],[26.3287480003,190.427822875,-384.759060121],[25.8015923212,190.868523117,-385.145233268],[25.2757625904,191.349069412,-385.542943037],[24.7522533873,191.871306858,-385.950906922],[24.2322758915,192.437141752,-386.36763899],[23.7172686771,193.048521618,-386.791439864],[23.2089053198,193.70741303,-387.220390644],[22.7091004003,194.41577074,-387.652347783],[22.2199962795,195.175546057,-388.084965755],[21.7439806893,195.988592778,-388.515669455],[21.2836503365,196.85670863,-388.941707431],[20.841804808,197.781575914,-389.360154991],[20.4214203121,198.764744564,-389.767945308],[20.0256206537,199.807611142,-390.161901625],[19.6576438662,200.911401392,-390.538773243],[19.3210076248,202.075545861,-390.894818334],[19.0189939724,203.300179443,-391.22673218],[18.7546768758,204.587129347,-391.531751586],[18.5313043188,205.936125291,-391.806681168],[18.3504566926,207.337070165,-392.047541469],[18.1841076425,208.802891165,-392.265625287],[18.0215608719,210.33042077,-392.466455856],[17.8630322066,211.907197895,-392.650807278],[17.7083848353,213.54249686,-392.821677407],[17.5575956236,215.23951196,-392.98064814],[17.4106902683,216.998682701,-393.128677195],[17.2676964492,218.820744064,-393.266540242],[17.1286987701,220.7019324,-393.394549352],[16.9937130509,222.644404134,-393.513368313],[16.8627373509,224.653541328,-393.623687553],[16.7358284094,226.730669958,-393.725810325],[16.6130526655,228.877227456,-393.819975012],[16.4944871874,231.094748955,-393.906364395],[16.3802205344,233.384856706,-393.985113145],[16.2703681184,235.746119442,-394.056221632],[16.1650636614,238.179147191,-394.11949198],[16.0644355503,240.689982856,-394.174825838],[15.9686257568,243.280493526,-394.222216557],[15.8777917447,245.952606274,-394.261631535],[15.7921073451,248.708302999,-394.293014379],[15.7117636565,251.549615037,-394.316286741],[15.6369471013,254.470404067,-394.331306337],[15.5678877779,257.480445754,-394.338044175],[15.5048330755,260.582175228,-394.33636632],[15.4480508433,263.777748113,-394.326119934],[15.3978308827,267.069335052,-394.30713678],[15.3544047089,270.449944497,-394.279305445],[15.3181556467,273.929873948,-394.24241179],[15.2894487599,277.512028078,-394.196242718],[15.2686689921,281.198520526,-394.14057783],[15.2560888167,284.981700378,-394.075348253],[15.2522316385,288.871637645,-394.000223028],[15.2577766226,292.87091159,-393.914947872],[15.2756368239,296.966585551,-393.819569617],[15.3069509946,301.156930312,-393.713926636],[15.3522379623,305.44991127,-393.597619333],[15.4117900502,309.840633314,-393.470558062],[15.4860562427,314.330629215,-393.332501513],[15.5756745538,318.927020261,-393.183025273],[15.6808543508,323.619355828,-393.022245519],[15.802384477,328.417519909,-392.849641],[15.9406965758,333.317268526,-392.665144063],[16.0963219329,338.317229403,-392.468606574],[16.2699839205,343.420647304,-392.259706391],[16.4620240148,348.619344236,-392.038571463],[16.6733490893,353.919736766,-391.804755272],[16.9041908422,359.310469254,-391.558555307],[17.1555135409,364.797665765,-391.299535628],[17.4275229262,370.369611795,-391.028059415],[17.7211063442,376.029543997,-390.743827476],[18.0365222102,381.767422684,-390.447177631],[18.3744499334,387.581876613,-390.13805268],[18.735265177,393.465830347,-389.816694628],[19.1193245156,399.412440805,-389.483362468],[19.5271633311,405.418202811,-389.138157851],[19.9587296905,411.470742903,-388.781691792],[20.4146201627,417.568510792,-388.414003292],[20.8946670538,423.699116647,-388.035768239],[21.3991305206,429.857324253,-387.647282144],[21.9279692329,436.034437638,-387.249067749],[22.4809623761,442.220503032,-386.841757867],[23.0581727583,448.410040646,-386.425735125],[23.6590377997,454.591010139,-386.001824852],[24.2835061725,460.75840651,-385.570430157],[24.9310073571,466.90227837,-385.132300786],[25.6011366573,473.015551093,-384.688023499],[26.2933527032,479.090641667,-384.238242282],[27.0070206226,485.119996753,-383.783623165],[27.7415543655,491.097419304,-383.324758035],[28.4962085595,497.016068569,-382.862304384],[29.2703009468,502.870479508,-382.396838265],[30.0630640321,508.655167584,-381.928952809],[30.8737131201,514.365200384,-381.459214731],[31.7014849838,519.996435886,-380.988142995],[32.5455579439,525.544836383,-380.516259408],[33.4051053853,531.006859466,-380.044057083],[34.2794347068,536.38036896,-379.571923654],[35.1675636137,541.661594957,-379.100386137],[36.0689207399,546.849961371,-378.629714723],[36.9826238141,551.943068539,-378.160333027],[37.9077895265,556.938869231,-377.692641055],[38.8439919874,561.838372691,-377.226776947],[39.7903420261,566.639882201,-376.763111322],[40.7460159294,571.342355874,-376.301961271],[41.7104003052,575.946124528,-375.84352177],[42.6832380119,580.453496302,-375.387802544],[43.6634840471,584.862542936,-374.935197047],[44.6505399202,589.173907196,-374.485864095],[45.6438344695,593.388412051,-374.039942098],[46.6429065566,597.507437923,-373.597511852],[47.6475499568,601.533534014,-373.158533721],[48.6568736062,605.465972786,-372.723281823],[49.6703991241,609.306046537,-372.29183214],[50.6876696233,613.055124787,-371.864248105],[51.7082482961,616.714638752,-371.440581958],[52.7317169552,620.286067412,-371.020876018],[53.7576745475,623.770925084,-370.605163873],[54.7908266242,627.190904469,-370.19132928],[55.8361029347,630.566660953,-369.7772638],[56.8934502266,633.898172238,-369.363006365],[57.9628145284,637.185415341,-368.948595304],[59.044140992,640.428366419,-368.53406841],[60.1373737247,643.627000601,-368.119463008],[61.2424556088,646.781291818,-367.70481602],[62.359328108,649.891212648,-367.29016404],[63.4879310597,652.956734158,-366.875543398],[64.6282024504,655.977825754,-366.460990236],[65.7800781745,658.954455038,-366.046540577],[66.943491774,661.886587666,-365.632230406],[68.1183741567,664.774187216,-365.218095745],[69.3046532928,667.617215061,-364.804172734],[70.5022538866,670.415630252,-364.390497715],[71.7110970225,673.169389402,-363.977107319],[72.9310997813,675.878446594,-363.56403856],[74.1621748278,678.542753288,-363.151328926],[75.4042299641,681.162258248,-362.739016478],[76.6571676492,683.736907492,-362.327139958],[77.9158316393,686.269732835,-361.916548361],[79.165962445,688.764971018,-361.509781022],[80.4071640501,691.223863404,-361.106829632],[81.6393816749,693.646594422,-360.707679159],[82.862559708,696.03335353,-360.312314438],[84.0766416458,698.384335252,-359.920720185],[85.2815700294,700.699739204,-359.532881022],[86.4772863814,702.979770125,-359.148781489],[87.6637311407,705.224637899,-358.768406071],[88.8408435973,707.434557579,-358.391739215],[90.0085618245,709.609749404,-358.018765354],[91.1668226117,711.750438814,-357.649468928],[92.315561395,713.856856464,-357.283834408],[93.4547121878,715.929238231,-356.92184632],[94.5842075104,717.967825227,-356.563489268],[95.704710473,719.97449825,-356.208513988],[96.8156183026,721.948291988,-355.857077172],[97.9166969062,723.889097232,-355.509215784],[99.007873702,725.797177266,-355.164914612],[100.089074281,727.67280055,-354.824158651],[101.160222335,729.516240712,-354.48693313],[102.221239584,731.327776536,-354.153223538],[103.272045705,733.107691956,-353.823015654],[104.312558264,734.85627604,-353.496295573],[105.342692644,736.573822976,-353.173049736],[106.362361977,738.260632062,-352.853264959],[107.379005236,739.918102765,-352.537437472],[108.401315356,741.550106862,-352.225688103],[109.428252019,743.1549093,-351.918310682],[110.459553575,744.732416943,-351.61535512],[111.495144008,746.282942625,-351.316811552],[112.534938312,747.806808896,-351.022670217],[113.578842347,749.304347852,-350.732921485],[114.626752694,750.775900969,-350.447555868],[115.678556517,752.221818935,-350.166564036],[116.735430742,753.644896424,-349.88954869],[117.796616768,755.044268974,-349.616691196],[118.861372,756.419173608,-349.348162992],[119.929546362,757.769995678,-349.083955171],[121.000979707,759.097128758,-348.824059063],[122.075501716,760.400974468,-348.568466239],[123.153749013,761.683385986,-348.316929],[124.236300862,762.946084121,-348.069216596],[125.321450557,764.186803705,-347.825764055],[126.408987685,765.405975566,-347.586563653],[127.49869122,766.604037557,-347.351607928],[128.590661778,767.781992269,-347.120793744],[129.686797425,768.943830469,-346.893498925],[130.784461815,770.085963626,-346.670406883],[131.883392248,771.208854034,-346.451510904],[132.983315273,772.312970015,-346.236804481],[134.085942124,773.401965773,-346.025713515],[135.190228113,774.475038834,-345.818449326],[136.294717018,775.530817844,-345.615334336],[137.399093325,776.569790851,-345.416362553],[138.505390589,777.596055866,-345.220863925],[139.612159436,778.608314405,-345.029150216],[140.71790399,779.605291674,-344.84153991],[141.82267643,780.588097058,-344.657912883],[142.929177459,781.561711478,-344.477409405],[144.033652167,782.521591809,-344.300969279],[145.135713506,783.468250648,-344.128586383],[146.238541675,784.40727749,-343.959265099],[147.33884788,785.33498546,-343.793801139],[148.435620751,786.251040058,-343.63235279],[149.532259091,787.161217525,-343.473862588],[150.625241206,788.0616781,-343.319176151],[151.713773504,788.952446064,-343.168382539],[152.80158058,789.839595618,-343.020334131],[153.883832689,790.717709627,-342.876219449],[154.962247378,791.590164573,-342.735434803],[156.037015627,792.45825993,-342.59779246],[157.10489131,793.318880631,-342.464033507],[158.170428381,794.178932985,-342.332782936],[159.228354888,795.032771415,-342.205322852],[160.283072465,795.878528461,-342.080909354],[161.334784504,796.7087547,-341.959980632],[162.383240292,797.523792995,-341.842530346],[163.429617645,798.325702155,-341.72816989],[164.471484991,799.11217015,-341.617478285],[165.51174087,799.887273208,-341.509608402],[166.546694997,800.647239468,-341.405474367],[167.580053738,801.397011637,-341.304016883],[168.607772302,802.132464437,-341.206242353],[169.633471388,802.858343378,-341.111118022],[170.653635065,803.571190516,-341.019507618],[171.670927287,804.274574802,-340.930635505],[172.683220362,804.9666436,-340.844996187],[173.69137609,805.648891439,-340.762293027],[174.695487065,806.321928919,-340.682433761],[175.693796627,806.984357116,-340.605813314],[176.689418828,807.64003035,-340.531544757],[177.678313217,808.285098016,-340.460623602],[178.664027165,808.923810118,-340.39205134],[179.644102926,809.554022333,-340.326406918],[180.618354588,810.176008864,-340.263672482],[181.589317035,810.792826031,-340.203119364],[182.553538662,811.401343371,-340.145584988],[183.513039041,812.004051528,-340.090476535],[184.467829988,812.601352862,-340.037726835],[185.415890005,813.191613912,-339.987798407],[186.359471088,813.777468719,-339.94004073],[187.297790387,814.358497557,-339.894594403],[188.229383624,814.933626928,-339.851776576],[189.155940866,815.504861772,-339.811085183],[190.077491989,816.072554694,-339.772450306],[190.992317551,816.635376217,-339.736255481],[191.90081441,817.194035298,-339.702335481],[192.805306345,817.751035166,-339.670027393],[193.703069474,818.304084579,-339.639974932],[194.594130035,818.853505012,-339.612109883],[195.479690798,819.400694496,-339.586060746],[196.360104664,819.946231572,-339.561676398],[197.233806458,820.488921781,-339.539300707],[198.10081762,821.029036294,-339.518868135],[198.961983488,821.567580547,-339.500101388],[199.818047053,822.105440845,-339.482750361],[200.667405451,822.641378362,-339.467169038],[201.51007586,823.175617795,-339.453294418],[202.346073993,823.708371875,-339.441064255],[203.176962923,824.241208683,-339.430019323],[204.001693277,824.773365392,-339.42037209],[204.819730771,825.304537751,-339.412202719],[205.631087554,825.83489621,-339.405451371],[206.435774519,826.364600366,-339.400058925],[207.234645057,826.894527418,-339.395750791],[208.027762818,827.424854239,-339.392455405],[208.814186271,827.954887654,-339.390358961],[209.593923453,828.484748396,-339.389404668],[210.366981349,829.014547233,-339.389536428],[211.13336594,829.544385137,-339.390698829],[211.893541442,830.074740611,-339.392719748],[212.648047333,830.60614113,-339.395408428],[213.395852529,831.137784688,-339.398975978],[214.136961012,831.669736633,-339.403369258],[214.871375956,832.202053178,-339.4085358],[215.599099774,832.734781518,-339.414423798],[216.320134152,833.267959954,-339.420982112],[217.034480094,833.801617995,-339.428160257],[217.743259152,834.336697026,-339.43562247],[218.44539496,834.872320111,-339.443594163],[219.140814266,835.408431726,-339.452045266],[219.829517124,835.9450287,-339.460927517],[220.511503073,836.48209946,-339.470193294],[221.186771156,837.019624094,-339.47979562],[221.855319956,837.557574414,-339.489688151],[222.517147623,838.095914015,-339.499825178],[223.172279922,838.634620822,-339.510154484],[223.821631863,839.174376772,-339.520398102],[224.464238348,839.714346853,-339.530757113],[225.100097251,840.254463398,-339.541187971],[225.199480248,840.33353993,-339.51591203],[225.297501499,840.41133953,-339.490987641]],this.cameraTgtData=[[-1183.88317871,-90.3306732178,-231.568664551],[-1183.41503906,-90.2536392212,-231.469619751],[-1182.01330566,-90.0230712891,-231.173202515],[-1180.61560059,-89.7933044434,-230.877853394],[-1179.22180176,-89.5643310547,-230.583557129],[-1177.83154297,-89.3361053467,-230.290237427],[-1176.43432617,-89.1068496704,-229.995620728],[-1175.04089355,-88.8783874512,-229.702056885],[-1173.65136719,-88.6507034302,-229.40953064],[-1172.265625,-88.4237976074,-229.118026733],[-1170.87536621,-88.1962890625,-228.825775146],[-1169.48596191,-87.9690704346,-228.533935547],[-1168.1003418,-87.7426223755,-228.243118286],[-1166.71838379,-87.5169372559,-227.953292847],[-1165.33496094,-87.2911300659,-227.663375854],[-1163.94909668,-87.0651092529,-227.373184204],[-1162.56713867,-86.8398361206,-227.084014893],[-1161.1887207,-86.6153106689,-226.795822144],[-1159.81140137,-86.3911132813,-226.508102417],[-1158.42895508,-86.166229248,-226.219512939],[-1157.0501709,-85.9420852661,-225.931930542],[-1155.67492676,-85.7186737061,-225.645309448],[-1154.30322266,-85.4959869385,-225.359649658],[-1152.92382813,-85.2722015381,-225.072631836],[-1151.54785156,-85.0491333008,-224.786560059],[-1150.17541504,-84.8267745972,-224.501449585],[-1148.80651855,-84.605140686,-224.217285156],[-1147.43212891,-84.3827667236,-223.932235718],[-1146.05871582,-84.1607208252,-223.647628784],[-1144.68884277,-83.9393768311,-223.363967896],[-1143.32226563,-83.7187347412,-223.081237793],[-1141.95227051,-83.4976806641,-222.798034668],[-1140.58117676,-83.2766113281,-222.514846802],[-1139.21350098,-83.0562286377,-222.232589722],[-1137.84899902,-82.8365402222,-221.951248169],[-1136.48278809,-82.6167068481,-221.669784546],[-1135.11364746,-82.3965606689,-221.387954712],[-1133.74780273,-82.1770935059,-221.107025146],[-1132.38525391,-81.9583053589,-220.827026367],[-1131.0222168,-81.7396011353,-220.547180176],[-1129.65466309,-81.5203323364,-220.266647339],[-1128.29040527,-81.3017349243,-219.987030029],[-1126.92919922,-81.0838012695,-219.708312988],[-1125.56872559,-80.8661270142,-219.429962158],[-1124.20263672,-80.6476974487,-219.15071106],[-1122.83947754,-80.4299240112,-218.872329712],[-1121.47961426,-80.2127990723,-218.594833374],[-1120.12109375,-79.996055603,-218.317886353],[-1118.75585938,-79.7784118652,-218.039840698],[-1117.39379883,-79.561416626,-217.762664795],[-1116.03466797,-79.3450622559,-217.486358643],[-1114.67749023,-79.12915802,-217.210693359],[-1113.31298828,-78.9122619629,-216.933822632],[-1111.95153809,-78.6960067749,-216.657806396],[-1110.59301758,-78.4803695679,-216.382644653],[-1109.2364502,-78.2652053833,-216.108139038],[-1107.87243652,-78.0490188599,-215.832382202],[-1106.51135254,-77.8334579468,-215.557479858],[-1105.15307617,-77.6185073853,-215.283432007],[-1103.79650879,-77.4039840698,-215.009979248],[-1102.43273926,-77.1884689331,-214.735305786],[-1101.07165527,-76.9735565186,-214.461486816],[-1099.71337891,-76.7592544556,-214.188491821],[-1098.35620117,-76.5452804565,-213.915985107],[-1096.9921875,-76.3303833008,-213.642364502],[-1095.63085938,-76.1160964966,-213.36958313],[-1094.27233887,-75.9023971558,-213.097625732],[-1092.91394043,-75.688873291,-212.825942993],[-1091.54943848,-75.474571228,-212.553344727],[-1090.18762207,-75.2608566284,-212.281555176],[-1088.82861328,-75.0477371216,-212.010604858],[-1087.46813965,-74.8345565796,-211.739639282],[-1086.10290527,-74.6208114624,-211.468017578],[-1084.74035645,-74.4076461792,-211.197219849],[-1083.38049316,-74.19506073,-210.927215576],[-1082.01733398,-73.982131958,-210.65687561],[-1080.65112305,-73.7689056396,-210.38621521],[-1079.28759766,-73.5562591553,-210.116363525],[-1077.92663574,-73.3441772461,-209.847305298],[-1076.56018066,-73.1314086914,-209.577453613],[-1075.19274902,-72.9186706543,-209.307723999],[-1073.82788086,-72.7065048218,-209.038787842],[-1072.46557617,-72.4948883057,-208.770645142],[-1071.09509277,-72.2821884155,-208.501205444],[-1069.72619629,-72.0699081421,-208.232391357],[-1068.35974121,-71.8581924438,-207.964355469],[-1066.99365234,-71.646697998,-207.69670105],[-1065.62060547,-71.4342880249,-207.427978516],[-1064.25,-71.222442627,-207.16003418],[-1062.88171387,-71.011138916,-206.892883301],[-1061.51037598,-70.7995300293,-206.625427246],[-1060.13537598,-70.5875320435,-206.357574463],[-1058.76281738,-70.376083374,-206.090515137],[-1057.39257813,-70.165184021,-205.824234009],[-1056.01513672,-69.9533538818,-205.556884766],[-1054.63793945,-69.7417449951,-205.289901733],[-1053.26318359,-69.5306777954,-205.023696899],[-1051.88842773,-69.3198013306,-204.757827759],[-1050.50646973,-69.1080093384,-204.490921021],[-1049.12695313,-68.8967590332,-204.22479248],[-1047.74975586,-68.6860427856,-203.959442139],[-1046.36767578,-68.4747772217,-203.693496704],[-1044.9831543,-68.2633361816,-203.427429199],[-1043.60107422,-68.0524215698,-203.162155151],[-1042.22045898,-67.8419342041,-202.897521973],[-1040.83105469,-67.6302871704,-202.631530762],[-1039.44384766,-67.4191665649,-202.366317749],[-1038.05883789,-67.2085723877,-202.101882935],[-1036.66967773,-66.9975280762,-201.836990356],[-1035.27722168,-66.7861862183,-201.571853638],[-1033.88708496,-66.5753707886,-201.307495117],[-1032.49816895,-66.364944458,-201.043746948],[-1031.10046387,-66.1533737183,-200.778686523],[-1029.70495605,-65.9423294067,-200.514404297],[-1028.31164551,-65.731803894,-200.250900269],[-1026.91271973,-65.5206375122,-199.986709595],[-1025.51184082,-65.3093566895,-199.722518921],[-1024.11303711,-65.0985946655,-199.459091187],[-1022.71325684,-64.8878860474,-199.195892334],[-1021.3067627,-64.6763534546,-198.931777954],[-1019.90234375,-64.4653396606,-198.668457031],[-1018.50006104,-64.2548446655,-198.405929565],[-1017.08898926,-64.0432357788,-198.14213562],[-1015.67889404,-63.8319664001,-197.878921509],[-1014.27087402,-63.6212120056,-197.616500854],[-1012.85778809,-63.4099082947,-197.353530884],[-1011.4418335,-63.1983795166,-197.090438843],[-1010.02801514,-62.9873657227,-196.828140259],[-1008.61236572,-62.7762908936,-196.56590271],[-1007.19049072,-62.5644950867,-196.302947998],[-1005.77075195,-62.3532180786,-196.040786743],[-1004.35198975,-62.1422996521,-195.77923584],[-1002.92407227,-61.9302368164,-195.516433716],[-1001.49829102,-61.7186927795,-195.254425049],[-1000.07452393,-61.5076637268,-194.993240356],[-998.641845703,-61.2955245972,-194.73085022],[-997.209899902,-61.0837097168,-194.469024658],[-995.780029297,-60.8724098206,-194.208023071],[-994.343078613,-60.660282135,-193.946182251],[-992.904907227,-60.4481964111,-193.684570313],[-991.468811035,-60.2366294861,-193.423782349],[-990.026977539,-60.0244369507,-193.162414551],[-988.582519531,-59.8120803833,-192.901031494],[-987.140136719,-59.6002464294,-192.640487671],[-985.692932129,-59.3879241943,-192.37953186],[-984.242126465,-59.1753005981,-192.118423462],[-982.793395996,-58.9631996155,-191.858139038],[-981.340270996,-58.7506790161,-191.597564697],[-979.882995605,-58.5377883911,-191.336746216],[-978.427856445,-58.3254203796,-191.076766968],[-976.968200684,-58.1126365662,-190.816513062],[-975.504516602,-57.8994865417,-190.556015015],[-974.04284668,-57.6868591309,-190.296386719],[-972.576171875,-57.4737434387,-190.036392212],[-971.105957031,-57.2603378296,-189.776260376],[-969.637756348,-57.0474586487,-189.51701355],[-968.163513184,-56.833946228,-189.257247925],[-966.686706543,-56.6202888489,-188.997528076],[-965.211914063,-56.4071655273,-188.738708496],[-963.729675293,-56.193195343,-188.479125977],[-962.24621582,-55.9792938232,-188.219863892],[-960.764831543,-55.7659339905,-187.961517334],[-959.273925781,-55.5514411926,-187.702072144],[-957.783813477,-55.337310791,-187.443328857],[-956.294677734,-55.1235542297,-187.185302734],[-954.795776367,-54.9086532593,-186.926177979],[-953.299072266,-54.6942977905,-186.667999268],[-951.800231934,-54.4799003601,-186.410049438],[-950.29473877,-54.2647857666,-186.151519775],[-948.791259766,-54.0502204895,-185.893951416],[-947.282409668,-53.8351249695,-185.636047363],[-945.770141602,-53.619808197,-185.378173828],[-944.260070801,-53.4050483704,-185.121292114],[-942.740539551,-53.189201355,-184.863418579],[-941.221618652,-52.9736976624,-184.606277466],[-939.702026367,-52.7583503723,-184.349655151],[-938.174255371,-52.5421028137,-184.092285156],[-936.648620605,-52.326423645,-183.8359375],[-935.117492676,-52.1102180481,-183.579299927],[-933.583007813,-51.8938102722,-183.322769165],[-932.05078125,-51.6779747009,-183.067276001],[-930.507568359,-51.4608573914,-182.810638428],[-928.966491699,-51.244304657,-182.555023193],[-927.421875,-51.0275192261,-182.299514771],[-925.871948242,-50.810256958,-182.043823242],[-924.324279785,-50.5935745239,-181.789215088],[-922.766723633,-50.3757820129,-181.533691406],[-921.210205078,-50.158405304,-181.279052734],[-919.650390625,-49.9408416748,-181.024612427],[-918.085021973,-49.7227706909,-180.769989014],[-916.521972656,-49.5052986145,-180.516494751],[-914.948425293,-49.2866363525,-180.262039185],[-913.376525879,-49.06848526,-180.008636475],[-911.799926758,-48.8499526978,-179.755218506],[-910.219238281,-48.6311340332,-179.501937866],[-908.639221191,-48.4126815796,-179.249542236],[-907.049743652,-48.1932029724,-178.996429443],[-905.46270752,-47.9743461609,-178.744522095],[-903.867614746,-47.7546577454,-178.492141724],[-902.271850586,-47.53515625,-178.240493774],[-900.672546387,-47.3154525757,-177.989105225],[-899.068054199,-47.0953178406,-177.737747192],[-897.464172363,-46.8755607605,-177.487350464],[-895.850952148,-46.654800415,-177.236343384],[-894.240356445,-46.4346809387,-176.986633301],[-892.620300293,-46.2135658264,-176.736328125],[-891.001037598,-45.9928436279,-176.487045288],[-889.375671387,-45.7715835571,-176.237731934],[-887.747802734,-45.5502662659,-175.988952637],[-886.116882324,-45.3288154602,-175.740631104],[-884.48046875,-45.1069145203,-175.492401123],[-882.843505859,-44.8852348328,-175.245056152],[-881.198547363,-44.6627616882,-174.997467041],[-879.555358887,-44.4408111572,-174.751098633],[-877.901916504,-44.2177772522,-174.504196167],[-876.251403809,-43.9954223633,-174.258712769],[-874.590270996,-43.7719306946,-174.012664795],[-872.931396484,-43.5490341187,-173.767974854],[-871.263244629,-43.3251914978,-173.522964478],[-869.596069336,-43.101764679,-173.279144287],[-867.920715332,-42.877532959,-173.035186768],[-866.245361328,-42.653591156,-172.792297363],[-864.56237793,-42.4289283752,-172.5493927],[-862.87890625,-42.2044868469,-172.307525635],[-861.188049316,-41.9793548584,-172.065704346],[-859.496520996,-41.7544212341,-171.824935913],[-857.797546387,-41.5287857056,-171.584228516],[-856.098083496,-41.3033714294,-171.344619751],[-854.390625,-41.0771942139,-171.105072021],[-852.683288574,-40.85131073,-170.866714478],[-850.967163086,-40.6245536804,-170.628356934],[-849.25201416,-40.3982162476,-170.391342163],[-847.526977539,-40.1708450317,-170.154190063],[-845.803710938,-39.9439964294,-169.918548584],[-844.069885254,-39.7160377502,-169.682723999],[-842.337097168,-39.488494873,-169.44833374],[-840.595825195,-39.2601089478,-169.214080811],[-838.85333252,-39.0318412781,-168.981002808],[-837.104614258,-38.8030357361,-168.748428345],[-835.352172852,-38.5740089417,-168.516708374],[-833.596252441,-38.3447914124,-168.285888672],[-831.833618164,-38.1149673462,-168.055603027],[-830.070617676,-37.885345459,-167.826644897],[-828.297607422,-37.6546897888,-167.597839355],[-826.524841309,-37.4243164063,-167.370513916],[-824.74407959,-37.1931533813,-167.143615723],[-822.960510254,-36.9618759155,-166.91784668],[-821.172973633,-36.7303237915,-166.693084717],[-819.378479004,-36.4981040955,-166.468963623],[-817.583374023,-36.2660484314,-166.246322632],[-815.778686523,-36.0329742432,-166.024047852],[-813.972290039,-35.7999038696,-165.803146362],[-812.161193848,-35.566444397,-165.583282471],[-810.343261719,-35.3323249817,-165.364227295],[-808.524169922,-35.0982513428,-165.14666748],[-806.696533203,-34.8632698059,-164.929748535],[-804.865600586,-34.6280708313,-164.714141846],[-803.031982422,-34.3927001953,-164.499938965],[-801.189208984,-34.1563339233,-164.286392212],[-799.344543457,-33.9198951721,-164.074401855],[-797.494995117,-33.6829872131,-163.863632202],[-795.638183594,-33.4453010559,-163.653839111],[-793.77911377,-33.2074661255,-163.445617676],[-791.914123535,-32.96900177,-163.238571167],[-790.042663574,-32.7298316956,-163.032714844],[-788.168640137,-32.490436554,-162.828460693],[-786.288574219,-32.250377655,-162.625473022],[-784.401977539,-32.0095596313,-162.423736572],[-782.512390137,-31.7684345245,-162.223648071],[-780.617797852,-31.5267333984,-162.025039673],[-778.715515137,-31.2840900421,-161.827636719],[-776.809936523,-31.0410556793,-161.631942749],[-774.900817871,-30.7975940704,-161.437973022],[-772.982849121,-30.5529918671,-161.245193481],[-771.060913086,-30.3078632355,-161.054138184],[-769.135131836,-30.0622158051,-160.864868164],[-767.203796387,-29.8157997131,-160.677215576],[-765.265075684,-29.5683708191,-160.491043091],[-763.322387695,-29.3203372955,-160.306732178],[-761.375549316,-29.0716571808,-160.124267578],[-759.422485352,-28.8220481873,-159.943496704],[-757.462585449,-28.5714054108,-159.764404297],[-755.498291016,-28.3200206757,-159.587234497],[-753.529541016,-28.0678501129,-159.412017822],[-751.555786133,-27.8148040771,-159.238723755],[-749.573974609,-27.5604667664,-159.067138672],[-747.587463379,-27.3052387238,-158.897567749],[-745.596191406,-27.049079895,-158.730056763],[-743.600036621,-26.7919387817,-158.564590454],[-741.598449707,-26.5337181091,-158.401168823],[-739.589233398,-26.2741088867,-158.239654541],[-737.575073242,-26.0134029388,-158.080291748],[-735.555725098,-25.7515525818,-157.923080444],[-733.53125,-25.4885082245,-157.768035889],[-731.501403809,-25.2242202759,-157.615203857],[-729.466003418,-24.9586048126,-157.464569092],[-727.423339844,-24.69140625,-157.316055298],[-725.375366211,-24.422826767,-157.169799805],[-723.321899414,-24.1528129578,-157.025848389],[-721.263000488,-23.8813076019,-156.88420105
],[-719.198547363,-23.6082553864,-156.744873047],[-717.128479004,-23.3335971832,-156.607894897],[-715.052734375,-23.0572738647,-156.47328186],[-712.971313477,-22.7792243958,-156.341033936],[-710.883666992,-22.4993305206,-156.211151123],[-708.789794922,-22.2175197601,-156.083648682],[-706.690185547,-21.9338092804,-155.958557129],[-704.584838867,-21.6481361389,-155.835906982],[-702.473754883,-21.3604297638,-155.715682983],[-700.356872559,-21.0706233978,-155.597915649],[-698.234191895,-20.7786445618,-155.48260498],[-696.105651855,-20.4844226837,-155.369735718],[-693.971252441,-20.1878852844,-155.25932312],[-691.830932617,-19.8889560699,-155.151367188],[-689.684814453,-19.5875587463,-155.045852661],[-687.532714844,-19.2836170197,-154.942779541],[-685.374755859,-18.9770507813,-154.842147827],[-683.21081543,-18.6677799225,-154.743927002],[-681.041015625,-18.35572052,-154.648117065],[-678.865234375,-18.0407905579,-154.554702759],[-676.683532715,-17.7229061127,-154.463653564],[-674.495910645,-17.4019813538,-154.374938965],[-672.302368164,-17.0779247284,-154.288543701],[-670.102905273,-16.7506523132,-154.204437256],[-667.897460938,-16.4200706482,-154.122589111],[-665.686096191,-16.0860900879,-154.042953491],[-663.46875,-15.7486200333,-153.965484619],[-661.245483398,-15.4075641632,-153.890151978],[-659.016235352,-15.0628204346,-153.816894531],[-656.780700684,-14.714261055,-153.745651245],[-654.538818359,-14.3639574051,-153.676376343],[-652.290466309,-14.0133771896,-153.609085083],[-650.035583496,-13.6625127792,-153.543777466],[-647.774108887,-13.3113546371,-153.480453491],[-645.506103516,-12.9598922729,-153.419128418],[-643.231567383,-12.6081161499,-153.359832764],[-640.950378418,-12.2560148239,-153.302536011],[-638.662658691,-11.9035768509,-153.247283936],[-636.367675781,-11.5506916046,-153.194061279],[-634.066040039,-11.1974382401,-153.142883301],[-631.757751465,-10.8438091278,-153.09375],[-629.442810059,-10.4897909164,-153.046691895],[-627.12121582,-10.1353693008,-153.001693726],[-624.79296875,-9.78053092957,-152.958786011],[-622.457580566,-9.42517948151,-152.917938232],[-620.115112305,-9.06933116913,-152.879165649],[-617.765991211,-8.71301555634,-152.842483521],[-615.41015625,-8.35621547699,-152.807907104],[-613.047607422,-7.99891281128,-152.775405884],[-610.677856445,-7.6410150528,-152.745010376],[-608.30090332,-7.28250837326,-152.716705322],[-605.917236328,-6.92343902588,-152.690505981],[-603.526855469,-6.56378746033,-152.666397095],[-601.129516602,-6.20350885391,-152.644378662],[-598.72454834,-5.8424706459,-152.624465942],[-596.312805176,-5.48078012466,-152.606628418],[-593.894348145,-5.11841344833,-152.590896606],[-591.46875,-4.75530433655,-152.57723999],[-589.035644531,-4.39134502411,-152.565658569],[-586.59564209,-4.02662944794,-152.556152344],[-584.148925781,-3.66112995148,-152.548706055],[-581.694580078,-3.29469490051,-152.543319702],[-579.233032227,-2.92736816406,-152.539978027],[-576.764709473,-2.55916571617,-152.53868103],[-574.2890625,-2.1899740696,-152.539398193],[-571.805908203,-1.81974720955,-152.542114258],[-569.315917969,-1.44854414463,-152.546844482],[-566.818603516,-1.07625067234,-152.553543091],[-564.313720703,-0.702806949615,-152.562225342],[-561.802001953,-0.328276157379,-152.5728302],[-559.282714844,.0474897809327,-152.585372925],[-556.75604248,.42449721694,-152.599822998],[-554.22253418,.802713632584,-152.616149902],[-551.680969238,1.18235015869,-152.634338379],[-549.132507324,1.5633007288,-152.654373169],[-546.576660156,1.94565927982,-152.676193237],[-544.013122559,2.32952880859,-152.699813843],[-541.442687988,2.71483612061,-152.72517395],[-538.864196777,3.10180282593,-152.752258301],[-536.278747559,3.49032497406,-152.781021118],[-533.68560791,3.88054728508,-152.811431885],[-531.085021973,4.27249574661,-152.843460083],[-528.477111816,4.66620731354,-152.877059937],[-525.861450195,5.06180381775,-152.912200928],[-523.238647461,5.45924758911,-152.948822021],[-520.607849121,5.85872650146,-152.986907959],[-517.969970703,6.26015663147,-153.026382446],[-515.324035645,6.66376256943,-153.067230225],[-512.671020508,7.06944274902,-153.109359741],[-510.009918213,7.47743368149,-153.152755737],[-507.341705322,7.88763856888,-153.197341919],[-504.665405273,8.30028438568,-153.243087769],[-501.981903076,8.71529865265,-153.289901733],[-499.290374756,9.13288116455,-153.337753296],[-496.591491699,9.55300331116,-153.386566162],[-493.884735107,9.97581672668,-153.436279297],[-491.170410156,10.4013538361,-153.486816406],[-488.448425293,10.829706192,-153.538116455],[-485.718597412,11.2609777451,-153.590103149],[-482.981323242,11.6951875687,-153.642715454],[-480.235931396,12.132525444,-153.695877075],[-477.483093262,12.5729675293,-153.74949646],[-474.722381592,13.0166721344,-153.803497314],[-471.953887939,13.4637012482,-153.857803345],[-469.177825928,13.9141168594,-153.912338257],[-466.393676758,14.3680906296,-153.966995239],[-463.601928711,14.8256311417,-154.021697998],[-460.802398682,15.2868690491,-154.076339722],[-457.994903564,15.7519159317,-154.130844116],[-455.179779053,16.220823288,-154.185119629],[-452.356719971,16.693731308,-154.239044189],[-449.525817871,17.1707286835,-154.292526245],[-446.687194824,17.6518878937,-154.345474243],[-443.840637207,18.1373519897,-154.397781372],[-440.986206055,18.6272068024,-154.449325562],[-438.12399292,19.1215381622,-154.500015259],[-435.25390625,19.6204719543,-154.549713135],[-432.37588501,20.1241207123,-154.598342896],[-429.490081787,20.6325683594,-154.645751953],[-426.596435547,21.1459255219,-154.691848755],[-423.694793701,21.6643295288,-154.736495972],[-420.785339355,22.1878585815,-154.779586792],[-417.757446289,22.7367515564,-154.822509766],[-414.509155273,23.3302841187,-154.866256714],[-411.052703857,23.9673137665,-154.91003418],[-407.399169922,24.6469116211,-154.952972412],[-403.558776855,25.3683547974,-154.994186401],[-399.540893555,26.1310977936,-155.03276062],[-395.354248047,26.9347515106,-155.067672729],[-391.006774902,27.7790775299,-155.097915649],[-386.506011963,28.6639518738,-155.122390747],[-381.858886719,29.589548111,-155.139953613],[-377.071807861,30.5555744171,-155.149642944],[-372.150604248,31.5610466003,-155.150436401],[-367.10067749,32.6048774719,-155.141357422],[-361.927032471,33.6858634949,-155.121444702],[-356.634368896,34.8027000427,-155.08972168],[-351.226959229,35.9539642334,-155.045227051],[-345.708740234,37.1381340027,-154.987014771],[-340.08392334,38.3534545898,-154.914154053],[-334.35559082,39.5982704163,-154.825775146],[-328.526733398,40.8707923889,-154.720977783],[-322.601409912,42.1688537598,-154.598953247],[-316.581268311,43.4907073975,-154.458908081],[-310.469940186,44.8340682983,-154.300094604],[-304.269012451,46.1969871521,-154.121795654],[-297.981842041,47.5770874023,-153.923400879],[-291.609313965,48.9724464417,-153.70425415],[-285.155212402,50.38048172,-153.463882446],[-278.619781494,51.7993583679,-153.20173645],[-272.006103516,53.2266044617,-152.917434692],[-265.315368652,54.66015625,-152.610580444],[-258.548828125,56.0979728699,-152.280822754],[-251.709609985,57.5376205444,-151.928009033],[-244.797363281,58.9774513245,-151.551803589],[-237.814941406,60.4151916504,-151.152160645],[-230.763259888,61.8490371704,-150.728942871],[-223.643005371,63.2772750854,-150.282058716],[-216.457382202,64.6977844238,-149.811630249],[-209.205169678,66.1093673706,-149.3175354],[-201.890319824,67.5099258423,-148.800033569],[-194.511520386,68.8984451294,-148.259063721],[-187.072067261,70.273109436,-147.694961548],[-179.571212769,71.6329574585,-147.107757568],[-172.012084961,72.9763946533,-146.497817993],[-164.393356323,74.3027267456,-145.865203857],[-156.719284058,75.6103286743,-145.210449219],[-148.987625122,76.8988113403,-144.533554077],[-141.201919556,78.1668701172,-143.83505249],[-133.3621521,79.4138717651,-143.11517334],[-125.468254089,80.6392440796,-142.374145508],[-117.523727417,81.8419342041,-141.612564087],[-109.528007507,83.0216064453,-140.830627441],[-101.481445313,84.1778182983,-140.028640747],[-93.3851318359,85.3100662231,-139.207000732],[-85.2332763672,86.4156570435,-138.448898315],[-77.0079956055,87.4876022339,-138.011199951],[-68.7222137451,88.5251235962,-137.908050537],[-60.390247345,89.5281143188,-138.133865356],[-52.0256462097,90.496673584,-138.682403564],[-43.6414604187,91.4309997559,-139.546875],[-35.2487182617,92.3316040039,-140.720336914],[-26.8582553864,93.1990127563,-142.195785522],[-18.4801826477,94.0338439941,-143.966217041],[-10.124540329,94.8367233276,-146.024658203],[-1.79972410202,95.6084365845,-148.364654541],[6.48595476151,96.3497543335,-150.980026245],[14.7244024277,97.0614471436,-153.864944458],[22.9075317383,97.7442703247,-157.013900757],[31.0279521942,98.399017334,-160.421981812],[39.078250885,99.0264587402,-164.084777832],[47.0508346558,99.6273345947,-167.99822998],[54.9380226135,100.20236969,-172.158813477],[62.7320709229,100.75226593,-176.563476563],[70.4247512817,101.277694702,-181.209564209],[78.0076904297,101.779296875,-186.095046997],[85.4718399048,102.25769043,-191.218170166],[92.8071975708,102.713439941,-196.577377319],[100.004020691,103.147125244,-202.172180176],[107.050384521,103.559242249,-208.001434326],[113.934173584,103.950286865,-214.064926147],[120.641975403,104.320732117,-220.362518311],[127.15851593,104.670982361,-226.893661499],[133.467605591,105.001472473,-233.65838623],[139.55078125,105.312568665,-240.655944824],[145.387130737,105.604606628,-247.884399414],[150.955291748,105.877967834,-255.343154907],[156.228805542,106.132919312,-263.026733398],[161.179855347,106.369743347,-270.928955078],[165.777984619,106.588752747,-279.040466309],[169.989181519,106.790176392,-287.34552002],[173.775894165,106.974212646,-295.817993164],[177.097702026,107.140960693,-304.414703369],[179.956924438,107.292800903,-313.212982178],[182.339309692,107.431900024,-322.318878174],[184.175720215,107.557991028,-331.702728271],[185.397354126,107.671066284,-341.326171875],[185.938644409,107.771362305,-351.141265869],[185.717529297,107.911094666,-361.087493896],[184.677978516,108.1876297,-371.092315674],[182.851135254,108.595077515,-381.084503174],[180.277557373,109.123703003,-391.006072998],[177.001647949,109.763237,-400.80770874],[173.068939209,110.503372192,-410.447113037],[168.522003174,111.334472656,-419.892425537],[163.401138306,112.247337341,-429.114868164],[157.743774414,113.233337402,-438.088562012],[151.582015991,114.284744263,-446.792541504],[144.94519043,115.394256592,-455.205474854],[137.859451294,116.555038452,-463.306091309],[130.347595215,117.76071167,-471.072875977],[122.429763794,119.0051651,-478.483001709],[114.124397278,120.282394409,-485.511016846],[105.448013306,121.586471558,-492.129058838],[96.4167327881,122.911254883,-498.305297852],[87.0467224121,124.250305176,-504.003662109],[77.3535308838,125.596916199,-509.184051514],[67.3573760986,126.943336487,-513.799377441],[57.0790901184,128.281311035,-517.798217773],[46.5477485657,129.601104736,-521.121948242],[35.7965621948,130.892059326,-523.707702637],[24.8723335266,132.141586304,-525.487731934],[13.8318681717,133.335845947,-526.393920898],[2.74674201012,134.459671021,-526.36151123],[-8.29572296143,135.496948242,-525.335998535],[-19.1964817047,136.431869507,-523.280578613],[-29.8476467133,137.249908447,-520.184020996],[-40.1423683167,137.93951416,-516.065551758],[-49.9852485657,138.493225098,-510.975097656],[-59.2952537537,138.908050537,-504.991943359],[-68.019821167,139.185852051,-498.212036133],[-76.1301956177,139.332199097,-490.740814209],[-83.743850708,139.412384033,-482.790710449],[-91.0249023438,139.522979736,-474.587280273],[-97.9480667114,139.671234131,-466.127929688],[-104.479034424,139.864196777,-457.411437988],[-110.577644348,140.110031128,-448.439971924],[-116.197921753,140.418121338,-439.219512939],[-121.288833618,140.799362183,-429.758392334],[-125.793312073,141.266433716,-420.068084717],[-129.645675659,141.833892822,-410.168395996],[-132.771606445,142.518173218,-400.090240479],[-135.089172363,143.337539673,-389.878601074],[-136.511672974,144.312301636,-379.589416504],[-136.948913574,145.462631226,-369.309173584],[-136.317901611,146.80758667,-359.14730835],[-134.554519653,148.361938477,-349.241516113],[-131.629745483,150.132675171,-339.751647949],[-127.565734863,152.11541748,-330.846954346],[-122.443649292,154.293014526,-322.682556152],[-116.397857666,156.637298584,-315.37600708],[-109.597541809,159.113082886,-308.992584229],[-102.221061707,161.683944702,-303.542510986],[-94.4408721924,164.314590454,-298.994567871],[-86.4014663696,166.976486206,-295.284210205],[-78.2233047485,169.645828247,-292.333465576],[-70.0087127686,172.301513672,-290.061187744],[-61.8277359009,174.930206299,-288.384185791],[-53.7420158386,177.518951416,-287.226806641],[-45.7969551086,180.05821228,-286.518859863],[-38.0368270874,182.537384033,-286.197357178],[-30.4873790741,184.950714111,-286.204589844],[-23.1721172333,187.291183472,-286.484893799],[-16.1325569153,189.542434692,-286.996520996],[-9.38508415222,191.701904297,-287.751342773],[-2.97038316727,193.760620117,-288.763793945],[3.06064343452,195.707199097,-290.044281006],[8.67102050781,197.535552979,-291.60244751],[13.7887239456,199.228790283,-293.430389404],[18.3490600586,200.772003174,-295.503112793],[22.2916240692,202.149795532,-297.76751709],[25.5557785034,203.341567993,-300.121398926],[28.1162166595,204.330291748,-302.417449951],[30.1693935394,205.179992676,-304.690338135],[31.9038639069,205.964401245,-307.077972412],[33.317276001,206.683288574,-309.546783447],[34.4193763733,207.338470459,-312.05871582],[35.2316856384,207.933929443,-314.575897217],[35.7845230103,208.47543335,-317.065429688],[36.1127128601,208.969863892,-319.501953125],[36.2514152527,209.424072266,-321.866821289],[36.2336006165,209.844909668,-324.149932861],[36.0884666443,210.238098145,-326.344024658],[35.8409347534,210.608917236,-328.448181152],[35.5119247437,210.961578369,-330.462493896],[35.1187591553,211.299575806,-332.388793945],[34.6756477356,211.625732422,-334.230102539],[34.1941490173,211.942352295,-335.990112305],[33.6836624146,212.251342773,-337.672821045],[33.1521568298,212.553970337,-339.28125],[32.6058502197,212.851470947,-340.819580078],[32.0497245789,213.144851685,-342.291870117],[31.4883670807,213.434585571,-343.700653076],[30.9249305725,213.721389771,-345.050018311],[30.3622760773,214.005645752,-346.342926025],[29.8029918671,214.287521362,-347.581695557],[29.2486629486,214.567382813,-348.769714355],[28.7008705139,214.845352173,-349.909393311],[28.1608924866,215.121505737,-351.003082275],[27.6297607422,215.395874023,-352.052947998],[27.1082553864,215.66847229,-353.061126709],[26.5969524384,215.939315796,-354.029663086],[26.0963306427,216.208358765,-354.960449219],[25.606754303,216.47555542,-355.855163574],[25.1284790039,216.740829468,-356.715454102],[24.6616668701,217.004135132,-357.542907715],[24.2064056396,217.265365601,-358.339019775],[23.7627372742,217.52444458,-359.105133057],[23.330663681,217.781295776,-359.842529297],[22.910150528,218.035797119,-360.552398682],[22.5011405945,218.287841797,-361.235870361],[22.1033115387,218.537460327,-361.894378662],[21.7167053223,218.784469604,-362.528656006],[21.3412094116,219.0287323,-363.13961792],[20.9765014648,219.270263672,-363.728424072],[20.6223659515,219.509002686,-364.296051025],[20.278837204,219.7447052,-364.842926025],[19.9453964233,219.977539063,-365.370330811],[19.6219959259,220.207275391,-365.878845215],[19.3085327148,220.433807373,-366.368927002],[19.0043773651,220.657333374,-366.84197998],[18.7098903656,220.87739563,-367.297698975],[18.4241333008,221.094451904,-367.737854004],[18.1476097107,221.307922363,-368.16192627],[17.8794116974,221.518280029,-368.571533203],[17.6199913025,221.724960327,-368.966186523],[17.368396759,221.928497314,-369.347564697],[17.1251926422,222.128250122,-369.714935303],[16.8893184662,222.324874878,-370.070098877],[16.6613197327,222.517730713,-370.412353516],[16.4404792786,222.707214355,-370.742919922],[16.2268009186,222.8931427,-371.061920166],[16.0202541351,223.0753479,-371.369476318],[15.8200531006,223.254348755,-371.666870117],[15.6266775131,223.429550171,-371.953491211],[15.4395685196,223.601272583,-372.230224609],[15.2584686279,223.769607544,-372.497558594],[15.0835866928,223.934173584,-372.755249023],[14.914358139,224.095367432,-373.004150391],[14.7506465912,224.253158569,-373.244537354],[14.5925960541,224.407272339,-373.476257324],[14.4398231506,224.557937622,-373.699951172],[14.2919311523,224.705413818,-373.916168213],[14.1491889954,224.849304199,-374.124603271],[14.0114269257,224.989639282,-374.325531006],[13.8780708313,225.12689209,-374.519805908],[13.7492513657,225.260803223,-374.707275391],[13.624961853,225.391296387,-374.887969971],[13.5050554276,225.518386841,-375.062133789],[13.3890399933,225.642501831,-375.230499268],[13.2770090103,225.763442993,-375.392974854],[13.168964386,225.881118774,-375.549530029],[13.0647773743,225.995574951,-375.700408936],[12.9642810822,226.106903076,-375.845825195],[12.8670368195,226.215515137,-375.986450195],[12.7733039856,226.321029663,-376.121948242],[12.6829710007,226.42350769,-376.252441406],[12.5959272385,226.522994995,-376.378112793],[12.5120687485,226.619537354,-376.499145508],[12.4310789108,226.713439941,-376.615966797],[12.352971077,226.804626465,-376.728607178],[12.277765274,226.893005371,-376.837036133],[12.2053718567,226.978637695,-376.941345215],[12.1357011795,227.061569214,-377.041717529],[12.0686664581,227.141830444,-377.138244629],[12.0041875839,227.219497681,-377.231079102],[11.941950798,227.294891357,-377.320678711],[11.882106781,227.367782593,-377.406799316],[11.824596405,227.438217163,-377.489532471],[11.7693462372,227.506210327,-377.569000244],[11.7162885666,227.571853638,-377.645324707],[11.665353775,227.635162354,-377.718566895],[11.61647892,227.696182251,-377.788818359],[11.569601059,227.754989624,-377.856201172],[11.5246553421,227.811599731,-377.920806885],[11.481423378,227.866287231,-377.982940674],[11.4400196075,227.918869019,-378.042449951],[11.400387764,227.969390869,-378.099395752],[11.3624763489,228.01789856,-378.153869629],[11.3262319565,228.064437866,-378.205932617],[11.2916049957,228.109054565,-378.25567627],[11.2585487366,228.151779175,-378.303161621],[11.227016449,228.192672729,-378.348449707],[11.1969614029,228.231750488,-378.391601563],[11.1683416367,228.269088745,-378.43270874],[11.1411132813,228.3046875,-378.471832275],[11.115237236,228.338623047,-378.508972168],[11.0906734467,228.370910645,-378.544250488],[11.0673828125,228.401596069,-378.577697754],[11.0452785492,228.430786133,-378.609436035],[11.024348259,228.458480835,-378.63949585],[11.0045881271,228.484680176,-378.667877197],[10.9859638214,228.509414673,-378.694610596],[10.9684419632,228.532745361,-378.71975708],[10.9519910812,228.554672241,-378.743377686],[10.936580658,228.575241089,-378.76550293],[10.9221801758,228.594497681,-378.786193848],[10.9087600708,228.612472534,-378.805450439],[10.8962917328,228.629196167,-378.823364258],[10.8847484589,228.644683838,-378.839935303],[10.8741035461,228.658996582,-378.855194092],[10.8643312454,228.672134399,-378.869232178],[10.8554048538,228.684158325,-378.882049561],[10.8473014832,228.695083618,-378.893676758],[10.8399972916,228.704940796,-378.904174805],[10.8334674835,228.713745117,-378.913543701],[10.8276910782,228.721542358,-378.921844482],[10.8226461411,228.728363037,-378.929077148],[10.8183097839,228.734222412,-378.935302734],[10.8146629333,228.73916626,-378.940551758],[10.8116846085,228.74319458,-378.944824219],[10.8093557358,228.746337891,-378.948150635],[10.8076562881,228.748641968,-378.950592041],[10.8065681458,228.75012207,-378.952148438],[10.8060731888,228.750778198,-378.952880859],[10.8061532974,228.750671387,-378.952758789],[10.8067913055,228.749816895,-378.951843262],[10.8079710007,228.748214722,-378.950134277],[10.809674263,228.745910645,-378.947692871],[10.8118877411,228.742919922,-378.944519043],[10.8145933151,228.739257813,-378.940643311],[10.81777668,228.734954834,-378.936065674],[10.8214235306,228.730010986,-378.930847168],[10.8255186081,228.724487305,-378.924957275],[10.8300476074,228.71836853,-378.918457031],[10.8349971771,228.711685181,-378.911346436],[10.8403539658,228.704452515,-378.903656006],[10.8461036682,228.69670105,-378.89541626],[10.8522348404,228.688430786,-378.88659668],[10.8587331772,228.679672241,-378.877258301],[10.8655872345,228.670455933,-378.867431641],[10.8727846146,228.660766602,-378.857086182],[10.8803138733,228.650650024,-378.846282959],[10.8881635666,228.640106201,-378.835021973],[10.8963222504,228.629150391,-378.823303223],[10.9047784805,228.61781311,-378.811157227],[10.913520813,228.60609436,-378.798614502],[10.9225406647,228.594024658,-378.785675049],[10.9318256378,228.581604004,-378.772338867],[10.9413671494,228.568847656,-378.758636475],[10.9511537552,228.555786133,-378.744598389],[10.9611768723,228.542419434,-378.730194092],[10.9714269638,228.528762817,-378.715484619],[10.9818935394,228.514831543,-378.700439453],[10.9925680161,228.500640869,-378.685119629],[11.0034418106,228.486206055,-378.669525146],[11.0145053864,228.4715271,-378.653625488],[11.0257501602,228.456619263,-378.637481689],[11.0371685028,228.441513062,-378.62109375],[11.0487518311,228.426193237,-378.60446167],[11.0604858398,228.410690308,-378.587615967],[11.0723304749,228.395065308,-378.570587158],[11.0843153,228.379272461,-378.553375244],[11.0964336395,228.363327026,-378.535980225],[11.1086759567,228.347244263,-378.5184021],[11.1210355759,228.331008911,-378.500640869],[11.1335067749,228.314651489,-378.482757568],[11.1460809708,228.298187256,-378.464691162],[11.1587505341,228.281616211,-378.446502686],[11.1715106964,228.264938354,-378.428161621],[11.1843528748,228.248184204,-378.409729004],[11.197271347,228.23135376,-378.391174316],[11.2102594376,228.214447021,-378.372528076],[11.2233104706,228.197479248,-378.353759766],[11.2364187241,228.180465698,-378.33493042],[11.2495775223,228.163406372,-378.316040039],[11.2627811432,228.14630127,-378.297088623],[11.2760238647,228.129180908,-378.278045654],[11.2892999649,228.112030029,-378.258972168],[11.3026027679,228.094863892,-378.239868164],[11.3159275055,228.077697754,-378.220733643],[11.3292684555,228.060531616,-378.201568604],[11.3426198959,228.043380737,-378.182373047],[11.3559770584,228.026229858,-378.163208008],[11.3693342209,228.009109497,-378.144012451],[11.3826856613,227.992019653,-378.124816895],[11.396027565,227.974960327,-378.105651855],[11.4093542099,227.957946777,-378.086517334],[11.4226608276,227.940963745,-378.067382813],[11.4359426498,227.924057007,-378.048309326],[11.4491949081,227.907196045,-378.029266357],[11.4624137878,227.890396118,-378.010253906],[11.4755926132,227.873672485,-377.991333008],[11.4887285233,227.857025146,-377.972442627],[11.5018177032,227.840454102,-377.953643799],[11.5148534775,227.823974609,-377.934906006],[11.5278244019,227.807601929,-377.916259766],[11.5406942368,227.791366577,-377.897766113],[11.5535001755,227.775238037,-377.879364014],[11.5662374496,227.759216309,-377.861053467],[11.5789012909,227.743301392,-377.842834473],[11.5914897919,227.727493286,-377.824737549],[11.6039981842,227.71182251,-377.806762695],[11.6164226532,227.696258545,-377.788909912],[11.6287584305,227.680831909,-377.771179199],[11.6410036087,227.665527344,-377.753570557],[11.6531534195,227.650360107,-377.736083984],[11.6652050018,227.635345459,-377.718780518],[11.677154541,227.62046814,-377.701599121],[11.688999176,227.605728149,-377.684539795],[11.7007350922,227.591156006,-377.667663574],[11.7123584747,227.576721191,-377.650970459],[11.7238664627,227.562454224,-377.634399414],[11.7352561951,227.548355103,-377.618041992],[11.7465238571,227.534408569,-377.601837158],[11.7576675415,227.520629883,-377.58581543],[11.7686824799,227.507034302,-377.569946289],[11.7795677185,227.493606567,-377.554290771],[11.7903184891,227.480361938,-377.538848877],[11.8009328842,227.467300415,-377.52355957],[11.8114089966,227.454406738,-377.508514404],[11.8217420578,227.441711426,-377.493621826],[11.8319301605,227.429214478,-377.478973389],[11.8419704437,227.416900635,-377.464538574],[11.8518610001,227.404785156,-377.450317383],[11.8615989685,227.392852783,-377.436279297],[11.871181488,227.381134033,-377.422515869],[11.8806056976,227.369613647,-377.408935547],[11.8898696899,227.358306885,-377.395599365],[11.8989715576,227.347198486,-377.382507324],[11.907907486,227.33631897,-377.369659424],[11.9166765213,227.325637817,-377.357025146],[11.9252758026,227.315170288,-377.344665527],[11.9337034225,227.304916382,-377.332550049],[11.9419565201,227.294891357,-377.320648193],[11.9500331879,227.285079956,-377.309020996],[11.9579315186,227.275497437,-377.297668457],[11.9656486511,227.266143799,-377.286560059],[11.9731845856,227.257003784,-377.275726318],[11.9805345535,227.24810791,-377.265136719],[11.987698555,227.239440918,-377.254821777],[11.9946737289,227.231002808,-377.244781494],[12.0014543533,227.222808838,-377.235015869],[12.0080213547,227.214874268,-377.22555542],[12.0143938065,227.207183838,-377.216400146],[12.0205717087,227.19972229,-377.207489014],[12.0265522003,227.192520142,-377.198883057],[12.0323343277,227.185546875,-377.190551758],[12.0379161835,227.178817749,-377.182525635],[12.043296814,227.172348022,-377.17477417],[12.0484724045,227.166107178,-377.167327881],[12.0534439087,227.160125732,-377.16015625],[12.0582084656,227.154403687,-377.153320313],[12.0627641678,227.148925781,-377.146759033],[12.0671110153,227.143707275,-377.14050293],[12.0712461472,227.13873291,-377.134521484],[12.0751686096,227.134033203,-377.128875732],[12.0788764954,227.129577637,-377.123535156],[12.0823698044,227.12538147,-377.118530273],[12.0856456757,227.121459961,-377.113800049],[12.0887041092,227.117797852,-377.109405518],[12.0915431976,227.114395142,-377.105316162],[12.0941610336,227.111251831,-377.101531982],[12.0965576172,227.108383179,-377.098083496],[12.098731041,227.105773926,-377.094940186],[12.1006803513,227.103439331,-377.092163086],[12.1024036407,227.101379395,-377.089660645],[12.1039009094,227.099578857,-377.087524414],[12.1051712036,227.098068237,-377.085693359],[12.1062116623,227.096817017,-377.08416748],[12.1070232391,227.095840454,-377.083007813],[12.1076040268,227.095153809,-377.082183838],[12.1079540253,227.094726563,-377.081665039],[12.1080703735,227.094589233,-377.081512451],[12.1030082703,227.100646973,-377.088806152],[12.0877151489,227.118972778,-377.110809326],[12.0620384216,227.149795532,-377.147796631],[12.0258302689,227.193389893,-377.199920654],[11.9788665771,227.25012207,-377.26751709],[11.9209623337,227.320419312,-377.350860596],[11.8520994186,227.40447998,-377.449951172],[11.7721719742,227.502731323,-377.564941406],[11.6810855865,227.615570068,-377.695922852],[11.5787611008,227.743469238,-377.843048096],[11.4649057388,227.887237549,-378.00668335],[11.3394584656,228.047439575,-378.186920166],[11.2026023865,228.224411011,-378.383514404],[11.0543212891,228.418838501,-378.596466064],[10.8940935135,228.632141113,-378.826507568],[10.7225055695,228.8644104,-379.072845459],[10.539434433,229.116760254,-379.335632324],[10.3447751999,229.390426636,-379.615112305],[10.1390695572,229.685882568,-379.910491943],[9.92195415497,230.0050354,-380.222412109],[9.69424724579,230.348251343,-380.549743652],[9.45574474335,230.717605591,-380.892913818],[9.2072353363,231.113876343,-381.250915527],[8.94898319244,231.538864136,-381.623565674],[8.68157577515,231.994155884,-382.010223389],[8.40580844879,232.481231689,-382.41003418],[8.12237453461,233.002059937,-382.82232666],[7.83223962784,233.558517456,-383.24609375],[7.53656435013,234.15246582,-383.680114746],[7.23659276962,234.785995483,-384.123168945],[6.93377304077,235.461257935,-384.573760986],[6.62976789474,236.180435181,-385.030273438],[6.32646417618,236.945678711,-385.490753174],[6.02597856522,237.759140015,-385.953125],[5.73064661026,238.622970581,-386.415039063],[5.44303894043,239.539154053,-386.873962402],[5.16592884064,240.509658813,-387.327178955],[4.90228319168,241.536315918,-387.771728516],[4.65523958206,242.620788574,-388.204650879],[4.42807626724,243.764587402,-388.622711182],[4.22417879105,244.969055176,-389.022735596],[4.04720830917,246.233718872,-389.400939941],[3.90058326721,247.558807373,-389.754119873],[3.78750991821,248.946212769,-390.079437256],[3.71136379242,250.395767212,-390.373809814],[3.67384767532,251.89743042,-390.633178711],[3.64705443382,253.464172363,-390.868927002],[3.6204020977,255.092895508,-391.086547852],[3.594217062,256.771179199,-391.286834717],[3.56847000122,258.508361816,-391.472839355],[3.54324126244,260.307617188,-391.646118164],[3.51865696907,262.169464111,-391.807647705],[3.49484205246,264.094665527,-391.958221436],[3.47197508812,266.079437256,-392.098175049],[3.45016312599,268.12600708,-392.228179932],[3.4294924736,270.239715576,-392.348907471],[3.41010570526,272.421936035,-392.460693359],[3.392152071,274.674102783,-392.563812256],[3.37578892708,276.997772217,-392.658447266],[3.3611831665,279.39453125,-392.744689941],[3.34852552414,281.862945557,-392.822631836],[3.33799815178,284.403656006,-392.892272949],[3.32977604866,287.022705078,-392.953857422],[3.32406973839,289.721923828,-393.007324219],[3.32110357285,292.503234863,-393.052642822],[3.32111620903,295.368591309,-393.089813232],[3.32436132431,298.320068359,-393.118713379],[3.33108568192,301.35144043,-393.139221191],[3.341578722,304.47253418,-393.151306152],[3.35614466667,307.685760498,-393.154876709],[3.37510633469,310.993225098,-393.149719238],[3.3988070488,314.397094727,-393.13571167],[3.42753005028,317.890380859,-393.112731934],[3.46170926094,321.48336792,-393.080596924],[3.50175786018,325.178924561,-393.039031982],[3.54810833931,328.979156494,-392.987884521],[3.6010787487,332.876373291,-392.927062988],[3.661236763,336.88067627,-392.856262207],[3.72910690308,340.995269775,-392.775177002],[3.80511641502,345.216339111,-392.683685303],[3.889783144,349.544708252,-392.581634521],[3.98379945755,353.988098145,-392.468597412],[4.08762454987,358.541351318,-392.344482422],[4.20186901093,363.205749512,-392.209106445],[4.32732582092,367.988189697,-392.062011719],[4.46435451508,372.877929688,-391.90335083],[4.61388778687,377.88470459,-391.732574463],[4.77649688721,383.003936768,-391.549682617],[4.95284843445,388.234100342,-391.354492188],[5.14379549026,393.578155518,-391.146728516],[5.34980487823,399.027709961,-390.926483154],[5.57190513611,404.588989258,-390.693328857],[5.81044578552,410.250396729,-390.447601318],[6.06650447845,416.017822266,-390.188842773],[6.3403968811,421.879364014,-389.917419434],[6.63311767578,427.838012695,-389.633087158],[6.94502735138,433.883544922,-389.336120605],[7.27690649033,440.014373779,-389.026519775],[7.62922716141,446.223236084,-388.704528809],[8.00244045258,452.503051758,-388.370391846],[8.39717388153,458.850158691,-388.024230957],[8.81346225739,465.251953125,-387.666656494],[9.2519903183,471.706695557,-387.297698975],[9.71267414093,478.201782227,-386.91809082],[10.1958551407,484.731842041,-386.528076172],[10.7015714645,491.28793335,-386.128234863],[11.2296791077,497.859954834,-385.719146729],[11.7803182602,504.442230225,-385.301239014],[12.3529977798,511.022491455,-384.875335693],[12.9477396011,517.59564209,-384.441833496],[13.564043045,524.151489258,-384.001525879],[14.2015714645,530.682800293,-383.554962158],[14.8598508835,537.181762695,-383.102783203],[15.5383119583,543.64074707,-382.645690918],[16.2364330292,550.053344727,-382.184265137],[16.9535312653,556.412475586,-381.719177246],[17.6889858246,562.712585449,-381.25100708],[18.4420890808,568.948059082,-380.780334473],[19.2121162415,575.113708496,-380.307769775],[19.9983634949,581.20526123,-379.833770752],[20.8000640869,587.218505859,-379.358917236],[21.6164493561,593.149780273,-378.88369751],[22.4468803406,598.996704102,-378.408508301],[23.2904319763,604.755432129,-377.933837891],[24.1465835571,610.425231934,-377.460021973],[25.014509201,616.003479004,-376.987426758],[25.8933753967,621.488037109,-376.51651001],[26.7828083038,626.879760742,-376.047363281],[27.681968689,632.176757813,-375.580413818],[28.5900859833,637.377868652,-375.115936279],[29.5065937042,642.483276367,-374.654144287],[30.4312858582,647.495117188,-374.195068359],[31.3631649017,652.411315918,-373.739074707],[32.3016815186,657.23236084,-373.286376953],[33.2463150024,661.958984375,-372.837036133],[34.1966438293,666.592346191,-372.391204834],[35.1525192261,671.134887695,-371.948822021],[36.1130905151,675.58581543,-371.510162354],[37.0779266357,679.946166992,-371.075317383],[38.0466194153,684.217163086,-370.644317627],[39.0187759399,688.40020752,-370.217254639],[39.9940261841,692.496582031,-369.794189453],[40.9720115662,696.507629395,-369.37512207],[41.9574813843,700.45489502
,-368.957946777],[42.9554176331,704.359008789,-368.540557861],[43.9658050537,708.219665527,-368.123016357],[44.9886398315,712.036804199,-367.705352783],[46.0239105225,715.810241699,-367.287597656],[47.0716056824,719.539855957,-366.869781494],[48.1317100525,723.225402832,-366.45199585],[49.2042121887,726.866760254,-366.034240723],[50.2890968323,730.463806152,-365.616546631],[51.3863449097,734.016296387,-365.198944092],[52.4959373474,737.524108887,-364.781524658],[53.6178512573,740.987121582,-364.364318848],[54.7520637512,744.405090332,-363.947296143],[55.8985481262,747.777893066,-363.530578613],[57.05727005,751.10534668,-363.11416626],[58.2281951904,754.387268066,-362.6980896],[59.4112854004,757.623535156,-362.282409668],[60.6064987183,760.813842773,-361.867156982],[61.8137893677,763.958129883,-361.452392578],[63.0331001282,767.056213379,-361.038116455],[64.2593231201,770.110900879,-360.625244141],[65.4782409668,773.126342773,-360.216247559],[66.6894989014,776.10369873,-359.811157227],[67.8930969238,779.04296875,-359.409973145],[69.089012146,781.944274902,-359.012634277],[70.2772369385,784.807556152,-358.61920166],[71.4577636719,787.633056641,-358.22958374],[72.6305770874,790.420715332,-357.843841553],[73.7956542969,793.170654297,-357.461914063],[74.9529876709,795.882995605,-357.08380127],[76.1025543213,798.557739258,-356.709472656],[77.2443466187,801.195068359,-356.33895874],[78.3783340454,803.79510498,-355.972229004],[79.5045013428,806.357849121,-355.60925293],[80.6228179932,808.883483887,-355.250030518],[81.7340087891,811.373779297,-354.894348145],[82.8374938965,813.827575684,-354.542297363],[83.9331054688,816.244628906,-354.193969727],[85.0208053589,818.62512207,-353.849334717],[86.1005630493,820.969238281,-353.508361816],[87.1723556519,823.276977539,-353.171081543],[88.2361373901,825.548583984,-352.837463379],[89.291885376,827.784240723,-352.507507324],[90.339553833,829.984008789,-352.181182861],[91.3791046143,832.148071289,-351.858459473],[92.4104995728,834.276672363,-351.539367676],[93.4336929321,836.369873047,-351.223907471],[94.4498596191,838.430419922,-350.911651611],[95.4579849243,840.456359863,-350.602905273],[96.457824707,842.447631836,-350.297729492],[97.4493103027,844.40423584,-349.996124268],[98.4323959351,846.326538086,-349.698059082],[99.4070205688,848.214660645,-349.403533936],[100.373130798,850.068786621,-349.112548828],[101.33065033,851.889160156,-348.82510376],[102.280815125,853.678344727,-348.540802002],[103.222938538,855.435424805,-348.25982666],[104.156333923,857.159423828,-347.982330322],[105.080924988,858.850524902,-347.708343506],[105.996650696,860.509033203,-347.437835693],[106.903411865,862.135070801,-347.170837402],[107.801956177,863.73046875,-346.907073975],[108.692955017,865.296569824,-346.646331787],[109.574813843,866.831115723,-346.389068604],[110.44744873,868.33416748,-346.135253906],[111.310760498,869.806091309,-345.88494873],[112.164985657,871.247680664,-345.637969971],[113.012153625,872.662658691,-345.393798828],[113.849784851,874.047302246,-345.153045654],[114.677772522,875.401794434,-344.915771484],[115.496002197,876.726501465,-344.681976318],[116.306365967,878.024719238,-344.451080322],[117.10799408,879.295593262,-344.223297119],[117.899620056,880.537414551,-343.998962402],[118.681129456,881.750488281,-343.778106689],[119.45475769,882.938720703,-343.560089111],[120.219261169,884.100524902,-343.345184326],[120.973381042,885.23449707,-343.133758545],[121.717391968,886.341430664,-342.925689697],[122.454231262,887.426147461,-342.720184326],[123.180389404,888.483825684,-342.518127441],[123.895751953,889.514770508,-342.319549561],[124.603744507,890.524353027,-342.123504639],[125.301368713,891.508666992,-341.930786133],[125.987884521,892.467102051,-341.741577148],[126.666984558,893.405212402,-341.554840088],[127.335456848,894.319030762,-341.371429443],[127.992805481,895.208251953,-341.191467285],[128.643081665,896.078735352,-341.013824463],[129.281784058,896.924865723,-340.83972168],[129.910964966,897.749755859,-340.668548584],[130.531173706,898.55456543,-340.500183105],[131.13949585,899.335876465,-340.335357666],[131.740875244,900.100402832,-340.172729492],[132.33039856,900.842285156,-340.01361084],[132.911102295,901.565734863,-339.857147217],[133.481689453,902.26953125,-339.703704834],[134.042068481,902.953857422,-339.553253174],[134.593612671,903.620788574,-339.405456543],[135.134033203,904.267883301,-339.260864258],[135.666412354,904.899169922,-339.118682861],[136.187210083,905.510864258,-338.979797363],[136.700332642,906.107788086,-338.843170166],[137.201873779,906.685791016,-338.709838867],[137.695663452,907.249572754,-338.578765869],[138.178314209,907.795532227,-338.450836182],[138.652694702,908.327331543,-338.325286865],[139.116836548,908.842895508,-338.202606201],[139.571762085,909.343811035,-338.082519531],[140.017745972,909.830505371,-337.964935303],[140.453216553,910.301696777,-337.850280762],[140.881439209,910.761047363,-337.737670898],[141.298553467,911.204711914,-337.628112793],[141.708282471,911.636962891,-337.520629883],[142.108337402,912.055541992,-337.415802002],[142.498718262,912.460693359,-337.313598633],[142.882125854,912.855407715,-337.213348389],[143.255264282,913.236633301,-337.115875244],[143.620361328,913.606750488,-337.020599365],[143.97756958,913.966186523,-336.927490234],[144.325057983,914.313232422,-336.836975098],[144.665252686,914.650512695,-336.748474121],[144.997558594,914.977600098,-336.662078857],[145.320648193,915.293395996,-336.578155518],[145.636413574,915.599914551,-336.49621582],[145.945068359,915.897521973,-336.416168213],[146.245040894,916.184875488,-336.338439941],[146.536911011,916.462585449,-336.2628479],[146.823196411,916.733276367,-336.188781738],[147.101318359,916.994628906,-336.116882324],[147.371490479,917.246948242,-336.047088623],[147.63508606,917.491699219,-335.979034424],[147.892623901,917.729431152,-335.912567139],[148.142730713,917.95892334,-335.848083496],[148.385604858,918.180541992,-335.785491943],[148.622238159,918.395324707,-335.72454834],[148.853546143,918.604187012,-335.665008545],[149.078125,918.805847168,-335.60723877],[149.296142578,919.000671387,-335.551177979],[149.507797241,919.188842773,-335.496795654],[149.714797974,919.372009277,-335.443603516],[149.916305542,919.549438477,-335.391876221],[150.111907959,919.72088623,-335.341674805],[150.301818848,919.88659668,-335.29296875],[150.486206055,920.04675293,-335.245697021],[150.666091919,920.202392578,-335.199584961],[150.841705322,920.353637695,-335.154602051],[151.012268066,920.499938965,-335.110931396],[151.177947998,920.641479492,-335.068511963],[151.338928223,920.778503418,-335.02734375],[151.495361328,920.911132813,-334.987335205],[151.647888184,921.039978027,-334.94833374],[151.797195435,921.165588379,-334.91015625],[151.94241333,921.287414551,-334.873046875],[152.083724976,921.405517578,-334.83694458],[152.221252441,921.520019531,-334.801849365],[152.355194092,921.631225586,-334.76763916],[152.485671997,921.739196777,-334.734344482],[152.612854004,921.844116211,-334.701904297],[152.738021851,921.947021484,-334.66998291],[152.860244751,922.047241211,-334.638793945],[152.979598999,922.144775391,-334.608398438],[153.096221924,922.239807129,-334.578674316],[153.210266113,922.332519531,-334.549591064],[153.321884155,922.422973633,-334.521179199],[153.43119812,922.511291504,-334.49331665],[153.538375854,922.597717285,-334.466033936],[153.643554688,922.682250977,-334.43927002],[153.747817993,922.765869141,-334.412719727],[153.850311279,922.847839355,-334.386657715],[153.951187134,922.928283691,-334.360992432],[154.050582886,923.007385254,-334.335723877],[154.148590088,923.085144043,-334.310791016]]},t}(Base3DChapter),Canvas=function(e){function t(){return this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="canvas",t.prototype.context=null,t.prototype.attr=null,t.prototype.paused=!0,t.prototype.initialize=function(e,n){return e==null&&(e=1024),n==null&&(n=768),this.attr={width:e,height:n},t.__super__.initialize.call(this),null},t.prototype.init=function(){return this.$el.attr(this.attr),this.context=this.el.getContext("2d"),null},t}(Abstract),CheckBox=function(e){function t(){return this.val=__bind(this.val,this),this.toggleCheck=__bind(this.toggleCheck,this),this.click=__bind(this.click,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.check=null,t.prototype.checked=null,t.prototype.className="openingCheckBox",t.prototype.init=function(){return this.$el.addClass("btanimated"),this.check=new SSAsset("interface","checkbox"),this.check.mouseEnabled(!1),this.addChild(this.check),this.check.$el.addClass("openingCheckBox"),this.check.$el.css({"background-position-y":parseInt(this.check.$el.css("background-position-y"))+1,height:parseInt(this.check.$el.css("height"))+1,width:parseInt(this.check.$el.css("width"))+1}),this.checked=new SSAsset("interface","checkbox_checked"),this.checked.mouseEnabled(!1),this.addChild(this.checked),this.checked.$el.addClass("openingCheckBox"),this.checked.$el.css({"background-position-y":parseInt(this.checked.$el.css("background-position-y"))+1,height:parseInt(this.checked.$el.css("height"))+1,width:parseInt(this.check.$el.css("width"))+1}),this.checked.hide(),this.$el.click(this.click),null},t.prototype.click=function(){return this.trigger("toggled"),null},t.prototype.toggleCheck=function(){return this.check.visible?this.check.hide():this.check.show(),this.checked.visible?this.checked.hide():this.checked.show(),null},t.prototype.val=function(){return this.checked.visible},t}(Abstract),Instructions=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="instructionsContainer",t.prototype.active=!1,t.prototype.initialize=function(e){var n,r,i,s;return t.__super__.initialize.call(this),n=$("            <div class='box'>                <div id='r1' class='row'>                    <div id='c11' class='cell'></div>                    <div id='c12' class='cell'></div>                    <div id='c13' class='cell'></div>                </div>                <div id='r2' class='row'>                    <div id='c21' class='cell'></div>                    <div id='c22' class='cell'></div>                    <div id='c23' class='cell'></div>                </div>                <div id='r3' class='row'>                    <div id='c31' class='cell'></div>                    <div id='c32' class='cell'></div>                    <div id='c33' class='cell'></div>                </div>            </div>"),this.addChild(n),i=new SSAsset("interface",e.assetID),i.css({margin:"0 auto"}),n.find("#c22").append(i.$el),s=$("<p>"+this.oz().locale.get(e.localeID)+"</p>"),n.find("#c22").append(s),r=new SSAsset("interface","instructions_flourish"),r.css({margin:"0 auto"}),n.find("#c22").append(r.$el),null},t.prototype.show=function(e,n){return this.active=!0,t.__super__.show.call(this,e,n),null},t.prototype.hide=function(e,n){var r=this;return t.__super__.hide.call(this,e,function(){return typeof n=="function"&&n(),r.active=!1}),null},t.prototype.dispose=function(){return null},t}(Abstract),InstructionsChapter=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.close=__bind(this.close,this),this.onMouseMove=__bind(this.onMouseMove,this),this.addMouseListener=__bind(this.addMouseListener,this),this.activate=__bind(this.activate,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="instructionsChapterContainer",t.prototype.timeoutToMouseMove=null,t.prototype.activated=!1,t.prototype.initialize=function(){return t.__super__.initialize.call(this),this.instructions=new Instructions({assetID:"instructions_music",localeID:"landingInstructions"}),this.addChild(this.instructions),this.instructions.$el.css({display:"table-cell","vertical-align":"middle"}),this.instructions.$el.find("#c22 p").css({"text-transform":"uppercase"}),this.instructions.$el.find("#c22 p").append("<br>"+this.oz().locale.get("landing_instructions_small")),this.hide(),null},t.prototype.activate=function(){if(this.oz().router.showInstructions===!1)return;return this.activated||(this.activated=!0,this.show(!0),this.instructions.show(!0),this.$el.bind("mousedown",this.close),this.timeoutToMouseMove=setTimeout(this.addMouseListener,4e3)),null},t.prototype.addMouseListener=function(){return document.addEventListener("mousemove",this.onMouseMove,!1),null},t.prototype.onMouseMove=function(){return this.close(),null},t.prototype.close=function(){var e=this;return clearTimeout(this.timeoutToMouseMove),this.$el.unbind("mousedown"),document.removeEventListener("mousemove",this.onMouseMove,!1),this.hide(!0,function(){return e.oz().appView.area.remove(e.oz().appView.area.chapterInstructions),e.oz().appView.area.chapterInstructions=null}),null},t.prototype.dispose=function(){return null},t}(Abstract),LocalisedTexture=function(){function e(){this.trim=__bind(this.trim,this),this.wrapText=__bind(this.wrapText,this),this.get=__bind(this.get,this),this.diamond=window.oz.baseAssets.get("diamond").result,$('<p style="font-family: "TradeGothic"" />'),null}return e.prototype.title=null,e.prototype.canvas=null,e.prototype.ctx=null,e.prototype.flourish=null,e.prototype.diamond=null,e.prototype.wHalf=null,e.prototype.icon=null,e.prototype.get=function(e){var t,n,r;return this.icon=window.oz.baseAssets.get("section_icon_"+e).result,this.canvas=document.createElement("canvas"),this.canvas.width=1e3,this.canvas.height=1e3,this.ctx=this.canvas.getContext("2d"),this.wHalf=parseInt(this.canvas.width)/2,this.ctx.drawImage(this.diamond,this.wHalf-4,0),this.ctx.drawImage(this.icon,this.wHalf-30,15),t=window.oz.locale.get(e+"Title"),this.ctx.font="46px TradeGothic",this.ctx.save(),this.ctx.fillStyle="#FFF",this.ctx.textAlign="center",this.ctx.textBaseline="top",r=this.wrapText(this.ctx,t,this.wHalf,88,400,46),n="",n.length>0&&(this.ctx.font="14px TradeGothic",this.ctx.save(),this.ctx.fillStyle="#FFF",this.ctx.textAlign="center",this.ctx.textBaseline="top",r=this.wrapText(this.ctx,n,this.wHalf,r,400,14)),this.ctx.drawImage(this.diamond,this.wHalf-4,r+5),this.trim()},e.prototype.wrapText=function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m;d=t.split(" "),u="",l=!1;for(f=v=0,m=d.length;0<=m?v<m:v>m;f=0<=m?++v:--v)p=d[f],o=!1,p.indexOf("<br>")>-1&&(p=p.replace("<br>"," "),o=!0,c=u),c=u+p+" ",a=e.measureText(c),h=a.width,h>i||o?(e.fillText(u,n,r),u=p+" ",r+=s):u=c;return e.fillText(u,n,r),r+s},e.prototype.trim=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;t=this.canvas,n=document.createElement("canvas").getContext("2d"),s=this.ctx.getImageData(0,0,t.width,t.height),i=s.data.length,e={top:null,left:null,right:null,bottom:null};for(r=c=0,h=i-1;c<=h;r=c+=4)s.data[r+3]!==0&&(f=r/4%t.width,l=~~(r/4/t.width),e.top===null&&(e.top=l),e.left===null?e.left=f:f<e.left&&(e.left=f),e.right===null?e.right=f:e.right<f&&(e.right=f),e.bottom===null?e.bottom=l:e.bottom<l&&(e.bottom=l));return e.width=Math.max(e.right-e.left,180),e.height=Math.max(e.bottom-e.top,145),u=1024,o=1024,a=this.ctx.getImageData(e.left,e.top,u,o),n.canvas.width=u,n.canvas.height=o,n.putImageData(a,u/2-(e.right-e.left)/2,o/2-(e.bottom-e.top)/2),{canvas:n.canvas,bound:e}},e}(),Logo=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.enable=__bind(this.enable,this),this.disable=__bind(this.disable,this),this.onClick=__bind(this.onClick,this),this.logoRollOut=__bind(this.logoRollOut,this),this.logoRollOver=__bind(this.logoRollOver,this),this.showGoogleLogos=__bind(this.showGoogleLogos,this),this.hideGoogleLogos=__bind(this.hideGoogleLogos,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.id="logo",t.prototype.obj=null,t.prototype.chromeLogo=null,t.prototype.googleLogo=null,t.prototype.init=function(){var e=this;return this.canvas=new LogoParticles(80,80),this.logoContainer=$("<div class='logo'/>"),this.assetLogo=new SSAsset("interface","logo_oz"),this.assetLogoOver=new SSAsset("interface","logo_oz_over"),this.assetLogoOver.hide(!1),this.logoContainer.append(this.assetLogo.$el),this.logoContainer.append(this.assetLogoOver.$el),this.addChild(this.logoContainer),this.addChild(this.canvas),this.canvas.init(),this.chromeLogo=new SSAsset("interface","logo_chrome"),this.chromeLogo.addClass("chrome"),this.chromeLogo.addClass("button_alpha_enabled"),this.chromeLogo.$el.bind("click",function(){return Analytics.track("click_chrome_logo"),window.open("http://www.chromeexperiments.com/")}),this.addChild(this.chromeLogo),this.googleLogo=new SSAsset("interface","logo_google"),this.googleLogo.addClass("google"),this.googleLogo.addClass("button_alpha_enabled"),this.googleLogo.$el.bind("click",function(){return Analytics.track("click_friends_google"),window.open("http://google.com/")}),this.addChild(this.googleLogo),this.enable(),null},t.prototype.hideGoogleLogos=function(){return this.googleLogo.$el.removeClass("button_alpha_enabled"),this.chromeLogo.$el.removeClass("button_alpha_enabled"),this.chromeLogo.hide(!0,null,400,"linear",!0),this.googleLogo.hide(!0,null,400,"linear",!0),null},t.prototype.showGoogleLogos=function(){var e=this;return this.chromeLogo.show(!0,null,400,"linear"),this.googleLogo.show(!0,function(){return e.googleLogo.$el.hasClass("button_alpha_enabled")&&(e.googleLogo.$el.removeClass("button_alpha_enabled"),e.chromeLogo.$el.removeClass("button_alpha_enabled")),e.googleLogo.$el.addClass("button_alpha_enabled"),e.chromeLogo.$el.addClass("button_alpha_enabled")},400,"linear"),null},t.prototype.logoRollOver=function(){return this.canvas.show(),this.assetLogoOver.show(!0,null,200),this.assetLogo.hide(!0,null,200),null},t.prototype.logoRollOut=function(){return this.canvas.hide(),this.assetLogoOver.hide(!0,null,200),this.assetLogo.show(!0,null,200),null},t.prototype.onClick=function(){return this.canvas.hide(),this.assetLogoOver.hide(!0,null,200),this.assetLogo.show(!0,null,200),this.oz().router.navigateTo("carnival",!1),null},t.prototype.disable=function(){return this.logoContainer.unbind("click"),this.logoContainer.css({cursor:"default"}),this.logoContainer.unbind("mouseover"),this.logoContainer.unbind("mouseout"),null},t.prototype.enable=function(){return this.disable(),this.logoContainer.bind("click",this.onClick),this.logoContainer.css({cursor:"pointer"}),this.logoContainer.bind("mouseover",this.logoRollOver),this.logoContainer.bind("mouseout",this.logoRollOut),null},t.prototype.dispose=function(){return this.logoContainer.unbind("mouseover"),this.logoContainer.unbind("mouseout"),this.logoContainer.unbind("click"),null},t}(Abstract),LogoParticles=function(e){function t(){return this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="logoParticles",t.prototype.particles=null,t.prototype.speed=.6,t.prototype.paused=!0,t.prototype.init=function(){var e,n,r;t.__super__.init.call(this),this.mouseEnabled(!1),this.particles=[],this.paused=!0,this.$el.css({opacity:0});for(e=r=0;r<=20;e=++r)n=new Particle({_canvas:this.context,_w:this.$el[0].width,_h:this.$el[0].height,_maxSize:3,_speed:.6,_type:0,_rect:{x:0,y:0,w:80,h:80}}),this.particles.push(n);return},t.prototype.onEnterFrame=function(){var e,t,n,r;if(this.paused)return;this.clear(),r=this.particles;for(t=0,n=r.length;t<n;t++)e=r[t],e.move(),e.draw();return},t.prototype.show=function(){return this.resume(),this.$el.stop().animate({opacity:1}),null},t.prototype.hide=function(){return this.$el.stop().animate({opacity:0},this.pause),null},t.prototype.clear=function(){return this.context.clearRect(0,0,this.$el[0].width,this.$el[0].height),null},t.prototype.rand=function(e,t){return e==null&&(e=0),t==null&&(t=1),(Math.random()*(t-e)+e)%t},t}(Canvas),Map=function(e){function t(){return this.changeMenuArea=__bind(this.changeMenuArea,this),this.show=__bind(this.show,this),this.hide=__bind(this.hide,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.base=null,t.prototype.buttonsCoord=null,t.prototype.className="map",t.prototype.currentIndex=-1,t.prototype.buttons=null,t.prototype.view=null,t.prototype.init=function(){return this.view=new MapMenu,this.addChild(this.view),null},t.prototype.hide=function(e,t,n,r){return e==null&&(e=!1),t==null&&(t=null),n==null&&(n=400),r==null&&(r="linear"),this.visible=!1,this.mouseEnabled(!1),e?this.view.animateOut(t):typeof t=="function"&&t(),null},t.prototype.show=function(e,t,n,r){return e==null&&(e=!1),t==null&&(t=null),n==null&&(n=400),r==null&&(r="linear"),this.visible=!0,this.mouseEnabled(!0),e?(this.view.animateIn(),typeof t=="function"&&t()):(this.view.animateIn(),typeof t=="function"&&t()),null},t.prototype.showMenu=function(){return null},t.prototype.changeMenuArea=function(e){return this.view.changeMenuArea(e),null},t}(Abstract),MapMenu=function(e){function t(){return this.createSequence=__bind(this.createSequence,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.changeMenuArea=__bind(this.changeMenuArea,this),this.menuEvents=__bind(this.menuEvents,this),this.menuClick=__bind(this.menuClick,this),this.animateOut=__bind(this.animateOut,this),this.animateIn=__bind(this.animateIn,this),this.render=__bind(this.render,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="div",t.prototype.stage=null,t.prototype.canvas=null,t.prototype.fill=null,t.prototype.buttons=null,t.prototype.seq=null,t.prototype.paused=!0,t.prototype.container=null,t.prototype.animateSequence=null,t.prototype.timeout=0,t.prototype.scale=0,t.prototype.totalW=0,t.prototype.center=0,t.prototype.init=function(){return this.scale=.7,this.canvas=document.createElement("canvas"),this.canvas.width=800,this.canvas.height=160,this.$el.append(this.canvas),this.stage=new createjs.Stage(this.canvas),this.stage.mouseEventsEnabled=!0,this.stage.enableMouseOver(10),this.container=new createjs.Container,this.stage.addChild(this.container),this.fill=this.oz().baseAssets.get("buttonpattern").result,this.render(),null},t.prototype.render=function(){var e,t,n,r,i;this.createSequence(),this.animateSequence=[],this.buttons=[],this.totalW=35,this.center=75;for(e=r=0,i=this.seq.length;0<=i?r<i:r>i;e=0<=i?++r:--r){t=this.seq[e];switch(t.type){case"scene":n=new MenuFilledCircle(this.totalW,this.center,30*this.scale,this.scale,this.oz().baseAssets.get("menu_"+t.id).result,this.oz().baseAssets.get("menu_on").result),this.buttons.push(n),n.id=t.id,this.totalW+=e<this.seq.length-1?43:35;break;case"sep":n=new MenuSeparator(this.totalW,this.center),this.totalW+=t.space}this.animateSequence.push(n),this.container.addChild(n.view),n.on&&(n.on("click",this.menuClick),n.on("rollover",this.menuEvents),n.on("rollout",this.menuEvents))}return this.container.x=this.canvas.width/2-this.totalW/2,this.paused=!1,null},t.prototype.animateIn=function(){var e,t,n;clearTimeout(this.timeout);for(e=t=0,n=this.animateSequence.length;0<=n?t<n:t>n;e=0<=n?++t:--t)this.animateSequence[e].animateIn(25*e);return null},t.prototype.animateOut=function(e){var t,n,r;for(t=n=r=this.animateSequence.length-1;r<=0?n<=0:n>=0;t=r<=0?++n:--n)this.animateSequence[t].animateOut(25*t);return this.timeout=setTimeout(e,this.animateSequence.length*25+500),null},t.prototype.menuClick=function(e){return Analytics.track("menu_click_"+e.id),$(this.canvas).css({cursor:""}),this.oz().router.navigateTo(e.id,!1),null},t.prototype.menuEvents=function(e){var t;return t=e==="rollover"?"pointer":"",$(this.canvas).css({cursor:t}),null},t.prototype.changeMenuArea=function(e){var t,n,r,i;i=this.buttons;for(n=0,r=i.length;n<r;n++)t=i[n],t.menuState(t.id===e);return null},t.prototype.onEnterFrame=function(){return this.stage.update(),TWEEN.update(),null},t.prototype.createSequence=function(){return this.seq=[{type:"scene",id:"carnival"},{type:"sep",space:16},{type:"sep",space:16},{type:"sep",space:48},{type:"scene",id:"carnival2"},{type:"sep",space:16},{type:"sep",space:16},{type:"sep",space:48},{type:"scene",id:"carnival3"}],null},t}(Abstract),MenuFilledCircle=function(){function e(e,t,n,r,i,s){this.menuState=__bind(this.menuState,this),this.animateOut=__bind(this.animateOut,this),this.animateIn=__bind(this.animateIn,this),this.animateCircle=__bind(this.animateCircle,this),this.draw=__bind(this.draw,this),this.disable=__bind(this.disable,this);var o=this;_.extend(this,Backbone.Events),this.radius=n,this.iconAsset=i,this.glowAsset=s,this.targetY=t,this.current={y:400},this.currentState={radius:this.radius,stroke:4,alpha:0,rotation:0},this.view=new createjs.Container,this.view.x=e,this.view.y=this.current.y,this.view.onMouseOver=function(e){if(o.clicked)return;return o.animateCircle(n+o.radius*.25),o.trigger("rollover","rollover")},this.view.onMouseOut=function(e){if(o.clicked)return;return o.animateCircle(o.radius),o.trigger("rollout","rollout")},this.view.onClick=function(e){return o.animateCircle(o.radius),o.trigger("click",o)},this.circle=new createjs.Shape,this.draw(this.radius,this.currentState.stroke),this.icon=new createjs.Bitmap(this.iconAsset),this.icon.regX=this.icon.regY=17,this.icon.scaleX=this.icon.scaleY=r,this.glow=new createjs.Bitmap(this.glowAsset),this.glow.regX=74.5,this.glow.regY=74.5,this.glow.scaleX=this.glow.scaleY=r,this.glow.alpha=0,this.view.addChild(this.circle),this.view.addChild(this.icon),this.view.addChild(this.glow),null}return e.prototype.view=null,e.prototype.circle=null,e.prototype.radius=null,e.prototype.currentState=null,e.prototype.tween=null,e.prototype.targetY=null,e.prototype.current=null,e.prototype.id=null,e.prototype.arrow=null,e.prototype.icon=null,e.prototype.iconAsset=null,e.prototype.glowAsset=null,e.prototype.glow=null,e.prototype.disable=function(){return null},e.prototype.draw=function(e,t){return this.circle.graphics.clear(),this.circle.graphics.setStrokeStyle(t),this.circle.graphics.beginFill("rgba(255, 255, 255, 0.39)"),this.circle.graphics.beginStroke("#FFFFFF"),this.circle.graphics.drawCircle(0,0,this.currentState.radius),this.circle.graphics.endFill(),null},e.prototype.animateCircle=function(e,t,n){var r=this;return t==null&&(t=0),this.tween=(new TWEEN.Tween(this.currentState)).to({radius:e},200).easing(TWEEN.Easing.Quadratic.Out),this.tween.onUpdate(function(e){return r.draw(r.currentState.radius,r.currentState.stroke)}),this.tween.start(),null},e.prototype.animateIn=function(e){var t=this;return this.tween=(new TWEEN.Tween(this.current)).to({y:this.targetY},600).easing(TWEEN.Easing.Back.Out).delay(e),this.tween.onUpdate(function(e){return t.view.y=t.current.y}),this.tween.start(),null},e.prototype.animateOut=function(e){var t=this;return this.tween=(new TWEEN.Tween(this.current)).to({y:400},600).easing(TWEEN.Easing.Back.In).delay(e),this.tween.onUpdate(function(e){return t.view.y=t.current.y}),this.tween.start(),null},e.prototype.menuState=function(e){var t;return e==null&&(e=!0),this.clicked=e,t=(new TWEEN.Tween(this.glow)).to({alpha:e?1:0},400),t.start(),null},e}(),MenuSeparator=function(){function e(e,t){this.menuState=__bind(this.menuState,this),this.animateOut=__bind(this.animateOut,this),this.animateIn=__bind(this.animateIn,this),this.current={y:200},this.view=new createjs.Container,this.view.x=e,this.view.y=this.current.y,this.targetY=t,this.shape=new createjs.Shape,this.shape.graphics.beginFill("#FFF"),this.shape.graphics.drawCircle(0,0,3.5),this.shape.graphics.endFill(),this.view.addChild(this.shape),null}return e.prototype.view=null,e.prototype.shape=null,e.prototype.targetY=null,e.prototype.current=null,e.prototype.tween=null,e.prototype.animateIn=function(e){var t=this;return this.tween=(new TWEEN.Tween(this.current)).to({y:this.targetY},600).easing(TWEEN.Easing.Back.Out).delay(e),this.tween.onUpdate(function(e){return t.view.y=t.current.y}),this.tween.start(),null},e.prototype.animateOut=function(e){var t=this;return this.tween=(new TWEEN.Tween(this.current)).to({y:200},600).easing(TWEEN.Easing.Back.In).delay(e),this.tween.onUpdate(function(e){return t.view.y=t.current.y}),this.tween.start(),null},e.prototype.menuState=function(e){return e==null&&(e=!0),null},e}(),OpeningTitles=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.render=__bind(this.render,this),this.init=__bind(this.init,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.template="openingTitles",t.prototype.fluorish=null,t.prototype.diamond=null,t.prototype.className="openingTitles",t.prototype.divider=null,t.prototype.cta=null,t.prototype.header=null,t.prototype.pauseState=!1,t.prototype.initialize=function(e,n,r,i){return r==null&&(r=!0),i==null&&(i=!1),this.templateVars={title:e,cta:n},this.pauseState=i,this.divider=r,t.__super__.initialize.call(this),null},t.prototype.init=function(){var e,t,n,r;return this.fluorish=new SSAsset("interface","pause_top"),this.addChild(this.fluorish,1),this.fluorish.center(),this.diamond=new SSAsset("interface","pause_bottom"),this.addChild(this.diamond),this.diamond.center(),this.divider&&(this.cta=this.$el.find(".openingTitlesCTA"),e=new SSAsset("interface","pause_left"),n=new SSAsset("interface","pause_right"),t=$("<span class='left'>"),t.append(e.$el),r=$("<span class='right'>"),r.append(n.$el),this.cta.prepend(t),this.cta.append(r)),this.header=this.$el.find(".openingTitlesHeader"),null},t.prototype.render=function(e){var t=this;return setTimeout(function(){var n;n=parseInt(window.getComputedStyle(t.header[0],null).fontSize);while(parseInt(t.header.find("span").width())>725)n--,t.header.css({"font-size":n});return t.header.css({"line-height":n-2+"px"}),e()},200),null},t.prototype.dispose=function(){return null},t}(Abstract),Particle=function(){function e(e){this.fadeOut=__bind(this.fadeOut,this),this.reset=__bind(this.reset,this),this.move=__bind(this.move,this),this.rand=__bind(this.rand,this),this.drawParticle=__bind(this.drawParticle,this),this.draw=__bind(this.draw,this),this.speed=e._speed,this.maxSize=e._maxSize,this.canvas=e._canvas,this.w=e._w,this.h=e._h,this.type=e._type,this.rect=e._rect,this.r=this.rand(this.minSize,this.maxSize),this.dx=this.rand(-this.speed,this.speed),this.dy=this.rand(-this.speed,this.speed),null}return e.prototype.dx=0,e.prototype.dy=0,e.prototype.x=0,e.prototype.y=0,e.prototype.r=0,e.prototype.canvas=null,e.prototype.w=0,e.prototype.h=0,e.prototype.image=null,e.prototype.alpha=0,e.prototype.rColour=0,e.prototype.mult=1,e.prototype.minSize=.8,e.prototype.maxSize=0,e.prototype.type=null,e.prototype.rect=null,e.prototype.fading=!1,e.prototype.gradient=null,e.prototype.draw=function(){switch(this.type){case-1:this.canvas.beginPath(),this.canvas.fillStyle="rgba(255,255,255,"+this.rColour+")",this.canvas.arc(this.x,this.y,this.r,0,Math.PI*2,!0),this.canvas.closePath(),this.canvas.fill();break;case 0:case 1:this.drawParticle(this.x,this.y,this.r,"rgba(247,234,155,"+this.rColour.toFixed(2)+")","rgba(255,204,0,0)")}return this.fading||(this.rColour-=.005*this.mult),null},e.prototype.drawParticle=function(e,t,n,r,i){return this.gradient=this.canvas.createRadialGradient(e,t,0,e,t,n),this.gradient.addColorStop(0,r),this.gradient.addColorStop(1,i),this.canvas.fillStyle=this.gradient,this.canvas.fillRect(e-n,t-n,n*2,n*2),null},e.prototype.rand=function(e,t){return e==null&&(e=0),t==null&&(t=1),(Math.random()*(t-e)+e)%t},e.prototype.move=function(){this.x+=this.dx,this.y-=this.dy;if(this.rColour<0||this.rColour>this.alpha)this.mult*=-1;return(this.x>this.rect.w+this.rect.x||this.x<this.rect.x||this.y>this.rect.h+this.rect.y||this.y<this.rect.y)&&this.fadeOut(),null},e.prototype.reset=function(){return this.x=this.rand(this.rect.x,this.rect.w+this.rect.x),this.y=this.rand(this.rect.y,this.rect.h+this.rect.y),this.dx=this.rand(-this.speed,this.speed),this.dy=this.rand(-this.speed,this.speed),this.alpha=1-MathUtils.map(this.r,this.minSize,this.maxSize,0,1),this.rColour=this.alpha,this.r=this.rand(this.minSize,this.maxSize),null},e.prototype.fadeOut=function(){return this.fading=!0,this.rColour-=.005,this.rColour<=0&&(this.fading=!1,this.reset()),null},e}(),ParticleCard=function(){function e(e){this.fadeOut=__bind(this.fadeOut,this),this.reset=__bind(this.reset,this),this.move=
__bind(this.move,this),this.rand=__bind(this.rand,this),this.drawParticle=__bind(this.drawParticle,this),this.draw=__bind(this.draw,this),this.speed=e._speed,this.maxSize=e._maxSize,this.canvas=e._canvas,this.w=e._w,this.h=e._h,this.type=e._type,this.rect=e._rect,this.r=this.rand(this.minSize,this.maxSize),this.dx=this.rand(-this.speed,this.speed),this.dy=this.rand(-this.speed,this.speed),null}return e.prototype.dx=0,e.prototype.dy=0,e.prototype.x=0,e.prototype.y=0,e.prototype.r=0,e.prototype.canvas=null,e.prototype.w=0,e.prototype.h=0,e.prototype.image=null,e.prototype.alpha=0,e.prototype.rColour=1,e.prototype.mult=1,e.prototype.minSize=.8,e.prototype.maxSize=0,e.prototype.type=null,e.prototype.rect=null,e.prototype.fading=!1,e.prototype.gradient=null,e.prototype.draw=function(){switch(this.type){case 0:this.canvas.beginPath(),this.canvas.fillStyle="rgba(255,255,255,"+this.rColour+")",this.canvas.arc(this.x,this.y,this.r,0,Math.PI*2,!0),this.canvas.closePath(),this.canvas.fill();break;case 1:this.drawParticle(this.x,this.y,this.r,"rgba(247,234,155,"+this.rColour.toFixed(2)+")","rgba(255,204,0,0)")}return this.fading||(this.rColour-=.005*this.mult),null},e.prototype.drawParticle=function(e,t,n,r,i){return this.gradient=this.canvas.createRadialGradient(e,t,0,e,t,n),this.gradient.addColorStop(0,r),this.gradient.addColorStop(1,i),this.canvas.fillStyle=this.gradient,this.canvas.fillRect(e-n,t-n,n*2,n*2),null},e.prototype.rand=function(e,t){return e==null&&(e=0),t==null&&(t=1),(Math.random()*(t-e)+e)%t},e.prototype.move=function(){this.x+=this.dx,this.y-=this.dy;if(this.rColour<0||this.rColour>this.alpha)this.mult*=-1;return(this.x>this.rect.w+this.rect.x||this.x<this.rect.x||this.y>this.rect.h+this.rect.y||this.y<this.rect.y)&&this.fadeOut(),null},e.prototype.reset=function(){return this.x=this.rand(this.rect.w/2+this.rect.x-150,this.rect.w/2+this.rect.x+150),this.y=this.rand(this.rect.h/2+this.rect.y-250,this.rect.h/2+this.rect.y+250),this.dx=this.rand(-this.speed,this.speed),this.dy=this.rand(-this.speed,this.speed),this.r=this.rand(this.minSize,this.maxSize),this.alpha=1-MathUtils.map(this.r,this.minSize,this.maxSize,0,1),this.rColour=this.alpha,null},e.prototype.fadeOut=function(){return this.fading=!0,this.rColour-=.005,this.rColour<=0&&(this.fading=!1,this.reset()),null},e}(),Particles=function(e){function t(){return this.onResize=__bind(this.onResize,this),this.dispose=__bind(this.dispose,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.init=__bind(this.init,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="canvas",t.prototype.className="particles",t.prototype.particles=null,t.prototype.paused=!0,t.prototype.speed=.6,t.prototype.pType=0,t.prototype.pMaxSize=2,t.prototype.rectangle=null,t.prototype.nParticles=150,t.prototype.initialize=function(e,n,r,i){return e!=null&&(this.pType=e),n!=null&&(this.pMaxSize=n),r!=null&&(this.nParticles=r),i!=null?this.rectangle=i:this.rectangle={x:0,y:$(window).innerHeight()/3,w:$(window).innerWidth(),h:$(window).innerHeight()/3},t.__super__.initialize.call(this),null},t.prototype.init=function(){var e,t,n,r;if(!Modernizr.canvas)return;this.$el[0].width=$(window).innerWidth(),this.$el[0].height=$(window).innerHeight(),this.ctx=this.$el[0].getContext("2d"),this.particles=[];for(e=n=0,r=this.nParticles;0<=r?n<=r:n>=r;e=0<=r?++n:--n)this.pType===0?(t=new Particle({_canvas:this.ctx,_w:this.$el[0].width,_h:this.$el[0].height,_maxSize:this.pMaxSize,_speed:this.speed,_type:this.pType,_rect:this.rectangle}),t.reset()):this.pType===1&&(t=new ParticleCard({_canvas:this.ctx,_w:this.$el[0].width,_h:this.$el[0].height,_maxSize:this.pMaxSize,_speed:this.speed,_type:this.pType,_rect:this.rectangle}),t.reset()),this.particles.push(t);return this.paused=!1,null},t.prototype.onEnterFrame=function(){var e,t,n,r;if(!Modernizr.canvas)return;this.clear(),r=this.particles;for(t=0,n=r.length;t<n;t++)e=r[t],e.move(),e.draw();return null},t.prototype.dispose=function(){return null},t.prototype.clear=function(){return this.ctx.clearRect(0,0,this.$el[0].width,this.$el[0].height),null},t.prototype.rand=function(e,t){return e==null&&(e=0),t==null&&(t=1),(Math.random()*(t-e)+e)%t},t.prototype.onResize=function(){if(!Modernizr.canvas)return;return this.$el[0].width=$(window).innerWidth(),this.$el[0].height=$(window).innerHeight(),null},t}(Abstract),Controller=function(e){function t(){return this.pauseState=__bind(this.pauseState,this),this.playState=__bind(this.playState,this),this.progress=__bind(this.progress,this),this.toggleVideo=__bind(this.toggleVideo,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="controller",t.prototype.progressBar=null,t.prototype.scruber=null,t.prototype.bg=null,t.prototype.border=null,t.prototype.pausePlayButton=null,t.prototype.init=function(){var e=this;return this.pausePlayButton=new PlayPause,this.pausePlayButton.on("clicked",this.toggleVideo),this.addChild(this.pausePlayButton),this.progressBar=new Abstract,this.progressBar.dispose-function(){return null},this.addChild(this.progressBar),this.progressBar.$el.addClass("progressBar"),this.border=new SSAsset("interface","video_progress_border"),this.progressBar.addChild(this.border),this.bg=new SSAsset("interface","video_progress_background"),this.progressBar.addChild(this.bg),this.scruber=new SSAsset("interface","video_progress_scrubber"),this.progressBar.addChild(this.scruber),this.width=parseInt(this.scruber.$el.css("width")),null},t.prototype.toggleVideo=function(){return this.trigger("toggleVideo"),null},t.prototype.progress=function(e){return this.scruber.$el.css({width:this.width*e}),null},t.prototype.playState=function(){return this.pausePlayButton.playState(),null},t.prototype.pauseState=function(){return this.pausePlayButton.pauseState(),null},t}(Abstract),PlayPause=function(e){function t(){return this.playState=__bind(this.playState,this),this.pauseState=__bind(this.pauseState,this),this.dispose=__bind(this.dispose,this),this.toggle=__bind(this.toggle,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="playPauseButton",t.prototype.asset=null,t.prototype.playing=!0,t.prototype.init=function(){return this.asset=new SSAsset("interface","button_play"),this.addChild(this.asset),this.$el.addClass("btanimated"),this.$el.bind("click",this.toggle),null},t.prototype.toggle=function(){return this.playing?this.pauseState():this.playState(),this.trigger("clicked"),null},t.prototype.dispose=function(){return null},t.prototype.pauseState=function(){return this.asset.changeState("button_pause"),this.playing=!1,null},t.prototype.playState=function(){return this.asset.changeState("button_play"),this.playing=!0,null},t}(Abstract),VideoPlayer=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.onClose=__bind(this.onClose,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.show=__bind(this.show,this),this.videoEnded=__bind(this.videoEnded,this),this.resume=__bind(this.resume,this),this.pause=__bind(this.pause,this),this.toggleVideo=__bind(this.toggleVideo,this),this.getLocalisedVideo=__bind(this.getLocalisedVideo,this),this.init=__bind(this.init,this),this.changeView=__bind(this.changeView,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="videoPlayer",t.prototype.videoElement=null,t.prototype.controller=null,t.prototype.videoPaused=!0,t.prototype.changeView=function(){return null},t.prototype.init=function(){return this.videoElement=$("<video/>"),this.videoElement.attr({src:this.getLocalisedVideo()}),this.addChild(this.videoElement),this.addChild($('<img src="/img/home/pix.gif" style="position:absolute;top:0;left:0;width:100%;height:100%;"/>')),this.controller=new Controller,this.controller.on("toggleVideo",this.toggleVideo),this.addChild(this.controller),this.controller.$el.find(".playPauseButton").css({"-webkit-transform":"scale(0.6,0.6)"}),this.$el.css({opacity:0}),this.addCloseButton(),this.closeBtn.$el.bind("click",this.onClose),null},t.prototype.getLocalisedVideo=function(){var e;e=(navigator.language||navigator.userLanguage.toLowerCase()).split("-")[0];switch(e){case"pt":return"/videos/bubbles_pt.webm";case"es":return"/videos/bubbles_es.webm";default:return"/videos/bubbles_en.webm"}return"/videos/bubbles_en.webm"},t.prototype.toggleVideo=function(){return this.videoPaused?(this.videoPaused=!1,this.videoElement[0].play()):(this.videoPaused=!0,this.videoElement[0].pause()),null},t.prototype.pause=function(){return this.videoElement[0].removeEventListener("ended",this.videoEnded,!1),this.videoPaused=!0,this.videoElement[0].pause(),this.controller.playState(),t.__super__.pause.call(this),null},t.prototype.resume=function(){return this.videoPaused=!1,this.videoElement[0].play(),this.controller.pauseState(),this.videoElement[0].addEventListener("ended",this.videoEnded,!1),t.__super__.resume.call(this),null},t.prototype.videoEnded=function(e){return this.videoElement[0].src="",this.onClose(),null},t.prototype.show=function(e,n,r,i){return e==null&&(e=!1),n==null&&(n=null),r==null&&(r=400),i==null&&(i="linear"),this.$el.css({display:"block"}),t.__super__.show.call(this,e,n,r,i),this.resume(),null},t.prototype.onEnterFrame=function(){return this.controller.progress(this.videoElement[0].currentTime/this.videoElement[0].duration),null},t.prototype.onClose=function(){var e=this;return SoundController.send("trailer_end"),this.oz().appView.area.content.$el.css({display:"inline"}),this.oz().appView.area.content.show(!0),this.oz().appView.logo.showGoogleLogos(),this.oz().appView.footer.mainMenu.show(!0),this.oz().appView.footer.showShare(),this.pause(),this.hide(!0,function(){return e.oz().appView.wrapper.remove(e)}),null},t.prototype.dispose=function(){return this.closeBtn.$el.unbind("click",this.onClose),this.controller.off("toggleVideo",this.toggleVideo),null},t}(AbstractScene),RainDrops=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.id="raindrops",t.prototype.tagName="div",t.prototype.container=null,t.prototype.topLeft=null,t.prototype.topRight=null,t.prototype.bottomLeft=null,t.prototype.bottomRight=null,t.prototype.init=function(){return this.container=$(this.el),this.container.css({width:"100%",height:"100%",position:"absolute",top:0,left:0}),this.topLeft=$("<div id='drops_overlay1'></div>"),this.topLeft.css({position:"absolute",width:792,height:392,top:0,left:0,background:"url('/models/textures/drops_tl.png')"}),this.topRight=$("<div id='drops_overlay2'></div>"),this.topRight.css({position:"absolute",width:491,height:492,top:0,right:0,background:"url('/models/textures/drops_tr.png')"}),this.bottomLeft=$("<div id='drops_overlay3'></div>"),this.bottomLeft.css({position:"absolute",width:697,height:543,bottom:0,left:0,background:"url('/models/textures/drops_bl.png')"}),this.bottomRight=$("<div id='drops_overlay4'></div>"),this.bottomRight.css({position:"absolute",width:291,height:286,bottom:0,right:0,background:"url('/models/textures/drops_br.png')"}),this.container.append(this.topLeft),this.container.append(this.topRight),this.container.append(this.bottomLeft),this.container.append(this.bottomRight),null},t}(Abstract),ShareBox=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.getFloodlight=__bind(this.getFloodlight,this),this.onShare=__bind(this.onShare,this),this.onBackClick=__bind(this.onBackClick,this),this.onLinkClick=__bind(this.onLinkClick,this),this.init=__bind(this.init,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="shareContainer",t.prototype.template="sharebox",t.prototype.iconsContainer=null,t.prototype.shareLinkCont=null,t.prototype.linkIcon=null,t.prototype.callback=null,t.prototype.shareType=null,t.prototype.initialize=function(e,n,r,i,s,o){return this.templateVars={title:e,sub:n,link:s,shareBack:r,shareLegal:this.oz().locale.get("shareBoxExpiry")},this.shareType=o,this.callback=i,t.__super__.initialize.call(this),null},t.prototype.init=function(){var e,t=this;return this.iconsContainer=this.$el.find(".shareIconsRow"),this.oz().locale.lang.indexOf("zh-")===0?this.iconsContainer.append("<button_renren /><button_weibo />"):this.iconsContainer.append("<button_google /><button_facebook /><button_twitter />"),this.iconsContainer.children().each(function(e,n){var r;return r=new SSAsset("interface",$(n)[0].tagName.toLowerCase()),r.addClass("shareIcon"),r.$el.attr("id",$(n)[0].tagName.toLowerCase()),t.iconsContainer.append(r.$el),r.$el.css({width:""+(parseInt(r.$el.css("width"))+2)+"px"}),r.$el.bind("click",t.onShare),$(n).remove()}),this.shareLinkCont=this.$el.find(".shareLinkContainer").find(".abstractbutton"),this.linkIcon=new SSAsset("interface","link_icon"),this.linkIcon.$el.bind("click",this.onLinkClick),this.linkIcon.$el.addClass("shareLinkIcon"),this.shareLinkCont.prepend(this.linkIcon.$el),e=this.$el.find(".shareBack"),e.bind("click",this.onBackClick),navigator.appVersion.indexOf("Win")!==-1&&(e.css({padding:"7px 20px 8px 20px"}),this.shareLinkCont.css({padding:"3px 12px 7px 12px"})),null},t.prototype.onLinkClick=function(){return Analytics.track(this.shareType+"_open_preview"),window.open(this.shareLinkCont.find("input").val()),null},t.prototype.onBackClick=function(){return Analytics.track("cutout_take_another"),typeof this.callback=="function"&&this.callback(),this.trigger("removeShareBox"),null},t.prototype.onShare=function(e){switch(e.currentTarget.id){case"button_facebook":Analytics.track(this.shareType+"_share_fb",this.getFloodlight("Facebook")),Share.facebook(this.templateVars.link,this.oz().locale.get("share_"+this.shareType+"_facebook_default_message"));break;case"button_google":Analytics.track(this.shareType+"_share_gplus",this.getFloodlight("Google")),Share.plus(this.templateVars.link);break;case"button_twitter":Analytics.track(this.shareType+"_share_twitter",this.getFloodlight("Twitter")),Share.twitter(this.templateVars.link,this.oz().locale.get("share_"+this.shareType+"_facebook_default_message"));break;case"button_renren":Analytics.track(this.shareType+"_share_renren"),Share.renren(this.templateVars.link);break;case"button_weibo":Analytics.track(this.shareType+"_share_weibo"),Share.weibo(this.templateVars.link)}return null},t.prototype.getFloodlight=function(e){switch(this.shareType){case"zoe":return"Google_OZ_Zeotrope_SocialClick_"+e;case"cutout":return"Google_OZ_HoleInFace_SocialClick_"+e}return null},t.prototype.dispose=function(){return null},t}(Abstract),SSAsset=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.center=__bind(this.center,this),this.changeState=__bind(this.changeState,this),this.removeClass=__bind(this.removeClass,this),this.addClass=__bind(this.addClass,this),this.css=__bind(this.css,this),this.out=__bind(this.out,this),this.over=__bind(this.over,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.ss=null,t.prototype.from=null,t.prototype.asset=null,t.prototype.initialize=function(e,n){return this.from=e,this.asset=n,t.__super__.initialize.call(this)},t.prototype.init=function(){var e,t,n,r,i;return this.ss=this.oz().ss.get(this.from,this.asset),r=Math.round(this.ss.x/2)-1,i=Math.round(this.ss.y/2),n=Math.round(this.ss.width/2),t=Math.round(this.ss.height/2),e={width:n,height:t,"background-image":"url("+this.ss.image+")","background-size":""+this.ss.fullSize[0]+"px "+this.ss.fullSize[1]+"px","background-position":"-"+r+"px -"+i+"px"},window.devicePixelRatio===2&&(e["background-image"]="-webkit-image-set(url("+this.ss.image+") 1x, url("+this.ss.image2x+") 2x)"),this.$el.css(e),this.render(),null},t.prototype.over=function(e){return this.changeState(e),null},t.prototype.out=function(){var e,t;return e=Math.round(this.ss.x/2)-1,t=Math.round(this.ss.y/2),this.$el.css({"background-position":""+ -e+"px "+ -t+"px"}),null},t.prototype.css=function(e){return this.$el.css(e),null},t.prototype.addClass=function(e){return this.$el.addClass(e),null},t.prototype.removeClass=function(e){return this.$el.removeClass(e),null},t.prototype.changeState=function(e){var t,n,r;return t=this.oz().ss.get(this.from,e),n=Math.round(t.x/2)-1,r=Math.round(t.y/2),this.$el.css({"background-position":""+ -n+"px "+ -r+"px"}),null},t.prototype.center=function(){var e;return e=Math.round(this.ss.width/4),this.$el.css({position:"absolute",left:"50%","margin-left":""+ -e+"px"}),null},t.prototype.dispose=function(){return null},t}(Abstract),SubLoader=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.activateMouseInteraction=__bind(this.activateMouseInteraction,this),this.hideCard=__bind(this.hideCard,this),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.onClick=__bind(this.onClick,this),this.onMouseMove=__bind(this.onMouseMove,this),this.update=__bind(this.update,this),this.showError=__bind(this.showError,this),this.addSpinner=__bind(this.addSpinner,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="subLoader",t.prototype.container=null,t.prototype.square=null,t.prototype.visible=!1,t.prototype.angleX=0,t.prototype.angleY=0,t.prototype.error=null,t.prototype.init=function(){return this.container=(new Abstract).setElement("<div class='subLoaderContainer'></div>"),this.container.dispose=function(){return null},this.addChild(this.container),this.card=new LoadingCard,this.addChild(this.card),this.addSpinner(),this.hide(!1),null},t.prototype.addSpinner=function(){return this.spinner=new Sonic({width:50,height:50,stepsPerFrame:1,trailLength:1,pointDistance:.02,fps:30,fillColor:"#FFFFFF",step:function(e,t){return this._.beginPath(),this._.moveTo(e.x,e.y),this._.arc(e.x,e.y,t*3,0,Math.PI*2,!1),this._.closePath(),this._.fill()},path:[["arc",25,25,10,0,360]]}),this.container.addChild(this.spinner.canvas),this.container.$el.css({display:"none"}),null},t.prototype.showError=function(){var e,t;return this.container.$el.css({display:"none"}),t=new SSAsset("interface","pause_top"),t.$el.css({margin:"0 auto 15px auto"}),this.error=$("<div class='subLoaderError'><div class='shareErrorCopy'>"+this.oz().locale.get("share_error_message")+"</div></div>"),this.error.prepend(t.$el),this.addChild(this.error),e=new SSAsset("interface","pause_bottom"),this.error.append(e.$el),e.$el.css({margin:"20px auto"}),this.$el.bind("click",this.hide)},t.prototype.update=function(e){return this.card.update(e),null},t.prototype.onMouseMove=function(e){var t,n;if(this.paused)return;return t=(e.clientX-$(window).innerWidth()/2)/40,n=(e.clientY-$(window).innerHeight()/2)/35,this.angleX+=(t-this.angleX)*.075,this.angleY+=(n-this.angleY)*.075,this.angleX=this.angleX%360,this.angleY=this.angleY%360,this.card.transform(this.angleX,this.angleY),null},t.prototype.onClick=function(e){return this.card.toggleTopple(),null},t.prototype.show=function(e){return e==null&&(e=!1),t.__super__.show.call(this,!0,null,400,"linear"),this.paused=!1,$(".scene3d").css({"-webkit-filter":"blur(10px)"}),e?(this.spinner.play(),this.card.$el.css({display:"none"}),this.container.$el.css({display:""})):(this.spinner.stop(),this.card.$el.css({display:""}),this.container.$el.css({display:"none"}),this.card.animateIn(this.activateMouseInteraction)),this.oz().appView.logo.disable(),this.oz().appView.showMap(!1),this.oz().appView.footer.mainMenu.hide(!0),this.visible=!0,null},t.prototype.hide=function(e,n,r,i,s){var o;return e==null&&(e=!0),n==null&&(n=null),r==null&&(r=400),i==null&&(i="linear"),s==null&&(s=!0),this.$el.unbind("click",this.hide),(o=this.error)!=null&&o.remove(),t.__super__.hide.call(this,e,n,r,i,s),$(".scene3d").css({"-webkit-filter":"blur(0px)"}),this.$el.css({"background-color":"rgba(0,0,0,0.6)"}),this.visible=!1,null},t.prototype.hideCard=function(){var e,t,n=this;return this.card.animateOut(null),$(window).unbind("mousemove",this.onMouseMove),$(window).unbind("click",this.onClick),this.paused=!0,this.$el.css({"background-color":"rgba(0,0,0,1)"}),t=function(e,t){return setTimeout(t,e)},e=Number(this.$el.css("opacity"))*1e3,t(e,function(){return n.trigger("END_LOADING")}),null},t.prototype.activateMouseInteraction=function(){return $(window).bind("mousemove",this.onMouseMove),$(window).bind("click",this.onClick),null},t.prototype.dispose=function(){return null},t}(Abstract),WebCam=function(){function e(){this.dispose=__bind(this.dispose,this),this.flipImage=__bind(this.flipImage,this),this.dom=__bind(this.dom,this),this.get=__bind(this.get,this),this.onUserMediaError=__bind(this.onUserMediaError,this),this.onUserMediaSuccess=__bind(this.onUserMediaSuccess,this),this.init=__bind(this.init,this),_.extend(this,Backbone.Events),null}return e.prototype.stream=null,e.prototype.videoDom=null,e.prototype.canvas=null,e.prototype.ctx=null,e.prototype.init=function(){return this.canvas=document.createElement("canvas"),this.canvas.width=512,this.canvas.height=this.canvas.width/1.333333333,this.ctx=this.canvas.getContext("2d"),this.ctx.scale(-1,1),this.videoDom=$('<video style="display:none;" autoplay="true"/>'),$("body").prepend(this.videoDom),this.stream==null?navigator.getUserMedia({video:!0,audio:!1},this.onUserMediaSuccess,this.onUserMediaError):this.onUserMediaSuccess(),null},e.prototype.onUserMediaSuccess=function(e){return e==null&&(e=null),this.stream=e||this.stream,this.trigger("CAM_READY"),null},e.prototype.onUserMediaError=function(){return this.trigger("CAM_FAIL"),this.dispose(),null},e.prototype.get=function(){var e;if(this.stream==null){this.init();return}return e=window.URL.createObjectURL(this.stream),this.dom().src=e,e},e.prototype.dom=function(){return this.videoDom.get()[0]},e.prototype.flipImage=function(){return this.ctx.drawImage(this.dom(),-this.canvas.width,0),this.canvas},e.prototype.dispose=function(){return this.stream&&this.stream.stop(),this.stream=null,this.canvas=null,null},e}(),Copyright=function(e){function t(){return this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="copyright",t.prototype.init=function(){return this.$el.empty(),this.$el.append("<a class='button_alpha_enabled' href='http://disney.com' target='_blank'>"+this.oz().locale.get("copyright")+"</a>"),null},t}(Abstract),Footer=function(e){function t(){return this.disableOver=__bind(this.disableOver,this),this.hideMenu=__bind(this.hideMenu,this),this.showMenu=__bind(this.showMenu,this),this.showCC=__bind(this.showCC,this),this.showShare=__bind(this.showShare,this),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.id="footer",t.prototype.shareMenu=null,t.prototype.mainMenu=null,t.prototype.ratings=null,t.prototype.cr=null,t.prototype.init=function(){return this.shareMenu=new ShareMenu,this.addChild(this.shareMenu),this.mainMenu=new MainMenu,this.addChild(this.mainMenu),this.mainMenu.mouseEnabled(!1),this.mainMenu.hide(),this.mainMenu.$el.css({display:"none"}),this.ratings=new Ratings,this.addChild(this.ratings),this.cr=new Copyright,this.cr.mouseEnabled(!1),this.addChild(this.cr),this.cr.hide(),null},t.prototype.show=function(e){return this.mainMenu.$el.css({display:""}),t.__super__.show.call(this,e),null},t.prototype.hide=function(e){var n=this;return t.__super__.hide.call(this,e,function(){return n.mainMenu.$el.css({display:"none"})}),null},t.prototype.showShare=function(){return this.cr.hide(),this.cr.mouseEnabled(!1),this.shareMenu.$el.css({display:""}),this.shareMenu.show(!0),null},t.prototype.showCC=function(){return this.remove(this.ratings),this.mainMenu.show(),this.cr.mouseEnabled(!0),this.cr.show(),this.shareMenu.hide(),this.shareMenu.$el.css({display:"none"}),null},t.prototype.showMenu=function(e){return e==null&&(e=!1),this.remove(this.ratings),this.mainMenu.show(),this.mainMenu.showMenu(),this.mainMenu.disableMouseMove(e),null},t.prototype.hideMenu=function(){return this.mainMenu.hideMenu(),null},t.prototype.disableOver=function(e){return this.mainMenu.disableMouseMove(e),null},t}(Abstract),MainMenu=function(e){function t(){this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.toggleItem=__bind(this.toggleItem,this),this.disableMouseMove=__bind(this.disableMouseMove,this),this.onMouseMove=__bind(this.onMouseMove,this),this.hideThis=__bind(this.hideThis,this),this.showThis=__bind(this.showThis,this),this.hideMenu=__bind(this.hideMenu,this),this.showMenu=__bind(this.showMenu,this),this.toggleMenu=__bind(this.toggleMenu,this),this.init=__bind(this.init,this),this.templateVars={open:this.oz().locale.get("menuOpen"),official:this.oz().locale.get("menuOfficial"),tech:this.oz().locale.get("menuTech"),credits:this.oz().locale.get("menuCredits"),terms:this.oz().locale.get("menuTerms"),privacy:this.oz().locale.get("menuPrivacy")},t.__super__.constructor.call(this)}return __extends(t,e),t.prototype.template="menu",t.prototype.className="menu",t.prototype.openMenuBtn=null,t.prototype.buttonList=null,t.prototype.opened=!1,t.prototype.disableOpen=!1,t.prototype.init=function(){var e=this;return this.buttonList=this.$el.find(".menu_buttons"),this.openMenuBtn=this.$el.find(".open_menu"),this.openMenuBtn.find("span").mouseover(this.showMenu),this.$el.find(".button").each(function(t,n){return $(n).bind("click",function(t){var n;n=$(t.currentTarget).attr("deep");switch(n){case"terms":Analytics.track("menu_click_terms"),window.open("/tou.html");break;case"privacy":Analytics.track("menu_click_privacy"),window.open("/pp.html");break;case"tech":Analytics.track("menu_click_tech"),window.open("http://html5rocks.com/en/tutorials/");break;case"official":Analytics.track("menu_click_official"),window.open("http://disney.go.com/thewizard/");break;default:Analytics.track("menu_click_credits"),e.oz().appView["static"].changePage(n)}return SoundController.send("btn_generic_click")}),$(n).bind("mouseover",function(e){return SoundController.send("btn_generic_over")})})},t.prototype.toggleMenu=function(){if(this.disableOpen)return;return this.toggleItem(this.openMenuBtn),this.toggleItem(this.buttonList),this.opened=!this.opened,this.opened?(this.oz().appView.showMap(!1),this.oz().appView.footer.showShare()):(this.oz().appView.showMap(),this.oz().appView.footer.showCC())},t.prototype.showMenu=function(){return this.oz().appView.map.hide(!1),this.hideThis(this.openMenuBtn),this.showThis(this.buttonList),this.opened=!0,$("body").unbind("mousemove"),$("body").bind("mousemove",this.onMouseMove),this.oz().appView.footer.showShare()},t.prototype.hideMenu=function(){return this.oz().appView.showMap(),this.hideThis(this.openMenuBtn),this.hideThis(this.buttonList),this.opened=!1,$("body").unbind("mousemove")},t.prototype.showThis=function(e){return e.css({visibility:"visible"}),e.stop().animate({opacity:1},{duration:300})},t.prototype.hideThis=function(e){var t=this;return e.stop().animate({opacity:0},{duration:100,complete:function(){return e.css({visibility:"hidden"})}})},t.prototype.onMouseMove=function(e){if(e.originalEvent.clientY<$(window).innerHeight()-this.$el.height()-60)return $("body").unbind("mousemove",this.onMouseMove),this.toggleMenu()},t.prototype.disableMouseMove=function(e){return $("body").unbind("mousemove"),this.disableOpen=e},t.prototype.toggleItem=function(e){var t;return t=e.css("visibility"),t==="hidden"?this.showThis(e):this.hideThis(e)},t.prototype.show=function(e){return this.$el.css({display:""}),t.__super__.show.call(this,e)},t.prototype.hide=function(e,n){var r=this;return t.__super__.hide.call(this,e,function(){return typeof n=="function"&&n(),r.$el.css({display:"none"})})},t}(Abstract),Ratings=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="ratings",t.prototype.mpaa=null,t.prototype.init=function(){var e,t=this;return this.mpaa=new SSAsset("interface","rating_block"),this.addChild(this.mpaa),this.mpaa.center(),e=$("<span>"+this.oz().locale.get("menuRatings")+"</span>"),e.addClass("button_alpha_enabled"),this.$el.append(e),this.$el.bind("click",function(){return Analytics.track("menu_click_mpaa"),window.open(t.oz().locale.get("menuRatingsLink"))})},t.prototype.dispose=function(){},t}(Abstract),ShareMenu=function(e){function t(){return this.toogleSound=__bind(this.toogleSound,this),this.disableSound=__bind(this.disableSound,this),this.enableSound=__bind(this.enableSound,this),this.showSoundButton=__bind(this.showSoundButton,this),this.hideSoundButton=__bind(this.hideSoundButton,this),this.addWeibo=__bind(this.addWeibo,this),this.addRenRen=__bind(this.addRenRen,this),this.onLibLoaded=__bind(this.onLibLoaded,this),this.rerender=__bind(this.rerender,this),this.render=__bind(this.render,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="share_menu",t.prototype.soundEnabled=!0,t.prototype.sound_label="SOUND",t.prototype.sound_label_on="ON",t.prototype.sound_label_off="OFF",t.prototype.render=function(){return this.oz().locale.get("sound_button_label")&&this.oz().locale.get("sound_button_label")!==""&&(this.sound_label=this.oz().locale.get("sound_button_label")),this.oz().locale.get("sound_button_on")&&this.oz().locale.get("sound_button_on")!==""&&(this.sound_label_on=this.oz().locale.get("sound_button_on")),this.oz().locale.get("sound_button_off")&&this.oz().locale.get("sound_button_off")!==""&&(this.sound_label_off=this.oz().locale.get("sound_button_off")),this.sound=$("<div class='sound'>"+this.sound_label+" <span>"+this.sound_label_on+"</span></div>"),this.sound.bind("mousedown",this.toogleSound),this.disableSound(),this.$el.append(this.sound),require(["http://platform.twitter.com/widgets.js","//apis.google.com/js/plusone.js"],this.onLibLoaded)},t.prototype.rerender=function(){return this.oz().locale.lang.indexOf("zh")===-1?(this.$googleBtn=$("<div/>"),this.$googleBtn.attr({id:"g-plusone","class":"g-plusone","data-size":"medium"}),this.$facebookContainer=$("<div class='facebookShare'></div>"),this.$facebookBtn=$("<iframe/>"),this.$facebookBtn.attr({"class":"fb-like",src:"//www.facebook.com/plugins/like.php?send=false&layout=button_count&href="+document.location.origin,scrolling:"no",frameborder:"0"}),this.$facebookBtn.css({width:"100px"}),this.$facebookContainer.css({"margin-left":"10px"}),this.$twitterContainer=$("<div class='twitterShare'></div>"),this.$twitterBtn=$("<a/>"),this.$twitterBtn.attr({"class":"twitter-share-button",href:"https://twitter.com/share","data-lang":this.oz().locale.lang,"data-size":"small","data-hashtags":this.oz().locale.get("seo_twtter_hashtag"),"data-text":this.oz().locale.get("seo_twtter_default_text"),"data-via":this.oz().locale.get("seo_twitter_handle")}),this.$el.prepend(this.$twitterContainer),this.$twitterContainer.append(this.$twitterBtn),this.$el.prepend(this.$facebookContainer),this.$facebookContainer.append(this.$facebookBtn),this.$el.prepend(this.$googleBtn),twttr.widgets.load(),typeof gapi!="undefined"&&gapi!==null&&gapi.plusone.render("g-plusone",{size:"medium",expandTo:"top"}),this.$googleBtn.css({width:"50px !important"})):(this.addWeibo(),this.addRenRen()),this.$el.append($("<div class='clearfix'></div>"))},t.prototype.onLibLoaded=function(){return this.rerender()},t.prototype.addRenRen=function(){var e,t,n,r,i,s;r=[],s=130,e=20,n={url:window.location.href,title:document.title,description:"",image:""};for(t in n)i=n[t],r.push(t+"="+encodeURIComponent(i||""));return this.renren=$('<iframe scrolling="no" frameborder="0" allowtransparency="true" src="http://www.connect.renren.com/like/v2?'+r.join("&")+"\" style='width:"+s+"px; height:"+e+"px;'/>"),this.$el.prepend(this.renren)},t.prototype.addWeibo=function(){var e,t,n,r,i,s;s=72,i=24,t={url:window.location.href,type:"2",count:"1",appkey:"",title:"",pic:"",ralateUid:"",language:"zh_cn",rnd:(new Date).valueOf()},n=[];for(e in t)r=t[e],n.push(e+"="+encodeURIComponent(r||""));return this.weibo=$('<iframe class="weibo_share" allowTransparency="true" frameborder="0" scrolling="no" src="http://hits.sinajs.cn/A1/weiboshare.html?'+n.join("&")+'" width="'+s+'" height="'+i+'"/>'),this.weibo.css({"-webkit-transform":"scale(.85)","margin-top":"-2px"}),this.$el.prepend(this.weibo)},t.prototype.hideSoundButton=function(){var e;return(e=this.sound)!=null?e.css({display:"none"}):void 0},t.prototype.showSoundButton=function(
){var e;return(e=this.sound)!=null?e.css({display:""}):void 0},t.prototype.enableSound=function(){var e;return(e=this.sound)!=null?e.css({opacity:1,visibility:"visible"}):void 0},t.prototype.disableSound=function(){var e;return(e=this.sound)!=null?e.css({opacity:0,visibility:"hidden"}):void 0},t.prototype.toogleSound=function(){return Analytics.track("menu_click_toggle_sound"),this.soundEnabled=!this.soundEnabled,this.soundEnabled?(SoundController.send("sound_on"),SoundController.resume(!0),this.sound.find("span").html(this.sound_label_on)):(this.sound.find("span").html(this.sound_label_off),SoundController.paused(!0))},t}(Abstract),BaseLandingOpenings=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.render=__bind(this.render,this),this.init=__bind(this.init,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="staticPage",t.prototype.titles=null,t.prototype.title=null,t.prototype.cta=null,t.prototype.dividers=null,t.prototype.me=null,t.prototype.particles=null,t.prototype.withParticles=null,t.prototype.initialize=function(e,n,r,i,s){return r==null&&(r=!0),i==null&&(i=!1),s==null&&(s=!0),this.dividers=r,this.title=e,this.cta=n,this.me=i,this.withParticles=s,t.__super__.initialize.call(this),null},t.prototype.init=function(){return this.withParticles&&(this.particles=new Particles(0,10,150,{x:0,y:0,w:$(window).innerWidth(),h:$(window).innerHeight()}),this.addChild(this.particles)),this.titles=new OpeningTitles(this.oz().locale.get(this.title),this.oz().locale.get(this.cta),this.dividers),this.addChild(this.titles),this.mouseEnabled(this.me),null},t.prototype.render=function(e){return this.titles.render(e),null},t.prototype.dispose=function(){return null},t}(Abstract),Credits=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.render=__bind(this.render,this),this.getPartner=__bind(this.getPartner,this),this.getPerson=__bind(this.getPerson,this),this.parse=__bind(this.parse,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="staticPage",t.prototype.template="credits",t.prototype.fluorish=null,t.prototype.bottom=null,t.prototype.init=function(){return this.fluorish=new SSAsset("interface","pause_top"),this.addChild(this.fluorish,1),this.fluorish.$el.css({margin:"0 auto 15px auto"}),this.oz().appView["static"].$el.css({"background-color":"rgba(0,0,0,0.8)"}),this.list=JSON.parse(this.oz().baseAssets.get("credits").result),this.parse(),this.bottom=new SSAsset("interface","pause_bottom"),this.addChild(this.bottom),this.bottom.$el.css({margin:"17px auto"}),null},t.prototype.parse=function(){var e,t,n,r,i,s,o;e=$('<div class="credits_container"/>'),this.addChild(e),s=this.list;for(n in s){r=s[n],e.append(this.getPartner(r.title));for(t=i=0,o=r.names.length;0<=o?i<o:i>o;t=0<=o?++i:--i)e.append(this.getPerson(r.names[t].role,r.names[t].name))}return null},t.prototype.getPerson=function(e,t){var n,r,i;return i="",n=$('<div class="name">'+t+"</div>"),r=$('<div class="person"><div class="space_credits"/><div class="clearfix"></div></div>'),r.prepend(n),e!==""?(i=$('<div class="role">'+e+"</div>"),r.prepend(i)):n.css({width:"100%","text-align":"center"}),r},t.prototype.getPartner=function(e){return $('<div class="title">'+e+"</div>")},t.prototype.render=function(e){return e(),null},t.prototype.dispose=function(){return this.oz().appView["static"].$el.css({"background-color":"rgba(0,0,0,0.7)"}),null},t}(Abstract),LandingAgree=function(e){function t(){return this.onEnterClick=__bind(this.onEnterClick,this),this.clickAgree=__bind(this.clickAgree,this),this.enableEnterButton=__bind(this.enableEnterButton,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.checkBox=null,t.prototype.mpaa=null,t.prototype.buttonContainer=null,t.prototype.buttonEnter=null,t.prototype.init=function(){var e,n,r,i,s=this;return t.__super__.init.call(this),this.hide(),this.mouseEnabled(!0),r=new Abstract,r.dispose=function(){},r.$el.addClass("bigDividers"),i=new SSAsset("interface","final_end_top"),n=$('<div class="containerBottom" />'),e=new SSAsset("interface","bottomheader"),e.$el.css({display:"table-cell"}),n.append(e.$el),r.addChild(i),this.titles.$el.find(".openingTitlesHeader").css({"margin-top":"0"}),n=$('<div class="containerBottom" />'),e=new SSAsset("interface","landing_bottom"),e.$el.css({display:"table-cell"}),n.append(e.$el),r.$el.insertAfter(this.titles.$el.children()[0]),this.titles.header.append(n),this.titles.fluorish.$el.remove(),n.width(e.$el.width()),n.height(e.$el.height()),this.checkBox=new CheckBox,this.checkBox.on("toggled",this.clickAgree),this.titles.cta.find(".cta").prepend(this.checkBox.$el),this.titles.cta.find("p").addClass("pMargin"),this.titles.cta.find("p").find("a").attr("href","/tou.html"),this.titles.cta.find("p").find("a").click(function(e){return e.preventDefault(),window.open("/tou.html")}),this.titles.cta.find("p").bind("click",this.clickAgree),this.buttonContainer=(new Abstract).setElement("<div class='enterButtonContainer'/>"),this.buttonContainer.dispose=function(){return null},this.buttonEnter=new SimpleButton("enter",this.oz().locale.get("homeButton")),this.buttonContainer.addChild(this.titles.cta.find(".left")),this.buttonContainer.addChild(this.buttonEnter.$el),this.buttonContainer.addChild(this.titles.cta.find(".right")),this.titles.remove(this.titles.diamond),this.titles.addChild(this.buttonContainer),this.enableEnterButton(!1),this.show(!0),null},t.prototype.enableEnterButton=function(e){var t=this;return e==null&&(e=!0),e?(this.buttonEnter.$el.css({cursor:"pointer"}),this.buttonEnter.on("click",this.onEnterClick),this.buttonEnter.on("mouseover",function(){return SoundController.send("btn_enter_over")})):(this.buttonEnter.$el.css({cursor:"default"}),this.buttonEnter.off("click",this.onEnterClick),this.buttonEnter.off("mouseover")),null},t.prototype.clickAgree=function(e){if(e&&e.srcElement.nodeName==="A")return;return this.checkBox.toggleCheck(),this.enableEnterButton(this.checkBox.val()),this.buttonContainer.$el.css({opacity:this.checkBox.val()===!0?1:.2,"pointer-events":this.checkBox.val()===!0?"visible":"none"}),null},t.prototype.onEnterClick=function(){if(this.checkBox.val()===!1)return;return Analytics.track("click_enter"),SoundController.send("landing_end"),this.trigger("agreedEnter"),null},t}(BaseLandingOpenings),LandingFinal=function(e){function t(){return this.onTrailerClick=__bind(this.onTrailerClick,this),this.onResetClick=__bind(this.onResetClick,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.checkBox=null,t.prototype.init=function(){var e,n,r,i,s,o,u,a,f,l=this;return t.__super__.init.call(this),this.mouseEnabled(!0),a=new Abstract,a.dispose=function(){},a.$el.addClass("bigDividers"),a.$el.css({}),f=new SSAsset("interface","final_end_top"),n=$('<div class="containerBottom" />'),e=new SSAsset("interface","bottomheader"),e.$el.css({display:"table-cell"}),n.append(e.$el),a.addChild(f),this.titles.$el.find(".openingTitlesHeader").css({"margin-top":"0"}),r=$('<div class="finalButtonContainer"/>'),s=new SimpleButton("trailer",this.oz().locale.get("finalBtnTrailer")),s.on("click",this.onTrailerClick),r.append(s.$el),r.append("<br>"),i=new SimpleButton("reset",this.oz().locale.get("finalBtnReset")),i.on("click",this.onResetClick),r.append(i.$el),setTimeout(function(){var e;return e=Math.max(s.$el.width(),i.$el.width()),s.$el.width(e),i.$el.width(e)},300),this.titles.$el.find(".openingTitlesCTA").addClass("openingTitlesCTAFinal"),this.titles.$el.find(".openingTitlesCTA").find(".cta p").css({cursor:"default"}),o=$('<div class="ctaFlufFinal"/>'),u=new SSAsset("interface","pause_bottom"),u.$el.css({margin:"38px auto 0 auto"}),o.append(u.$el),this.titles.$el.find(".openingTitlesCTA").append(o),this.titles.addChild(r),a.$el.insertAfter(this.titles.$el.children()[0]),this.titles.fluorish.$el.remove(),this.titles.diamond.$el.remove(),null},t.prototype.onResetClick=function(){return Analytics.track("payoff_playagain"),document.location.href="http://"+document.location.host,null},t.prototype.onTrailerClick=function(){return Analytics.track("payoff_watch_trailer"),this.oz().appView.area.showVideo(),null},t}(BaseLandingOpenings),LandingPause=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.particles=null,t.prototype.init=function(){return this.particles=new Particles(0,7,40,{x:0,y:$(window).innerHeight()/3,w:$(window).innerWidth(),h:$(window).innerHeight()/3}),this.addChild(this.particles),this.titles=new OpeningTitles(this.oz().locale.get("politePause"),this.oz().locale.get("politePauseCTA"),this.dividers,!0),this.addChild(this.titles),this.titles.$el.find(".openingTitlesCTA").addClass("openingTitlesCTAFinal"),this.titles.$el.find(".openingTitlesCTA").find(".cta").css({"margin-top":"0px"}),$(this.titles.$el.children()[0]).css({"margin-top":"-45px"}),this.titles.$el.find(".openingTitlesCTA").css({"margin-top":"-5px"}),this.titles.$el.find(".openingTitlesCTA").find(".left").css({"margin-top":"0px"}),this.titles.$el.find(".openingTitlesCTA").find(".right").css({"margin-top":"0px"}),this.titles.diamond.$el.css({"margin-top":"-35px"}),this.mouseEnabled(this.me),null},t.prototype.dispose=function(){return null},t}(BaseLandingOpenings),StaticOverlay=function(e){function t(){return this.restoreAddress=__bind(this.restoreAddress,this),this.dispose=__bind(this.dispose,this),this.onClose=__bind(this.onClose,this),this.addCloseButton=__bind(this.addCloseButton,this),this.has=__bind(this.has,this),this.animateComplete=__bind(this.animateComplete,this),this.close=__bind(this.close,this),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.showPage=__bind(this.showPage,this),this.changePage=__bind(this.changePage,this),this.init=__bind(this.init,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="staticOverlay",t.prototype.page=null,t.prototype.lastPage=null,t.prototype.opened=!1,t.prototype.pages=["trailer","credits","opening"],t.prototype.area=null,t.prototype.currentPage=null,t.prototype.init=function(){return this.$el.bind("click",this.close),this.hide(),null},t.prototype.changePage=function(e,t){var n=this;this.empty(),this.page=null,this.currentPage=e,this.$el.removeClass("stormImage"),this.$el.css({"background-color":"rgba(0, 0, 0, .7)",position:"absolute"});switch(e){case"credits":this.addCloseButton(),this.oz().appView.wrapper.pause(),this.oz().appView.pauseEnabled=!1,$(".scene3d").css({"-webkit-filter":"blur(10px)"}),$("#wrapper").css({"-webkit-filter":"blur(10px)"}),this.oz().appView.scene!=="Final"&&(this.oz().appView.footer.mainMenu.hide(!0,function(){return n.oz().appView.footer.mainMenu.$el.css({display:"none"}),n.oz().appView.footer.cr.show(!0),n.oz().appView.footer.mainMenu.showThis(n.oz().appView.footer.mainMenu.openMenuBtn),n.oz().appView.footer.mainMenu.hideThis(n.oz().appView.footer.mainMenu.buttonList)}),this.oz().appView.logo.disable(),this.oz().appView.showMap(!1),this.oz().appView.footer.shareMenu.hide(!0),$("body").unbind("mousemove")),this.page=new Credits;break;case"pause":this.page=new LandingPause;break;case"agree":this.$el.css({"background-color":"rgba(0, 0, 0, 0)",position:"static"}),this.$el.unbind("click",this.close),this.mouseEnabled(!0),this.page=new LandingAgree(t.title,t.cta,t.divider,!1,!1),this.page.on("agreedEnter",this.close)}if(this.page==null)return;return this.$el.css({display:"block"}),this.addChild(this.page),this.page.render(this.showPage),this.lastPage=e,null},t.prototype.showPage=function(){var e;return e=this.page instanceof LandingPause?500:1e3,this.opened=!0,this.show(!0,null,e),null},t.prototype.show=function(e,t,n,r){return e==null&&(e=!1),t==null&&(t=null),n==null&&(n=400),r==null&&(r="linear"),this.visible=!0,e?this.$el.animate({opacity:1},n,r,t):this.$el.css({opacity:1}),null},t.prototype.hide=function(e,t,n,r){var i=this;return e==null&&(e=!1),t==null&&(t=null),n==null&&(n=400),r==null&&(r="linear"),this.visible=!1,e?this.$el.animate({opacity:0},n,r,function(){return i.$el.css({display:"none"}),typeof t=="function"?t():void 0}):this.$el.css({opacity:0,display:"none"}),null},t.prototype.close=function(e){return e==null&&(e=!1),e&&this.oz().appView.scene!=="Final"&&(this.oz().appView.footer.mainMenu.$el.css({display:""}),this.oz().appView.footer.mainMenu.show(!0),this.oz().appView.logo.enable(),this.oz().appView.showMap()),this.currentPage==="credits"&&($(".scene3d").css({"-webkit-filter":"blur(0px)"}),$("#wrapper").css({"-webkit-filter":"blur(0px)"}),this.oz().appView.pauseEnabled=!0,this.oz().appView.wrapper.resume()),this.$el.animate({opacity:"0"},this.animateComplete),null},t.prototype.animateComplete=function(){return this.restoreAddress(),this.opened=!1,this.page=null,this.currentPage=null,this.$el.css({display:"none"}),this.trigger("staticPageClose"),null},t.prototype.has=function(e){return this.pages.indexOf(e)},t.prototype.addCloseButton=function(){var e;return this.closeBtn=(new Abstract).setElement("<div class='sceneClose'></div>"),this.closeBtn.$el.addClass("button_alpha_enabled"),this.closeBtn.dispose=function(){return null},this.closeBtn.$el.bind("click",this.onClose),this.addChild(this.closeBtn),e=new SSAsset("interface","button_close"),this.closeBtn.addChild(e),null},t.prototype.onClose=function(){return this.close(!0),null},t.prototype.dispose=function(){return null},t.prototype.restoreAddress=function(){var e;return e=this.oz().router.area===this.lastPage||this.has(this.oz().router.area)>=0?"":this.oz().router.sub?this.oz().router.area+"/"+this.oz().router.sub:this.oz().router.area,this.oz().router.navigate(e,{trigger:!1}),null},t}(Abstract),Wrapper=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="div",t.prototype.id="wrapper",t}(Abstract),Circle=function(e){function t(){return this.setProgress=__bind(this.setProgress,this),this.draw=__bind(this.draw,this),this.init=__bind(this.init,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="canvas",t.prototype.className="circularProgress",t.prototype.canvas=null,t.prototype.context=null,t.prototype.radius=0,t.prototype.startAngle=0,t.prototype.endAngle=360,t.prototype.stroke=5,t.prototype.progress=0,t.prototype.cClockwise=!1,t.prototype.strokeColor="#FFFFFF",t.prototype.initialize=function(e){return this.radius=e.radius,this.startAngle=e.startAngle,this.endAngle=e.endAngle,this.progress=e.progress,this.stroke=e.stroke,this.strokeColor=e.strokeColor!=null?e.strokeColor:"#FFFFFF",this.cClockwise=e.cClockwise!=null?e.cClockwise:!1,t.__super__.initialize.call(this),null},t.prototype.init=function(){return this.canvas=this.$el[0],this.context=this.canvas.getContext("2d"),this.canvas.width=this.radius*2+this.stroke,this.canvas.height=this.radius*2+this.stroke,this.draw(),null},t.prototype.draw=function(){var e,t,n,r,i;return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),r=this.canvas.width/2,i=this.canvas.height/2,t=this.radius,n=this.startAngle,e=this.progress*this.endAngle/100+this.startAngle,this.context.beginPath(),this.context.arc(r,i,t,n*Math.PI/180,e*Math.PI/180,this.cClockwise),this.context.lineWidth=this.stroke,this.context.strokeStyle=this.strokeColor,this.context.stroke(),null},t.prototype.setProgress=function(e,t,n){var r,i,s=this;return t==null&&(t=!1),n==null&&(n=1e3),t?(r={progress:this.progress},i={progress:e},jQuery(r).animate(i,{duration:n,step:function(){return s.progress=r.progress,s.draw()}})):(this.progress=e,this.draw()),null},t}(Abstract),Slider=function(e){function t(){return this.dispose=__bind(this.dispose,this),this.enabled=__bind(this.enabled,this),this.updateGUI=__bind(this.updateGUI,this),this.setProgress=__bind(this.setProgress,this),this.updateProgress=__bind(this.updateProgress,this),this.onEnterFrame=__bind(this.onEnterFrame,this),this.onMouseUp=__bind(this.onMouseUp,this),this.onMouseDown=__bind(this.onMouseDown,this),this.onMouseMove=__bind(this.onMouseMove,this),this.init=__bind(this.init,this),this.initialize=__bind(this.initialize,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="slider",t.prototype.tagName="div",t.prototype.foreground=null,t.prototype.hit=null,t.prototype.progress=null,t.prototype.handler=null,t.prototype.assetID=null,t.prototype.dragging=!1,t.prototype.mouseCoord={},t.prototype.percent=0,t.prototype.initialize=function(e){return this.assetID=e,t.__super__.initialize.call(this),null},t.prototype.init=function(){return this.foreground=$("<div class='foreground'></div>"),this.$el.prepend(this.foreground),this.progress=$("<div class='progress'></div>"),this.$el.append(this.progress),this.hit=$("<div class='hit'></div>"),this.$el.append(this.hit),this.handler=new SSAsset("interface",this.assetID),this.handler.$el.addClass("handler"),this.addChild(this.handler),this.hit.bind("mousedown",this.onMouseDown),$(document).bind("mousemove",this.onMouseMove),null},t.prototype.onMouseMove=function(e){return this.mouseCoord.x=Math.round(e.pageX),this.mouseCoord.y=Math.round(e.pageY),null},t.prototype.onMouseDown=function(e){return $("body").bind("mouseup",this.onMouseUp),this.dragging=!0,null},t.prototype.onMouseUp=function(e){return $("body").unbind("mouseup"),this.dragging=!1,null},t.prototype.onEnterFrame=function(){var e;return this.dragging&&(e=Math.round(this.mouseCoord.x-this.hit.offset().left),e=e>0?e:0,this.updateGUI(e)),null},t.prototype.updateProgress=function(e){return this.percent=Math.round(e*100/this.hit.width()),this.trigger("SLIDER_CHANGED",this.percent),null},t.prototype.setProgress=function(e){var t;return t=Math.round(e*this.hit.width()/100),this.updateGUI(t),null},t.prototype.updateGUI=function(e){var t;return e=e>this.hit.width()?this.hit.width():e,this.progress.css({width:""+e+"px"}),t=e-this.handler.$el.width()/2-4,t=t<0?0:t,this.handler.$el.css({left:""+t+"px"}),this.updateProgress(e),null},t.prototype.enabled=function(e){return e?(this.$el.css({"pointer-events":"auto"}),this.hit.bind("mousedown",this.onMouseDown),this.$el.stop().animate({opacity:1})):(this.$el.css({"pointer-events":"none"}),this.hit.unbind("mousedown",this.onMouseDown),this.$el.stop().animate({opacity:.5})),null},t.prototype.dispose=function(){return $(document).unbind("mousemove",this.onMouseMove),this.hit.unbind("mousedown",this.onMouseDown),null},t}(Abstract),AppView=function(_super){function AppView(){return this.onAgreed=__bind(this.onAgreed,this),this.showMap=__bind(this.showMap,this),this.addChapter=__bind(this.addChapter,this),this.addFinal=__bind(this.addFinal,this),this.addTermsScreen=__bind(this.addTermsScreen,this),this.hideSubLoader=__bind(this.hideSubLoader,this),this.onWorldLoaded=__bind(this.onWorldLoaded,this),this.onWorldProgress=__bind(this.onWorldProgress,this),this.removeLoading=__bind(this.removeLoading,this),this.onCameraReady=__bind(this.onCameraReady,this),this.isDeepLink=__bind(this.isDeepLink,this),this.checkSub=__bind(this.checkSub,this),this.getCurrentScene=__bind(this.getCurrentScene,this),this.addNewView=__bind(this.addNewView,this),this.changeMapState=__bind(this.changeMapState,this),this.hideArea=__bind(this.hideArea,this),this.changeView=__bind(this.changeView,this),this.changeOpening=__bind(this.changeOpening,this),this.looseFocus=__bind(this.looseFocus,this),this.startFocus=__bind(this.startFocus,this),this.listenToEvents=__bind(this.listenToEvents,this),this.onAssetsProgress=__bind(this.onAssetsProgress,this),this.onAssetsComplete=__bind(this.onAssetsComplete,this),this.render=__bind(this.render,this),AppView.__super__.constructor.apply(this,arguments)}return __extends(AppView,_super),AppView.prototype.footer=null,AppView.prototype.wrapper=null,AppView.prototype.area=null,AppView.prototype.scene=null,AppView.prototype.containerSubArea=null,AppView.prototype.subArea=null,AppView.prototype.map=null,AppView.prototype.logo=null,AppView.prototype["static"]=null,AppView.prototype.loaded=null,AppView.prototype.currentArea=null,AppView.prototype.currentSub=null,AppView.prototype.loading=null,AppView.prototype.renderCanvas3D=null,AppView.prototype.zoetropeTexture=null,AppView.prototype.textureQuality=null,AppView.prototype.displayQuality=null,AppView.prototype.dofEnabled=!1,AppView.prototype.debugMode=!1,AppView.prototype.remoteSounds=!1,AppView.prototype.showInterface=null,AppView.prototype.enablePrefetching=!1,AppView.prototype.pauseEnabled=!0,AppView.prototype.areaLoading=!1,AppView.prototype.areaLoadingPercent=0,AppView.prototype.firstTime=!0,AppView.prototype.chapterInstructionsShowed=!1,AppView.prototype.deepLink=null,AppView.prototype.secondaryLoad=null,AppView.prototype.loadingSecondary=!0,AppView.prototype.secLoadingProgress=null,AppView.prototype.render=function(){return this.deepLink=["","cutout","music","zoetrope","storm"],this.setElement($("body")),this.renderCanvas3D=document.createElement("canvas"),this.renderCanvas3D.className="scene3d",this.addChild(this.renderCanvas3D),this.oz().baseAssets.on("COMPLETE",this.onAssetsComplete),this.oz().baseAssets.on("PROGRESS",this.onAssetsProgress),this.oz().baseAssets.loadBatch(["secondHomeAssets"]),this.textureQuality=(window||document).textureQuality,this.displayQuality=(window||document).displayQuality,this.dofEnabled=(window||document).dof,this.debugMode=QueryString.get("debug")==="on"?!0:!1,this.remoteSounds=QueryString.get("remotesounds")==="on"?!0:!1,this.showInterface=QueryString.get("interface")!=="off"?!0:!1,this.enablePrefetching=QueryString.get("prefetching")==="on"?!0:!1,SoundController.active=!0,QueryString.get("sound")==="off"&&(SoundController.active=!1),this.subLoader=new SubLoader,this.addChild(this.subLoader,!0),this.wrapper=new Wrapper,this.addChild(this.wrapper),this.share=new ShareScene,this["static"]=new StaticOverlay,this.footer=new Footer,this.map=new Map,this.logo=new Logo,this.showMap(!1),this.addChild(this["static"]),this.showInterface&&(this.addChild(this.share),this.addChild(this.footer),this.addChild(this.map),this.addChild(this.logo),this.debugMode&&this.addChild(this.oz().stats.domElement)),this.listenToEvents(),$("#polite").remove(),this},AppView.prototype.onAssetsComplete=function(e){return this.loadingSecondary=!1,this.oz().baseAssets.off("COMPLETE",this.onAssetsComplete),this.oz().baseAssets.off("PROGRESS",this.onAssetsProgress)},AppView.prototype.onAssetsProgress=function(e){return this.secLoadingProgress=e.loaded},AppView.prototype.listenToEvents=function(){return $(window).resize(this.onResize)},AppView.prototype.startFocus=function(){var e;return Analytics.track("resume"),this["static"].page instanceof LandingPause&&this["static"].close(),$(window).bind("blur",this.looseFocus),$(window).unbind("focus",this.startFocus),this["static"].off("staticPageClose",this.startFocus),$(".scene3d").css({"-webkit-filter":"blur(0px)"}),$("#wrapper").css({"-webkit-filter":"blur(0px)"}),this.changeMapState(),this.wrapper.resume(),SoundController.resume(),((e=this.subArea)!=null?!e.instructions:!void 0)&&!this.subLoader.visible&&this.scene!=="Final"&&this["static"].currentPage!=="credits"&&this.currentArea!=="storm"?(this.showMap(),this.footer.mainMenu.show(!0),this.footer.cr.show(!0),this.logo.show(!0)):(this.footer.cr.show(!0),this.logo.show(!0))},AppView.prototype.looseFocus=function(){var e;Analytics.track("pause");if(((e=this.subArea)!=null?!e.instructions.active:!void 0)&&this.pauseEnabled){$(window).unbind("blur",this.looseFocus),$(window).bind("focus",this.startFocus),$(".scene3d").css({"-webkit-filter":"blur(10px)"}),$("#wrapper").css({"-webkit-filter":"blur(10px)"}),SoundController.paused();if(!this["static"].opened)return this.wrapper.pause(),this.changeOpening("pause"),this.showMap(!1),this.footer.mainMenu.hide(!0),this.footer.cr.hide(!0),this.logo.hide(!0)}},AppView.prototype.changeOpening=function(e,t){return this["static"].changePage(e,t)},AppView.prototype.changeView=function(e,t){var n=this;t==null&&(t=null);if(this["static"].has(e)>=0){this["static"].changePage(e),this.addNewView("");return}if(!this["static"].opened){this.addNewView(e,t);return}return this["static"].on("staticPageClose",function(){return n.addNewView(e,t)}),this["static"].close()},AppView.prototype.hideArea=function(e){var t=this;return this.area.hide(!0,function(){return typeof e=="function"?e():void 0},600)},AppView.prototype.changeMapState=function(){return this.map.changeMenuArea(this.scene.toLowerCase())},AppView.prototype.addNewView=function(area,noLoading){var areaClass,currentScene,_this=this;return noLoading==null&&(noLoading=!1),this["static"].off(),this.subArea&&this.subArea.hide(!0,function(){return _this.oz().appView.footer.mainMenu.$el.css({display:""}),_this.oz().appView.logo.enable(),_this.footer.mainMenu.show(!0),_this.wrapper.remove(_this.subArea),_this.wrapper.remove(_this.containerSubArea),_this.subArea=null}),area!==this.currentArea&&(this.currentArea=area,this.loaded||(this.loading=new Loading),currentScene=this.getCurrentScene(area),currentScene!==this.scene?(this.loaded&&(currentScene==="Final"?this.subLoader.visible=!0:this.subLoader.show()),this.scene=currentScene,this.area&&this.wrapper.remove(this.area),areaClass=eval(this.scene),areaClass==null&&(this.scene=currentScene="Carnival",areaClass=eval(this.scene)),this.area=new areaClass,this.area.hide(),this.wrapper.$el.empty(),this.area.render(),this.loading?(Analytics.track("start_loading"),SoundController.init(this.remoteSounds),this.areaLoading=!0,this.wrapper.addChild(this.loading),this.area.on("onWorldProgress",this.onWorldProgress),this.area.on("onWorldLoaded",this.onWorldLoaded),this.logo.disable()):this.subLoader.visible&&(this.firstTime=!1,this.pauseEnabled=!1,SoundController.send("loading_start"),currentScene==="Final"?this.addFinal():(this.areaLoading=!0,this.area.on("onWorldProgress",this.onWorldProgress),this.area.on("onWorldLoaded",this.onWorldLoaded)))):this.checkSub()),this.changeMapState(),null},AppView.prototype.getCurrentScene=function(e){switch(e){case"":return this.scene!==null?this.scene:"Carnival";case"cutout":case"music":case"carnival":return"Carnival";case"zoetrope":case"carnival2":return"Carnival2";case"carnival3":return"Carnival3";case"storm":return"Stormtest";case"final":return"Final"}},AppView.prototype.checkSub=function(){var e,t;Analytics.track("finish_loading"),SoundController.send("loading_end");switch(this.scene.toLowerCase()){case"carnival":Analytics.track("scene3D_1_enterPage");break;case"carnival2":Analytics.track("scene3D_2_enterPage");break;case"storm":case"carnival3":Analytics.track("scene3D_3_enterPage");break;case"final":Analytics.track("payoff_enter_page")}if(!this.currentArea)return this.chapterInstructionsShowed||(this.chapterInstructionsShowed=!0,(t=this.area.chapterInstructions)!=null&&t.activate()),this.area.changeView(null);e=this.isDeepLink(this.currentArea);if(e!=="")return this.area.changeView(e)},AppView.prototype.isDeepLink=function(e){return this.deepLink.indexOf(e)>-1?e:""},AppView.prototype.onCameraReady=function(){switch(this.currentArea){case"cutout":this.subArea=new Cutout;break;case"music":this.subArea=new MusicBox;break;case"zoetrope":this.subArea=new Zoetrope;break;case"storm":this.subArea=new StormInstructions;break;default:this.subArea=null}if(this.subArea)return this.containerSubArea=(new Abstract).setElement("<div></div>"),this.containerSubArea.$el.css({display:"table",width:"100%",height:"100%",position:"absolute"}),this.containerSubArea.dispose=function(){return null},this.wrapper.addChild(this.containerSubArea),this.containerSubArea.addChild(this.subArea)},AppView.prototype.removeLoading=function(){return this.wrapper.remove(this.loading),this.loading=null},AppView.prototype.onWorldProgress=function(e){var t;return this.areaLoadingPercent=Math.round(e*100),t=this.areaLoadingPercent,this.subLoader.visible?this.subLoader.update(t):this.loading.update(t)},AppView.prototype.onWorldLoaded=function(e){var t;return this.areaLoadingPercent=0,this.areaLoading=!1,this.pauseEnabled=!0,typeof (t=this.area).cleanloading=="function"&&t.cleanloading(),this.area.off("onWorldProgress",this.onWorldProgress),this.area.off("onWorldLoaded",this.onWorldLoaded),this.loading?(this.wrapper.addChild(this.area),this["static"].on("staticPageClose",this.onAgreed),this.loading&&this.loading.update(99),this.loading.onAnimateOut(this.oz().agreed?this.addChapter:this.addTermsScreen)):this.oz().agreed?(this.subLoader.on("END_LOADING",this.hideSubLoader),this.subLoader.hideCard()):this.addTermsScreen()},AppView.prototype.hideSubLoader=function(){return this.subLoader.off("END_LOADING",this.hideSubLoader),this.wrapper.addChild(this.area),this.addChapter(),setTimeout(this.subLoader.hide,500)},AppView.prototype.addTermsScreen=function(){return Analytics.track(null,"Google_OZ_landing page"),this.oz().appView.changeOpening("agree",{title:"homeTitle",cta:"homeSub"})},AppView.prototype.addFinal=function(){return this.wrapper.addChild(this.area),this.logo.disable(),this.footer.shareMenu.enableSound(),SoundController.send("end_scene_start"),this.removeLoading(),this.loaded=!0,this.area.show(!0)},AppView.prototype.addChapter=function(){var e=this;this.logo.enable(),this.footer.shareMenu.enableSound();switch(this.scene.toLowerCase()){case"final":SoundController.send("end_scene_start"),this.removeLoading(),this.loaded=!0,this.area.show(!0);return}return this.footer.show(!0),this.footer.mainMenu.showThis(this.footer.mainMenu.openMenuBtn),this.logo.hideGoogleLogos(),this.footer.showCC(),this.removeLoading(),this.loaded=!0,this.area.show(!0,function(){return e.checkSub(),e.showMap()},700)},AppView.prototype.showMap=function(e){e==null&&(e=!0);if(e===!1){this.map.hide(!0);return}switch(this.scene.toLowerCase()){case"carnival":case"carnival2":case"carnival3":case"":case null:return this.map.show(!0)}},AppView.prototype.onAgreed=function(){var e=this;return this["static"].off("staticPageClose",this.onAgreed),this.loading.hide(!0,function(){return e.addChapter(),e.oz().agreed=!0,$(window).bind("blur",e.looseFocus)})},AppView.prototype.showMenu=function(){var e;return(e=this.map)!=null&&e.showMenu(),null},AppView}(Abstract),$(function(){var e,t,n,r,i,s,o,u,a,f=this;return _.templateSettings={interpolate:/\{\{(.+?)\}\}/g},a=window||document,window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,o=null,u=function(e){return a.oz.baseAssets.off("COMPLETE",u),t(),null},t=function(){return Analytics.start(),a.oz.locale=new Locale,a.oz.locale.on("complete",s),a.oz.localeTexture=new LocalisedTexture,null},s=function(){return a.oz.locale.off("complete",s),a.oz.templates=new Templates(a.oz.baseAssets.get("templates").result),a.oz.cam=new WebCam,a.oz.appView=new AppView,a.oz.router=new Router,a.oz.agreed=!1,n(),null},n=function(){return TweenLite.ticker.useRAF(!1),a.oz.appView.render(),a.oz.router.on(Router.EVENT_HASH_CHANGED,a.oz.appView.changeView),a.oz.router.start(),r(),e(),null},i=function(){return window.requestAnimationFrame(r)},r=function(){a.oz.stats.begin(),a.oz.appView.onEnterFrame(),a.oz.stats.end(),window.requestAnimationFrame(r)},e=function(){return a.oz.stats.domElement.style.position="absolute",a.oz.stats.domElement.style.top="0px",null},a.initApp=function(){return a.oz={BASE_PATH:a.location.origin+"/",ss:new CollectionSpriteSheets,baseAssets:new BaseAssets,stats:new Stats,touch:Modernizr.touch},a.oz.baseAssets.on("COMPLETE",u),a.oz.baseAssets.init(["homeAssets"]),null},a.textureQuality=window.textureQuality,a.displayQuality=window.displayQuality,a.dof=window.dof,$("body").bind("touchmove",function(e){return e.preventDefault(),null}),a.initApp()})}).call(this);