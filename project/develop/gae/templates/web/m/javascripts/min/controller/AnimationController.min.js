/*global Poof *//*global Package *//*global Load *//*global Import *//*global Class *//*global console *//*global AnimationController *//*global StatsView */Package("controller",[Import("view.StatsView"),Class("public singleton AnimationController",{_public_static:{EVENT_FRAME:"AnimationController.Event.Frame"},_public:{initialised:!1,running:!1,lastFrameTime:0,AnimationController:function(){this.init()},init:function(){if(this.initialised)return;this.initAnimationFrame()},initAnimationFrame:function(){window.requestAnimationFrameProxy=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}()},start:function(){this.running=!0;window.requestAnimationFrameProxy(Poof.retainContext(this,this.onFrame))},stop:function(){this.running=!1;this.lastFrameTime=0},onFrame:function(){if(this.running){StatsView.getInstance().registerFrame();this.dispatch(AnimationController.EVENT_FRAME,{deltaTime:this.lastFrameTime===0?0:(new Date).getTime()-this.lastFrameTime});window.requestAnimationFrameProxy(Poof.retainContext(this,this.onFrame));this.lastFrameTime=(new Date).getTime()}}}})]);