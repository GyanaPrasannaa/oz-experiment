/*global Package *//*global Import *//*global Class *//*global ClassUtils *//*global View *//*global LayoutAnimation *//*global Template *//*global Copy *//*global TML *//*global NavigationManager *//*global config */Package("mjframe",[Import("mjframe.LayoutAnimation"),Import("mjframe.Template"),Import("mjframe.Copy"),Import("mjframe.TML"),Class("public abstract View",{_public_static:{EVENT_INIT:"View.EventInit",EVENT_SHOW:"View.EventShow",EVENT_HIDE:"View.EventHide",viewId:0},_public:{compiled:!1,copy:null,containerObject:null,contentObject:null,$container:null,templatePath:null,animation:null,View:function(){},init:function(e,t,n){this.compiled=!1;e!==null?this.containerObject=document.getElementById(e):this.containerObject=document.body;this.contentObject=document.createElement("div");this.contentObject.id="view"+View.viewId++;this.containerObject.appendChild(this.contentObject);"$"in window&&(this.$container=$(this.containerObject));this.templatePath=t;this.$el=$(this.contentObject);this.$el.hide();this.copy=n;Template.load(this.templatePath,this.contentObject.id,Poof.retainContext(this,this.onTemplateReady))},show:function(e){this.log("showing view",this.name,"("+e+")");this.beforeShow();typeof e=="undefined"&&(e=LayoutAnimation.DIRECTION_FORWARD);if(this.animation===null){this.$el.css("display","");this.onShow()}else{this.animation.on(LayoutAnimation.EVENT_IN_COMPLETE,Poof.retainContext(this,this.onShow));this.animation.init(this.contentObject,e);this.animation.playIn(this.contentObject,e)}},hide:function(e){this.beforeHide();typeof e=="undefined"&&(e=LayoutAnimation.DIRECTION_FORWARD);if(this.animation===null){this.contentObject.style.display="none";this.onHide()}else{this.animation.on(LayoutAnimation.EVENT_OUT_COMPLETE,Poof.retainContext(this,this.onHide));this.animation.playOut(this.contentObject,e)}},bindEvents:function(){},compilePageLinks:function(){$(this.contentObject).find("a[page]").each(function(){$(this).off("click");this.setAttribute("href",this.getAttribute("page"));$(this).click(function(e){e.preventDefault();NavigationManager.getInstance().goTo($(this).attr("page"))})})},compile:function(){if(this.compiled)return;this.contentObject.innerHTML=TML.compile([this.data,window],this.contentObject.innerHTML);this.compiled=!0},destroy:function(){$(this.contentObject).find("a").off("click");this.containerObject.removeChild(this.contentObject)},loadCopy:function(){Copy.load(window.config.defaultLocale,window.PLATFORM,this.copy,Poof.retainContext(this,this.onCopyLoaded))},onTemplateReady:function(){this.copy!==null&&typeof this.copy!="undefined"?this.loadCopy():this.onViewReady()},onViewReady:function(){this.compile();this.bindEvents();this.compilePageLinks();this.onReady()},onReady:function(){this.dispatch(View.EVENT_INIT)},onCopyLoaded:function(e){var t=e.packageName.split("."),n=window.Package,r,i;for(r=0,i=t.length;r<i;r++)n=n[t[r]];n=n[e.className];this.copy=n.getInstance();this.contentObject.innerHTML=this.copy.compile(this.contentObject.innerHTML);this.onViewReady()},onShow:function(){this.animation&&this.animation.off(LayoutAnimation.EVENT_IN_COMPLETE);this.dispatch(View.EVENT_SHOW)},onHide:function(){this.animation&&this.animation.off(LayoutAnimation.EVENT_OUT_COMPLETE);this.destroy();this.dispatch(View.EVENT_HIDE)},beforeShow:function(){},beforeHide:function(){}}})]);