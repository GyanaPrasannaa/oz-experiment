/*global Poof *//*global Package *//*global Class *//*global AnimationController *//*global ThreeUtil *//*global TweenLite */Package("fx",[Class("public ParticlesFx",{_public:{numParticles:100,size:4,color:"#ffffff",assetName:null,rangeX:600,rangeY:1e3,rangeZ:1e3,dynamic:!1,energy:.2,gyroControl:!1,gyroControlScaleX:1,gyroControlScaleY:1,gyroControlScaleZ:0,gyroDelay:0,particles:[],acceleration:{x:0,y:0,z:0},domObject:null,$domObject:null,ParticlesFx:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){this.numParticles=e||this.numParticles;this.size=t||this.size;this.color=n||this.color;this.dynamic=u||this.dynamic;this.rangeX=r||this.rangeX;this.rangeY=i||this.rangeY;this.rangeZ=s||this.rangeZ;this.assetName=o||this.assetName;this.dynamic=u||this.dynamic;this.energy=a||this.energy;this.gyroControl=f||this.gyroControl;this.gyroControlScaleX=l||this.gyroControlScaleX;this.gyroControlScaleY=c||this.gyroControlScaleY;this.gyroControlScaleZ=h||this.gyroControlScaleZ;this.gyroDelay=p||this.gyroDelay;this.build()},build:function(){var e=$('<div class="particles" />');this.particles=[];for(var t=0;t<this.numParticles;++t){var n=this.generateParticle(this.size,this.color,this.assetName,this.dynamic),r=$(n.domObject);ThreeUtil.getInstance().setPosition(r,Math.random()*this.rangeX*2-this.rangeX,Math.random()*this.rangeY*2-this.rangeY,Math.random()*this.rangeZ*2-this.rangeZ);e.append(n.domObject);this.particles.push(r)}this.$domObject=e;this.domObject=e[0]},start:function(){AnimationController.getInstance().on(AnimationController.EVENT_FRAME+"#particles",Poof.retainContext(this,this.update));$(window).bind("devicemotion.particles",Poof.retainContext(this,this.onDeviceMotion))},stop:function(){AnimationController.getInstance().off(AnimationController.EVENT_FRAME);$(window).unbind("devicemotion.particles")},generateParticle:function(e,t,n,r){var i=$('<div class="particle" />').width(e).height(e).css("position","absolute");n?i.addClass("asset "+n):i.css("background-color",t);i.css("opacity",Math.random()*.5);var s={domObject:i,dynamic:r};return s},update:function(e){if(this.dynamic)for(var t=0;t<this.particles.length;++t)Math.random()<this.energy&&TweenLite.to(this.particles[t],.1,{css:{top:"100px",left:"100px"}});this.gyroControl&&ThreeUtil.getInstance().rotate(this.$domObject,(this.acceleration.y+6)*this.gyroControlScaleX,this.acceleration.x*this.gyroControlScaleY,this.acceleration.z*this.gyroControlScaleZ)},onDeviceMotion:function(e){TweenLite.to(this.acceleration,this.gyroDelay,{x:e.originalEvent.accelerationIncludingGravity.x,y:e.originalEvent.accelerationIncludingGravity.y,z:e.originalEvent.accelerationIncludingGravity.z})}}})]);