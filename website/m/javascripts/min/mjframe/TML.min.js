/*global Package *//*global Import *//*global Class *//*global ClassUtils *//*global TML */Package("mjframe",[Class("public TML",{_public_static:{REGEXP_TAG_VARIABLE:/\{\{\@[a-zA-Z0-9\.\_]*\}\}/g,REGEXP_LOGIC_IF_TRUE:/\{\{IF true\}\}/g,compile:function(e,t){var n=t;for(var r in e){var i=e[r];i!==null&&(n=TML.compileModel(i,n))}n=TML.compileModel(null,n,!0);n=TML.compileLogic(n);return n},compileModel:function(e,t,n){var r=t.match(TML.REGEXP_TAG_VARIABLE);if(!r)return t;var i,s;for(i=0,s=r.length;i<s;i++){var o=r[i],u=TML.resolveVariable(e,o);u!==null&&typeof u!="undefined"?t=t.replace(o,u):n&&(t=t.replace(o,"{{UNDEFINED}}"))}return t},compileLogic:function(e){var t=e.indexOf("{{IF true}}"),n,r,i,s;while(t!==-1){i=e.indexOf("{{ELSE}}",t);s=e.indexOf("{{/IF}}",t);i!==-1?e=e.substring(0,i)+e.substring(s+"{{/IF}}".length,e.length):e=e.substring(0,s)+e.substring(s+"{{/IF}}".length,e.length);e=e.substring(0,t)+e.substring(t+"{{IF true}}".length,e.length);t=e.indexOf("{{IF true}}")}r="{{IF false}}";t=e.indexOf(r);n=e.indexOf("{{IF {{UNDEFINED}}}}");if(n!==-1&&(t===-1||n<t)){t=n;r="{{IF {{UNDEFINED}}}}"}while(t!==-1){i=e.indexOf("{{ELSE}}",t);s=e.indexOf("{{/IF}}",t);if(i!==-1){e=e.substring(0,s)+e.substring(s+"{{/IF}}".length,e.length);e=e.substring(0,t)+e.substring(i+"{{ELSE}}".length,e.length)}else e=e.substring(0,t)+e.substring(s+"{{/IF}}".length,e.length);r="{{IF false}}";t=e.indexOf(r);n=e.indexOf("{{IF {{UNDEFINED}}}}");if(n!==-1&&(t===-1||n<t)){t=n;r="{{IF {{UNDEFINED}}}}"}}return e},resolveVariable:function(e,t){t=t.substring(3,t.length-2);var n=t.split("."),r=e;if(r===null||typeof r=="undefined")return null;var i,s;for(i=0,s=n.length;i<s;i++){if(!(n[i]in r))return null;r=r[n[i]]}return r}}})]);