/*global Poof *//*global Package *//*global Load *//*global Import *//*global Class *//*global console */Package("view",[Import("mjframe.View"),Import("util.ThreeUtil"),Class("public singleton PreloaderCard extends View",{_public_static:{SPINNER_ROTATION_SPEED:1.5},_public_static:{ACCELERATION_MULTIPLER_X:-6,ACCELERATION_MULTIPLER_Y:-6,ACCELERATION_OFFSET_X:0,ACCELERATION_OFFSET_Y:6,ACCELERATION_EASE_TIME:.3,EVENT_COMPLETE:"PreloaderCard.Event.Complete"},_public:{ready:!1,shown:!1,cardProperties:{posX:0,posY:0,posZ:0,rotX:90,rotY:-360,rotZ:0,opacity:0},cardFlipAngle:0,accelerationControlled:!1,$card:null,$progress:null,PreloaderCard:function(){this._super();this.init("preloader","view.PreloaderCardView","PreloaderCard")},onReady:function(){this.ready=!0;this.initView();this.$el.css("display","");this.shown||this.showReady()},compile:function(){this._super();this.$card=$(".preloaderContainer .container3d");this.$progress=$(".preloaderContainer .progress")},show:function(e){this.ready&&this.showReady()},initView:function(){ThreeUtil.getInstance().setPerspective(this.$card,200);this.$card.css("opacity",0)},showReady:function(){this.shown=!0;this.$container.fadeIn();this.startAnimation();this.animateIn()},hide:function(e){this.stopAnimation();this.$container.fadeOut()},startAnimation:function(){AnimationController.getInstance().on(AnimationController.EVENT_FRAME,Poof.retainContext(this,this.onFrame));$(window).bind("devicemotion",Poof.retainContext(this,this.onDeviceMotion));this.$container.bind("click",Poof.retainContext(this,this.onCardClick))},stopAnimation:function(){AnimationController.getInstance().off(AnimationController.EVENT_FRAME);$(window).off("devicemotion");this.$container.off("click")},animateIn:function(){TweenLite.to(this.cardProperties,1,{opacity:1});TweenLite.to(this.cardProperties,2,{rotX:0,rotY:0,ease:Power4.easeInOut,onComplete:Poof.retainContext(this,this.onAnimateInComplete)})},animateOut:function(){this.accelerationControlled=!1;TweenLite.to(this.cardProperties,1,{opacity:0,delay:1});TweenLite.to(this.cardProperties,2,{rotX:270,rotY:0,ease:Power4.easeInOut,onComplete:Poof.retainContext(this,this.onAnimateOutComplete)})},setProgress:function(e){this.$progress&&this.$progress.text(Math.round(e).toString())},onCardClick:function(e){TweenLite.to(this.cardProperties,1,{rotZ:this.cardFlipAngle+=180,ease:Power4.easeInOut})},onTweenUpdate:function(){this.$card.css("opacity",this.cardProperties.opacity)},onAnimateInComplete:function(){this.accelerationControlled=!0},onAnimateOutComplete:function(){this.hide();this.dispatch(PreloaderCard.EVENT_COMPLETE)},onDeviceMotion:function(e){if(this.accelerationControlled){var t=e.originalEvent.accelerationIncludingGravity,n=(t.y+PreloaderCard.ACCELERATION_OFFSET_Y)*PreloaderCard.ACCELERATION_MULTIPLER_X,r=(t.x+PreloaderCard.ACCELERATION_OFFSET_X)*PreloaderCard.ACCELERATION_MULTIPLER_Y;TweenLite.to(this.cardProperties,PreloaderCard.ACCELERATION_EASE_TIME,{rotX:n,rotY:r})}},onFrame:function(e){this.$card.css("opacity",this.cardProperties.opacity);ThreeUtil.getInstance().rotate(this.$card,this.cardProperties.rotX,this.cardProperties.rotY,this.cardProperties.rotZ)}}})]);