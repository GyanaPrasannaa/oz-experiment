/*global Poof *//*global Package *//*global Import *//*global Class *//*global RotationController */Package("controller",[Import("view.StatsView"),Class("public singleton RotationController",{_public_static:{EVENT_ROTATION:"RotationController.Event.Motion",GYRO_MULTIPLIER:8*Math.PI/180,GYRO_OFFSET_Y:3},_public:{initialised:!1,running:!1,lastFrameTime:0,RotationController:function(){},bindEvents:function(){window.DeviceOrientationEvent?$(window).bind("deviceorientation.rotationcontroller",Poof.retainContext(this,this.onDeviceOrientation)):window.DeviceMotionEvent&&$(window).bind("devicemotion.rotationcontroller",Poof.retainContext(this,this.onDeviceMotion))},unbindEvents:function(){$(window).unbind("deviceorientation.rotationcontroller");$(window).unbind("devicemotion.rotationcontroller")},start:function(){this.running=!0;this.bindEvents()},stop:function(){this.running=!1;this.unbindEvents()},applyRotation:function(e){this.dispatchEvent(RotationController.EVENT_ROTATION,{rotation:e})},onDeviceMotion:function(e){if(this.accelerationControlled){var t=e.originalEvent.accelerationIncludingGravity;this.applyRotation(t)}},onDeviceOrientation:function(e){if(this.accelerationControlled){var t=e.originalEvent.gamma,n=e.originalEvent.beta;if(t>90||t<-90){n=180-n;t=t<0?-(180+t):-(t-180)}n>80&&n<100&&(t/=5);var r={x:t*RotationController.GYRO_MULTIPLIER,y:-n*RotationController.GYRO_MULTIPLIER+RotationController.GYRO_OFFSET_Y,z:0};this.applyRotation(r)}}}})]);